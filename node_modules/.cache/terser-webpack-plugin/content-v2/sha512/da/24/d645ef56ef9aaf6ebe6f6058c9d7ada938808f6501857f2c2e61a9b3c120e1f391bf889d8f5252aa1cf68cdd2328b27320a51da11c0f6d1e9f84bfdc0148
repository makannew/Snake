{"code":"!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,\"a\",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p=\"\",i(i.s=0)}([function(e,t,i){window.THREE=i(1),window.CANNON=i(2),i(3)},function(e,t,i){!function(e){function t(){}function i(e,t){this.x=e||0,this.y=t||0}function n(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error(\"THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.\")}function r(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1}function o(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}function a(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error(\"THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.\")}function s(e,t,n,r,o,l,c,h,u,p){Object.defineProperty(this,\"id\",{value:no++}),this.uuid=eo.generateUUID(),this.name=\"\",this.image=void 0!==e?e:s.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:s.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:1001,this.wrapT=void 0!==r?r:1001,this.magFilter=void 0!==o?o:1006,this.minFilter=void 0!==l?l:1008,this.anisotropy=void 0!==u?u:1,this.format=void 0!==c?c:1023,this.type=void 0!==h?h:1009,this.offset=new i(0,0),this.repeat=new i(1,1),this.center=new i(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new a,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==p?p:3e3,this.version=0,this.onUpdate=null}function l(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1}function c(e,t,i){this.width=e,this.height=t,this.scissor=new l(0,0,e,t),this.scissorTest=!1,this.viewport=new l(0,0,e,t),i=i||{},this.texture=new s(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:1006,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function h(e,t,i){c.call(this,e,t,i),this.activeMipMapLevel=this.activeCubeFace=0}function u(e,t,i,n,r,o,a,l,c,h,u,p){s.call(this,null,o,a,l,c,h,n,r,u,p),this.image={data:e,width:t,height:i},this.magFilter=void 0!==c?c:1003,this.minFilter=void 0!==h?h:1003,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1}function p(e,t){this.min=void 0!==e?e:new o(1/0,1/0,1/0),this.max=void 0!==t?t:new o(-1/0,-1/0,-1/0)}function d(e,t){this.center=void 0!==e?e:new o,this.radius=void 0!==t?t:0}function f(e,t){this.normal=void 0!==e?e:new o(1,0,0),this.constant=void 0!==t?t:0}function m(e,t,i,n,r,o){this.planes=[void 0!==e?e:new f,void 0!==t?t:new f,void 0!==i?i:new f,void 0!==n?n:new f,void 0!==r?r:new f,void 0!==o?o:new f]}function g(e){var t,i={};for(t in e)for(var n in i[t]={},e[t]){var r=e[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?i[t][n]=r.clone():Array.isArray(r)?i[t][n]=r.slice():i[t][n]=r}return i}function v(e){for(var t={},i=0;i<e.length;i++){var n,r=g(e[i]);for(n in r)t[n]=r[n]}return t}function y(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}function x(){function e(r,o){!1!==i&&(n(r,o),t.requestAnimationFrame(e))}var t=null,i=!1,n=null;return{start:function(){!0!==i&&null!==n&&(t.requestAnimationFrame(e),i=!0)},stop:function(){i=!1},setAnimationLoop:function(e){n=e},setContext:function(e){t=e}}}function b(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var n=t.get(i);n&&(e.deleteBuffer(n.buffer),t.delete(i))},update:function(i,n){i.isInterleavedBufferAttribute&&(i=i.data);var r=t.get(i);if(void 0===r)t.set(i,function(t,i){var n=t.array,r=t.dynamic?35048:35044,o=e.createBuffer();return e.bindBuffer(i,o),e.bufferData(i,n,r),t.onUploadCallback(),i=5126,n instanceof Float32Array?i=5126:n instanceof Float64Array?console.warn(\"THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.\"):n instanceof Uint16Array?i=5123:n instanceof Int16Array?i=5122:n instanceof Uint32Array?i=5125:n instanceof Int32Array?i=5124:n instanceof Int8Array?i=5120:n instanceof Uint8Array&&(i=5121),{buffer:o,type:i,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(i,n));else if(r.version<i.version){var o=i,a=o.array,s=o.updateRange;e.bindBuffer(n,r.buffer),!1===o.dynamic?e.bufferData(n,a,35044):-1===s.count?e.bufferSubData(n,0,a):0===s.count?console.error(\"THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.\"):(e.bufferSubData(n,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1),r.version=i.version}}}}function w(e,t,i,n,r,a){this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new o,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new y,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==a?a:0}function M(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||M.DefaultOrder}function E(){this.mask=1}function _(){Object.defineProperty(this,\"id\",{value:co++}),this.uuid=eo.generateUUID(),this.name=\"\",this.type=\"Object3D\",this.parent=null,this.children=[],this.up=_.DefaultUp.clone();var e=new o,t=new M,i=new r,s=new o(1,1,1);t.onChange((function(){i.setFromEuler(t,!1)})),i.onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new n},normalMatrix:{value:new a}}),this.matrix=new n,this.matrixWorld=new n,this.matrixAutoUpdate=_.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new E,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function S(){Object.defineProperty(this,\"id\",{value:ho+=2}),this.uuid=eo.generateUUID(),this.name=\"\",this.type=\"Geometry\",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function T(e,t,i){if(Array.isArray(e))throw new TypeError(\"THREE.BufferAttribute: array should be a Typed Array.\");this.name=\"\",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function A(e,t,i){T.call(this,new Int8Array(e),t,i)}function C(e,t,i){T.call(this,new Uint8Array(e),t,i)}function R(e,t,i){T.call(this,new Uint8ClampedArray(e),t,i)}function L(e,t,i){T.call(this,new Int16Array(e),t,i)}function P(e,t,i){T.call(this,new Uint16Array(e),t,i)}function N(e,t,i){T.call(this,new Int32Array(e),t,i)}function B(e,t,i){T.call(this,new Uint32Array(e),t,i)}function z(e,t,i){T.call(this,new Float32Array(e),t,i)}function O(e,t,i){T.call(this,new Float64Array(e),t,i)}function F(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function I(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}function D(){Object.defineProperty(this,\"id\",{value:uo+=2}),this.uuid=eo.generateUUID(),this.name=\"\",this.type=\"BufferGeometry\",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0},this.userData={}}function H(e,t,i,n,r,o){S.call(this),this.type=\"BoxGeometry\",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new j(e,t,i,n,r,o)),this.mergeVertices()}function j(e,t,i,n,r,a){function s(e,t,i,n,r,a,s,m,g,v,y){var x=a/g,b=s/v,w=a/2,M=s/2,E=m/2;s=g+1;var _,S,T=v+1,A=a=0,C=new o;for(S=0;S<T;S++){var R=S*b-M;for(_=0;_<s;_++)C[e]=(_*x-w)*n,C[t]=R*r,C[i]=E,h.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[i]=0<m?1:-1,u.push(C.x,C.y,C.z),p.push(_/g),p.push(1-S/v),a+=1}for(S=0;S<v;S++)for(_=0;_<g;_++)e=d+_+s*(S+1),t=d+(_+1)+s*(S+1),i=d+(_+1)+s*S,c.push(d+_+s*S,e,i),c.push(e,t,i),A+=6;l.addGroup(f,A,y),f+=A,d+=a}D.call(this),this.type=\"BoxBufferGeometry\",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};var l=this;e=e||1,t=t||1,i=i||1,n=Math.floor(n)||1,r=Math.floor(r)||1,a=Math.floor(a)||1;var c=[],h=[],u=[],p=[],d=0,f=0;s(\"z\",\"y\",\"x\",-1,-1,i,t,e,a,r,0),s(\"z\",\"y\",\"x\",1,-1,i,t,-e,a,r,1),s(\"x\",\"z\",\"y\",1,1,e,i,t,n,a,2),s(\"x\",\"z\",\"y\",1,-1,e,i,-t,n,a,3),s(\"x\",\"y\",\"z\",1,-1,e,t,i,n,r,4),s(\"x\",\"y\",\"z\",-1,-1,e,t,-i,n,r,5),this.setIndex(c),this.addAttribute(\"position\",new z(h,3)),this.addAttribute(\"normal\",new z(u,3)),this.addAttribute(\"uv\",new z(p,2))}function V(e,t,i,n){S.call(this),this.type=\"PlaneGeometry\",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new k(e,t,i,n)),this.mergeVertices()}function k(e,t,i,n){D.call(this),this.type=\"PlaneBufferGeometry\",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};var r=(e=e||1)/2,o=(t=t||1)/2,a=(i=Math.floor(i)||1)+1,s=(n=Math.floor(n)||1)+1,l=e/i,c=t/n,h=[],u=[],p=[],d=[];for(e=0;e<s;e++){var f=e*c-o;for(t=0;t<a;t++)u.push(t*l-r,-f,0),p.push(0,0,1),d.push(t/i),d.push(1-e/n)}for(e=0;e<n;e++)for(t=0;t<i;t++)r=t+a*(e+1),o=t+1+a*(e+1),s=t+1+a*e,h.push(t+a*e,r,s),h.push(r,o,s);this.setIndex(h),this.addAttribute(\"position\",new z(u,3)),this.addAttribute(\"normal\",new z(p,3)),this.addAttribute(\"uv\",new z(d,2))}function U(){Object.defineProperty(this,\"id\",{value:po++}),this.uuid=eo.generateUUID(),this.name=\"\",this.type=\"Material\",this.lights=this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function G(e){U.call(this),this.type=\"ShaderMaterial\",this.defines={},this.uniforms={},this.vertexShader=\"void main() {\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n}\",this.fragmentShader=\"void main() {\\n\\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\\n}\",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error(\"THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.\"),this.setValues(e))}function W(e,t){this.origin=void 0!==e?e:new o,this.direction=void 0!==t?t:new o}function q(e,t,i){this.a=void 0!==e?e:new o,this.b=void 0!==t?t:new o,this.c=void 0!==i?i:new o}function Q(e){U.call(this),this.type=\"MeshBasicMaterial\",this.color=new y(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap=\"round\",this.lights=this.morphTargets=this.skinning=!1,this.setValues(e)}function X(e,t){_.call(this),this.type=\"Mesh\",this.geometry=void 0!==e?e:new D,this.material=void 0!==t?t:new Q({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function Y(e,t,i,n){function r(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,n)}var o,a,s=new y(0),l=0,c=null,h=0;return{getClearColor:function(){return s},setClearColor:function(e,t){s.set(e),r(s,l=void 0!==t?t:1)},getClearAlpha:function(){return l},setClearAlpha:function(e){r(s,l=e)},render:function(t,n,u,p){null===(n=n.background)?(r(s,l),c=null,h=0):n&&n.isColor&&(r(n,1),p=!0,c=null,h=0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),n&&(n.isCubeTexture||n.isWebGLRenderTargetCube)?(void 0===a&&((a=new X(new j(1,1,1),new G({type:\"BackgroundCubeMaterial\",uniforms:g(lo.cube.uniforms),vertexShader:lo.cube.vertexShader,fragmentShader:lo.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute(\"normal\"),a.geometry.removeAttribute(\"uv\"),a.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(a.material,\"map\",{get:function(){return this.uniforms.tCube.value}}),i.update(a)),p=n.isWebGLRenderTargetCube?n.texture:n,a.material.uniforms.tCube.value=p,a.material.uniforms.tFlip.value=n.isWebGLRenderTargetCube?1:-1,c===n&&h===p.version||(a.material.needsUpdate=!0,c=n,h=p.version),t.unshift(a,a.geometry,a.material,0,null)):n&&n.isTexture&&(void 0===o&&((o=new X(new k(2,2),new G({type:\"BackgroundMaterial\",uniforms:g(lo.background.uniforms),vertexShader:lo.background.vertexShader,fragmentShader:lo.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute(\"normal\"),Object.defineProperty(o.material,\"map\",{get:function(){return this.uniforms.t2D.value}}),i.update(o)),o.material.uniforms.t2D.value=n,!0===n.matrixAutoUpdate&&n.updateMatrix(),o.material.uniforms.uvTransform.value.copy(n.matrix),c===n&&h===n.version||(o.material.needsUpdate=!0,c=n,h=n.version),t.unshift(o,o.geometry,o.material,0,null))}}}function Z(e,t,i,n){var r;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.update(n,r)},this.renderInstances=function(o,a,s){if(n.isWebGL2)var l=e;else if(null===(l=t.get(\"ANGLE_instanced_arrays\")))return void console.error(\"THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");l[n.isWebGL2?\"drawArraysInstanced\":\"drawArraysInstancedANGLE\"](r,a,s,o.maxInstancedCount),i.update(s,r,o.maxInstancedCount)}}function J(e,t,i){function n(t){if(\"highp\"===t){if(0<e.getShaderPrecisionFormat(35633,36338).precision&&0<e.getShaderPrecisionFormat(35632,36338).precision)return\"highp\";t=\"mediump\"}return\"mediump\"===t&&0<e.getShaderPrecisionFormat(35633,36337).precision&&0<e.getShaderPrecisionFormat(35632,36337).precision?\"mediump\":\"lowp\"}var r,o=\"undefined\"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,a=void 0!==i.precision?i.precision:\"highp\",s=n(a);s!==a&&(console.warn(\"THREE.WebGLRenderer:\",a,\"not supported, using\",s,\"instead.\"),a=s),i=!0===i.logarithmicDepthBuffer,s=e.getParameter(34930);var l=e.getParameter(35660),c=e.getParameter(3379),h=e.getParameter(34076),u=e.getParameter(34921),p=e.getParameter(36347),d=e.getParameter(36348),f=e.getParameter(36349),m=0<l,g=o||!!t.get(\"OES_texture_float\");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var i=t.get(\"EXT_texture_filter_anisotropic\");return r=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:i,maxTextures:s,maxVertexTextures:l,maxTextureSize:c,maxCubemapSize:h,maxAttributes:u,maxVertexUniforms:p,maxVaryings:d,maxFragmentUniforms:f,vertexTextures:m,floatFragmentTextures:g,floatVertexTextures:m&&g}}function K(){function e(){h.value!==n&&(h.value=n,h.needsUpdate=0<r),i.numPlanes=r,i.numIntersection=0}function t(e,t,n,r){var o=null!==e?e.length:0,a=null;if(0!==o){if(a=h.value,!0!==r||null===a)for(r=n+4*o,t=t.matrixWorldInverse,c.getNormalMatrix(t),(null===a||a.length<r)&&(a=new Float32Array(r)),r=0;r!==o;++r,n+=4)l.copy(e[r]).applyMatrix4(t,c),l.normal.toArray(a,n),a[n+3]=l.constant;h.value=a,h.needsUpdate=!0}return i.numPlanes=o,a}var i=this,n=null,r=0,o=!1,s=!1,l=new f,c=new a,h={value:null,needsUpdate:!1};this.uniform=h,this.numIntersection=this.numPlanes=0,this.init=function(e,i,a){var s=0!==e.length||i||0!==r||o;return o=i,n=t(e,a,0),r=e.length,s},this.beginShadows=function(){s=!0,t(null)},this.endShadows=function(){s=!1,e()},this.setState=function(i,a,l,c,u,p){if(!o||null===i||0===i.length||s&&!l)s?t(null):e();else{var d=4*(l=s?0:r),f=u.clippingState||null;for(h.value=f,f=t(i,c,d,p),i=0;i!==d;++i)f[i]=n[i];u.clippingState=f,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=l}}}function $(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];switch(i){case\"WEBGL_depth_texture\":var n=e.getExtension(\"WEBGL_depth_texture\")||e.getExtension(\"MOZ_WEBGL_depth_texture\")||e.getExtension(\"WEBKIT_WEBGL_depth_texture\");break;case\"EXT_texture_filter_anisotropic\":n=e.getExtension(\"EXT_texture_filter_anisotropic\")||e.getExtension(\"MOZ_EXT_texture_filter_anisotropic\")||e.getExtension(\"WEBKIT_EXT_texture_filter_anisotropic\");break;case\"WEBGL_compressed_texture_s3tc\":n=e.getExtension(\"WEBGL_compressed_texture_s3tc\")||e.getExtension(\"MOZ_WEBGL_compressed_texture_s3tc\")||e.getExtension(\"WEBKIT_WEBGL_compressed_texture_s3tc\");break;case\"WEBGL_compressed_texture_pvrtc\":n=e.getExtension(\"WEBGL_compressed_texture_pvrtc\")||e.getExtension(\"WEBKIT_WEBGL_compressed_texture_pvrtc\");break;default:n=e.getExtension(i)}return null===n&&console.warn(\"THREE.WebGLRenderer: \"+i+\" extension not supported.\"),t[i]=n}}}function ee(e,t,i){function n(e){var a=e.target;for(var s in null!==(e=r[a.id]).index&&t.remove(e.index),e.attributes)t.remove(e.attributes[s]);a.removeEventListener(\"dispose\",n),delete r[a.id],(s=o[e.id])&&(t.remove(s),delete o[e.id]),i.memory.geometries--}var r={},o={};return{get:function(e,t){var o=r[t.id];return o||(t.addEventListener(\"dispose\",n),t.isBufferGeometry?o=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new D).setFromObject(e)),o=t._bufferGeometry),r[t.id]=o,i.memory.geometries++,o)},update:function(e){var i=e.index,n=e.attributes;for(var r in null!==i&&t.update(i,34963),n)t.update(n[r],34962);for(r in e=e.morphAttributes){n=0;for(var o=(i=e[r]).length;n<o;n++)t.update(i[n],34962)}},getWireframeAttribute:function(e){var i=o[e.id];if(i)return i;i=[];var n=e.index,r=e.attributes;if(null!==n){r=0;for(var a=(n=n.array).length;r<a;r+=3){var s=n[r+0],l=n[r+1],c=n[r+2];i.push(s,l,l,c,c,s)}}else for(n=r.position.array,r=0,a=n.length/3-1;r<a;r+=3)s=r+0,l=r+1,c=r+2,i.push(s,l,l,c,c,s);return i=new(65535<I(i)?B:P)(i,1),t.update(i,34963),o[e.id]=i}}}function te(e,t,i,n){var r,o,a;this.setMode=function(e){r=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(r,n,o,t*a),i.update(n,r)},this.renderInstances=function(s,l,c){if(n.isWebGL2)var h=e;else if(null===(h=t.get(\"ANGLE_instanced_arrays\")))return void console.error(\"THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");h[n.isWebGL2?\"drawElementsInstanced\":\"drawElementsInstancedANGLE\"](r,c,o,l*a,s.maxInstancedCount),i.update(c,r,s.maxInstancedCount)}}function ie(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(n=n||1,t.calls++,i){case 4:t.triangles+=e/3*n;break;case 5:case 6:t.triangles+=n*(e-2);break;case 1:t.lines+=e/2*n;break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error(\"THREE.WebGLInfo: Unknown draw mode:\",i)}}}}function ne(e,t){return Math.abs(t[1])-Math.abs(e[1])}function re(e){var t={},i=new Float32Array(8);return{update:function(n,r,o,a){var s=n.morphTargetInfluences,l=s.length;if(void 0===(n=t[r.id])){n=[];for(var c=0;c<l;c++)n[c]=[c,0];t[r.id]=n}var h=o.morphTargets&&r.morphAttributes.position;for(o=o.morphNormals&&r.morphAttributes.normal,c=0;c<l;c++){var u=n[c];0!==u[1]&&(h&&r.removeAttribute(\"morphTarget\"+c),o&&r.removeAttribute(\"morphNormal\"+c))}for(c=0;c<l;c++)(u=n[c])[0]=c,u[1]=s[c];for(n.sort(ne),c=0;8>c;c++)(u=n[c])&&(s=u[0],l=u[1])?(h&&r.addAttribute(\"morphTarget\"+c,h[s]),o&&r.addAttribute(\"morphNormal\"+c,o[s]),i[c]=l):i[c]=0;a.getUniforms().setValue(e,\"morphTargetInfluences\",i)}}}function oe(e,t){var i={};return{update:function(n){var r=t.render.frame,o=n.geometry,a=e.get(n,o);return i[a.id]!==r&&(o.isGeometry&&a.updateFromObject(n),e.update(a),i[a.id]=r),a},dispose:function(){i={}}}}function ae(e,t,i,n,r,o,a,l,c,h){e=void 0!==e?e:[],s.call(this,e,void 0!==t?t:301,i,n,r,o,a,l,c,h),this.flipY=!1}function se(e,t,i,n){s.call(this,null),this.image={data:e,width:t,height:i,depth:n},this.minFilter=this.magFilter=1003,this.flipY=this.generateMipmaps=!1}function le(e,t,i){var n=e[0];if(0>=n||0<n)return e;var r=t*i,o=vo[r];if(void 0===o&&(o=new Float32Array(r),vo[r]=o),0!==t)for(n.toArray(o,0),n=1,r=0;n!==t;++n)r+=i,e[n].toArray(o,r);return o}function ce(e,t){if(e.length!==t.length)return!1;for(var i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function he(e,t){for(var i=0,n=t.length;i<n;i++)e[i]=t[i]}function ue(e,t){var i=yo[t];void 0===i&&(i=new Int32Array(t),yo[t]=i);for(var n=0;n!==t;++n)i[n]=e.allocTextureUnit();return i}function pe(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function de(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function fe(e,t){var i=this.cache;void 0!==t.x?i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y):ce(i,t)||(e.uniform2fv(this.addr,t),he(i,t))}function me(e,t){var i=this.cache;void 0!==t.x?i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z):void 0!==t.r?i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b):ce(i,t)||(e.uniform3fv(this.addr,t),he(i,t))}function ge(e,t){var i=this.cache;void 0!==t.x?i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w):ce(i,t)||(e.uniform4fv(this.addr,t),he(i,t))}function ve(e,t){var i=this.cache,n=t.elements;void 0===n?ce(i,t)||(e.uniformMatrix2fv(this.addr,!1,t),he(i,t)):ce(i,n)||(wo.set(n),e.uniformMatrix2fv(this.addr,!1,wo),he(i,n))}function ye(e,t){var i=this.cache,n=t.elements;void 0===n?ce(i,t)||(e.uniformMatrix3fv(this.addr,!1,t),he(i,t)):ce(i,n)||(bo.set(n),e.uniformMatrix3fv(this.addr,!1,bo),he(i,n))}function xe(e,t){var i=this.cache,n=t.elements;void 0===n?ce(i,t)||(e.uniformMatrix4fv(this.addr,!1,t),he(i,t)):ce(i,n)||(xo.set(n),e.uniformMatrix4fv(this.addr,!1,xo),he(i,n))}function be(e,t,i){var n=this.cache,r=i.allocTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(t||fo,r)}function we(e,t,i){var n=this.cache,r=i.allocTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||mo,r)}function Me(e,t,i){var n=this.cache,r=i.allocTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||go,r)}function Ee(e,t){var i=this.cache;ce(i,t)||(e.uniform2iv(this.addr,t),he(i,t))}function _e(e,t){var i=this.cache;ce(i,t)||(e.uniform3iv(this.addr,t),he(i,t))}function Se(e,t){var i=this.cache;ce(i,t)||(e.uniform4iv(this.addr,t),he(i,t))}function Te(e,t){var i=this.cache;ce(i,t)||(e.uniform1fv(this.addr,t),he(i,t))}function Ae(e,t){var i=this.cache;ce(i,t)||(e.uniform1iv(this.addr,t),he(i,t))}function Ce(e,t){ce(this.cache,t=le(t,this.size,2))||(e.uniform2fv(this.addr,t),this.updateCache(t))}function Re(e,t){ce(this.cache,t=le(t,this.size,3))||(e.uniform3fv(this.addr,t),this.updateCache(t))}function Le(e,t){ce(this.cache,t=le(t,this.size,4))||(e.uniform4fv(this.addr,t),this.updateCache(t))}function Pe(e,t){ce(this.cache,t=le(t,this.size,4))||(e.uniformMatrix2fv(this.addr,!1,t),this.updateCache(t))}function Ne(e,t){ce(this.cache,t=le(t,this.size,9))||(e.uniformMatrix3fv(this.addr,!1,t),this.updateCache(t))}function Be(e,t){ce(this.cache,t=le(t,this.size,16))||(e.uniformMatrix4fv(this.addr,!1,t),this.updateCache(t))}function ze(e,t,i){var n=this.cache,r=t.length,o=ue(i,r);for(!1===ce(n,o)&&(e.uniform1iv(this.addr,o),he(n,o)),e=0;e!==r;++e)i.setTexture2D(t[e]||fo,o[e])}function Oe(e,t,i){var n=this.cache,r=t.length,o=ue(i,r);for(!1===ce(n,o)&&(e.uniform1iv(this.addr,o),he(n,o)),e=0;e!==r;++e)i.setTextureCube(t[e]||go,o[e])}function Fe(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return pe;case 35664:return fe;case 35665:return me;case 35666:return ge;case 35674:return ve;case 35675:return ye;case 35676:return xe;case 35678:case 36198:return be;case 35679:return we;case 35680:return Me;case 5124:case 35670:return de;case 35667:case 35671:return Ee;case 35668:case 35672:return _e;case 35669:case 35673:return Se}}(t.type)}function Ie(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Te;case 35664:return Ce;case 35665:return Re;case 35666:return Le;case 35674:return Pe;case 35675:return Ne;case 35676:return Be;case 35678:return ze;case 35680:return Oe;case 5124:case 35670:return Ae;case 35667:case 35671:return Ee;case 35668:case 35672:return _e;case 35669:case 35673:return Se}}(t.type)}function De(e){this.id=e,this.seq=[],this.map={}}function He(e,t,i){this.seq=[],this.map={},this.renderer=i,i=e.getProgramParameter(t,35718);for(var n=0;n<i;++n){var r=e.getActiveUniform(t,n),o=e.getUniformLocation(t,r.name),a=this,s=r.name,l=s.length;for(Mo.lastIndex=0;;){var c=Mo.exec(s),h=Mo.lastIndex,u=c[1],p=c[3];if(\"]\"===c[2]&&(u|=0),void 0===p||\"[\"===p&&h+2===l){s=a,r=void 0===p?new Fe(u,r,o):new Ie(u,r,o),s.seq.push(r),s.map[r.id]=r;break}void 0===(p=a.map[u])&&(p=new De(u),u=a,a=p,u.seq.push(a),u.map[a.id]=a),a=p}}}function je(e,t,i){var n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),!1===e.getShaderParameter(n,35713)&&console.error(\"THREE.WebGLShader: Shader couldn't compile.\"),\"\"!==e.getShaderInfoLog(n)&&console.warn(\"THREE.WebGLShader: gl.getShaderInfoLog()\",35633===t?\"vertex\":\"fragment\",e.getShaderInfoLog(n),function(e){e=e.split(\"\\n\");for(var t=0;t<e.length;t++)e[t]=t+1+\": \"+e[t];return e.join(\"\\n\")}(i)),n}function Ve(e){switch(e){case 3e3:return[\"Linear\",\"( value )\"];case 3001:return[\"sRGB\",\"( value )\"];case 3002:return[\"RGBE\",\"( value )\"];case 3004:return[\"RGBM\",\"( value, 7.0 )\"];case 3005:return[\"RGBM\",\"( value, 16.0 )\"];case 3006:return[\"RGBD\",\"( value, 256.0 )\"];case 3007:return[\"Gamma\",\"( value, float( GAMMA_FACTOR ) )\"];default:throw Error(\"unsupported encoding: \"+e)}}function ke(e,t){return\"vec4 \"+e+\"( vec4 value ) { return \"+(t=Ve(t))[0]+\"ToLinear\"+t[1]+\"; }\"}function Ue(e,t){return\"vec4 \"+e+\"( vec4 value ) { return LinearTo\"+(t=Ve(t))[0]+t[1]+\"; }\"}function Ge(e,t){switch(t){case 1:t=\"Linear\";break;case 2:t=\"Reinhard\";break;case 3:t=\"Uncharted2\";break;case 4:t=\"OptimizedCineon\";break;case 5:t=\"ACESFilmic\";break;default:throw Error(\"unsupported toneMapping: \"+t)}return\"vec3 \"+e+\"( vec3 color ) { return \"+t+\"ToneMapping( color ); }\"}function We(e){return\"\"!==e}function qe(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Qe(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function Xe(e){return e.replace(/^[ \\t]*#include +<([\\w\\d./]+)>/gm,(function(e,t){if(void 0===(e=ro[t]))throw Error(\"Can not resolve #include <\"+t+\">\");return Xe(e)}))}function Ye(e){return e.replace(/#pragma unroll_loop[\\s]+?for \\( int i = (\\d+); i < (\\d+); i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g,(function(e,t,i,n){for(e=\"\",t=parseInt(t);t<parseInt(i);t++)e+=n.replace(/\\[ i \\]/g,\"[ \"+t+\" ]\");return e}))}function Ze(e,t,i,n,r,o,a){var s=e.context,l=n.defines,c=r.vertexShader,h=r.fragmentShader,u=\"SHADOWMAP_TYPE_BASIC\";1===o.shadowMapType?u=\"SHADOWMAP_TYPE_PCF\":2===o.shadowMapType&&(u=\"SHADOWMAP_TYPE_PCF_SOFT\");var p=\"ENVMAP_TYPE_CUBE\",d=\"ENVMAP_MODE_REFLECTION\",f=\"ENVMAP_BLENDING_MULTIPLY\";if(o.envMap){switch(n.envMap.mapping){case 301:case 302:p=\"ENVMAP_TYPE_CUBE\";break;case 306:case 307:p=\"ENVMAP_TYPE_CUBE_UV\";break;case 303:case 304:p=\"ENVMAP_TYPE_EQUIREC\";break;case 305:p=\"ENVMAP_TYPE_SPHERE\"}switch(n.envMap.mapping){case 302:case 304:d=\"ENVMAP_MODE_REFRACTION\"}switch(n.combine){case 0:f=\"ENVMAP_BLENDING_MULTIPLY\";break;case 1:f=\"ENVMAP_BLENDING_MIX\";break;case 2:f=\"ENVMAP_BLENDING_ADD\"}}var m,g,v=0<e.gammaFactor?e.gammaFactor:1,y=a.isWebGL2?\"\":function(e,t,i){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?\"#extension GL_OES_standard_derivatives : enable\":\"\",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get(\"EXT_frag_depth\")?\"#extension GL_EXT_frag_depth : enable\":\"\",e.drawBuffers&&i.get(\"WEBGL_draw_buffers\")?\"#extension GL_EXT_draw_buffers : require\":\"\",(e.shaderTextureLOD||t.envMap)&&i.get(\"EXT_shader_texture_lod\")?\"#extension GL_EXT_shader_texture_lod : enable\":\"\"].filter(We).join(\"\\n\")}(n.extensions,o,t),x=function(e){var t,i=[];for(t in e){var n=e[t];!1!==n&&i.push(\"#define \"+t+\" \"+n)}return i.join(\"\\n\")}(l),b=s.createProgram();return n.isRawShaderMaterial?(0<(l=[x].filter(We).join(\"\\n\")).length&&(l+=\"\\n\"),0<(t=[y,x].filter(We).join(\"\\n\")).length&&(t+=\"\\n\")):(l=[\"precision \"+o.precision+\" float;\",\"precision \"+o.precision+\" int;\",\"#define SHADER_NAME \"+r.name,x,o.supportsVertexTextures?\"#define VERTEX_TEXTURES\":\"\",\"#define GAMMA_FACTOR \"+v,\"#define MAX_BONES \"+o.maxBones,o.useFog&&o.fog?\"#define USE_FOG\":\"\",o.useFog&&o.fogExp?\"#define FOG_EXP2\":\"\",o.map?\"#define USE_MAP\":\"\",o.envMap?\"#define USE_ENVMAP\":\"\",o.envMap?\"#define \"+d:\"\",o.lightMap?\"#define USE_LIGHTMAP\":\"\",o.aoMap?\"#define USE_AOMAP\":\"\",o.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",o.bumpMap?\"#define USE_BUMPMAP\":\"\",o.normalMap?\"#define USE_NORMALMAP\":\"\",o.normalMap&&o.objectSpaceNormalMap?\"#define OBJECTSPACE_NORMALMAP\":\"\",o.displacementMap&&o.supportsVertexTextures?\"#define USE_DISPLACEMENTMAP\":\"\",o.specularMap?\"#define USE_SPECULARMAP\":\"\",o.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",o.metalnessMap?\"#define USE_METALNESSMAP\":\"\",o.alphaMap?\"#define USE_ALPHAMAP\":\"\",o.vertexColors?\"#define USE_COLOR\":\"\",o.flatShading?\"#define FLAT_SHADED\":\"\",o.skinning?\"#define USE_SKINNING\":\"\",o.useVertexTexture?\"#define BONE_TEXTURE\":\"\",o.morphTargets?\"#define USE_MORPHTARGETS\":\"\",o.morphNormals&&!1===o.flatShading?\"#define USE_MORPHNORMALS\":\"\",o.doubleSided?\"#define DOUBLE_SIDED\":\"\",o.flipSided?\"#define FLIP_SIDED\":\"\",o.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",o.shadowMapEnabled?\"#define \"+u:\"\",o.sizeAttenuation?\"#define USE_SIZEATTENUATION\":\"\",o.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get(\"EXT_frag_depth\"))?\"#define USE_LOGDEPTHBUF_EXT\":\"\",\"uniform mat4 modelMatrix;\",\"uniform mat4 modelViewMatrix;\",\"uniform mat4 projectionMatrix;\",\"uniform mat4 viewMatrix;\",\"uniform mat3 normalMatrix;\",\"uniform vec3 cameraPosition;\",\"attribute vec3 position;\",\"attribute vec3 normal;\",\"attribute vec2 uv;\",\"#ifdef USE_COLOR\",\"\\tattribute vec3 color;\",\"#endif\",\"#ifdef USE_MORPHTARGETS\",\"\\tattribute vec3 morphTarget0;\",\"\\tattribute vec3 morphTarget1;\",\"\\tattribute vec3 morphTarget2;\",\"\\tattribute vec3 morphTarget3;\",\"\\t#ifdef USE_MORPHNORMALS\",\"\\t\\tattribute vec3 morphNormal0;\",\"\\t\\tattribute vec3 morphNormal1;\",\"\\t\\tattribute vec3 morphNormal2;\",\"\\t\\tattribute vec3 morphNormal3;\",\"\\t#else\",\"\\t\\tattribute vec3 morphTarget4;\",\"\\t\\tattribute vec3 morphTarget5;\",\"\\t\\tattribute vec3 morphTarget6;\",\"\\t\\tattribute vec3 morphTarget7;\",\"\\t#endif\",\"#endif\",\"#ifdef USE_SKINNING\",\"\\tattribute vec4 skinIndex;\",\"\\tattribute vec4 skinWeight;\",\"#endif\",\"\\n\"].filter(We).join(\"\\n\"),t=[y,\"precision \"+o.precision+\" float;\",\"precision \"+o.precision+\" int;\",\"#define SHADER_NAME \"+r.name,x,o.alphaTest?\"#define ALPHATEST \"+o.alphaTest+(o.alphaTest%1?\"\":\".0\"):\"\",\"#define GAMMA_FACTOR \"+v,o.useFog&&o.fog?\"#define USE_FOG\":\"\",o.useFog&&o.fogExp?\"#define FOG_EXP2\":\"\",o.map?\"#define USE_MAP\":\"\",o.matcap?\"#define USE_MATCAP\":\"\",o.envMap?\"#define USE_ENVMAP\":\"\",o.envMap?\"#define \"+p:\"\",o.envMap?\"#define \"+d:\"\",o.envMap?\"#define \"+f:\"\",o.lightMap?\"#define USE_LIGHTMAP\":\"\",o.aoMap?\"#define USE_AOMAP\":\"\",o.emissiveMap?\"#define USE_EMISSIVEMAP\":\"\",o.bumpMap?\"#define USE_BUMPMAP\":\"\",o.normalMap?\"#define USE_NORMALMAP\":\"\",o.normalMap&&o.objectSpaceNormalMap?\"#define OBJECTSPACE_NORMALMAP\":\"\",o.specularMap?\"#define USE_SPECULARMAP\":\"\",o.roughnessMap?\"#define USE_ROUGHNESSMAP\":\"\",o.metalnessMap?\"#define USE_METALNESSMAP\":\"\",o.alphaMap?\"#define USE_ALPHAMAP\":\"\",o.vertexColors?\"#define USE_COLOR\":\"\",o.gradientMap?\"#define USE_GRADIENTMAP\":\"\",o.flatShading?\"#define FLAT_SHADED\":\"\",o.doubleSided?\"#define DOUBLE_SIDED\":\"\",o.flipSided?\"#define FLIP_SIDED\":\"\",o.shadowMapEnabled?\"#define USE_SHADOWMAP\":\"\",o.shadowMapEnabled?\"#define \"+u:\"\",o.premultipliedAlpha?\"#define PREMULTIPLIED_ALPHA\":\"\",o.physicallyCorrectLights?\"#define PHYSICALLY_CORRECT_LIGHTS\":\"\",o.logarithmicDepthBuffer?\"#define USE_LOGDEPTHBUF\":\"\",o.logarithmicDepthBuffer&&(a.isWebGL2||t.get(\"EXT_frag_depth\"))?\"#define USE_LOGDEPTHBUF_EXT\":\"\",o.envMap&&(a.isWebGL2||t.get(\"EXT_shader_texture_lod\"))?\"#define TEXTURE_LOD_EXT\":\"\",\"uniform mat4 viewMatrix;\",\"uniform vec3 cameraPosition;\",0!==o.toneMapping?\"#define TONE_MAPPING\":\"\",0!==o.toneMapping?ro.tonemapping_pars_fragment:\"\",0!==o.toneMapping?Ge(\"toneMapping\",o.toneMapping):\"\",o.dithering?\"#define DITHERING\":\"\",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding?ro.encodings_pars_fragment:\"\",o.mapEncoding?ke(\"mapTexelToLinear\",o.mapEncoding):\"\",o.matcapEncoding?ke(\"matcapTexelToLinear\",o.matcapEncoding):\"\",o.envMapEncoding?ke(\"envMapTexelToLinear\",o.envMapEncoding):\"\",o.emissiveMapEncoding?ke(\"emissiveMapTexelToLinear\",o.emissiveMapEncoding):\"\",o.outputEncoding?Ue(\"linearToOutputTexel\",o.outputEncoding):\"\",o.depthPacking?\"#define DEPTH_PACKING \"+n.depthPacking:\"\",\"\\n\"].filter(We).join(\"\\n\")),c=Qe(c=qe(c=Xe(c),o),o),h=Qe(h=qe(h=Xe(h),o),o),c=Ye(c),h=Ye(h),a.isWebGL2&&!n.isRawShaderMaterial&&(a=!1,u=/^\\s*#version\\s+300\\s+es\\s*\\n/,n.isShaderMaterial&&null!==c.match(u)&&null!==h.match(u)&&(a=!0,c=c.replace(u,\"\"),h=h.replace(u,\"\")),l=\"#version 300 es\\n\\n#define attribute in\\n#define varying out\\n#define texture2D texture\\n\"+l,t=[\"#version 300 es\\n\\n#define varying in\",a?\"\":\"out highp vec4 pc_fragColor;\",a?\"\":\"#define gl_FragColor pc_fragColor\",\"#define gl_FragDepthEXT gl_FragDepth\\n#define texture2D texture\\n#define textureCube texture\\n#define texture2DProj textureProj\\n#define texture2DLodEXT textureLod\\n#define texture2DProjLodEXT textureProjLod\\n#define textureCubeLodEXT textureLod\\n#define texture2DGradEXT textureGrad\\n#define texture2DProjGradEXT textureProjGrad\\n#define textureCubeGradEXT textureGrad\"].join(\"\\n\")+\"\\n\"+t),h=t+h,c=je(s,35633,l+c),h=je(s,35632,h),s.attachShader(b,c),s.attachShader(b,h),void 0!==n.index0AttributeName?s.bindAttribLocation(b,0,n.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(b,0,\"position\"),s.linkProgram(b),o=s.getProgramInfoLog(b).trim(),a=s.getShaderInfoLog(c).trim(),u=s.getShaderInfoLog(h).trim(),d=p=!0,!1===s.getProgramParameter(b,35714)?(p=!1,console.error(\"THREE.WebGLProgram: shader error: \",s.getError(),\"35715\",s.getProgramParameter(b,35715),\"gl.getProgramInfoLog\",o,a,u)):\"\"!==o?console.warn(\"THREE.WebGLProgram: gl.getProgramInfoLog()\",o):\"\"!==a&&\"\"!==u||(d=!1),d&&(this.diagnostics={runnable:p,material:n,programLog:o,vertexShader:{log:a,prefix:l},fragmentShader:{log:u,prefix:t}}),s.deleteShader(c),s.deleteShader(h),this.getUniforms=function(){return void 0===m&&(m=new He(s,b,e)),m},this.getAttributes=function(){if(void 0===g){for(var e={},t=s.getProgramParameter(b,35721),i=0;i<t;i++){var n=s.getActiveAttrib(b,i).name;e[n]=s.getAttribLocation(b,n)}g=e}return g},this.destroy=function(){s.deleteProgram(b),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn(\"THREE.WebGLProgram: .uniforms is now .getUniforms().\"),this.getUniforms()}},attributes:{get:function(){return console.warn(\"THREE.WebGLProgram: .attributes is now .getAttributes().\"),this.getAttributes()}}}),this.name=r.name,this.id=Eo++,this.code=i,this.usedTimes=1,this.program=b,this.vertexShader=c,this.fragmentShader=h,this}function Je(e,t,i){function n(e,t){if(e)e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn(\"THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.\"),i=e.texture.encoding);else var i=3e3;return 3e3===i&&t&&(i=3007),i}var r=[],o={MeshDepthMaterial:\"depth\",MeshDistanceMaterial:\"distanceRGBA\",MeshNormalMaterial:\"normal\",MeshBasicMaterial:\"basic\",MeshLambertMaterial:\"lambert\",MeshPhongMaterial:\"phong\",MeshToonMaterial:\"phong\",MeshStandardMaterial:\"physical\",MeshPhysicalMaterial:\"physical\",MeshMatcapMaterial:\"matcap\",LineBasicMaterial:\"basic\",LineDashedMaterial:\"dashed\",PointsMaterial:\"points\",ShadowMaterial:\"shadow\",SpriteMaterial:\"sprite\"},a=\"precision supportsVertexTextures map mapEncoding matcap matcapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering\".split(\" \");this.getParameters=function(t,r,a,s,l,c,h){var u=o[t.type];if(h.isSkinnedMesh){var p=h.skeleton.bones;if(i.floatVertexTextures)p=1024;else{var d=Math.min(Math.floor((i.maxVertexUniforms-20)/4),p.length);d<p.length?(console.warn(\"THREE.WebGLRenderer: Skeleton has \"+p.length+\" bones. This GPU supports \"+d+\".\"),p=0):p=d}}else p=0;d=i.precision,null!==t.precision&&(d=i.getMaxPrecision(t.precision))!==t.precision&&console.warn(\"THREE.WebGLProgram.getParameters:\",t.precision,\"not supported, using\",d,\"instead.\");var f=e.getRenderTarget();return{shaderID:u,precision:d,supportsVertexTextures:i.vertexTextures,outputEncoding:n(f?f.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:n(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:n(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:n(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(306===t.envMap.mapping||307===t.envMap.mapping),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:n(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:1===t.normalMapType,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!s,useFog:t.fog,fogExp:s&&s.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:t.skinning&&0<p,maxBones:p,useVertexTexture:i.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:l,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.receiveShadow&&0<a.length,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,i){var n=[];if(i.shaderID?n.push(i.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);for(r=0;r<a.length;r++)n.push(i[a[r]]);return n.push(t.onBeforeCompile.toString()),n.push(e.gammaOutput),n.push(e.gammaFactor),n.join()},this.acquireProgram=function(n,o,a,s){for(var l,c=0,h=r.length;c<h;c++){var u=r[c];if(u.code===s){++(l=u).usedTimes;break}}return void 0===l&&(l=new Ze(e,t,s,n,o,a,i),r.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function Ke(){var e=new WeakMap;return{get:function(t){var i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function $e(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function et(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function tt(){function e(e,n,r,o,a){var s=t[i];return void 0===s?(s={id:e.id,object:e,geometry:n,material:r,program:r.program,renderOrder:e.renderOrder,z:o,group:a},t[i]=s):(s.id=e.id,s.object=e,s.geometry=n,s.material=r,s.program=r.program,s.renderOrder=e.renderOrder,s.z=o,s.group=a),i++,s}var t=[],i=0,n=[],r=[];return{opaque:n,transparent:r,init:function(){i=0,n.length=0,r.length=0},push:function(t,i,o,a,s){t=e(t,i,o,a,s),(!0===o.transparent?r:n).push(t)},unshift:function(t,i,o,a,s){t=e(t,i,o,a,s),(!0===o.transparent?r:n).unshift(t)},sort:function(){1<n.length&&n.sort($e),1<r.length&&r.sort(et)}}}function it(){var e={};return{get:function(t,i){var n=e[t.id];if(void 0===n){var r=new tt;e[t.id]={},e[t.id][i.id]=r}else void 0===(r=n[i.id])&&(r=new tt,n[i.id]=r);return r},dispose:function(){e={}}}}function nt(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];switch(t.type){case\"DirectionalLight\":var n={direction:new o,color:new y,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case\"SpotLight\":n={position:new o,direction:new o,color:new y,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case\"PointLight\":n={position:new o,color:new y,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i,shadowCameraNear:1,shadowCameraFar:1e3};break;case\"HemisphereLight\":n={direction:new o,skyColor:new y,groundColor:new y};break;case\"RectAreaLight\":n={color:new y,position:new o,halfWidth:new o,halfHeight:new o}}return e[t.id]=n}}}function rt(){var e=new nt,t={id:_o++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=new o,r=new n,a=new n;return{setup:function(n,o,s){var l=0,c=0,h=0,u=0,p=0,d=0,f=0,m=0;s=s.matrixWorldInverse;for(var g=0,v=n.length;g<v;g++){var y=n[g],x=y.color,b=y.intensity,w=y.distance,M=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)l+=x.r*b,c+=x.g*b,h+=x.b*b;else if(y.isDirectionalLight){var E=e.get(y);E.color.copy(y.color).multiplyScalar(y.intensity),E.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),E.direction.sub(i),E.direction.transformDirection(s),(E.shadow=y.castShadow)&&(x=y.shadow,E.shadowBias=x.bias,E.shadowRadius=x.radius,E.shadowMapSize=x.mapSize),t.directionalShadowMap[u]=M,t.directionalShadowMatrix[u]=y.shadow.matrix,t.directional[u]=E,u++}else y.isSpotLight?((E=e.get(y)).position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(s),E.color.copy(x).multiplyScalar(b),E.distance=w,E.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),E.direction.sub(i),E.direction.transformDirection(s),E.coneCos=Math.cos(y.angle),E.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),E.decay=y.decay,(E.shadow=y.castShadow)&&(x=y.shadow,E.shadowBias=x.bias,E.shadowRadius=x.radius,E.shadowMapSize=x.mapSize),t.spotShadowMap[d]=M,t.spotShadowMatrix[d]=y.shadow.matrix,t.spot[d]=E,d++):y.isRectAreaLight?((E=e.get(y)).color.copy(x).multiplyScalar(b),E.position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(s),a.identity(),r.copy(y.matrixWorld),r.premultiply(s),a.extractRotation(r),E.halfWidth.set(.5*y.width,0,0),E.halfHeight.set(0,.5*y.height,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),t.rectArea[f]=E,f++):y.isPointLight?((E=e.get(y)).position.setFromMatrixPosition(y.matrixWorld),E.position.applyMatrix4(s),E.color.copy(y.color).multiplyScalar(y.intensity),E.distance=y.distance,E.decay=y.decay,(E.shadow=y.castShadow)&&(x=y.shadow,E.shadowBias=x.bias,E.shadowRadius=x.radius,E.shadowMapSize=x.mapSize,E.shadowCameraNear=x.camera.near,E.shadowCameraFar=x.camera.far),t.pointShadowMap[p]=M,t.pointShadowMatrix[p]=y.shadow.matrix,t.point[p]=E,p++):y.isHemisphereLight&&((E=e.get(y)).direction.setFromMatrixPosition(y.matrixWorld),E.direction.transformDirection(s),E.direction.normalize(),E.skyColor.copy(y.color).multiplyScalar(b),E.groundColor.copy(y.groundColor).multiplyScalar(b),t.hemi[m]=E,m++)}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=h,t.directional.length=u,t.spot.length=d,t.rectArea.length=f,t.point.length=p,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=u,t.hash.pointLength=p,t.hash.spotLength=d,t.hash.rectAreaLength=f,t.hash.hemiLength=m,t.hash.shadowsLength=o.length},state:t}}function ot(){var e=new rt,t=[],i=[];return{init:function(){t.length=0,i.length=0},state:{lightsArray:t,shadowsArray:i,lights:e},setupLights:function(n){e.setup(t,i,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){i.push(e)}}}function at(){var e={};return{get:function(t,i){if(void 0===e[t.id]){var n=new ot;e[t.id]={},e[t.id][i.id]=n}else void 0===e[t.id][i.id]?(n=new ot,e[t.id][i.id]=n):n=e[t.id][i.id];return n},dispose:function(){e={}}}}function st(e){U.call(this),this.type=\"MeshDepthMaterial\",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.setValues(e)}function lt(e){U.call(this),this.type=\"MeshDistanceMaterial\",this.referencePosition=new o,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.lights=this.fog=!1,this.setValues(e)}function ct(e,t,r){function a(t,i,n,r,o,a){var s=t.geometry,l=v,c=t.customDepthMaterial;return n&&(l=y,c=t.customDistanceMaterial),c?l=c:(c=!1,i.morphTargets&&(s&&s.isBufferGeometry?c=s.morphAttributes&&s.morphAttributes.position&&0<s.morphAttributes.position.length:s&&s.isGeometry&&(c=s.morphTargets&&0<s.morphTargets.length)),t.isSkinnedMesh&&!1===i.skinning&&console.warn(\"THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:\",t),s=0,c&&(s|=1),(t=t.isSkinnedMesh&&i.skinning)&&(s|=2),l=l[s]),e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length&&(s=l.uuid,c=i.uuid,void 0===(t=x[s])&&(t={},x[s]=t),void 0===(s=t[c])&&(s=l.clone(),t[c]=s),l=s),l.visible=i.visible,l.wireframe=i.wireframe,l.side=null!=i.shadowSide?i.shadowSide:b[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,n&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(r),l.nearDistance=o,l.farDistance=a),l}function s(i,n,r,o){if(!1!==i.visible){if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&i.castShadow&&(!i.frustumCulled||h.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld);var l=t.update(i),c=i.material;if(Array.isArray(c))for(var u=l.groups,p=0,d=u.length;p<d;p++){var f=u[p],m=c[f.materialIndex];m&&m.visible&&(m=a(i,m,o,g,r.near,r.far),e.renderBufferDirect(r,null,l,m,i,f))}else c.visible&&(m=a(i,c,o,g,r.near,r.far),e.renderBufferDirect(r,null,l,m,i,null))}for(l=0,c=(i=i.children).length;l<c;l++)s(i[l],n,r,o)}}var h=new m,u=new n,p=new i,d=new i(r,r),f=new o,g=new o,v=Array(4),y=Array(4),x={},b={0:1,1:0,2:2},w=[new o(1,0,0),new o(-1,0,0),new o(0,0,1),new o(0,0,-1),new o(0,1,0),new o(0,-1,0)],M=[new o(0,1,0),new o(0,1,0),new o(0,1,0),new o(0,1,0),new o(0,0,1),new o(0,0,-1)],E=[new l,new l,new l,new l,new l,new l];for(r=0;4!==r;++r){var _=0!=(1&r),S=0!=(2&r),T=new st({depthPacking:3201,morphTargets:_,skinning:S});v[r]=T,_=new lt({morphTargets:_,skinning:S}),y[r]=_}var A=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,i,n){if(!1!==A.enabled&&(!1!==A.autoUpdate||!1!==A.needsUpdate)&&0!==t.length){var r=e.state;r.disable(3042),r.buffers.color.setClear(1,1,1,1),r.buffers.depth.setTest(!0),r.setScissorTest(!1);for(var o,a=0,l=t.length;a<l;a++){var m=t[a];o=m.shadow;var v=m&&m.isPointLight;if(void 0===o)console.warn(\"THREE.WebGLShadowMap:\",m,\"has no shadow.\");else{var y=o.camera;if(p.copy(o.mapSize),p.min(d),v){var x=p.x,b=p.y;E[0].set(2*x,b,x,b),E[1].set(0,b,x,b),E[2].set(3*x,b,x,b),E[3].set(x,b,x,b),E[4].set(3*x,0,x,b),E[5].set(x,0,x,b),p.x*=4,p.y*=2}for(null===o.map&&(o.map=new c(p.x,p.y,{minFilter:1003,magFilter:1003,format:1023}),o.map.texture.name=m.name+\".shadowMap\",y.updateProjectionMatrix()),o.isSpotLightShadow&&o.update(m),x=o.map,b=o.matrix,g.setFromMatrixPosition(m.matrixWorld),y.position.copy(g),v?(o=6,b.makeTranslation(-g.x,-g.y,-g.z)):(o=1,f.setFromMatrixPosition(m.target.matrixWorld),y.lookAt(f),y.updateMatrixWorld(),b.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),b.multiply(y.projectionMatrix),b.multiply(y.matrixWorldInverse)),e.setRenderTarget(x),e.clear(),m=0;m<o;m++)v&&(f.copy(y.position),f.add(w[m]),y.up.copy(M[m]),y.lookAt(f),y.updateMatrixWorld(),r.viewport(E[m])),u.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),h.setFromMatrix(u),s(i,n,y,v)}}A.needsUpdate=!1}}}function ht(e,t,i,n){function r(t,i,n){var r=new Uint8Array(4),o=e.createTexture();for(e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728),t=0;t<n;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,r);return o}function o(i,r){y[i]=1,0===x[i]&&(e.enableVertexAttribArray(i),x[i]=1),b[i]!==r&&((n.isWebGL2?e:t.get(\"ANGLE_instanced_arrays\"))[n.isWebGL2?\"vertexAttribDivisor\":\"vertexAttribDivisorANGLE\"](i,r),b[i]=r)}function a(t){!0!==w[t]&&(e.enable(t),w[t]=!0)}function s(t){!1!==w[t]&&(e.disable(t),w[t]=!1)}function c(t,n,r,o,l,c,h,u){if(0===t)_&&(s(3042),_=!1);else if(_||(a(3042),_=!0),5!==t){if(t!==S||u!==N){if(100===T&&100===R||(e.blendEquation(32774),R=T=100),u)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error(\"THREE.WebGLState: Invalid blending: \",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error(\"THREE.WebGLState: Invalid blending: \",t)}P=L=C=A=null,S=t,N=u}}else l=l||n,c=c||r,h=h||o,n===T&&l===R||(e.blendEquationSeparate(i.convert(n),i.convert(l)),T=n,R=l),r===A&&o===C&&c===L&&h===P||(e.blendFuncSeparate(i.convert(r),i.convert(o),i.convert(c),i.convert(h)),A=r,C=o,L=c,P=h),S=t,N=null}function h(t){B!==t&&(t?e.frontFace(2304):e.frontFace(2305),B=t)}function u(t){0!==t?(a(2884),t!==z&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):s(2884),z=t}function p(t,i,n){t?(a(32823),(F!==i||I!==n)&&(e.polygonOffset(i,n),F=i,I=n)):s(32823)}function d(t){void 0===t&&(t=33984+D-1),j!==t&&(e.activeTexture(t),j=t)}var f=new function(){var t=!1,i=new l,n=null,r=new l(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,o,a,s){!0===s&&(t*=a,n*=a,o*=a),i.set(t,n,o,a),!1===r.equals(i)&&(e.clearColor(t,n,o,a),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},m=new function(){var t=!1,i=null,n=null,r=null;return{setTest:function(e){e?a(2929):s(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,r=n=i=null}}},g=new function(){var t=!1,i=null,n=null,r=null,o=null,l=null,c=null,h=null,u=null;return{setTest:function(e){e?a(2960):s(2960)},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,a){n===t&&r===i&&o===a||(e.stencilFunc(t,i,a),n=t,r=i,o=a)},setOp:function(t,i,n){l===t&&c===i&&h===n||(e.stencilOp(t,i,n),l=t,c=i,h=n)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,u=h=c=l=o=r=n=i=null}}},v=e.getParameter(34921),y=new Uint8Array(v),x=new Uint8Array(v),b=new Uint8Array(v),w={},M=null,E=null,_=null,S=null,T=null,A=null,C=null,R=null,L=null,P=null,N=!1,B=null,z=null,O=null,F=null,I=null,D=e.getParameter(35661),H=!1;v=0,-1!==(v=e.getParameter(7938)).indexOf(\"WebGL\")?(v=parseFloat(/^WebGL ([0-9])/.exec(v)[1]),H=1<=v):-1!==v.indexOf(\"OpenGL ES\")&&(v=parseFloat(/^OpenGL ES ([0-9])/.exec(v)[1]),H=2<=v);var j=null,V={},k=new l,U=new l,G={};return G[3553]=r(3553,3553,1),G[34067]=r(34067,34069,6),f.setClear(0,0,0,1),m.setClear(1),g.setClear(0),a(2929),m.setFunc(3),h(!1),u(1),a(2884),c(0),{buffers:{color:f,depth:m,stencil:g},initAttributes:function(){for(var e=0,t=y.length;e<t;e++)y[e]=0},enableAttribute:function(e){o(e,0)},enableAttributeAndDivisor:o,disableUnusedAttributes:function(){for(var t=0,i=x.length;t!==i;++t)x[t]!==y[t]&&(e.disableVertexAttribArray(t),x[t]=0)},enable:a,disable:s,getCompressedTextureFormats:function(){if(null===M&&(M=[],t.get(\"WEBGL_compressed_texture_pvrtc\")||t.get(\"WEBGL_compressed_texture_s3tc\")||t.get(\"WEBGL_compressed_texture_etc1\")||t.get(\"WEBGL_compressed_texture_astc\")))for(var i=e.getParameter(34467),n=0;n<i.length;n++)M.push(i[n]);return M},useProgram:function(t){return E!==t&&(e.useProgram(t),E=t,!0)},setBlending:c,setMaterial:function(e,t){2===e.side?s(2884):a(2884);var i=1===e.side;t&&(i=!i),h(i),1===e.blending&&!1===e.transparent?c(0):c(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),m.setFunc(e.depthFunc),m.setTest(e.depthTest),m.setMask(e.depthWrite),f.setMask(e.colorWrite),p(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:h,setCullFace:u,setLineWidth:function(t){t!==O&&(H&&e.lineWidth(t),O=t)},setPolygonOffset:p,setScissorTest:function(e){e?a(3089):s(3089)},activeTexture:d,bindTexture:function(t,i){null===j&&d();var n=V[j];void 0===n&&(n={type:void 0,texture:void 0},V[j]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||G[t]),n.type=t,n.texture=i)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error(\"THREE.WebGLState:\",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error(\"THREE.WebGLState:\",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error(\"THREE.WebGLState:\",e)}},scissor:function(t){!1===k.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),k.copy(t))},viewport:function(t){!1===U.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),U.copy(t))},reset:function(){for(var t=0;t<x.length;t++)1===x[t]&&(e.disableVertexAttribArray(t),x[t]=0);w={},j=M=null,V={},z=B=S=E=null,f.reset(),m.reset(),g.reset()}}}function ut(e,t,i,n,r,o,a){function s(e,t){if(e.width>t||e.height>t){if(\"data\"in e)return void console.warn(\"THREE.WebGLRenderer: image in DataTexture is too big (\"+e.width+\"x\"+e.height+\").\");t/=Math.max(e.width,e.height);var i=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\");return i.width=Math.floor(e.width*t),i.height=Math.floor(e.height*t),i.getContext(\"2d\").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.warn(\"THREE.WebGLRenderer: image is too big (\"+e.width+\"x\"+e.height+\"). Resized to \"+i.width+\"x\"+i.height),i}return e}function l(e){return eo.isPowerOfTwo(e.width)&&eo.isPowerOfTwo(e.height)}function c(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function h(t,i,r,o){e.generateMipmap(t),n.get(i).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function u(e,t){if(!r.isWebGL2)return e;if(6403===e){if(5126===t)return 33326;if(5131===t)return 33325;if(5121===t)return 33321}if(6407===e){if(5126===t)return 34837;if(5131===t)return 34843;if(5121===t)return 32849}if(6408===e){if(5126===t)return 34836;if(5131===t)return 34842;if(5121===t)return 32856}return e}function p(e){return 1003===e||1004===e||1005===e?9728:9729}function d(t){(t=t.target).removeEventListener(\"dispose\",d);e:{var i=n.get(t);if(t.image&&i.__image__webglTextureCube)e.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)break e;e.deleteTexture(i.__webglTexture)}n.remove(t)}t.isVideoTexture&&delete w[t.id],a.memory.textures--}function f(t){(t=t.target).removeEventListener(\"dispose\",f);var i=n.get(t),r=n.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(r=0;6>r;r++)e.deleteFramebuffer(i.__webglFramebuffer[r]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[r]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}a.memory.textures--}function m(e,t){var r=n.get(e);if(e.isVideoTexture){var o=e.id,s=a.render.frame;w[o]!==s&&(w[o]=s,e.update())}if(0<e.version&&r.__version!==e.version)if(void 0===(o=e.image))console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is undefined\");else{if(!1!==o.complete)return void v(r,e,t);console.warn(\"THREE.WebGLRenderer: Texture marked for update but image is incomplete\")}i.activeTexture(33984+t),i.bindTexture(3553,r.__webglTexture)}function g(i,a,s){s?(e.texParameteri(i,10242,o.convert(a.wrapS)),e.texParameteri(i,10243,o.convert(a.wrapT)),e.texParameteri(i,10240,o.convert(a.magFilter)),e.texParameteri(i,10241,o.convert(a.minFilter))):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),1001===a.wrapS&&1001===a.wrapT||console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.\"),e.texParameteri(i,10240,p(a.magFilter)),e.texParameteri(i,10241,p(a.minFilter)),1003!==a.minFilter&&1006!==a.minFilter&&console.warn(\"THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.\")),!(s=t.get(\"EXT_texture_filter_anisotropic\"))||1015===a.type&&null===t.get(\"OES_texture_float_linear\")||1016===a.type&&null===(r.isWebGL2||t.get(\"OES_texture_half_float_linear\"))||!(1<a.anisotropy||n.get(a).__currentAnisotropy)||(e.texParameterf(i,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}function v(t,n,p){var f=n.isDataTexture3D?32879:3553;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener(\"dispose\",d),t.__webglTexture=e.createTexture(),a.memory.textures++),i.activeTexture(33984+p),i.bindTexture(f,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),p=s(n.image,r.maxTextureSize);var m=!r.isWebGL2&&(1001!==n.wrapS||1001!==n.wrapT||1003!==n.minFilter&&1006!==n.minFilter);m&&!1===l(p)&&(p instanceof HTMLImageElement||p instanceof HTMLCanvasElement||p instanceof ImageBitmap)&&(void 0===b&&(b=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\")),b.width=eo.floorPowerOfTwo(p.width),b.height=eo.floorPowerOfTwo(p.height),b.getContext(\"2d\").drawImage(p,0,0,b.width,b.height),console.warn(\"THREE.WebGLRenderer: image is not power of two (\"+p.width+\"x\"+p.height+\"). Resized to \"+b.width+\"x\"+b.height),p=b),m=l(p);var v=o.convert(n.format),y=o.convert(n.type),x=u(v,y);g(f,n,m);var w=n.mipmaps;if(n.isDepthTexture){if(x=6402,1015===n.type){if(!r.isWebGL2)throw Error(\"Float Depth Texture only supported in WebGL2.0\");x=36012}else r.isWebGL2&&(x=33189);1026===n.format&&6402===x&&1012!==n.type&&1014!==n.type&&(console.warn(\"THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.\"),n.type=1012,y=o.convert(n.type)),1027===n.format&&(x=34041,1020!==n.type&&(console.warn(\"THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.\"),n.type=1020,y=o.convert(n.type))),i.texImage2D(3553,0,x,p.width,p.height,0,v,y,null)}else if(n.isDataTexture)if(0<w.length&&m){for(var M=0,E=w.length;M<E;M++)f=w[M],i.texImage2D(3553,M,x,f.width,f.height,0,v,y,f.data);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,x,p.width,p.height,0,v,y,p.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(M=0,E=w.length;M<E;M++)f=w[M],1023!==n.format&&1022!==n.format?-1<i.getCompressedTextureFormats().indexOf(v)?i.compressedTexImage2D(3553,M,x,f.width,f.height,0,f.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()\"):i.texImage2D(3553,M,x,f.width,f.height,0,v,y,f.data);t.__maxMipLevel=w.length-1}else if(n.isDataTexture3D)i.texImage3D(32879,0,x,p.width,p.height,p.depth,0,v,y,p.data),t.__maxMipLevel=0;else if(0<w.length&&m){for(M=0,E=w.length;M<E;M++)f=w[M],i.texImage2D(3553,M,x,v,y,f);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,x,v,y,p),t.__maxMipLevel=0;c(n,m)&&h(3553,n,p.width,p.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function y(t,r,a,s){var l=o.convert(r.texture.format),c=o.convert(r.texture.type),h=u(l,c);i.texImage2D(s,0,h,r.width,r.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,s,n.get(r.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function x(t,i){e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer?(e.renderbufferStorage(36161,33189,i.width,i.height),e.framebufferRenderbuffer(36160,36096,36161,t)):i.depthBuffer&&i.stencilBuffer?(e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t)):e.renderbufferStorage(36161,32854,i.width,i.height),e.bindRenderbuffer(36161,null)}var b,w={};this.setTexture2D=m,this.setTexture3D=function(e,t){var r=n.get(e);0<e.version&&r.__version!==e.version?v(r,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(t,p){var f=n.get(t);if(6===t.image.length)if(0<t.version&&f.__version!==t.version){f.__image__webglTextureCube||(t.addEventListener(\"dispose\",d),f.__image__webglTextureCube=e.createTexture(),a.memory.textures++),i.activeTexture(33984+p),i.bindTexture(34067,f.__image__webglTextureCube),e.pixelStorei(37440,t.flipY),p=t&&t.isCompressedTexture;for(var m=t.image[0]&&t.image[0].isDataTexture,v=[],y=0;6>y;y++)v[y]=p||m?m?t.image[y].image:t.image[y]:s(t.image[y],r.maxCubemapSize);var x=v[0],b=l(x),w=o.convert(t.format),M=o.convert(t.type),E=u(w,M);for(g(34067,t,b),y=0;6>y;y++)if(p)for(var _,S=v[y].mipmaps,T=0,A=S.length;T<A;T++)_=S[T],1023!==t.format&&1022!==t.format?-1<i.getCompressedTextureFormats().indexOf(w)?i.compressedTexImage2D(34069+y,T,E,_.width,_.height,0,_.data):console.warn(\"THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()\"):i.texImage2D(34069+y,T,E,_.width,_.height,0,w,M,_.data);else m?i.texImage2D(34069+y,0,E,v[y].width,v[y].height,0,w,M,v[y].data):i.texImage2D(34069+y,0,E,w,M,v[y]);f.__maxMipLevel=p?S.length-1:0,c(t,b)&&h(34067,t,x.width,x.height),f.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(33984+p),i.bindTexture(34067,f.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,t){i.activeTexture(33984+t),i.bindTexture(34067,n.get(e).__webglTexture)},this.setupRenderTarget=function(t){var r=n.get(t),o=n.get(t.texture);t.addEventListener(\"dispose\",f),o.__webglTexture=e.createTexture(),a.memory.textures++;var s=!0===t.isWebGLRenderTargetCube,u=l(t);if(s){r.__webglFramebuffer=[];for(var p=0;6>p;p++)r.__webglFramebuffer[p]=e.createFramebuffer()}else r.__webglFramebuffer=e.createFramebuffer();if(s){for(i.bindTexture(34067,o.__webglTexture),g(34067,t.texture,u),p=0;6>p;p++)y(r.__webglFramebuffer[p],t,36064,34069+p);c(t.texture,u)&&h(34067,t.texture,t.width,t.height),i.bindTexture(34067,null)}else i.bindTexture(3553,o.__webglTexture),g(3553,t.texture,u),y(r.__webglFramebuffer,t,36064,3553),c(t.texture,u)&&h(3553,t.texture,t.width,t.height),i.bindTexture(3553,null);if(t.depthBuffer){if(r=n.get(t),o=!0===t.isWebGLRenderTargetCube,t.depthTexture){if(o)throw Error(\"target.depthTexture not supported in Cube render targets\");if(t&&t.isWebGLRenderTargetCube)throw Error(\"Depth Texture with cube render targets is not supported\");if(e.bindFramebuffer(36160,r.__webglFramebuffer),!t.depthTexture||!t.depthTexture.isDepthTexture)throw Error(\"renderTarget.depthTexture must be an instance of THREE.DepthTexture\");if(n.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),m(t.depthTexture,0),r=n.get(t.depthTexture).__webglTexture,1026===t.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(1027!==t.depthTexture.format)throw Error(\"Unknown depthTexture format\");e.framebufferTexture2D(36160,33306,3553,r,0)}}else if(o)for(r.__webglDepthbuffer=[],o=0;6>o;o++)e.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),x(r.__webglDepthbuffer[o],t);else e.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),x(r.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}},this.updateRenderTargetMipmap=function(e){var t=e.texture,r=l(e);if(c(t,r)){r=e.isWebGLRenderTargetCube?34067:3553;var o=n.get(t).__webglTexture;i.bindTexture(r,o),h(r,t,e.width,e.height),i.bindTexture(r,null)}}}function pt(e,t,i){return{convert:function(e){if(1e3===e)return 10497;if(1001===e)return 33071;if(1002===e)return 33648;if(1003===e)return 9728;if(1004===e)return 9984;if(1005===e)return 9986;if(1006===e)return 9729;if(1007===e)return 9985;if(1008===e)return 9987;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e){if(i.isWebGL2)return 5131;var n=t.get(\"OES_texture_half_float\");if(null!==n)return n.HALF_FLOAT_OES}if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(100===e)return 32774;if(101===e)return 32778;if(102===e)return 32779;if(200===e)return 0;if(201===e)return 1;if(202===e)return 768;if(203===e)return 769;if(204===e)return 770;if(205===e)return 771;if(206===e)return 772;if(207===e)return 773;if(208===e)return 774;if(209===e)return 775;if(210===e)return 776;if((33776===e||33777===e||33778===e||33779===e)&&null!==(n=t.get(\"WEBGL_compressed_texture_s3tc\"))){if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===e||35841===e||35842===e||35843===e)&&null!==(n=t.get(\"WEBGL_compressed_texture_pvrtc\"))){if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e&&null!==(n=t.get(\"WEBGL_compressed_texture_etc1\")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e)&&null!==(n=t.get(\"WEBGL_compressed_texture_astc\")))return e;if(103===e||104===e){if(i.isWebGL2){if(103===e)return 32775;if(104===e)return 32776}if(null!==(n=t.get(\"EXT_blend_minmax\"))){if(103===e)return n.MIN_EXT;if(104===e)return n.MAX_EXT}}if(1020===e){if(i.isWebGL2)return 34042;if(null!==(n=t.get(\"WEBGL_depth_texture\")))return n.UNSIGNED_INT_24_8_WEBGL}return 0}}}function dt(){_.call(this),this.type=\"Group\"}function ft(){_.call(this),this.type=\"Camera\",this.matrixWorldInverse=new n,this.projectionMatrix=new n,this.projectionMatrixInverse=new n}function mt(e,t,i,n){ft.call(this),this.type=\"PerspectiveCamera\",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function gt(e){mt.call(this),this.cameras=e||[]}function vt(e,t,i){To.setFromMatrixPosition(t.matrixWorld),Ao.setFromMatrixPosition(i.matrixWorld);var n=To.distanceTo(Ao),r=t.projectionMatrix.elements,o=i.projectionMatrix.elements,a=r[14]/(r[10]-1);i=r[14]/(r[10]+1);var s=(r[9]+1)/r[5],l=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(o[8]+1)/o[0];r=a*c,o=a*h,c=(h=n/(-c+h))*-c,t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(c),e.translateZ(h),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld),t=a+h,a=i+h,e.projectionMatrix.makePerspective(r-c,o+(n-c),s*i/a*t,l*i/a*t,t,a)}function yt(e){function t(){return null!==s&&!0===s.isPresenting}function i(){if(t()){var i=s.getEyeParameters(\"left\"),n=i.renderWidth*f;i=i.renderHeight*f,_=e.getPixelRatio(),E=e.getSize(),e.setDrawingBufferSize(2*n,i,1),T.start()}else a.enabled&&e.setDrawingBufferSize(E.width,E.height,_),T.stop()}var a=this,s=null,c=null,h=null,u=[],p=new n,d=new n,f=1,m=\"stage\";\"undefined\"!=typeof window&&\"VRFrameData\"in window&&(c=new window.VRFrameData,window.addEventListener(\"vrdisplaypresentchange\",i,!1));var g=new n,v=new r,y=new o,b=new mt;b.bounds=new l(0,0,.5,1),b.layers.enable(1);var w=new mt;w.bounds=new l(.5,0,.5,1),w.layers.enable(2);var M=new gt([b,w]);M.layers.enable(1),M.layers.enable(2);var E,_,S=[];this.enabled=!1,this.getController=function(e){var t=u[e];return void 0===t&&((t=new dt).matrixAutoUpdate=!1,t.visible=!1,u[e]=t),t},this.getDevice=function(){return s},this.setDevice=function(e){void 0!==e&&(s=e),T.setContext(e)},this.setFramebufferScaleFactor=function(e){f=e},this.setFrameOfReferenceType=function(e){m=e},this.setPoseTarget=function(e){void 0!==e&&(h=e)},this.getCamera=function(e){var t=\"stage\"===m?1.6:0;if(null===s)return e.position.set(0,t,0),e;if(s.depthNear=e.near,s.depthFar=e.far,s.getFrameData(c),\"stage\"===m){var i=s.stageParameters;i?p.fromArray(i.sittingToStandingTransform):p.makeTranslation(0,t,0)}if(t=c.pose,(i=null!==h?h:e).matrix.copy(p),i.matrix.decompose(i.position,i.quaternion,i.scale),null!==t.orientation&&(v.fromArray(t.orientation),i.quaternion.multiply(v)),null!==t.position&&(v.setFromRotationMatrix(p),y.fromArray(t.position),y.applyQuaternion(v),i.position.add(y)),i.updateMatrixWorld(),!1===s.isPresenting)return e;b.near=e.near,w.near=e.near,b.far=e.far,w.far=e.far,b.matrixWorldInverse.fromArray(c.leftViewMatrix),w.matrixWorldInverse.fromArray(c.rightViewMatrix),d.getInverse(p),\"stage\"===m&&(b.matrixWorldInverse.multiply(d),w.matrixWorldInverse.multiply(d)),null!==(e=i.parent)&&(g.getInverse(e.matrixWorld),b.matrixWorldInverse.multiply(g),w.matrixWorldInverse.multiply(g)),b.matrixWorld.getInverse(b.matrixWorldInverse),w.matrixWorld.getInverse(w.matrixWorldInverse),b.projectionMatrix.fromArray(c.leftProjectionMatrix),w.projectionMatrix.fromArray(c.rightProjectionMatrix),vt(M,b,w),(e=s.getLayers()).length&&(null!==(e=e[0]).leftBounds&&4===e.leftBounds.length&&b.bounds.fromArray(e.leftBounds),null!==e.rightBounds&&4===e.rightBounds.length&&w.bounds.fromArray(e.rightBounds));e:for(e=0;e<u.length;e++){t=u[e];t:{i=e;for(var n=navigator.getGamepads&&navigator.getGamepads(),r=0,o=0,a=n.length;r<a;r++){var l=n[r];if(l&&(\"Daydream Controller\"===l.id||\"Gear VR Controller\"===l.id||\"Oculus Go Controller\"===l.id||\"OpenVR Gamepad\"===l.id||l.id.startsWith(\"Oculus Touch\")||l.id.startsWith(\"Spatial Controller\"))){if(o===i){i=l;break t}o++}}i=void 0}if(void 0!==i&&void 0!==i.pose){if(null===i.pose)break e;!1===(n=i.pose).hasPosition&&t.position.set(.2,-.6,-.05),null!==n.position&&t.position.fromArray(n.position),null!==n.orientation&&t.quaternion.fromArray(n.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(p),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0,n=\"Daydream Controller\"===i.id?0:1,S[e]!==i.buttons[n].pressed&&(S[e]=i.buttons[n].pressed,!0===S[e]?t.dispatchEvent({type:\"selectstart\"}):(t.dispatchEvent({type:\"selectend\"}),t.dispatchEvent({type:\"select\"})))}else t.visible=!1}return M},this.getStandingMatrix=function(){return p},this.isPresenting=t;var T=new x;this.setAnimationLoop=function(e){T.setAnimationLoop(e)},this.submitFrame=function(){t()&&s.submitFrame()},this.dispose=function(){\"undefined\"!=typeof window&&window.removeEventListener(\"vrdisplaypresentchange\",i)}}function xt(e){function t(){return null!==s&&null!==h}function i(e){var t=d[f.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function n(){e.setFramebuffer(null),b.stop()}function r(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}var o=e.context,a=null,s=null,c=1,h=null,u=\"stage\",p=null,d=[],f=[],m=new mt;m.layers.enable(1),m.viewport=new l;var g=new mt;g.layers.enable(2),g.viewport=new l;var v=new gt([m,g]);v.layers.enable(1),v.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=d[e];return void 0===t&&((t=new dt).matrixAutoUpdate=!1,t.visible=!1,d[e]=t),t},this.getDevice=function(){return a},this.setDevice=function(e){void 0!==e&&(a=e),e instanceof XRDevice&&o.setCompatibleXRDevice(e)},this.setFramebufferScaleFactor=function(e){c=e},this.setFrameOfReferenceType=function(e){u=e},this.setSession=function(t){null!==(s=t)&&(s.addEventListener(\"select\",i),s.addEventListener(\"selectstart\",i),s.addEventListener(\"selectend\",i),s.addEventListener(\"end\",n),s.baseLayer=new XRWebGLLayer(s,o,{framebufferScaleFactor:c}),s.requestFrameOfReference(u).then((function(t){h=t,e.setFramebuffer(s.baseLayer.framebuffer),b.setContext(s),b.start()})),f=s.getInputSources(),s.addEventListener(\"inputsourceschange\",(function(){f=s.getInputSources(),console.log(f);for(var e=0;e<d.length;e++)d[e].userData.inputSource=f[e]})))},this.getCamera=function(e){if(t()){var i=e.parent,n=v.cameras;r(v,i);for(var o=0;o<n.length;o++)r(n[o],i);for(e.matrixWorld.copy(v.matrixWorld),o=0,i=(e=e.children).length;o<i;o++)e[o].updateMatrixWorld(!0);return vt(v,m,g),v}return e},this.isPresenting=t;var y=null,b=new x;b.setAnimationLoop((function(e,t){if(null!==(p=t.getDevicePose(h)))for(var i=s.baseLayer,n=t.views,r=0;r<n.length;r++){var o=n[r],a=i.getViewport(o),l=p.getViewMatrix(o),c=v.cameras[r];c.matrix.fromArray(l).getInverse(c.matrix),c.projectionMatrix.fromArray(o.projectionMatrix),c.viewport.set(a.x,a.y,a.width,a.height),0===r&&v.matrix.copy(c.matrix)}for(r=0;r<d.length;r++)i=d[r],(n=f[r])&&null!==(n=t.getInputPose(n,h))?(\"targetRay\"in n?i.matrix.elements=n.targetRay.transformMatrix:\"pointerMatrix\"in n&&(i.matrix.elements=n.pointerMatrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.visible=!0):i.visible=!1;y&&y(e)})),this.setAnimationLoop=function(e){y=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn(\"THREE.WebXRManager: getStandingMatrix() is no longer needed.\"),new THREE.Matrix4},this.submitFrame=function(){}}function bt(e){var t;function i(){B=new $(Ne),(z=new J(Ne,B,e)).isWebGL2||(B.get(\"WEBGL_depth_texture\"),B.get(\"OES_texture_float\"),B.get(\"OES_texture_half_float\"),B.get(\"OES_texture_half_float_linear\"),B.get(\"OES_standard_derivatives\"),B.get(\"OES_element_index_uint\"),B.get(\"ANGLE_instanced_arrays\")),B.get(\"OES_texture_float_linear\"),ne=new pt(Ne,B,z),(O=new ht(Ne,B,ne,z)).scissor(ve.copy(_e).multiplyScalar(Me)),O.viewport(ge.copy(Ee).multiplyScalar(Me)),F=new ie(Ne),I=new Ke,D=new ut(Ne,B,O,I,z,ne,F),H=new b(Ne),j=new ee(Ne,H,F),V=new oe(j,F),q=new re(Ne),k=new Je(ae,B,z),U=new it,G=new at,W=new Y(ae,O,V,C),Q=new Z(Ne,B,F,z),X=new te(Ne,B,F,z),F.programs=k.programs,ae.context=Ne,ae.capabilities=z,ae.extensions=B,ae.properties=I,ae.renderLists=U,ae.state=O,ae.info=F}function r(e){e.preventDefault(),console.log(\"THREE.WebGLRenderer: Context Lost.\"),se=!0}function a(){console.log(\"THREE.WebGLRenderer: Context Restored.\"),se=!1,i()}function s(e){(e=e.target).removeEventListener(\"dispose\",s),c(e),I.remove(e)}function c(e){var t=I.get(e).program;e.program=void 0,void 0!==t&&k.releaseProgram(t)}function h(e,t,i,n){for(var r=0,o=e.length;r<o;r++){var a=e[r],s=a.object,l=a.geometry,c=void 0===n?a.material:n;if(a=a.group,i.isArrayCamera){me=i;for(var h=i.cameras,u=0,d=h.length;u<d;u++){var f=h[u];if(s.layers.test(f.layers)){if(\"viewport\"in f)O.viewport(ge.copy(f.viewport));else{var m=f.bounds;O.viewport(ge.set(m.x*be,m.y*we,m.z*be,m.w*we).multiplyScalar(Me))}N.setupLights(f),p(s,t,f,l,c,a)}}}else me=null,p(s,t,i,l,c,a)}}function p(e,i,n,r,o,a){if(e.onBeforeRender(ae,i,n,r,o,a),N=G.get(i,me||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){O.setMaterial(o);var s=f(n,i.fog,o,e);pe=t=null,de=!1,function(e,t){e.render((function(e){ae.renderBufferImmediate(e,t)}))}(e,s)}else ae.renderBufferDirect(n,i.fog,r,o,e,a);e.onAfterRender(ae,i,n,r,o,a),N=G.get(i,me||n)}function d(e,t,i){var n=I.get(e),r=N.state.lights,o=n.lightsHash,a=r.state.hash;i=k.getParameters(e,r.state,N.state.shadowsArray,t,Ae.numPlanes,Ae.numIntersection,i);var l=k.getProgramCode(e,i),h=n.program,u=!0;if(void 0===h)e.addEventListener(\"dispose\",s);else if(h.code!==l)c(e);else{if(o.stateID!==a.stateID||o.directionalLength!==a.directionalLength||o.pointLength!==a.pointLength||o.spotLength!==a.spotLength||o.rectAreaLength!==a.rectAreaLength||o.hemiLength!==a.hemiLength||o.shadowsLength!==a.shadowsLength)o.stateID=a.stateID,o.directionalLength=a.directionalLength,o.pointLength=a.pointLength,o.spotLength=a.spotLength,o.rectAreaLength=a.rectAreaLength,o.hemiLength=a.hemiLength,o.shadowsLength=a.shadowsLength;else if(void 0!==i.shaderID)return;u=!1}if(u&&(i.shaderID?(l=lo[i.shaderID],n.shader={name:e.type,uniforms:g(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}):n.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader},e.onBeforeCompile(n.shader,ae),l=k.getProgramCode(e,i),h=k.acquireProgram(e,n.shader,i,l),n.program=h,e.program=h),i=h.getAttributes(),e.morphTargets)for(l=e.numSupportedMorphTargets=0;l<ae.maxMorphTargets;l++)0<=i[\"morphTarget\"+l]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(l=e.numSupportedMorphNormals=0;l<ae.maxMorphNormals;l++)0<=i[\"morphNormal\"+l]&&e.numSupportedMorphNormals++;i=n.shader.uniforms,(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=Ae.numPlanes,n.numIntersection=Ae.numIntersection,i.clippingPlanes=Ae.uniform),n.fog=t,void 0===o&&(n.lightsHash=o={}),o.stateID=a.stateID,o.directionalLength=a.directionalLength,o.pointLength=a.pointLength,o.spotLength=a.spotLength,o.rectAreaLength=a.rectAreaLength,o.hemiLength=a.hemiLength,o.shadowsLength=a.shadowsLength,e.lights&&(i.ambientLightColor.value=r.state.ambient,i.directionalLights.value=r.state.directional,i.spotLights.value=r.state.spot,i.rectAreaLights.value=r.state.rectArea,i.pointLights.value=r.state.point,i.hemisphereLights.value=r.state.hemi,i.directionalShadowMap.value=r.state.directionalShadowMap,i.directionalShadowMatrix.value=r.state.directionalShadowMatrix,i.spotShadowMap.value=r.state.spotShadowMap,i.spotShadowMatrix.value=r.state.spotShadowMatrix,i.pointShadowMap.value=r.state.pointShadowMap,i.pointShadowMatrix.value=r.state.pointShadowMatrix),e=n.program.getUniforms(),e=He.seqWithValue(e.seq,i),n.uniformsList=e}function f(e,t,i,n){xe=0;var r=I.get(i),o=r.lightsHash,a=N.state.lights.state.hash;Ce&&(Re||e!==fe)&&Ae.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,r,e===fe&&i.id===ue),!1===i.needsUpdate&&(void 0===r.program||i.fog&&r.fog!==t?i.needsUpdate=!0:(!i.lights||o.stateID===a.stateID&&o.directionalLength===a.directionalLength&&o.pointLength===a.pointLength&&o.spotLength===a.spotLength&&o.rectAreaLength===a.rectAreaLength&&o.hemiLength===a.hemiLength&&o.shadowsLength===a.shadowsLength)&&(void 0===r.numClippingPlanes||r.numClippingPlanes===Ae.numPlanes&&r.numIntersection===Ae.numIntersection)||(i.needsUpdate=!0)),i.needsUpdate&&(d(i,t,n),i.needsUpdate=!1);var s=!1,l=!1,c=!1;a=(o=r.program).getUniforms();var h=r.shader.uniforms;if(O.useProgram(o.program)&&(c=l=s=!0),i.id!==ue&&(ue=i.id,l=!0),(s||fe!==e)&&(a.setValue(Ne,\"projectionMatrix\",e.projectionMatrix),z.logarithmicDepthBuffer&&a.setValue(Ne,\"logDepthBufFC\",2/(Math.log(e.far+1)/Math.LN2)),fe!==e&&(fe=e,c=l=!0),(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap)&&void 0!==(s=a.map.cameraPosition)&&s.setValue(Ne,Pe.setFromMatrixPosition(e.matrixWorld)),(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&a.setValue(Ne,\"viewMatrix\",e.matrixWorldInverse)),i.skinning&&(a.setOptional(Ne,n,\"bindMatrix\"),a.setOptional(Ne,n,\"bindMatrixInverse\"),e=n.skeleton))if(s=e.bones,z.floatVertexTextures){if(void 0===e.boneTexture){s=Math.sqrt(4*s.length),s=eo.ceilPowerOfTwo(s),s=Math.max(s,4);var p=new Float32Array(s*s*4);p.set(e.boneMatrices);var f=new u(p,s,s,1023,1015);f.needsUpdate=!0,e.boneMatrices=p,e.boneTexture=f,e.boneTextureSize=s}a.setValue(Ne,\"boneTexture\",e.boneTexture),a.setValue(Ne,\"boneTextureSize\",e.boneTextureSize)}else a.setOptional(Ne,e,\"boneMatrices\");return l&&(a.setValue(Ne,\"toneMappingExposure\",ae.toneMappingExposure),a.setValue(Ne,\"toneMappingWhitePoint\",ae.toneMappingWhitePoint),i.lights&&(l=c,h.ambientLightColor.needsUpdate=l,h.directionalLights.needsUpdate=l,h.pointLights.needsUpdate=l,h.spotLights.needsUpdate=l,h.rectAreaLights.needsUpdate=l,h.hemisphereLights.needsUpdate=l),t&&i.fog&&(h.fogColor.value=t.color,t.isFog?(h.fogNear.value=t.near,h.fogFar.value=t.far):t.isFogExp2&&(h.fogDensity.value=t.density)),i.isMeshBasicMaterial?v(h,i):i.isMeshLambertMaterial?(v(h,i),i.emissiveMap&&(h.emissiveMap.value=i.emissiveMap)):i.isMeshPhongMaterial?(v(h,i),i.isMeshToonMaterial?(y(h,i),i.gradientMap&&(h.gradientMap.value=i.gradientMap)):y(h,i)):i.isMeshStandardMaterial?(v(h,i),i.isMeshPhysicalMaterial?(w(h,i),h.reflectivity.value=i.reflectivity,h.clearCoat.value=i.clearCoat,h.clearCoatRoughness.value=i.clearCoatRoughness):w(h,i)):i.isMeshMatcapMaterial?(v(h,i),i.matcap&&(h.matcap.value=i.matcap),i.bumpMap&&(h.bumpMap.value=i.bumpMap,h.bumpScale.value=i.bumpScale,1===i.side&&(h.bumpScale.value*=-1)),i.normalMap&&(h.normalMap.value=i.normalMap,h.normalScale.value.copy(i.normalScale),1===i.side&&h.normalScale.value.negate()),i.displacementMap&&(h.displacementMap.value=i.displacementMap,h.displacementScale.value=i.displacementScale,h.displacementBias.value=i.displacementBias)):i.isMeshDepthMaterial?(v(h,i),i.displacementMap&&(h.displacementMap.value=i.displacementMap,h.displacementScale.value=i.displacementScale,h.displacementBias.value=i.displacementBias)):i.isMeshDistanceMaterial?(v(h,i),i.displacementMap&&(h.displacementMap.value=i.displacementMap,h.displacementScale.value=i.displacementScale,h.displacementBias.value=i.displacementBias),h.referencePosition.value.copy(i.referencePosition),h.nearDistance.value=i.nearDistance,h.farDistance.value=i.farDistance):i.isMeshNormalMaterial?(v(h,i),i.bumpMap&&(h.bumpMap.value=i.bumpMap,h.bumpScale.value=i.bumpScale,1===i.side&&(h.bumpScale.value*=-1)),i.normalMap&&(h.normalMap.value=i.normalMap,h.normalScale.value.copy(i.normalScale),1===i.side&&h.normalScale.value.negate()),i.displacementMap&&(h.displacementMap.value=i.displacementMap,h.displacementScale.value=i.displacementScale,h.displacementBias.value=i.displacementBias)):i.isLineBasicMaterial?(h.diffuse.value=i.color,h.opacity.value=i.opacity,i.isLineDashedMaterial&&(h.dashSize.value=i.dashSize,h.totalSize.value=i.dashSize+i.gapSize,h.scale.value=i.scale)):i.isPointsMaterial?(h.diffuse.value=i.color,h.opacity.value=i.opacity,h.size.value=i.size*Me,h.scale.value=.5*we,h.map.value=i.map,null!==i.map&&(!0===i.map.matrixAutoUpdate&&i.map.updateMatrix(),h.uvTransform.value.copy(i.map.matrix))):i.isSpriteMaterial?(h.diffuse.value=i.color,h.opacity.value=i.opacity,h.rotation.value=i.rotation,h.map.value=i.map,null!==i.map&&(!0===i.map.matrixAutoUpdate&&i.map.updateMatrix(),h.uvTransform.value.copy(i.map.matrix))):i.isShadowMaterial&&(h.color.value=i.color,h.opacity.value=i.opacity),void 0!==h.ltc_1&&(h.ltc_1.value=so.LTC_1),void 0!==h.ltc_2&&(h.ltc_2.value=so.LTC_2),He.upload(Ne,r.uniformsList,h,ae)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(He.upload(Ne,r.uniformsList,h,ae),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&a.setValue(Ne,\"center\",n.center),a.setValue(Ne,\"modelViewMatrix\",n.modelViewMatrix),a.setValue(Ne,\"normalMatrix\",n.normalMatrix),a.setValue(Ne,\"modelMatrix\",n.matrixWorld),o}function v(e,t){if(e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=I.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map)var i=t.map;else t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap);void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}function y(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function w(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}console.log(\"THREE.WebGLRenderer\",\"100\");var M=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\"),E=void 0!==e.context?e.context:null,_=void 0!==e.alpha&&e.alpha,S=void 0===e.depth||e.depth,T=void 0===e.stencil||e.stencil,A=void 0!==e.antialias&&e.antialias,C=void 0===e.premultipliedAlpha||e.premultipliedAlpha,R=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,L=void 0!==e.powerPreference?e.powerPreference:\"default\",P=null,N=null;this.domElement=M,this.context=null,this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1,this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var B,z,O,F,I,D,H,j,V,k,U,G,W,q,Q,X,ne,ae=this,se=!1,le=null,ce=null,he=null,ue=-1,pe=t=null,de=!1,fe=null,me=null,ge=new l,ve=new l,ye=null,xe=0,be=M.width,we=M.height,Me=1,Ee=new l(0,0,be,we),_e=new l(0,0,be,we),Se=!1,Te=new m,Ae=new K,Ce=!1,Re=!1,Le=new n,Pe=new o;try{_={alpha:_,depth:S,stencil:T,antialias:A,premultipliedAlpha:C,preserveDrawingBuffer:R,powerPreference:L},M.addEventListener(\"webglcontextlost\",r,!1),M.addEventListener(\"webglcontextrestored\",a,!1);var Ne=E||M.getContext(\"webgl\",_)||M.getContext(\"experimental-webgl\",_);if(null===Ne){if(null!==M.getContext(\"webgl\"))throw Error(\"Error creating WebGL context with your selected attributes.\");throw Error(\"Error creating WebGL context.\")}void 0===Ne.getShaderPrecisionFormat&&(Ne.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error(\"THREE.WebGLRenderer: \"+e.message)}i();var Be=null;\"undefined\"!=typeof navigator&&(Be=\"xr\"in navigator?new xt(ae):new yt(ae)),this.vr=Be;var ze=new ct(ae,V,z.maxTextureSize);this.shadowMap=ze,this.getContext=function(){return Ne},this.getContextAttributes=function(){return Ne.getContextAttributes()},this.forceContextLoss=function(){var e=B.get(\"WEBGL_lose_context\");e&&e.loseContext()},this.forceContextRestore=function(){var e=B.get(\"WEBGL_lose_context\");e&&e.restoreContext()},this.getPixelRatio=function(){return Me},this.setPixelRatio=function(e){void 0!==e&&(Me=e,this.setSize(be,we,!1))},this.getSize=function(){return{width:be,height:we}},this.setSize=function(e,t,i){Be.isPresenting()?console.warn(\"THREE.WebGLRenderer: Can't change size while VR device is presenting.\"):(be=e,we=t,M.width=e*Me,M.height=t*Me,!1!==i&&(M.style.width=e+\"px\",M.style.height=t+\"px\"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(){return{width:be*Me,height:we*Me}},this.setDrawingBufferSize=function(e,t,i){be=e,we=t,Me=i,M.width=e*i,M.height=t*i,this.setViewport(0,0,e,t)},this.getCurrentViewport=function(){return ge},this.setViewport=function(e,t,i,n){Ee.set(e,we-t-n,i,n),O.viewport(ge.copy(Ee).multiplyScalar(Me))},this.setScissor=function(e,t,i,n){_e.set(e,we-t-n,i,n),O.scissor(ve.copy(_e).multiplyScalar(Me))},this.setScissorTest=function(e){O.setScissorTest(Se=e)},this.getClearColor=function(){return W.getClearColor()},this.setClearColor=function(){W.setClearColor.apply(W,arguments)},this.getClearAlpha=function(){return W.getClearAlpha()},this.setClearAlpha=function(){W.setClearAlpha.apply(W,arguments)},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),Ne.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){M.removeEventListener(\"webglcontextlost\",r,!1),M.removeEventListener(\"webglcontextrestored\",a,!1),U.dispose(),G.dispose(),I.dispose(),V.dispose(),Be.dispose(),Fe.stop()},this.renderBufferImmediate=function(e,t){O.initAttributes();var i=I.get(e);e.hasPositions&&!i.position&&(i.position=Ne.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=Ne.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=Ne.createBuffer()),e.hasColors&&!i.color&&(i.color=Ne.createBuffer()),t=t.getAttributes(),e.hasPositions&&(Ne.bindBuffer(34962,i.position),Ne.bufferData(34962,e.positionArray,35048),O.enableAttribute(t.position),Ne.vertexAttribPointer(t.position,3,5126,!1,0,0)),e.hasNormals&&(Ne.bindBuffer(34962,i.normal),Ne.bufferData(34962,e.normalArray,35048),O.enableAttribute(t.normal),Ne.vertexAttribPointer(t.normal,3,5126,!1,0,0)),e.hasUvs&&(Ne.bindBuffer(34962,i.uv),Ne.bufferData(34962,e.uvArray,35048),O.enableAttribute(t.uv),Ne.vertexAttribPointer(t.uv,2,5126,!1,0,0)),e.hasColors&&(Ne.bindBuffer(34962,i.color),Ne.bufferData(34962,e.colorArray,35048),O.enableAttribute(t.color),Ne.vertexAttribPointer(t.color,3,5126,!1,0,0)),O.disableUnusedAttributes(),Ne.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,i,n,r,o,a){var s=o.isMesh&&0>o.normalMatrix.determinant();O.setMaterial(r,s);var l=f(e,i,r,o),c=!1;t===n.id&&pe===l.id&&de===(!0===r.wireframe)||(t=n.id,pe=l.id,de=!0===r.wireframe,c=!0),o.morphTargetInfluences&&(q.update(o,n,r,l),c=!0),s=n.index;var h=n.attributes.position;if(i=1,!0===r.wireframe&&(s=j.getWireframeAttribute(n),i=2),e=Q,null!==s){var u=H.get(s);(e=X).setIndex(u)}if(c){if(n&&n.isInstancedBufferGeometry&!z.isWebGL2&&null===B.get(\"ANGLE_instanced_arrays\"))console.error(\"THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.\");else{O.initAttributes(),c=n.attributes,l=l.getAttributes();var p=r.defaultAttributeValues;for(E in l){var d=l[E];if(0<=d){var m=c[E];if(void 0!==m){var g=m.normalized,v=m.itemSize,y=H.get(m);if(void 0!==y){var x=y.buffer,b=y.type;if(y=y.bytesPerElement,m.isInterleavedBufferAttribute){var w=m.data,M=w.stride;m=m.offset,w&&w.isInstancedInterleavedBuffer?(O.enableAttributeAndDivisor(d,w.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=w.meshPerAttribute*w.count)):O.enableAttribute(d),Ne.bindBuffer(34962,x),Ne.vertexAttribPointer(d,v,b,g,M*y,m*y)}else m.isInstancedBufferAttribute?(O.enableAttributeAndDivisor(d,m.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=m.meshPerAttribute*m.count)):O.enableAttribute(d),Ne.bindBuffer(34962,x),Ne.vertexAttribPointer(d,v,b,g,0,0)}}else if(void 0!==p&&void 0!==(g=p[E]))switch(g.length){case 2:Ne.vertexAttrib2fv(d,g);break;case 3:Ne.vertexAttrib3fv(d,g);break;case 4:Ne.vertexAttrib4fv(d,g);break;default:Ne.vertexAttrib1fv(d,g)}}}O.disableUnusedAttributes()}null!==s&&Ne.bindBuffer(34963,u.buffer)}u=1/0,null!==s?u=s.count:void 0!==h&&(u=h.count),s=n.drawRange.start*i,h=null!==a?a.start*i:0;var E=Math.max(s,h);if(0!==(a=Math.max(0,Math.min(u,s+n.drawRange.count*i,h+(null!==a?a.count*i:1/0))-1-E+1))){if(o.isMesh)if(!0===r.wireframe)O.setLineWidth(r.wireframeLinewidth*(null===ce?Me:1)),e.setMode(1);else switch(o.drawMode){case 0:e.setMode(4);break;case 1:e.setMode(5);break;case 2:e.setMode(6)}else o.isLine?(void 0===(r=r.linewidth)&&(r=1),O.setLineWidth(r*(null===ce?Me:1)),o.isLineSegments?e.setMode(1):o.isLineLoop?e.setMode(2):e.setMode(3)):o.isPoints?e.setMode(0):o.isSprite&&e.setMode(4);n&&n.isInstancedBufferGeometry?0<n.maxInstancedCount&&e.renderInstances(n,E,a):e.render(E,a)}},this.compile=function(e,t){(N=G.get(e,t)).init(),e.traverse((function(e){e.isLight&&(N.pushLight(e),e.castShadow&&N.pushShadow(e))})),N.setupLights(t),e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var i=0;i<t.material.length;i++)d(t.material[i],e.fog,t);else d(t.material,e.fog,t)}))};var Oe=null,Fe=new x;Fe.setAnimationLoop((function(e){Be.isPresenting()||Oe&&Oe(e)})),\"undefined\"!=typeof window&&Fe.setContext(window),this.setAnimationLoop=function(e){Oe=e,Be.setAnimationLoop(e),Fe.start()},this.render=function(e,i,n,r){if(i&&i.isCamera){if(!se){pe=t=null,de=!1,ue=-1,fe=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),Be.enabled&&(i=Be.getCamera(i)),(N=G.get(e,i)).init(),e.onBeforeRender(ae,e,i,n),Le.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Te.setFromMatrix(Le),Re=this.localClippingEnabled,Ce=Ae.init(this.clippingPlanes,Re,i),(P=U.get(e,i)).init(),function e(t,i,n){if(!1!==t.visible){if(t.layers.test(i.layers))if(t.isLight)N.pushLight(t),t.castShadow&&N.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Te.intersectsSprite(t)){n&&Pe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Le);var r=V.update(t),o=t.material;P.push(t,r,o,Pe.z,null)}}else if(t.isImmediateRenderObject)n&&Pe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Le),P.push(t,null,t.material,Pe.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||Te.intersectsObject(t)))if(n&&Pe.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Le),r=V.update(t),o=t.material,Array.isArray(o))for(var a=r.groups,s=0,l=a.length;s<l;s++){var c=a[s],h=o[c.materialIndex];h&&h.visible&&P.push(t,r,h,Pe.z,c)}else o.visible&&P.push(t,r,o,Pe.z,null);for(s=0,l=(t=t.children).length;s<l;s++)e(t[s],i,n)}}(e,i,ae.sortObjects),!0===ae.sortObjects&&P.sort(),Ce&&Ae.beginShadows(),ze.render(N.state.shadowsArray,e,i),N.setupLights(i),Ce&&Ae.endShadows(),this.info.autoReset&&this.info.reset(),void 0===n&&(n=null),this.setRenderTarget(n),W.render(P,e,i,r),r=P.opaque;var o=P.transparent;if(e.overrideMaterial){var a=e.overrideMaterial;r.length&&h(r,e,i,a),o.length&&h(o,e,i,a)}else r.length&&h(r,e,i),o.length&&h(o,e,i);n&&D.updateRenderTargetMipmap(n),O.buffers.depth.setTest(!0),O.buffers.depth.setMask(!0),O.buffers.color.setMask(!0),O.setPolygonOffset(!1),e.onAfterRender(ae,e,i),Be.enabled&&Be.submitFrame(),N=P=null}}else console.error(\"THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.\")},this.allocTextureUnit=function(){var e=xe;return e>=z.maxTextures&&console.warn(\"THREE.WebGLRenderer: Trying to use \"+e+\" texture units while this GPU supports only \"+z.maxTextures),xe+=1,e},this.setTexture2D=function(){var e=!1;return function(t,i){t&&t.isWebGLRenderTarget&&(e||(console.warn(\"THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead.\"),e=!0),t=t.texture),D.setTexture2D(t,i)}}(),this.setTexture3D=function(e,t){D.setTexture3D(e,t)},this.setTexture=function(){var e=!1;return function(t,i){e||(console.warn(\"THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead.\"),e=!0),D.setTexture2D(t,i)}}(),this.setTextureCube=function(){var e=!1;return function(t,i){t&&t.isWebGLRenderTargetCube&&(e||(console.warn(\"THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead.\"),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?D.setTextureCube(t,i):D.setTextureCubeDynamic(t,i)}}(),this.setFramebuffer=function(e){le=e},this.getRenderTarget=function(){return ce},this.setRenderTarget=function(e){(ce=e)&&void 0===I.get(e).__webglFramebuffer&&D.setupRenderTarget(e);var t=le,i=!1;e?(t=I.get(e).__webglFramebuffer,e.isWebGLRenderTargetCube&&(t=t[e.activeCubeFace],i=!0),ge.copy(e.viewport),ve.copy(e.scissor),ye=e.scissorTest):(ge.copy(Ee).multiplyScalar(Me),ve.copy(_e).multiplyScalar(Me),ye=Se),he!==t&&(Ne.bindFramebuffer(36160,t),he=t),O.viewport(ge),O.scissor(ve),O.setScissorTest(ye),i&&(i=I.get(e.texture),Ne.framebufferTexture2D(36160,36064,34069+e.activeCubeFace,i.__webglTexture,e.activeMipMapLevel))},this.readRenderTargetPixels=function(e,t,i,n,r,o){if(e&&e.isWebGLRenderTarget){var a=I.get(e).__webglFramebuffer;if(a){var s=!1;a!==he&&(Ne.bindFramebuffer(36160,a),s=!0);try{var l=e.texture,c=l.format,h=l.type;1023!==c&&ne.convert(c)!==Ne.getParameter(35739)?console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.\"):1009===h||ne.convert(h)===Ne.getParameter(35738)||1015===h&&(z.isWebGL2||B.get(\"OES_texture_float\")||B.get(\"WEBGL_color_buffer_float\"))||1016===h&&(z.isWebGL2?B.get(\"EXT_color_buffer_float\"):B.get(\"EXT_color_buffer_half_float\"))?36053===Ne.checkFramebufferStatus(36160)?0<=t&&t<=e.width-n&&0<=i&&i<=e.height-r&&Ne.readPixels(t,i,n,r,ne.convert(c),ne.convert(h),o):console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.\"):console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.\")}finally{s&&Ne.bindFramebuffer(36160,he)}}}else console.error(\"THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.\")},this.copyFramebufferToTexture=function(e,t,i){var n=t.image.width,r=t.image.height,o=ne.convert(t.format);this.setTexture2D(t,0),Ne.copyTexImage2D(3553,i||0,o,e.x,e.y,n,r,0)},this.copyTextureToTexture=function(e,t,i,n){var r=t.image.width,o=t.image.height,a=ne.convert(i.format),s=ne.convert(i.type);this.setTexture2D(i,0),t.isDataTexture?Ne.texSubImage2D(3553,n||0,e.x,e.y,r,o,a,s,t.image.data):Ne.texSubImage2D(3553,n||0,e.x,e.y,a,s,t.image)}}function wt(e,t){this.name=\"\",this.color=new y(e),this.density=void 0!==t?t:25e-5}function Mt(e,t,i){this.name=\"\",this.color=new y(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function Et(){_.call(this),this.type=\"Scene\",this.overrideMaterial=this.fog=this.background=null,this.autoUpdate=!0}function _t(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function St(e,t,i,n){this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}function Tt(e){U.call(this),this.type=\"SpriteMaterial\",this.color=new y(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function At(e){if(_.call(this),this.type=\"Sprite\",void 0===So){So=new D;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);t=new _t(t,5),So.setIndex([0,1,2,0,2,3]),So.addAttribute(\"position\",new St(t,3,0,!1)),So.addAttribute(\"uv\",new St(t,2,3,!1))}this.geometry=So,this.material=void 0!==e?e:new Tt,this.center=new i(.5,.5)}function Ct(){_.call(this),this.type=\"LOD\",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Rt(e,t){e&&e.isGeometry&&console.error(\"THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\"),X.call(this,e,t),this.type=\"SkinnedMesh\",this.bindMode=\"attached\",this.bindMatrix=new n,this.bindMatrixInverse=new n}function Lt(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else for(console.warn(\"THREE.Skeleton boneInverses is the wrong length.\"),this.boneInverses=[],e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new n)}function Pt(){_.call(this),this.type=\"Bone\"}function Nt(e){U.call(this),this.type=\"LineBasicMaterial\",this.color=new y(16777215),this.linewidth=1,this.linejoin=this.linecap=\"round\",this.lights=!1,this.setValues(e)}function Bt(e,t,i){1===i&&console.error(\"THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead.\"),_.call(this),this.type=\"Line\",this.geometry=void 0!==e?e:new D,this.material=void 0!==t?t:new Nt({color:16777215*Math.random()})}function zt(e,t){Bt.call(this,e,t),this.type=\"LineSegments\"}function Ot(e,t){Bt.call(this,e,t),this.type=\"LineLoop\"}function Ft(e){U.call(this),this.type=\"PointsMaterial\",this.color=new y(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=this.morphTargets=!1,this.setValues(e)}function It(e,t){_.call(this),this.type=\"Points\",this.geometry=void 0!==e?e:new D,this.material=void 0!==t?t:new Ft({color:16777215*Math.random()})}function Dt(e,t,i,n,r,o,a,l,c){s.call(this,e,t,i,n,r,o,a,l,c),this.format=void 0!==a?a:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==r?r:1006,this.generateMipmaps=!1}function Ht(e,t,i,n,r,o,a,l,c,h,u,p){s.call(this,null,o,a,l,c,h,n,r,u,p),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=this.flipY=!1}function jt(e,t,i,n,r,o,a,l,c){s.call(this,e,t,i,n,r,o,a,l,c),this.needsUpdate=!0}function Vt(e,t,i,n,r,o,a,l,c,h){if(1026!==(h=void 0!==h?h:1026)&&1027!==h)throw Error(\"DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat\");void 0===i&&1026===h&&(i=1012),void 0===i&&1027===h&&(i=1020),s.call(this,null,n,r,o,a,l,h,i,c),this.image={width:e,height:t},this.magFilter=void 0!==a?a:1003,this.minFilter=void 0!==l?l:1003,this.generateMipmaps=this.flipY=!1}function kt(e){D.call(this),this.type=\"WireframeGeometry\";var t,i,n,r=[],a=[0,0],s={},l=[\"a\",\"b\",\"c\"];if(e&&e.isGeometry){var c=e.faces,h=0;for(i=c.length;h<i;h++){var u=c[h];for(t=0;3>t;t++){var p=u[l[t]],d=u[l[(t+1)%3]];a[0]=Math.min(p,d),a[1]=Math.max(p,d),void 0===s[p=a[0]+\",\"+a[1]]&&(s[p]={index1:a[0],index2:a[1]})}}for(p in s)h=s[p],l=e.vertices[h.index1],r.push(l.x,l.y,l.z),l=e.vertices[h.index2],r.push(l.x,l.y,l.z)}else if(e&&e.isBufferGeometry)if(l=new o,null!==e.index){c=e.attributes.position,u=e.index;var f=e.groups;for(0===f.length&&(f=[{start:0,count:u.count,materialIndex:0}]),e=0,n=f.length;e<n;++e)for(t=(h=f[e]).start,i=h.count,h=t,i=t+i;h<i;h+=3)for(t=0;3>t;t++)p=u.getX(h+t),d=u.getX(h+(t+1)%3),a[0]=Math.min(p,d),a[1]=Math.max(p,d),void 0===s[p=a[0]+\",\"+a[1]]&&(s[p]={index1:a[0],index2:a[1]});for(p in s)h=s[p],l.fromBufferAttribute(c,h.index1),r.push(l.x,l.y,l.z),l.fromBufferAttribute(c,h.index2),r.push(l.x,l.y,l.z)}else for(h=0,i=(c=e.attributes.position).count/3;h<i;h++)for(t=0;3>t;t++)s=3*h+t,l.fromBufferAttribute(c,s),r.push(l.x,l.y,l.z),s=3*h+(t+1)%3,l.fromBufferAttribute(c,s),r.push(l.x,l.y,l.z);this.addAttribute(\"position\",new z(r,3))}function Ut(e,t,i){S.call(this),this.type=\"ParametricGeometry\",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new Gt(e,t,i)),this.mergeVertices()}function Gt(e,t,i){D.call(this),this.type=\"ParametricBufferGeometry\",this.parameters={func:e,slices:t,stacks:i};var n,r,a=[],s=[],l=[],c=[],h=new o,u=new o,p=new o,d=new o,f=new o;3>e.length&&console.error(\"THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.\");var m=t+1;for(n=0;n<=i;n++){var g=n/i;for(r=0;r<=t;r++){var v=r/t;e(v,g,u),s.push(u.x,u.y,u.z),0<=v-1e-5?(e(v-1e-5,g,p),d.subVectors(u,p)):(e(v+1e-5,g,p),d.subVectors(p,u)),0<=g-1e-5?(e(v,g-1e-5,p),f.subVectors(u,p)):(e(v,g+1e-5,p),f.subVectors(p,u)),h.crossVectors(d,f).normalize(),l.push(h.x,h.y,h.z),c.push(v,g)}}for(n=0;n<i;n++)for(r=0;r<t;r++)e=n*m+r+1,h=(n+1)*m+r+1,u=(n+1)*m+r,a.push(n*m+r,e,u),a.push(e,h,u);this.setIndex(a),this.addAttribute(\"position\",new z(s,3)),this.addAttribute(\"normal\",new z(l,3)),this.addAttribute(\"uv\",new z(c,2))}function Wt(e,t,i,n){S.call(this),this.type=\"PolyhedronGeometry\",this.parameters={vertices:e,indices:t,radius:i,detail:n},this.fromBufferGeometry(new qt(e,t,i,n)),this.mergeVertices()}function qt(e,t,n,r){function a(e){c.push(e.x,e.y,e.z)}function s(t,i){t*=3,i.x=e[t+0],i.y=e[t+1],i.z=e[t+2]}function l(e,t,i,n){0>n&&1===e.x&&(h[t]=e.x-1),0===i.x&&0===i.z&&(h[t]=n/2/Math.PI+.5)}D.call(this),this.type=\"PolyhedronBufferGeometry\",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1;var c=[],h=[];!function(e){for(var i=new o,n=new o,r=new o,l=0;l<t.length;l+=3){s(t[l+0],i),s(t[l+1],n),s(t[l+2],r);var c,h,u=i,p=n,d=r,f=Math.pow(2,e),m=[];for(h=0;h<=f;h++){m[h]=[];var g=u.clone().lerp(d,h/f),v=p.clone().lerp(d,h/f),y=f-h;for(c=0;c<=y;c++)m[h][c]=0===c&&h===f?g:g.clone().lerp(v,c/y)}for(h=0;h<f;h++)for(c=0;c<2*(f-h)-1;c++)u=Math.floor(c/2),0==c%2?(a(m[h][u+1]),a(m[h+1][u]),a(m[h][u])):(a(m[h][u+1]),a(m[h+1][u+1]),a(m[h+1][u]))}}(r=r||0),function(e){for(var t=new o,i=0;i<c.length;i+=3)t.x=c[i+0],t.y=c[i+1],t.z=c[i+2],t.normalize().multiplyScalar(e),c[i+0]=t.x,c[i+1]=t.y,c[i+2]=t.z}(n),function(){for(var e=new o,t=0;t<c.length;t+=3)e.x=c[t+0],e.y=c[t+1],e.z=c[t+2],h.push(Math.atan2(e.z,-e.x)/2/Math.PI+.5,1-(Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5));e=new o,t=new o;for(var n=new o,r=new o,a=new i,s=new i,u=new i,p=0,d=0;p<c.length;p+=9,d+=6){e.set(c[p+0],c[p+1],c[p+2]),t.set(c[p+3],c[p+4],c[p+5]),n.set(c[p+6],c[p+7],c[p+8]),a.set(h[d+0],h[d+1]),s.set(h[d+2],h[d+3]),u.set(h[d+4],h[d+5]),r.copy(e).add(t).add(n).divideScalar(3);var f=Math.atan2(r.z,-r.x);l(a,d+0,e,f),l(s,d+2,t,f),l(u,d+4,n,f)}for(e=0;e<h.length;e+=6)t=h[e+0],n=h[e+2],r=h[e+4],a=Math.min(t,n,r),.9<Math.max(t,n,r)&&.1>a&&(.2>t&&(h[e+0]+=1),.2>n&&(h[e+2]+=1),.2>r&&(h[e+4]+=1))}(),this.addAttribute(\"position\",new z(c,3)),this.addAttribute(\"normal\",new z(c.slice(),3)),this.addAttribute(\"uv\",new z(h,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Qt(e,t){S.call(this),this.type=\"TetrahedronGeometry\",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Xt(e,t)),this.mergeVertices()}function Xt(e,t){qt.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type=\"TetrahedronBufferGeometry\",this.parameters={radius:e,detail:t}}function Yt(e,t){S.call(this),this.type=\"OctahedronGeometry\",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Zt(e,t)),this.mergeVertices()}function Zt(e,t){qt.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type=\"OctahedronBufferGeometry\",this.parameters={radius:e,detail:t}}function Jt(e,t){S.call(this),this.type=\"IcosahedronGeometry\",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Kt(e,t)),this.mergeVertices()}function Kt(e,t){var i=(1+Math.sqrt(5))/2;qt.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type=\"IcosahedronBufferGeometry\",this.parameters={radius:e,detail:t}}function $t(e,t){S.call(this),this.type=\"DodecahedronGeometry\",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ei(e,t)),this.mergeVertices()}function ei(e,t){var i=(1+Math.sqrt(5))/2,n=1/i;qt.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type=\"DodecahedronBufferGeometry\",this.parameters={radius:e,detail:t}}function ti(e,t,i,n,r,o){S.call(this),this.type=\"TubeGeometry\",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r},void 0!==o&&console.warn(\"THREE.TubeGeometry: taper has been removed.\"),e=new ii(e,t,i,n,r),this.tangents=e.tangents,this.normals=e.normals,this.binormals=e.binormals,this.fromBufferGeometry(e),this.mergeVertices()}function ii(e,t,n,r,a){function s(i){f=e.getPointAt(i/t,f);var o=l.normals[i];for(i=l.binormals[i],h=0;h<=r;h++){var a=h/r*Math.PI*2,s=Math.sin(a);a=-Math.cos(a),p.x=a*o.x+s*i.x,p.y=a*o.y+s*i.y,p.z=a*o.z+s*i.z,p.normalize(),g.push(p.x,p.y,p.z),u.x=f.x+n*p.x,u.y=f.y+n*p.y,u.z=f.z+n*p.z,m.push(u.x,u.y,u.z)}}D.call(this),this.type=\"TubeBufferGeometry\",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:a},t=t||64,n=n||1,r=r||8,a=a||!1;var l=e.computeFrenetFrames(t,a);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;var c,h,u=new o,p=new o,d=new i,f=new o,m=[],g=[],v=[],y=[];for(c=0;c<t;c++)s(c);for(s(!1===a?t:0),c=0;c<=t;c++)for(h=0;h<=r;h++)d.x=c/t,d.y=h/r,v.push(d.x,d.y);!function(){for(h=1;h<=t;h++)for(c=1;c<=r;c++){var e=(r+1)*h+(c-1),i=(r+1)*h+c,n=(r+1)*(h-1)+c;y.push((r+1)*(h-1)+(c-1),e,n),y.push(e,i,n)}}(),this.setIndex(y),this.addAttribute(\"position\",new z(m,3)),this.addAttribute(\"normal\",new z(g,3)),this.addAttribute(\"uv\",new z(v,2))}function ni(e,t,i,n,r,o,a){S.call(this),this.type=\"TorusKnotGeometry\",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},void 0!==a&&console.warn(\"THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.\"),this.fromBufferGeometry(new ri(e,t,i,n,r,o)),this.mergeVertices()}function ri(e,t,i,n,r,a){function s(e,t,i,n,r){var o=Math.sin(e);t=i/t*e,i=Math.cos(t),r.x=n*(2+i)*.5*Math.cos(e),r.y=n*(2+i)*o*.5,r.z=n*Math.sin(t)*.5}D.call(this),this.type=\"TorusKnotBufferGeometry\",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:a},e=e||1,t=t||.4,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,a=a||3;var l,c=[],h=[],u=[],p=[],d=new o,f=new o,m=new o,g=new o,v=new o,y=new o,x=new o;for(l=0;l<=i;++l){var b=l/i*r*Math.PI*2;for(s(b,r,a,e,m),s(b+.01,r,a,e,g),y.subVectors(g,m),x.addVectors(g,m),v.crossVectors(y,x),x.crossVectors(v,y),v.normalize(),x.normalize(),b=0;b<=n;++b){var w=b/n*Math.PI*2,M=-t*Math.cos(w);w=t*Math.sin(w),d.x=m.x+(M*x.x+w*v.x),d.y=m.y+(M*x.y+w*v.y),d.z=m.z+(M*x.z+w*v.z),h.push(d.x,d.y,d.z),f.subVectors(d,m).normalize(),u.push(f.x,f.y,f.z),p.push(l/i),p.push(b/n)}}for(b=1;b<=i;b++)for(l=1;l<=n;l++)e=(n+1)*b+(l-1),t=(n+1)*b+l,r=(n+1)*(b-1)+l,c.push((n+1)*(b-1)+(l-1),e,r),c.push(e,t,r);this.setIndex(c),this.addAttribute(\"position\",new z(h,3)),this.addAttribute(\"normal\",new z(u,3)),this.addAttribute(\"uv\",new z(p,2))}function oi(e,t,i,n,r){S.call(this),this.type=\"TorusGeometry\",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new ai(e,t,i,n,r)),this.mergeVertices()}function ai(e,t,i,n,r){D.call(this),this.type=\"TorusBufferGeometry\",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},e=e||1,t=t||.4,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;var a,s,l=[],c=[],h=[],u=[],p=new o,d=new o,f=new o;for(a=0;a<=i;a++)for(s=0;s<=n;s++){var m=s/n*r,g=a/i*Math.PI*2;d.x=(e+t*Math.cos(g))*Math.cos(m),d.y=(e+t*Math.cos(g))*Math.sin(m),d.z=t*Math.sin(g),c.push(d.x,d.y,d.z),p.x=e*Math.cos(m),p.y=e*Math.sin(m),f.subVectors(d,p).normalize(),h.push(f.x,f.y,f.z),u.push(s/n),u.push(a/i)}for(a=1;a<=i;a++)for(s=1;s<=n;s++)e=(n+1)*(a-1)+s-1,t=(n+1)*(a-1)+s,r=(n+1)*a+s,l.push((n+1)*a+s-1,e,r),l.push(e,t,r);this.setIndex(l),this.addAttribute(\"position\",new z(c,3)),this.addAttribute(\"normal\",new z(h,3)),this.addAttribute(\"uv\",new z(u,2))}function si(e,t,i,n,r){for(var o,a=0,s=t,l=i-n;s<i;s+=n)a+=(e[l]-e[s])*(e[s+1]+e[l+1]),l=s;if(r===0<a)for(r=t;r<i;r+=n)o=xi(r,e[r],e[r+1],o);else for(r=i-n;r>=t;r-=n)o=xi(r,e[r],e[r+1],o);return o&&mi(o,o.next)&&(bi(o),o=o.next),o}function li(e,t){if(!e)return e;t||(t=e);do{var i=!1;if(e.steiner||!mi(e,e.next)&&0!==fi(e.prev,e,e.next))e=e.next;else{if(bi(e),(e=t=e.prev)===e.next)break;i=!0}}while(i||e!==t);return t}function ci(e,t){return e.x-t.x}function hi(e,t){var i=t,n=e.x,r=e.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>o){if(o=a,a===n){if(r===i.y)return i;if(r===i.next.y)return i.next}var s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(n===o)return s.prev;t=s,a=s.x;var l=s.y,c=1/0;for(i=s.next;i!==t;){if(n>=i.x&&i.x>=a&&n!==i.x&&di(r<l?n:o,r,a,l,r<l?o:n,r,i.x,i.y)){var h=Math.abs(r-i.y)/(n-i.x);(h<c||h===c&&i.x>s.x)&&vi(i,e)&&(s=i,c=h)}i=i.next}return s}function ui(e,t,i,n,r){return 1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1)|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function pi(e){var t=e,i=e;do{t.x<i.x&&(i=t),t=t.next}while(t!==e);return i}function di(e,t,i,n,r,o,a,s){return 0<=(r-a)*(t-s)-(e-a)*(o-s)&&0<=(e-a)*(n-s)-(i-a)*(t-s)&&0<=(i-a)*(o-s)-(r-a)*(n-s)}function fi(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function mi(e,t){return e.x===t.x&&e.y===t.y}function gi(e,t,i,n){return!!(mi(e,t)&&mi(i,n)||mi(e,n)&&mi(i,t))||0<fi(e,t,i)!=0<fi(e,t,n)&&0<fi(i,n,e)!=0<fi(i,n,t)}function vi(e,t){return 0>fi(e.prev,e,e.next)?0<=fi(e,t,e.next)&&0<=fi(e,e.prev,t):0>fi(e,t,e.prev)||0>fi(e,e.next,t)}function yi(e,t){var i=new wi(e.i,e.x,e.y),n=new wi(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function xi(e,t,i,n){return e=new wi(e,t,i),n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function bi(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function wi(e,t,i){this.i=e,this.x=t,this.y=i,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function Mi(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function Ei(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}function _i(e,t){S.call(this),this.type=\"ExtrudeGeometry\",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Si(e,t)),this.mergeVertices()}function Si(e,t){function n(e){function n(e,t,i){return t||console.error(\"THREE.ExtrudeGeometry: vec does not exist\"),t.clone().multiplyScalar(i).add(e)}function l(e,t,n){var r=e.x-t.x,o=e.y-t.y,a=n.x-e.x,s=n.y-e.y,l=r*r+o*o;if(Math.abs(r*s-o*a)>Number.EPSILON){var c=Math.sqrt(l),h=Math.sqrt(a*a+s*s);if(l=t.x-o/c,t=t.y+r/c,2>=(o=(a=l+r*(s=((n.x-s/h-l)*s-(n.y+a/h-t)*a)/(r*s-o*a))-e.x)*a+(r=t+o*s-e.y)*r))return new i(a,r);o=Math.sqrt(o/2)}else e=!1,r>Number.EPSILON?a>Number.EPSILON&&(e=!0):r<-Number.EPSILON?a<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(s)&&(e=!0),e?(a=-o,o=Math.sqrt(l)):(a=r,r=o,o=Math.sqrt(l/2));return new i(a/o,r/o)}function c(e,t){for(j=e.length;0<=--j;){var i=j,n=j-1;0>n&&(n=e.length-1);var o,s=g+2*w;for(o=0;o<s;o++){var l=D*o,c=D*(o+1),h=t+n+l,u=t+n+c;c=t+i+c,p(t+i+l),p(h),p(c),p(h),p(u),p(c),l=a.length/3,d((l=E.generateSideWallUV(r,a,l-6,l-3,l-2,l-1))[0]),d(l[1]),d(l[3]),d(l[1]),d(l[2]),d(l[3])}}}function h(e,t,i){f.push(e),f.push(t),f.push(i)}function u(e,t,i){p(e),p(t),p(i),e=a.length/3,d((e=E.generateTopUV(r,a,e-3,e-2,e-1))[0]),d(e[1]),d(e[2])}function p(e){a.push(f[3*e]),a.push(f[3*e+1]),a.push(f[3*e+2])}function d(e){s.push(e.x),s.push(e.y)}var f=[],m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=void 0!==t.depth?t.depth:100,y=void 0===t.bevelEnabled||t.bevelEnabled,x=void 0!==t.bevelThickness?t.bevelThickness:6,b=void 0!==t.bevelSize?t.bevelSize:x-2,w=void 0!==t.bevelSegments?t.bevelSegments:3,M=t.extrudePath,E=void 0!==t.UVGenerator?t.UVGenerator:Lo;void 0!==t.amount&&(console.warn(\"THREE.ExtrudeBufferGeometry: amount has been renamed to depth.\"),v=t.amount);var _,S=!1;if(M){var T=M.getSpacedPoints(g);S=!0,y=!1;var A=M.computeFrenetFrames(g,!1),C=new o,R=new o,L=new o}y||(b=x=w=0),m=e.extractPoints(m),e=m.shape;var P=m.holes;if(!Ro.isClockWise(e)){e=e.reverse();var N=0;for(_=P.length;N<_;N++){var B=P[N];Ro.isClockWise(B)&&(P[N]=B.reverse())}}var z=Ro.triangulateShape(e,P),O=e;for(N=0,_=P.length;N<_;N++)B=P[N],e=e.concat(B);var F,I,D=e.length,H=z.length;m=[];var j=0,V=O.length,k=V-1;for(F=j+1;j<V;j++,k++,F++)k===V&&(k=0),F===V&&(F=0),m[j]=l(O[j],O[k],O[F]);M=[];var U=m.concat();for(N=0,_=P.length;N<_;N++){B=P[N];var G=[];for(j=0,k=(V=B.length)-1,F=j+1;j<V;j++,k++,F++)k===V&&(k=0),F===V&&(F=0),G[j]=l(B[j],B[k],B[F]);M.push(G),U=U.concat(G)}for(k=0;k<w;k++){V=k/w;var W=x*Math.cos(V*Math.PI/2);for(F=b*Math.sin(V*Math.PI/2),j=0,V=O.length;j<V;j++){var q=n(O[j],m[j],F);h(q.x,q.y,-W)}for(N=0,_=P.length;N<_;N++)for(B=P[N],G=M[N],j=0,V=B.length;j<V;j++)h((q=n(B[j],G[j],F)).x,q.y,-W)}for(F=b,j=0;j<D;j++)q=y?n(e[j],U[j],F):e[j],S?(R.copy(A.normals[0]).multiplyScalar(q.x),C.copy(A.binormals[0]).multiplyScalar(q.y),L.copy(T[0]).add(R).add(C),h(L.x,L.y,L.z)):h(q.x,q.y,0);for(V=1;V<=g;V++)for(j=0;j<D;j++)q=y?n(e[j],U[j],F):e[j],S?(R.copy(A.normals[V]).multiplyScalar(q.x),C.copy(A.binormals[V]).multiplyScalar(q.y),L.copy(T[V]).add(R).add(C),h(L.x,L.y,L.z)):h(q.x,q.y,v/g*V);for(k=w-1;0<=k;k--){for(V=k/w,W=x*Math.cos(V*Math.PI/2),F=b*Math.sin(V*Math.PI/2),j=0,V=O.length;j<V;j++)h((q=n(O[j],m[j],F)).x,q.y,v+W);for(N=0,_=P.length;N<_;N++)for(B=P[N],G=M[N],j=0,V=B.length;j<V;j++)q=n(B[j],G[j],F),S?h(q.x,q.y+T[g-1].y,T[g-1].x+W):h(q.x,q.y,v+W)}!function(){var e=a.length/3;if(y){var t=0*D;for(j=0;j<H;j++)u((I=z[j])[2]+t,I[1]+t,I[0]+t);for(t=D*(g+2*w),j=0;j<H;j++)u((I=z[j])[0]+t,I[1]+t,I[2]+t)}else{for(j=0;j<H;j++)u((I=z[j])[2],I[1],I[0]);for(j=0;j<H;j++)u((I=z[j])[0]+D*g,I[1]+D*g,I[2]+D*g)}r.addGroup(e,a.length/3-e,0)}(),function(){var e=a.length/3,t=0;for(c(O,t),t+=O.length,N=0,_=P.length;N<_;N++)c(B=P[N],t),t+=B.length;r.addGroup(e,a.length/3-e,1)}()}D.call(this),this.type=\"ExtrudeBufferGeometry\",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,a=[],s=[],l=0,c=e.length;l<c;l++)n(e[l]);this.addAttribute(\"position\",new z(a,3)),this.addAttribute(\"uv\",new z(s,2)),this.computeVertexNormals()}function Ti(e,t,i){if(i.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++)i.shapes.push(e[n].uuid);else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function Ai(e,t){S.call(this),this.type=\"TextGeometry\",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Ci(e,t)),this.mergeVertices()}function Ci(e,t){var i=(t=t||{}).font;if(!i||!i.isFont)return console.error(\"THREE.TextGeometry: font parameter is not an instance of THREE.Font.\"),new S;e=i.generateShapes(e,t.size),t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Si.call(this,e,t),this.type=\"TextBufferGeometry\"}function Ri(e,t,i,n,r,o,a){S.call(this),this.type=\"SphereGeometry\",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Li(e,t,i,n,r,o,a)),this.mergeVertices()}function Li(e,t,i,n,r,a,s){D.call(this),this.type=\"SphereBufferGeometry\",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var l,c,h=(a=void 0!==a?a:0)+(s=void 0!==s?s:Math.PI),u=0,p=[],d=new o,f=new o,m=[],g=[],v=[],y=[];for(c=0;c<=i;c++){var x=[],b=c/i;for(l=0;l<=t;l++){var w=l/t;d.x=-e*Math.cos(n+w*r)*Math.sin(a+b*s),d.y=e*Math.cos(a+b*s),d.z=e*Math.sin(n+w*r)*Math.sin(a+b*s),g.push(d.x,d.y,d.z),f.set(d.x,d.y,d.z).normalize(),v.push(f.x,f.y,f.z),y.push(w,1-b),x.push(u++)}p.push(x)}for(c=0;c<i;c++)for(l=0;l<t;l++)e=p[c][l+1],n=p[c][l],r=p[c+1][l],s=p[c+1][l+1],(0!==c||0<a)&&m.push(e,n,s),(c!==i-1||h<Math.PI)&&m.push(n,r,s);this.setIndex(m),this.addAttribute(\"position\",new z(g,3)),this.addAttribute(\"normal\",new z(v,3)),this.addAttribute(\"uv\",new z(y,2))}function Pi(e,t,i,n,r,o){S.call(this),this.type=\"RingGeometry\",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Ni(e,t,i,n,r,o)),this.mergeVertices()}function Ni(e,t,n,r,a,s){D.call(this),this.type=\"RingBufferGeometry\",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:a,thetaLength:s},e=e||.5,t=t||1,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var l,c,h=[],u=[],p=[],d=[],f=e,m=(t-e)/(r=void 0!==r?Math.max(1,r):1),g=new o,v=new i;for(l=0;l<=r;l++){for(c=0;c<=n;c++)e=a+c/n*s,g.x=f*Math.cos(e),g.y=f*Math.sin(e),u.push(g.x,g.y,g.z),p.push(0,0,1),v.x=(g.x/t+1)/2,v.y=(g.y/t+1)/2,d.push(v.x,v.y);f+=m}for(l=0;l<r;l++)for(t=l*(n+1),c=0;c<n;c++)a=(e=c+t)+n+1,s=e+n+2,f=e+1,h.push(e,a,f),h.push(a,s,f);this.setIndex(h),this.addAttribute(\"position\",new z(u,3)),this.addAttribute(\"normal\",new z(p,3)),this.addAttribute(\"uv\",new z(d,2))}function Bi(e,t,i,n){S.call(this),this.type=\"LatheGeometry\",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},this.fromBufferGeometry(new zi(e,t,i,n)),this.mergeVertices()}function zi(e,t,n,r){D.call(this),this.type=\"LatheBufferGeometry\",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t)||12,n=n||0,r=r||2*Math.PI,r=eo.clamp(r,0,2*Math.PI);var a,s=[],l=[],c=[],h=1/t,u=new o,p=new i;for(a=0;a<=t;a++){var d=n+a*h*r,f=Math.sin(d),m=Math.cos(d);for(d=0;d<=e.length-1;d++)u.x=e[d].x*f,u.y=e[d].y,u.z=e[d].x*m,l.push(u.x,u.y,u.z),p.x=a/t,p.y=d/(e.length-1),c.push(p.x,p.y)}for(a=0;a<t;a++)for(d=0;d<e.length-1;d++)h=(n=d+a*e.length)+e.length,u=n+e.length+1,p=n+1,s.push(n,h,p),s.push(h,u,p);if(this.setIndex(s),this.addAttribute(\"position\",new z(l,3)),this.addAttribute(\"uv\",new z(c,2)),this.computeVertexNormals(),r===2*Math.PI)for(r=this.attributes.normal.array,s=new o,l=new o,c=new o,n=t*e.length*3,d=a=0;a<e.length;a++,d+=3)s.x=r[d+0],s.y=r[d+1],s.z=r[d+2],l.x=r[n+d+0],l.y=r[n+d+1],l.z=r[n+d+2],c.addVectors(s,l).normalize(),r[d+0]=r[n+d+0]=c.x,r[d+1]=r[n+d+1]=c.y,r[d+2]=r[n+d+2]=c.z}function Oi(e,t){S.call(this),this.type=\"ShapeGeometry\",\"object\"==typeof t&&(console.warn(\"THREE.ShapeGeometry: Options parameter has been removed.\"),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Fi(e,t)),this.mergeVertices()}function Fi(e,t){function i(e){var i,s=r.length/3,c=(e=e.extractPoints(t)).shape,h=e.holes;for(!1===Ro.isClockWise(c)&&(c=c.reverse()),e=0,i=h.length;e<i;e++){var u=h[e];!0===Ro.isClockWise(u)&&(h[e]=u.reverse())}var p=Ro.triangulateShape(c,h);for(e=0,i=h.length;e<i;e++)u=h[e],c=c.concat(u);for(e=0,i=c.length;e<i;e++)u=c[e],r.push(u.x,u.y,0),o.push(0,0,1),a.push(u.x,u.y);for(e=0,i=p.length;e<i;e++)c=p[e],n.push(c[0]+s,c[1]+s,c[2]+s),l+=3}D.call(this),this.type=\"ShapeBufferGeometry\",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],r=[],o=[],a=[],s=0,l=0;if(!1===Array.isArray(e))i(e);else for(var c=0;c<e.length;c++)i(e[c]),this.addGroup(s,l,c),s+=l,l=0;this.setIndex(n),this.addAttribute(\"position\",new z(r,3)),this.addAttribute(\"normal\",new z(o,3)),this.addAttribute(\"uv\",new z(a,2))}function Ii(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,n=e.length;i<n;i++)t.shapes.push(e[i].uuid);else t.shapes.push(e.uuid);return t}function Di(e,t){D.call(this),this.type=\"EdgesGeometry\",this.parameters={thresholdAngle:t};var i=[];t=Math.cos(eo.DEG2RAD*(void 0!==t?t:1));var n=[0,0],r={},o=[\"a\",\"b\",\"c\"];if(e.isBufferGeometry){var a=new S;a.fromBufferGeometry(e)}else a=e.clone();a.mergeVertices(),a.computeFaceNormals(),e=a.vertices;for(var s=0,l=(a=a.faces).length;s<l;s++)for(var c=a[s],h=0;3>h;h++){var u=c[o[h]],p=c[o[(h+1)%3]];n[0]=Math.min(u,p),n[1]=Math.max(u,p),void 0===r[u=n[0]+\",\"+n[1]]?r[u]={index1:n[0],index2:n[1],face1:s,face2:void 0}:r[u].face2=s}for(u in r)(void 0===(n=r[u]).face2||a[n.face1].normal.dot(a[n.face2].normal)<=t)&&(o=e[n.index1],i.push(o.x,o.y,o.z),o=e[n.index2],i.push(o.x,o.y,o.z));this.addAttribute(\"position\",new z(i,3))}function Hi(e,t,i,n,r,o,a,s){S.call(this),this.type=\"CylinderGeometry\",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new ji(e,t,i,n,r,o,a,s)),this.mergeVertices()}function ji(e,t,n,r,a,s,l,c){function h(n){var a,s=new i,h=new o,v=0,b=!0===n?e:t,w=!0===n?1:-1,M=g;for(a=1;a<=r;a++)d.push(0,y*w,0),f.push(0,w,0),m.push(.5,.5),g++;var E=g;for(a=0;a<=r;a++){var _=a/r*c+l,S=Math.cos(_);_=Math.sin(_),h.x=b*_,h.y=y*w,h.z=b*S,d.push(h.x,h.y,h.z),f.push(0,w,0),s.x=.5*S+.5,s.y=.5*_*w+.5,m.push(s.x,s.y),g++}for(a=0;a<r;a++)s=M+a,h=E+a,!0===n?p.push(h,h+1,s):p.push(h+1,h,s),v+=3;u.addGroup(x,v,!0===n?1:2),x+=v}D.call(this),this.type=\"CylinderBufferGeometry\",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:a,openEnded:s,thetaStart:l,thetaLength:c};var u=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,r=Math.floor(r)||8,a=Math.floor(a)||1,s=void 0!==s&&s,l=void 0!==l?l:0,c=void 0!==c?c:2*Math.PI;var p=[],d=[],f=[],m=[],g=0,v=[],y=n/2,x=0;!function(){var i,s,h=new o,b=new o,w=0,M=(t-e)/n;for(s=0;s<=a;s++){var E=[],_=s/a,S=_*(t-e)+e;for(i=0;i<=r;i++){var T=i/r,A=T*c+l,C=Math.sin(A);A=Math.cos(A),b.x=S*C,b.y=-_*n+y,b.z=S*A,d.push(b.x,b.y,b.z),h.set(C,M,A).normalize(),f.push(h.x,h.y,h.z),m.push(T,1-_),E.push(g++)}v.push(E)}for(i=0;i<r;i++)for(s=0;s<a;s++)h=v[s+1][i],b=v[s+1][i+1],M=v[s][i+1],p.push(v[s][i],h,M),p.push(h,b,M),w+=6;u.addGroup(x,w,0),x+=w}(),!1===s&&(0<e&&h(!0),0<t&&h(!1)),this.setIndex(p),this.addAttribute(\"position\",new z(d,3)),this.addAttribute(\"normal\",new z(f,3)),this.addAttribute(\"uv\",new z(m,2))}function Vi(e,t,i,n,r,o,a){Hi.call(this,0,e,t,i,n,r,o,a),this.type=\"ConeGeometry\",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function ki(e,t,i,n,r,o,a){ji.call(this,0,e,t,i,n,r,o,a),this.type=\"ConeBufferGeometry\",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:a}}function Ui(e,t,i,n){S.call(this),this.type=\"CircleGeometry\",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new Gi(e,t,i,n)),this.mergeVertices()}function Gi(e,t,n,r){D.call(this),this.type=\"CircleBufferGeometry\",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var a,s=[],l=[],c=[],h=[],u=new o,p=new i;l.push(0,0,0),c.push(0,0,1),h.push(.5,.5);var d=0;for(a=3;d<=t;d++,a+=3){var f=n+d/t*r;u.x=e*Math.cos(f),u.y=e*Math.sin(f),l.push(u.x,u.y,u.z),c.push(0,0,1),p.x=(l[a]/e+1)/2,p.y=(l[a+1]/e+1)/2,h.push(p.x,p.y)}for(a=1;a<=t;a++)s.push(a,a+1,0);this.setIndex(s),this.addAttribute(\"position\",new z(l,3)),this.addAttribute(\"normal\",new z(c,3)),this.addAttribute(\"uv\",new z(h,2))}function Wi(e){U.call(this),this.type=\"ShadowMaterial\",this.color=new y(0),this.transparent=!0,this.setValues(e)}function qi(e){G.call(this,e),this.type=\"RawShaderMaterial\"}function Qi(e){U.call(this),this.defines={STANDARD:\"\"},this.type=\"MeshStandardMaterial\",this.color=new y(16777215),this.metalness=this.roughness=.5,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new y(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap=\"round\",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Xi(e){Qi.call(this),this.defines={PHYSICAL:\"\"},this.type=\"MeshPhysicalMaterial\",this.reflectivity=.5,this.clearCoatRoughness=this.clearCoat=0,this.setValues(e)}function Yi(e){U.call(this),this.type=\"MeshPhongMaterial\",this.color=new y(16777215),this.specular=new y(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new y(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap=\"round\",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Zi(e){Yi.call(this),this.defines={TOON:\"\"},this.type=\"MeshToonMaterial\",this.gradientMap=null,this.setValues(e)}function Ji(e){U.call(this),this.type=\"MeshNormalMaterial\",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1,this.setValues(e)}function Ki(e){U.call(this),this.type=\"MeshLambertMaterial\",this.color=new y(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new y(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap=\"round\",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function $i(e){U.call(this),this.defines={MATCAP:\"\"},this.type=\"MeshMatcapMaterial\",this.color=new y(16777215),this.bumpMap=this.map=this.matcap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.lights=this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function en(e){Nt.call(this),this.type=\"LineDashedMaterial\",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function tn(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function nn(e,t,i,n){tn.call(this,e,t,i,n),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function rn(e,t,i,n){tn.call(this,e,t,i,n)}function on(e,t,i,n){tn.call(this,e,t,i,n)}function an(e,t,i,n){if(void 0===e)throw Error(\"THREE.KeyframeTrack: track name is undefined\");if(void 0===t||0===t.length)throw Error(\"THREE.KeyframeTrack: no keyframes in track named \"+e);this.name=e,this.times=Bo.convertArray(t,this.TimeBufferType),this.values=Bo.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function sn(e,t,i){an.call(this,e,t,i)}function ln(e,t,i,n){an.call(this,e,t,i,n)}function cn(e,t,i,n){an.call(this,e,t,i,n)}function hn(e,t,i,n){tn.call(this,e,t,i,n)}function un(e,t,i,n){an.call(this,e,t,i,n)}function pn(e,t,i,n){an.call(this,e,t,i,n)}function dn(e,t,i,n){an.call(this,e,t,i,n)}function fn(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=eo.generateUUID(),0>this.duration&&this.resetDuration()}function mn(e){if(void 0===e.type)throw Error(\"THREE.KeyframeTrack: track type undefined, can not parse\");var t=function(e){switch(e.toLowerCase()){case\"scalar\":case\"double\":case\"float\":case\"number\":case\"integer\":return cn;case\"vector\":case\"vector2\":case\"vector3\":case\"vector4\":return dn;case\"color\":return ln;case\"quaternion\":return un;case\"bool\":case\"boolean\":return sn;case\"string\":return pn}throw Error(\"THREE.KeyframeTrack: Unsupported typeName: \"+e)}(e.type);if(void 0===e.times){var i=[],n=[];Bo.flattenJSON(e.keys,i,n,\"value\"),e.times=i,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function gn(e,t,i){var n=this,r=!1,o=0,a=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===r&&void 0!==n.onStart&&n.onStart(e,o,a),r=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(r=!1,void 0!==n.onLoad)&&n.onLoad()},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}function vn(e){this.manager=void 0!==e?e:Oo}function yn(e){this.manager=void 0!==e?e:Oo}function xn(e){this.manager=void 0!==e?e:Oo,this._parser=null}function bn(e){this.manager=void 0!==e?e:Oo,this._parser=null}function wn(e){this.manager=void 0!==e?e:Oo}function Mn(e){this.manager=void 0!==e?e:Oo}function En(e){this.manager=void 0!==e?e:Oo}function _n(){this.type=\"Curve\",this.arcLengthDivisions=200}function Sn(e,t,i,n,r,o,a,s){_n.call(this),this.type=\"EllipseCurve\",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=n||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function Tn(e,t,i,n,r,o){Sn.call(this,e,t,i,i,n,r,o),this.type=\"ArcCurve\"}function An(){var e=0,t=0,i=0,n=0;return{initCatmullRom:function(r,o,a,s,l){e=o,t=r=l*(a-r),i=-3*o+3*a-2*r-(s=l*(s-o)),n=2*o-2*a+r+s},initNonuniformCatmullRom:function(r,o,a,s,l,c,h){e=o,t=r=((o-r)/l-(a-r)/(l+c)+(a-o)/c)*c,i=-3*o+3*a-2*r-(s=((a-o)/c-(s-o)/(c+h)+(s-a)/h)*c),n=2*o-2*a+r+s},calc:function(r){var o=r*r;return e+t*r+i*o+n*o*r}}}function Cn(e,t,i,n){_n.call(this),this.type=\"CatmullRomCurve3\",this.points=e||[],this.closed=t||!1,this.curveType=i||\"centripetal\",this.tension=n||.5}function Rn(e,t,i,n,r){var o=e*e;return(2*i-2*n+(t=.5*(n-t))+(r=.5*(r-i)))*e*o+(-3*i+3*n-2*t-r)*o+t*e+i}function Ln(e,t,i,n){var r=1-e;return r*r*t+2*(1-e)*e*i+e*e*n}function Pn(e,t,i,n,r){var o=1-e,a=1-e;return o*o*o*t+3*a*a*e*i+3*(1-e)*e*e*n+e*e*e*r}function Nn(e,t,n,r){_n.call(this),this.type=\"CubicBezierCurve\",this.v0=e||new i,this.v1=t||new i,this.v2=n||new i,this.v3=r||new i}function Bn(e,t,i,n){_n.call(this),this.type=\"CubicBezierCurve3\",this.v0=e||new o,this.v1=t||new o,this.v2=i||new o,this.v3=n||new o}function zn(e,t){_n.call(this),this.type=\"LineCurve\",this.v1=e||new i,this.v2=t||new i}function On(e,t){_n.call(this),this.type=\"LineCurve3\",this.v1=e||new o,this.v2=t||new o}function Fn(e,t,n){_n.call(this),this.type=\"QuadraticBezierCurve\",this.v0=e||new i,this.v1=t||new i,this.v2=n||new i}function In(e,t,i){_n.call(this),this.type=\"QuadraticBezierCurve3\",this.v0=e||new o,this.v1=t||new o,this.v2=i||new o}function Dn(e){_n.call(this),this.type=\"SplineCurve\",this.points=e||[]}function Hn(){_n.call(this),this.type=\"CurvePath\",this.curves=[],this.autoClose=!1}function jn(e){Hn.call(this),this.type=\"Path\",this.currentPoint=new i,e&&this.setFromPoints(e)}function Vn(e){jn.call(this,e),this.uuid=eo.generateUUID(),this.type=\"Shape\",this.holes=[]}function kn(e,t){_.call(this),this.type=\"Light\",this.color=new y(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Un(e,t,i){kn.call(this,e,i),this.type=\"HemisphereLight\",this.castShadow=void 0,this.position.copy(_.DefaultUp),this.updateMatrix(),this.groundColor=new y(t)}function Gn(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new i(512,512),this.map=null,this.matrix=new n}function Wn(){Gn.call(this,new mt(50,1,.5,500))}function qn(e,t,i,n,r,o){kn.call(this,e,t),this.type=\"SpotLight\",this.position.copy(_.DefaultUp),this.updateMatrix(),this.target=new _,Object.defineProperty(this,\"power\",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new Wn}function Qn(e,t,i,n){kn.call(this,e,t),this.type=\"PointLight\",Object.defineProperty(this,\"power\",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new Gn(new mt(90,1,.5,500))}function Xn(e,t,i,n,r,o){ft.call(this),this.type=\"OrthographicCamera\",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Yn(){Gn.call(this,new Xn(-5,5,5,-5,.5,500))}function Zn(e,t){kn.call(this,e,t),this.type=\"DirectionalLight\",this.position.copy(_.DefaultUp),this.updateMatrix(),this.target=new _,this.shadow=new Yn}function Jn(e,t){kn.call(this,e,t),this.type=\"AmbientLight\",this.castShadow=void 0}function Kn(e,t,i,n){kn.call(this,e,t),this.type=\"RectAreaLight\",this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}function $n(e){this.manager=void 0!==e?e:Oo,this.textures={}}function er(e){this.manager=void 0!==e?e:Oo}function tr(e){this.manager=void 0!==e?e:Oo,this.resourcePath=\"\"}function ir(e){\"undefined\"==typeof createImageBitmap&&console.warn(\"THREE.ImageBitmapLoader: createImageBitmap() not supported.\"),\"undefined\"==typeof fetch&&console.warn(\"THREE.ImageBitmapLoader: fetch() not supported.\"),this.manager=void 0!==e?e:Oo,this.options=void 0}function nr(){this.type=\"ShapePath\",this.color=new y,this.subPaths=[],this.currentPath=null}function rr(e){this.type=\"Font\",this.data=e}function or(e){this.manager=void 0!==e?e:Oo}function ar(){}function sr(e){this.manager=void 0!==e?e:Oo}function lr(){this.type=\"StereoCamera\",this.aspect=1,this.eyeSep=.064,this.cameraL=new mt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new mt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function cr(e,t,i,n){_.call(this),this.type=\"CubeCamera\";var r=new mt(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new o(1,0,0)),this.add(r);var a=new mt(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new o(-1,0,0)),this.add(a);var s=new mt(90,1,e,t);s.up.set(0,0,1),s.lookAt(new o(0,1,0)),this.add(s);var l=new mt(90,1,e,t);l.up.set(0,0,-1),l.lookAt(new o(0,-1,0)),this.add(l);var c=new mt(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new o(0,0,1)),this.add(c);var u=new mt(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new o(0,0,-1)),this.add(u),n=n||{format:1022,magFilter:1006,minFilter:1006},this.renderTarget=new h(i,i,n),this.renderTarget.texture.name=\"CubeCamera\",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,n=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,r,i),i.activeCubeFace=1,e.render(t,a,i),i.activeCubeFace=2,e.render(t,s,i),i.activeCubeFace=3,e.render(t,l,i),i.activeCubeFace=4,e.render(t,c,i),i.texture.generateMipmaps=n,i.activeCubeFace=5,e.render(t,u,i),e.setRenderTarget(null)},this.clear=function(e,t,i,n){for(var r=this.renderTarget,o=0;6>o;o++)r.activeCubeFace=o,e.setRenderTarget(r),e.clear(t,i,n);e.setRenderTarget(null)}}function hr(e){this.autoStart=void 0===e||e,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function ur(){_.call(this),this.type=\"AudioListener\",this.context=Zo.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function pr(e){_.call(this),this.type=\"Audio\",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.offset=this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType=\"empty\",this.filters=[]}function dr(e){pr.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function fr(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function mr(e,t,i){switch(this.binding=e,this.valueSize=i,e=Float64Array,t){case\"quaternion\":t=this._slerp;break;case\"string\":case\"bool\":e=Array,t=this._select;break;default:t=this._lerp}this.buffer=new e(4*i),this._mixBufferRegion=t,this.referenceCount=this.useCount=this.cumulativeWeight=0}function gr(e,t,i){i=i||vr.parseTrackName(t),this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function vr(e,t,i){this.path=t,this.parsedPath=i||vr.parseTrackName(t),this.node=vr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function yr(){this.uuid=eo.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function xr(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null,t=(e=t.tracks).length,i=Array(t);for(var n={endingStart:2400,endingEnd:2400},r=0;r!==t;++r){var o=e[r].createInterpolant(null);i[r]=o,o.settings=n}this._interpolantSettings=n,this._interpolants=i,this._propertyBindings=Array(t),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function br(e){this._root=e,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function wr(e,t){\"string\"==typeof e&&(console.warn(\"THREE.Uniform: Type parameter is no longer needed.\"),e=t),this.value=e}function Mr(){D.call(this),this.type=\"InstancedBufferGeometry\",this.maxInstancedCount=void 0}function Er(e,t,i){_t.call(this,e,t),this.meshPerAttribute=i||1}function _r(e,t,i,n){\"number\"==typeof i&&(n=i,i=!1,console.error(\"THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.\")),T.call(this,e,t,i),this.meshPerAttribute=n||1}function Sr(e,t,i,n){this.ray=new W(e,t),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn(\"THREE.Raycaster: params.PointCloud has been renamed to params.Points.\"),this.Points}}})}function Tr(e,t){return e.distance-t.distance}function Ar(e,t,i,n){if(!1!==e.visible&&(e.raycast(t,i),!0===n)){n=0;for(var r=(e=e.children).length;n<r;n++)Ar(e[n],t,i,!0)}}function Cr(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}function Rr(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}function Lr(e,t){this.min=void 0!==e?e:new i(1/0,1/0),this.max=void 0!==t?t:new i(-1/0,-1/0)}function Pr(e,t){this.start=void 0!==e?e:new o,this.end=void 0!==t?t:new o}function Nr(e){_.call(this),this.material=e,this.render=function(){}}function Br(e,t,i,n){this.object=e,this.size=void 0!==t?t:1,e=void 0!==i?i:16711680,n=void 0!==n?n:1,t=0,(i=this.object.geometry)&&i.isGeometry?t=3*i.faces.length:i&&i.isBufferGeometry&&(t=i.attributes.normal.count),i=new D,t=new z(6*t,3),i.addAttribute(\"position\",t),zt.call(this,i,new Nt({color:e,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}function zr(e,t){_.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,e=new D,t=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var i=0,n=1;32>i;i++,n++){var r=i/32*Math.PI*2,o=n/32*Math.PI*2;t.push(Math.cos(r),Math.sin(r),1,Math.cos(o),Math.sin(o),1)}e.addAttribute(\"position\",new z(t,3)),t=new Nt({fog:!1}),this.cone=new zt(e,t),this.add(this.cone),this.update()}function Or(e){for(var t=function e(t){var i=[];t&&t.isBone&&i.push(t);for(var n=0;n<t.children.length;n++)i.push.apply(i,e(t.children[n]));return i}(e),i=new D,n=[],r=[],o=new y(0,0,1),a=new y(0,1,0),s=0;s<t.length;s++){var l=t[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}i.addAttribute(\"position\",new z(n,3)),i.addAttribute(\"color\",new z(r,3)),n=new Nt({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0}),zt.call(this,i,n),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Fr(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i,e=new Li(t,4,2),t=new Q({wireframe:!0,fog:!1}),X.call(this,e,t),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Ir(e,t){this.type=\"RectAreaLightHelper\",this.light=e,this.color=t,(e=new D).addAttribute(\"position\",new z([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),e.computeBoundingSphere(),t=new Nt({fog:!1}),Bt.call(this,e,t),(e=new D).addAttribute(\"position\",new z([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),e.computeBoundingSphere(),this.add(new X(e,new Q({side:THREE.BackSide,fog:!1}))),this.update()}function Dr(e,t,i){_.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,(e=new Zt(t)).rotateY(.5*Math.PI),this.material=new Q({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2),t=e.getAttribute(\"position\"),t=new Float32Array(3*t.count),e.addAttribute(\"color\",new T(t,3)),this.add(new X(e,this.material)),this.update()}function Hr(e,t,i,n){e=e||10,t=t||10,i=new y(void 0!==i?i:4473924),n=new y(void 0!==n?n:8947848);var r=t/2,o=e/t,a=e/2;e=[];for(var s=[],l=0,c=0,h=-a;l<=t;l++,h+=o){e.push(-a,0,h,a,0,h),e.push(h,0,-a,h,0,a);var u=l===r?i:n;u.toArray(s,c),c+=3,u.toArray(s,c),c+=3,u.toArray(s,c),c+=3,u.toArray(s,c),c+=3}(t=new D).addAttribute(\"position\",new z(e,3)),t.addAttribute(\"color\",new z(s,3)),i=new Nt({vertexColors:2}),zt.call(this,t,i)}function jr(e,t,i,n,r,o){e=e||10,t=t||16,i=i||8,n=n||64,r=new y(void 0!==r?r:4473924),o=new y(void 0!==o?o:8947848);var a,s=[],l=[];for(a=0;a<=t;a++){var c=a/t*2*Math.PI,h=Math.sin(c)*e;c=Math.cos(c)*e,s.push(0,0,0),s.push(h,0,c);var u=1&a?r:o;l.push(u.r,u.g,u.b),l.push(u.r,u.g,u.b)}for(a=0;a<=i;a++){u=1&a?r:o;var p=e-e/i*a;for(t=0;t<n;t++)c=t/n*2*Math.PI,h=Math.sin(c)*p,c=Math.cos(c)*p,s.push(h,0,c),l.push(u.r,u.g,u.b),c=(t+1)/n*2*Math.PI,h=Math.sin(c)*p,c=Math.cos(c)*p,s.push(h,0,c),l.push(u.r,u.g,u.b)}(e=new D).addAttribute(\"position\",new z(s,3)),e.addAttribute(\"color\",new z(l,3)),s=new Nt({vertexColors:2}),zt.call(this,e,s)}function Vr(e,t,i,n){this.object=e,this.size=void 0!==t?t:1,e=void 0!==i?i:16776960,n=void 0!==n?n:1,t=0,(i=this.object.geometry)&&i.isGeometry?t=i.faces.length:console.warn(\"THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.\"),i=new D,t=new z(6*t,3),i.addAttribute(\"position\",t),zt.call(this,i,new Nt({color:e,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}function kr(e,t,i){_.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1),(e=new D).addAttribute(\"position\",new z([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3)),t=new Nt({fog:!1}),this.lightPlane=new Bt(e,t),this.add(this.lightPlane),(e=new D).addAttribute(\"position\",new z([0,0,0,0,0,1],3)),this.targetLine=new Bt(e,t),this.add(this.targetLine),this.update()}function Ur(e){function t(e,t,n){i(e,n),i(t,n)}function i(e,t){o.push(0,0,0),a.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(o.length/3-1)}var n=new D,r=new Nt({color:16777215,vertexColors:1}),o=[],a=[],s={},l=new y(16755200),c=new y(16711680),h=new y(43775),u=new y(16777215),p=new y(3355443);t(\"n1\",\"n2\",l),t(\"n2\",\"n4\",l),t(\"n4\",\"n3\",l),t(\"n3\",\"n1\",l),t(\"f1\",\"f2\",l),t(\"f2\",\"f4\",l),t(\"f4\",\"f3\",l),t(\"f3\",\"f1\",l),t(\"n1\",\"f1\",l),t(\"n2\",\"f2\",l),t(\"n3\",\"f3\",l),t(\"n4\",\"f4\",l),t(\"p\",\"n1\",c),t(\"p\",\"n2\",c),t(\"p\",\"n3\",c),t(\"p\",\"n4\",c),t(\"u1\",\"u2\",h),t(\"u2\",\"u3\",h),t(\"u3\",\"u1\",h),t(\"c\",\"t\",u),t(\"p\",\"c\",p),t(\"cn1\",\"cn2\",p),t(\"cn3\",\"cn4\",p),t(\"cf1\",\"cf2\",p),t(\"cf3\",\"cf4\",p),n.addAttribute(\"position\",new z(o,3)),n.addAttribute(\"color\",new z(a,3)),zt.call(this,n,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function Gr(e,t){this.object=e,void 0===t&&(t=16776960),e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var i=new Float32Array(24),n=new D;n.setIndex(new T(e,1)),n.addAttribute(\"position\",new T(i,3)),zt.call(this,n,new Nt({color:t})),this.matrixAutoUpdate=!1,this.update()}function Wr(e,t){this.type=\"Box3Helper\",this.box=e,e=void 0!==t?t:16776960,t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var i=new D;i.setIndex(new T(t,1)),i.addAttribute(\"position\",new z([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),zt.call(this,i,new Nt({color:e})),this.geometry.computeBoundingSphere()}function qr(e,t,i){this.type=\"PlaneHelper\",this.plane=e,this.size=void 0===t?1:t,e=void 0!==i?i:16776960,(t=new D).addAttribute(\"position\",new z([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),t.computeBoundingSphere(),Bt.call(this,t,new Nt({color:e})),(t=new D).addAttribute(\"position\",new z([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),t.computeBoundingSphere(),this.add(new X(t,new Q({color:e,opacity:.2,transparent:!0,depthWrite:!1})))}function Qr(e,t,i,n,r,o){_.call(this),void 0===e&&(e=new THREE.Vector3(0,0,1)),void 0===t&&(t=new THREE.Vector3(0,0,0)),void 0===i&&(i=1),void 0===n&&(n=16776960),void 0===r&&(r=.2*i),void 0===o&&(o=.2*r),void 0===Xo&&((Xo=new D).addAttribute(\"position\",new z([0,0,0,0,1,0],3)),(Yo=new ji(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Bt(Xo,new Nt({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new X(Yo,new Q({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}function Xr(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e];(e=new D).addAttribute(\"position\",new z(t,3)),e.addAttribute(\"color\",new z([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),t=new Nt({vertexColors:2}),zt.call(this,e,t)}function Yr(e){console.warn(\"THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.\"),Cn.call(this,e),this.type=\"catmullrom\",this.closed=!0}function Zr(e){console.warn(\"THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.\"),Cn.call(this,e),this.type=\"catmullrom\"}function Jr(e){console.warn(\"THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.\"),Cn.call(this,e),this.type=\"catmullrom\"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return\"number\"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:0<e?1:+e}),0==\"name\"in Function.prototype&&Object.defineProperty(Function.prototype,\"name\",{get:function(){return this.toString().match(/^\\s*function\\s*([^\\(\\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError(\"Cannot convert undefined or null to object\");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){void 0!==this._listeners&&void 0!==(e=this._listeners[e])&&-1!==(t=e.indexOf(t))&&e.splice(t,1)},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=0,n=(t=t.slice(0)).length;i<n;i++)t[i].call(this,e)}}}});var Kr,$r,eo={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;256>t;t++)e[t]=(16>t?\"0\":\"\")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+\"-\"+e[255&i]+e[i>>8&255]+\"-\"+e[i>>16&15|64]+e[i>>24&255]+\"-\"+e[63&n|128]+e[n>>8&255]+\"-\"+e[n>>16&255]+e[n>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]).toUpperCase()}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*eo.DEG2RAD},radToDeg:function(e){return e*eo.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};Object.defineProperties(i.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(i.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error(\"index is out of range: \"+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error(\"index is out of range: \"+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y;return e=e.elements,this.x=e[0]*t+e[3]*i+e[6],this.y=e[1]*t+e[4]*i+e[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(Kr=new i,$r=new i,function(e,t){return Kr.set(e,e),$r.set(t,t),this.clamp(Kr,$r)}),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return 0>e&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return t*t+(e=this.y-e.y)*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn(\"THREE.Vector2: offset has been removed from .fromBufferAttribute().\"),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t);t=Math.sin(t);var n=this.x-e.x,r=this.y-e.y;return this.x=n*i-r*t+e.x,this.y=n*t+r*i+e.y,this}}),Object.assign(n.prototype,{isMatrix4:!0,set:function(e,t,i,n,r,o,a,s,l,c,h,u,p,d,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new n).fromArray(this.elements)},copy:function(e){var t=this.elements;return e=e.elements,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},copyPosition:function(e){var t=this.elements;return e=e.elements,t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new o;return function(t){var i=this.elements,n=t.elements,r=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length();return t=1/e.setFromMatrixColumn(t,2).length(),i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*t,i[9]=n[9]*t,i[10]=n[10]*t,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error(\"THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.\");var t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i);i=Math.sin(i);var a=Math.cos(n);n=Math.sin(n);var s=Math.cos(r);if(r=Math.sin(r),\"XYZ\"===e.order){e=o*s;var l=o*r,c=i*s,h=i*r;t[0]=a*s,t[4]=-a*r,t[8]=n,t[1]=l+c*n,t[5]=e-h*n,t[9]=-i*a,t[2]=h-e*n,t[6]=c+l*n,t[10]=o*a}else\"YXZ\"===e.order?(e=a*s,l=a*r,c=n*s,h=n*r,t[0]=e+h*i,t[4]=c*i-l,t[8]=o*n,t[1]=o*r,t[5]=o*s,t[9]=-i,t[2]=l*i-c,t[6]=h+e*i,t[10]=o*a):\"ZXY\"===e.order?(e=a*s,l=a*r,c=n*s,h=n*r,t[0]=e-h*i,t[4]=-o*r,t[8]=c+l*i,t[1]=l+c*i,t[5]=o*s,t[9]=h-e*i,t[2]=-o*n,t[6]=i,t[10]=o*a):\"ZYX\"===e.order?(e=o*s,l=o*r,c=i*s,h=i*r,t[0]=a*s,t[4]=c*n-l,t[8]=e*n+h,t[1]=a*r,t[5]=h*n+e,t[9]=l*n-c,t[2]=-n,t[6]=i*a,t[10]=o*a):\"YZX\"===e.order?(e=o*a,l=o*n,c=i*a,h=i*n,t[0]=a*s,t[4]=h-e*r,t[8]=c*r+l,t[1]=r,t[5]=o*s,t[9]=-i*s,t[2]=-n*s,t[6]=l*r+c,t[10]=e-h*r):\"XZY\"===e.order&&(e=o*a,l=o*n,c=i*a,h=i*n,t[0]=a*s,t[4]=-r,t[8]=n*s,t[1]=e*r+h,t[5]=o*s,t[9]=l*r-c,t[2]=c*r-l,t[6]=i*s,t[10]=h*r+e);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new o(0,0,0),t=new o(1,1,1);return function(i){return this.compose(e,i,t)}}(),lookAt:function(){var e=new o,t=new o,i=new o;return function(n,r,o){var a=this.elements;return i.subVectors(n,r),0===i.lengthSq()&&(i.z=1),i.normalize(),e.crossVectors(o,i),0===e.lengthSq()&&(1===Math.abs(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),e.crossVectors(o,i)),e.normalize(),t.crossVectors(i,e),a[0]=e.x,a[4]=t.x,a[8]=i.x,a[1]=e.y,a[5]=t.y,a[9]=i.y,a[2]=e.z,a[6]=t.z,a[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn(\"THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.\"),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements;t=this.elements,e=i[0];var r=i[4],o=i[8],a=i[12],s=i[1],l=i[5],c=i[9],h=i[13],u=i[2],p=i[6],d=i[10],f=i[14],m=i[3],g=i[7],v=i[11];i=i[15];var y=n[0],x=n[4],b=n[8],w=n[12],M=n[1],E=n[5],_=n[9],S=n[13],T=n[2],A=n[6],C=n[10],R=n[14],L=n[3],P=n[7],N=n[11];return n=n[15],t[0]=e*y+r*M+o*T+a*L,t[4]=e*x+r*E+o*A+a*P,t[8]=e*b+r*_+o*C+a*N,t[12]=e*w+r*S+o*R+a*n,t[1]=s*y+l*M+c*T+h*L,t[5]=s*x+l*E+c*A+h*P,t[9]=s*b+l*_+c*C+h*N,t[13]=s*w+l*S+c*R+h*n,t[2]=u*y+p*M+d*T+f*L,t[6]=u*x+p*E+d*A+f*P,t[10]=u*b+p*_+d*C+f*N,t[14]=u*w+p*S+d*R+f*n,t[3]=m*y+g*M+v*T+i*L,t[7]=m*x+g*E+v*A+i*P,t[11]=m*b+g*_+v*C+i*N,t[15]=m*w+g*S+v*R+i*n,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new o;return function(t){for(var i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],s=e[9],l=e[13],c=e[2],h=e[6],u=e[10],p=e[14];return e[3]*(+r*s*h-n*l*h-r*a*u+i*l*u+n*a*p-i*s*p)+e[7]*(+t*s*p-t*l*u+r*o*u-n*o*p+n*l*c-r*s*c)+e[11]*(+t*l*h-t*a*p-r*o*h+i*o*p+r*a*c-i*l*c)+e[15]*(-n*a*c-t*s*h+t*a*u+n*o*h-i*o*u+i*s*c)},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements;e=n[0];var r=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],h=n[7],u=n[8],p=n[9],d=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=p*v*h-g*d*h+g*c*f-l*v*f-p*c*(n=n[15])+l*d*n,x=m*d*h-u*v*h-m*c*f+s*v*f+u*c*n-s*d*n,b=u*g*h-m*p*h+m*l*f-s*g*f-u*l*n+s*p*n,w=m*p*c-u*g*c-m*l*d+s*g*d+u*l*v-s*p*v,M=e*y+r*x+o*b+a*w;if(0===M){if(!0===t)throw Error(\"THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0\");return console.warn(\"THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0\"),this.identity()}return t=1/M,i[0]=y*t,i[1]=(g*d*a-p*v*a-g*o*f+r*v*f+p*o*n-r*d*n)*t,i[2]=(l*v*a-g*c*a+g*o*h-r*v*h-l*o*n+r*c*n)*t,i[3]=(p*c*a-l*d*a-p*o*h+r*d*h+l*o*f-r*c*f)*t,i[4]=x*t,i[5]=(u*v*a-m*d*a+m*o*f-e*v*f-u*o*n+e*d*n)*t,i[6]=(m*c*a-s*v*a-m*o*h+e*v*h+s*o*n-e*c*n)*t,i[7]=(s*d*a-u*c*a+u*o*h-e*d*h-s*o*f+e*c*f)*t,i[8]=b*t,i[9]=(m*p*a-u*g*a-m*r*f+e*g*f+u*r*n-e*p*n)*t,i[10]=(s*g*a-m*l*a+m*r*h-e*g*h-s*r*n+e*l*n)*t,i[11]=(u*l*a-s*p*a-u*r*h+e*p*h+s*r*f-e*l*f)*t,i[12]=w*t,i[13]=(u*g*o-m*p*o+m*r*d-e*g*d-u*r*v+e*p*v)*t,i[14]=(m*l*o-s*g*o-m*r*c+e*g*c+s*r*v-e*l*v)*t,i[15]=(s*p*o-u*l*o+u*r*c-e*p*c-s*r*d+e*l*d)*t,this},scale:function(e){var t=this.elements,i=e.x,n=e.y;return e=e.z,t[0]*=i,t[4]*=n,t[8]*=e,t[1]*=i,t[5]*=n,t[9]*=e,t[2]*=i,t[6]*=n,t[10]*=e,t[3]*=i,t[7]*=n,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t);t=Math.sin(t);var n=1-i,r=e.x,o=e.y;e=e.z;var a=n*r,s=n*o;return this.set(a*r+i,a*o-t*e,a*e+t*o,0,a*o+t*e,s*o+i,s*e-t*r,0,a*e-t*o,s*e+t*r,n*e*e+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){var n=this.elements,r=t._x,o=t._y,a=t._z,s=t._w,l=r+r,c=o+o,h=a+a;t=r*l;var u=r*c;r*=h;var p=o*c;o*=h,a*=h,l*=s,c*=s,s*=h,h=i.x;var d=i.y;return i=i.z,n[0]=(1-(p+a))*h,n[1]=(u+s)*h,n[2]=(r-c)*h,n[3]=0,n[4]=(u-s)*d,n[5]=(1-(t+a))*d,n[6]=(o+l)*d,n[7]=0,n[8]=(r+c)*i,n[9]=(o-l)*i,n[10]=(1-(t+p))*i,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:function(){var e=new o,t=new n;return function(i,n,r){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),s=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();0>this.determinant()&&(a=-a),i.x=o[12],i.y=o[13],i.z=o[14],t.copy(this),i=1/a,o=1/s;var c=1/l;return t.elements[0]*=i,t.elements[1]*=i,t.elements[2]*=i,t.elements[4]*=o,t.elements[5]*=o,t.elements[6]*=o,t.elements[8]*=c,t.elements[9]*=c,t.elements[10]*=c,n.setFromRotationMatrix(t),r.x=a,r.y=s,r.z=l,this}}(),makePerspective:function(e,t,i,n,r,o){void 0===o&&console.warn(\"THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.\");var a=this.elements;return a[0]=2*r/(t-e),a[4]=0,a[8]=(t+e)/(t-e),a[12]=0,a[1]=0,a[5]=2*r/(i-n),a[9]=(i+n)/(i-n),a[13]=0,a[2]=0,a[6]=0,a[10]=-(o+r)/(o-r),a[14]=-2*o*r/(o-r),a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(e,t,i,n,r,o){var a=this.elements,s=1/(t-e),l=1/(i-n),c=1/(o-r);return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-(t+e)*s,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-(i+n)*l,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-(o+r)*c,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(e){var t=this.elements;e=e.elements;for(var i=0;16>i;i++)if(t[i]!==e[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;16>i;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),Object.assign(r,{slerp:function(e,t,i,n){return i.copy(e).slerp(t,n)},slerpFlat:function(e,t,i,n,r,o,a){var s=i[n+0],l=i[n+1],c=i[n+2];i=i[n+3],n=r[o+0];var h=r[o+1],u=r[o+2];if(i!==(r=r[o+3])||s!==n||l!==h||c!==u){o=1-a;var p=s*n+l*h+c*u+i*r,d=0<=p?1:-1,f=1-p*p;f>Number.EPSILON&&(f=Math.sqrt(f),p=Math.atan2(f,p*d),o=Math.sin(o*p)/f,a=Math.sin(a*p)/f),s=s*o+n*(d*=a),l=l*o+h*d,c=c*o+u*d,i=i*o+r*d,o===1-a&&(s*=a=1/Math.sqrt(s*s+l*l+c*c+i*i),l*=a,c*=a,i*=a)}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=i}}),Object.defineProperties(r.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(r.prototype,{isQuaternion:!0,set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw Error(\"THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.\");var i=e._x,n=e._y,r=e._z;e=e.order;var o=Math.cos,a=Math.sin,s=o(i/2),l=o(n/2);return o=o(r/2),i=a(i/2),n=a(n/2),r=a(r/2),\"XYZ\"===e?(this._x=i*l*o+s*n*r,this._y=s*n*o-i*l*r,this._z=s*l*r+i*n*o,this._w=s*l*o-i*n*r):\"YXZ\"===e?(this._x=i*l*o+s*n*r,this._y=s*n*o-i*l*r,this._z=s*l*r-i*n*o,this._w=s*l*o+i*n*r):\"ZXY\"===e?(this._x=i*l*o-s*n*r,this._y=s*n*o+i*l*r,this._z=s*l*r+i*n*o,this._w=s*l*o-i*n*r):\"ZYX\"===e?(this._x=i*l*o-s*n*r,this._y=s*n*o+i*l*r,this._z=s*l*r-i*n*o,this._w=s*l*o+i*n*r):\"YZX\"===e?(this._x=i*l*o+s*n*r,this._y=s*n*o+i*l*r,this._z=s*l*r-i*n*o,this._w=s*l*o-i*n*r):\"XZY\"===e&&(this._x=i*l*o-s*n*r,this._y=s*n*o-i*l*r,this._z=s*l*r+i*n*o,this._w=s*l*o+i*n*r),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){t/=2;var i=Math.sin(t);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(t),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0];e=t[4];var n=t[8],r=t[1],o=t[5],a=t[9],s=t[2],l=t[6],c=i+o+(t=t[10]);return 0<c?(i=.5/Math.sqrt(c+1),this._w=.25/i,this._x=(l-a)*i,this._y=(n-s)*i,this._z=(r-e)*i):i>o&&i>t?(i=2*Math.sqrt(1+i-o-t),this._w=(l-a)/i,this._x=.25*i,this._y=(e+r)/i,this._z=(n+s)/i):o>t?(i=2*Math.sqrt(1+o-i-t),this._w=(n-s)/i,this._x=(e+r)/i,this._y=.25*i,this._z=(a+l)/i):(i=2*Math.sqrt(1+t-i-o),this._w=(r-e)/i,this._x=(n+s)/i,this._y=(a+l)/i,this._z=.25*i),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new o;return function(i,n){return void 0===t&&(t=new o),1e-6>(e=i.dot(n)+1)?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(eo.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);return 0===i||this.slerp(e,Math.min(1,t/i)),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn(\"THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.\"),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,n=e._y,r=e._z;e=e._w;var o=t._x,a=t._y,s=t._z;return t=t._w,this._x=i*t+e*o+n*s-r*a,this._y=n*t+e*a+r*o-i*s,this._z=r*t+e*s+i*a-n*o,this._w=e*t-i*o-n*a-r*s,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,n=this._y,r=this._z,o=this._w,a=o*e._w+i*e._x+n*e._y+r*e._z;if(0>a?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),1<=a)return this._w=o,this._x=i,this._y=n,this._z=r,this;if((e=1-a*a)<=Number.EPSILON)return a=1-t,this._w=a*o+t*this._w,this._x=a*i+t*this._x,this._y=a*n+t*this._y,this._z=a*r+t*this._z,this.normalize();e=Math.sqrt(e);var s=Math.atan2(e,a);return a=Math.sin((1-t)*s)/e,t=Math.sin(t*s)/e,this._w=o*a+this._w*t,this._x=i*a+this._x*t,this._y=n*a+this._y*t,this._z=r*a+this._z*t,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(o.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error(\"index is out of range: \"+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error(\"index is out of range: \"+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.\"),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new r;return function(t){return t&&t.isEuler||console.error(\"THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.\"),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new r;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}}(),applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z;return e=e.elements,this.x=e[0]*t+e[3]*i+e[6]*n,this.y=e[1]*t+e[4]*i+e[7]*n,this.z=e[2]*t+e[5]*i+e[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=1/((e=e.elements)[3]*t+e[7]*i+e[11]*n+e[15]);return this.x=(e[0]*t+e[4]*i+e[8]*n+e[12])*r,this.y=(e[1]*t+e[5]*i+e[9]*n+e[13])*r,this.z=(e[2]*t+e[6]*i+e[10]*n+e[14])*r,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,s=(e=e.w)*t+o*n-a*i,l=e*i+a*t-r*n,c=e*n+r*i-o*t;return t=-r*t-o*i-a*n,this.x=s*e+t*-r+l*-a-c*-o,this.y=l*e+t*-o+c*-r-s*-a,this.z=c*e+t*-a+s*-o-l*-r,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new n;return function(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){var t=this.x,i=this.y,n=this.z;return e=e.elements,this.x=e[0]*t+e[4]*i+e[8]*n,this.y=e[1]*t+e[5]*i+e[9]*n,this.z=e[2]*t+e[6]*i+e[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new o,t=new o;return function(i,n){return e.set(i,i,i),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.\"),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,n=e.y;e=e.z;var r=t.x,o=t.y;return t=t.z,this.x=n*t-e*o,this.y=e*r-i*t,this.z=i*o-n*r,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new o;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new o;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){return e=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq()),Math.acos(eo.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i+(e=this.z-e.z)*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){return e=e.elements,this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length();return e=this.setFromMatrixColumn(e,2).length(),this.x=t,this.y=i,this.z=e,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn(\"THREE.Vector3: offset has been removed from .fromBufferAttribute().\"),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(a.prototype,{isMatrix3:!0,set:function(e,t,i,n,r,o,a,s,l){var c=this.elements;return c[0]=e,c[1]=n,c[2]=a,c[3]=t,c[4]=r,c[5]=s,c[6]=i,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements;return e=e.elements,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},setFromMatrix4:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var e=new o;return function(t){for(var i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix3(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements;t=this.elements,e=i[0];var r=i[3],o=i[6],a=i[1],s=i[4],l=i[7],c=i[2],h=i[5];i=i[8];var u=n[0],p=n[3],d=n[6],f=n[1],m=n[4],g=n[7],v=n[2],y=n[5];return n=n[8],t[0]=e*u+r*f+o*v,t[3]=e*p+r*m+o*y,t[6]=e*d+r*g+o*n,t[1]=a*u+s*f+l*v,t[4]=a*p+s*m+l*y,t[7]=a*d+s*g+l*n,t[2]=c*u+h*f+i*v,t[5]=c*p+h*m+i*y,t[8]=c*d+h*g+i*n,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7];return t*o*(e=e[8])-t*a*l-i*r*e+i*a*s+n*r*l-n*o*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error(\"THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.\");var i=e.elements;e=this.elements;var n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],l=i[5],c=i[6],h=i[7],u=(i=i[8])*s-l*h,p=l*c-i*a,d=h*a-s*c,f=n*u+r*p+o*d;if(0===f){if(!0===t)throw Error(\"THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0\");return console.warn(\"THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0\"),this.identity()}return t=1/f,e[0]=u*t,e[1]=(o*h-i*r)*t,e[2]=(l*r-o*s)*t,e[3]=p*t,e[4]=(i*n-o*c)*t,e[5]=(o*a-l*n)*t,e[6]=d*t,e[7]=(r*c-h*n)*t,e[8]=(s*n-r*a)*t,this},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,n,r,o,a){var s=Math.cos(r);r=Math.sin(r),this.set(i*s,i*r,-i*(s*o+r*a)+o+e,-n*r,n*s,-n*(-r*o+s*a)+a+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e);e=Math.sin(e);var i=this.elements,n=i[0],r=i[3],o=i[6],a=i[1],s=i[4],l=i[7];return i[0]=t*n+e*a,i[3]=t*r+e*s,i[6]=t*o+e*l,i[1]=-e*n+t*a,i[4]=-e*r+t*s,i[7]=-e*o+t*l,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){var t=this.elements;e=e.elements;for(var i=0;9>i;i++)if(t[i]!==e[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;9>i;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var to,io={getDataURL:function(e){if(\"undefined\"==typeof HTMLCanvasElement)return e.src;if(!(e instanceof HTMLCanvasElement)){void 0===to&&(to=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"canvas\")),to.width=e.width,to.height=e.height;var t=to.getContext(\"2d\");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),e=to}return 2048<e.width||2048<e.height?e.toDataURL(\"image/jpeg\",.6):e.toDataURL(\"image/png\")}},no=0;s.DEFAULT_IMAGE=void 0,s.DEFAULT_MAPPING=300,s.prototype=Object.assign(Object.create(t.prototype),{constructor:s,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||\"string\"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:\"Texture\",generator:\"Texture.toJSON\"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(void 0===n.uuid&&(n.uuid=eo.generateUUID()),!t&&void 0===e.images[n.uuid]){if(Array.isArray(n))for(var r=[],o=0,a=n.length;o<a;o++)r.push(io.getDataURL(n[o]));else r=io.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:r}}i.image=n.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:\"dispose\"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),0>e.x||1<e.x)switch(this.wrapS){case 1e3:e.x-=Math.floor(e.x);break;case 1001:e.x=0>e.x?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(0>e.y||1<e.y)switch(this.wrapT){case 1e3:e.y-=Math.floor(e.y);break;case 1001:e.y=0>e.y?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(s.prototype,\"needsUpdate\",{set:function(e){!0===e&&this.version++}}),Object.assign(l.prototype,{isVector4:!0,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setScalar:function(e){return this.w=this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error(\"index is out of range: \"+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error(\"index is out of range: \"+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.\"),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn(\"THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.\"),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w;return e=e.elements,this.x=e[0]*t+e[4]*i+e[8]*n+e[12]*r,this.y=e[1]*t+e[5]*i+e[9]*n+e[13]*r,this.z=e[2]*t+e[6]*i+e[10]*n+e[14]*r,this.w=e[3]*t+e[7]*i+e[11]*n+e[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t=(e=e.elements)[0],i=e[4],n=e[8],r=e[1],o=e[5],a=e[9],s=e[2],l=e[6],c=e[10];return.01>Math.abs(i-r)&&.01>Math.abs(n-s)&&.01>Math.abs(a-l)?.1>Math.abs(i+r)&&.1>Math.abs(n+s)&&.1>Math.abs(a+l)&&.1>Math.abs(t+o+c-3)?(this.set(1,0,0,0),this):(e=Math.PI,c=(c+1)/2,i=(i+r)/4,n=(n+s)/4,a=(a+l)/4,(t=(t+1)/2)>(o=(o+1)/2)&&t>c?.01>t?(l=0,i=s=.707106781):(s=i/(l=Math.sqrt(t)),i=n/l):o>c?.01>o?(l=.707106781,s=0,i=.707106781):(l=i/(s=Math.sqrt(o)),i=a/s):.01>c?(s=l=.707106781,i=0):(l=n/(i=Math.sqrt(c)),s=a/i),this.set(l,s,i,e),this):(e=Math.sqrt((l-a)*(l-a)+(n-s)*(n-s)+(r-i)*(r-i)),.001>Math.abs(e)&&(e=1),this.x=(l-a)/e,this.y=(n-s)/e,this.z=(r-i)/e,this.w=Math.acos((t+o+c-1)/2),this)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,n){return void 0===e&&(e=new l,t=new l),e.set(i,i,i,i),t.set(n,n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn(\"THREE.Vector4: offset has been removed from .fromBufferAttribute().\"),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),c.prototype=Object.assign(Object.create(t.prototype),{constructor:c,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}}),h.prototype=Object.create(c.prototype),h.prototype.constructor=h,h.prototype.isWebGLRenderTargetCube=!0,u.prototype=Object.create(s.prototype),u.prototype.constructor=u,u.prototype.isDataTexture=!0,Object.assign(p.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],h=e[s+1],u=e[s+2];c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>o&&(o=h),u>a&&(a=u)}return this.min.set(t,i,n),this.max.set(r,o,a),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),h=e.getY(s),u=e.getZ(s);c<t&&(t=c),h<i&&(i=h),u<n&&(n=u),c>r&&(r=c),h>o&&(o=h),u>a&&(a=u)}return this.min.set(t,i,n),this.max.set(r,o,a),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o;return function(t,i){return i=e.copy(i).multiplyScalar(.5),this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn(\"THREE.Box3: .getCenter() target is now required\"),e=new o),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn(\"THREE.Box3: .getSize() target is now required\"),e=new o),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){function e(e){var o=e.geometry;if(void 0!==o)if(o.isGeometry)for(o=o.vertices,i=0,n=o.length;i<n;i++)r.copy(o[i]),r.applyMatrix4(e.matrixWorld),t.expandByPoint(r);else if(o.isBufferGeometry&&void 0!==(o=o.attributes.position))for(i=0,n=o.count;i<n;i++)r.fromBufferAttribute(o,i).applyMatrix4(e.matrixWorld),t.expandByPoint(r)}var t,i,n,r=new o;return function(i){return t=this,i.updateMatrixWorld(!0),i.traverse(e),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn(\"THREE.Box3: .getParameter() target is now required\"),t=new o),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new o;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){if(0<e.normal.x)var t=e.normal.x*this.min.x,i=e.normal.x*this.max.x;else t=e.normal.x*this.max.x,i=e.normal.x*this.min.x;return 0<e.normal.y?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant},intersectsTriangle:function(){function e(e){var r,o=0;for(r=e.length-3;o<=r;o+=3){l.fromArray(e,o);var a=h.x*Math.abs(l.x)+h.y*Math.abs(l.y)+h.z*Math.abs(l.z),s=t.dot(l),c=i.dot(l),u=n.dot(l);if(Math.max(-Math.max(s,c,u),Math.min(s,c,u))>a)return!1}return!0}var t=new o,i=new o,n=new o,r=new o,a=new o,s=new o,l=new o,c=new o,h=new o,u=new o;return function(o){return!this.isEmpty()&&(this.getCenter(c),h.subVectors(this.max,c),t.subVectors(o.a,c),i.subVectors(o.b,c),n.subVectors(o.c,c),r.subVectors(i,t),a.subVectors(n,i),s.subVectors(t,n),!!e(o=[0,-r.z,r.y,0,-a.z,a.y,0,-s.z,s.y,r.z,0,-r.x,a.z,0,-a.x,s.z,0,-s.x,-r.y,r.x,0,-a.y,a.x,0,-s.y,s.x,0])&&!!e(o=[1,0,0,0,1,0,0,0,1])&&(u.crossVectors(r,a),e(o=[u.x,u.y,u.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn(\"THREE.Box3: .clampPoint() target is now required\"),t=new o),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new o;return function(t){return void 0===t&&(console.warn(\"THREE.Box3: .getBoundingSphere() target is now required\"),t=new d),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new o,new o,new o,new o,new o,new o,new o,new o];return function(t){return this.isEmpty()||(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e)),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(d.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new p;return function(t,i){var n=this.center;void 0!==i?n.copy(i):e.setFromPoints(t).getCenter(n);for(var r=i=0,o=t.length;r<o;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);return void 0===t&&(console.warn(\"THREE.Sphere: .clampPoint() target is now required\"),t=new o),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn(\"THREE.Sphere: .getBoundingBox() target is now required\"),e=new p),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(f.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new o,t=new o;return function(i,n,r){return n=e.subVectors(r,n).cross(t.subVectors(i,n)).normalize(),this.setFromNormalAndCoplanarPoint(n,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn(\"THREE.Plane: .projectPoint() target is now required\"),t=new o),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new o;return function(t,i){void 0===i&&(console.warn(\"THREE.Plane: .intersectLine() target is now required\"),i=new o);var n=t.delta(e),r=this.normal.dot(n);if(0===r){if(0===this.distanceToPoint(t.start))return i.copy(t.start)}else if(!(0>(r=-(t.start.dot(this.normal)+this.constant)/r)||1<r))return i.copy(n).multiplyScalar(r).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&0<e||0>e&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn(\"THREE.Plane: .coplanarPoint() target is now required\"),e=new o),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new o,t=new a;return function(i,n){return n=n||t.getNormalMatrix(i),i=this.coplanarPoint(e).applyMatrix4(i),n=this.normal.applyMatrix3(n).normalize(),this.constant=-i.dot(n),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(m.prototype,{set:function(e,t,i,n,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements;e=i[0];var n=i[1],r=i[2],o=i[3],a=i[4],s=i[5],l=i[6],c=i[7],h=i[8],u=i[9],p=i[10],d=i[11],f=i[12],m=i[13],g=i[14];return i=i[15],t[0].setComponents(o-e,c-a,d-h,i-f).normalize(),t[1].setComponents(o+e,c+a,d+h,i+f).normalize(),t[2].setComponents(o+n,c+s,d+u,i+m).normalize(),t[3].setComponents(o-n,c-s,d-u,i-m).normalize(),t[4].setComponents(o-r,c-l,d-p,i-g).normalize(),t[5].setComponents(o+r,c+l,d+p,i+g).normalize(),this},intersectsObject:function(){var e=new d;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new d;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,i=e.center;e=-e.radius;for(var n=0;6>n;n++)if(t[n].distanceToPoint(i)<e)return!1;return!0},intersectsBox:function(){var e=new o;return function(t){for(var i=this.planes,n=0;6>n;n++){var r=i[n];if(e.x=0<r.normal.x?t.max.x:t.min.x,e.y=0<r.normal.y?t.max.y:t.min.y,e.z=0<r.normal.z?t.max.z:t.min.z,0>r.distanceToPoint(e))return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(0>t[i].distanceToPoint(e))return!1;return!0}});var ro={alphamap_fragment:\"#ifdef USE_ALPHAMAP\\n\\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\\n#endif\",alphamap_pars_fragment:\"#ifdef USE_ALPHAMAP\\n\\tuniform sampler2D alphaMap;\\n#endif\",alphatest_fragment:\"#ifdef ALPHATEST\\n\\tif ( diffuseColor.a < ALPHATEST ) discard;\\n#endif\",aomap_fragment:\"#ifdef USE_AOMAP\\n\\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\\n\\treflectedLight.indirectDiffuse *= ambientOcclusion;\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\\n\\t#endif\\n#endif\",aomap_pars_fragment:\"#ifdef USE_AOMAP\\n\\tuniform sampler2D aoMap;\\n\\tuniform float aoMapIntensity;\\n#endif\",begin_vertex:\"vec3 transformed = vec3( position );\",beginnormal_vertex:\"vec3 objectNormal = vec3( normal );\",bsdfs:\"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\\n\\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\\n\\tif( cutoffDistance > 0.0 ) {\\n\\t\\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\\n\\t}\\n\\treturn distanceFalloff;\\n#else\\n\\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\\n\\t\\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\\n\\t}\\n\\treturn 1.0;\\n#endif\\n}\\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\\n\\treturn RECIPROCAL_PI * diffuseColor;\\n}\\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\\n\\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\\n\\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\\n}\\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\treturn 1.0 / ( gl * gv );\\n}\\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\\n\\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\\n\\treturn 0.5 / max( gv + gl, EPSILON );\\n}\\nfloat D_GGX( const in float alpha, const in float dotNH ) {\\n\\tfloat a2 = pow2( alpha );\\n\\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\\n\\treturn RECIPROCAL_PI * a2 / pow2( denom );\\n}\\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat alpha = pow2( roughness );\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\\n\\tfloat D = D_GGX( alpha, dotNH );\\n\\treturn F * ( G * D );\\n}\\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\\n\\tconst float LUT_SIZE  = 64.0;\\n\\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\\n\\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\\n\\tfloat dotNV = saturate( dot( N, V ) );\\n\\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\\n\\tuv = uv * LUT_SCALE + LUT_BIAS;\\n\\treturn uv;\\n}\\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\\n\\tfloat l = length( f );\\n\\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\\n}\\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\\n\\tfloat x = dot( v1, v2 );\\n\\tfloat y = abs( x );\\n\\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\\n\\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\\n\\tfloat v = a / b;\\n\\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\\n\\treturn cross( v1, v2 ) * theta_sintheta;\\n}\\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\\n\\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\\n\\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\\n\\tvec3 lightNormal = cross( v1, v2 );\\n\\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\\n\\tvec3 T1, T2;\\n\\tT1 = normalize( V - N * dot( V, N ) );\\n\\tT2 = - cross( N, T1 );\\n\\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\\n\\tvec3 coords[ 4 ];\\n\\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\\n\\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\\n\\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\\n\\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\\n\\tcoords[ 0 ] = normalize( coords[ 0 ] );\\n\\tcoords[ 1 ] = normalize( coords[ 1 ] );\\n\\tcoords[ 2 ] = normalize( coords[ 2 ] );\\n\\tcoords[ 3 ] = normalize( coords[ 3 ] );\\n\\tvec3 vectorFormFactor = vec3( 0.0 );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\\n\\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\\n\\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\\n\\treturn vec3( result );\\n}\\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\\n\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\\n\\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\\n\\tvec4 r = roughness * c0 + c1;\\n\\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\\n\\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\\n\\treturn specularColor * AB.x + AB.y;\\n}\\nfloat G_BlinnPhong_Implicit( ) {\\n\\treturn 0.25;\\n}\\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\\n\\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\\n}\\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\\n\\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\\n\\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\\n\\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\\n\\tvec3 F = F_Schlick( specularColor, dotLH );\\n\\tfloat G = G_BlinnPhong_Implicit( );\\n\\tfloat D = D_BlinnPhong( shininess, dotNH );\\n\\treturn F * ( G * D );\\n}\\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\\n\\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\\n}\\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\\n\\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\\n}\",bumpmap_pars_fragment:\"#ifdef USE_BUMPMAP\\n\\tuniform sampler2D bumpMap;\\n\\tuniform float bumpScale;\\n\\tvec2 dHdxy_fwd() {\\n\\t\\tvec2 dSTdx = dFdx( vUv );\\n\\t\\tvec2 dSTdy = dFdy( vUv );\\n\\t\\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\\n\\t\\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\\n\\t\\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\\n\\t\\treturn vec2( dBx, dBy );\\n\\t}\\n\\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\\n\\t\\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\\n\\t\\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\\n\\t\\tvec3 vN = surf_norm;\\n\\t\\tvec3 R1 = cross( vSigmaY, vN );\\n\\t\\tvec3 R2 = cross( vN, vSigmaX );\\n\\t\\tfloat fDet = dot( vSigmaX, R1 );\\n\\t\\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\\t\\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\\n\\t\\treturn normalize( abs( fDet ) * surf_norm - vGrad );\\n\\t}\\n#endif\",clipping_planes_fragment:\"#if NUM_CLIPPING_PLANES > 0\\n\\tvec4 plane;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\\n\\t\\tplane = clippingPlanes[ i ];\\n\\t\\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\\n\\t}\\n\\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\\n\\t\\tbool clipped = true;\\n\\t\\t#pragma unroll_loop\\n\\t\\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\\n\\t\\t\\tplane = clippingPlanes[ i ];\\n\\t\\t\\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\\n\\t\\t}\\n\\t\\tif ( clipped ) discard;\\n\\t#endif\\n#endif\",clipping_planes_pars_fragment:\"#if NUM_CLIPPING_PLANES > 0\\n\\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\\n\\t\\tvarying vec3 vViewPosition;\\n\\t#endif\\n\\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\\n#endif\",clipping_planes_pars_vertex:\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\\n\\tvarying vec3 vViewPosition;\\n#endif\",clipping_planes_vertex:\"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\",color_fragment:\"#ifdef USE_COLOR\\n\\tdiffuseColor.rgb *= vColor;\\n#endif\",color_pars_fragment:\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\",color_pars_vertex:\"#ifdef USE_COLOR\\n\\tvarying vec3 vColor;\\n#endif\",color_vertex:\"#ifdef USE_COLOR\\n\\tvColor.xyz = color.xyz;\\n#endif\",common:\"#define PI 3.14159265359\\n#define PI2 6.28318530718\\n#define PI_HALF 1.5707963267949\\n#define RECIPROCAL_PI 0.31830988618\\n#define RECIPROCAL_PI2 0.15915494\\n#define LOG2 1.442695\\n#define EPSILON 1e-6\\n#define saturate(a) clamp( a, 0.0, 1.0 )\\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\\nfloat pow2( const in float x ) { return x*x; }\\nfloat pow3( const in float x ) { return x*x*x; }\\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\\nhighp float rand( const in vec2 uv ) {\\n\\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\\n\\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\\n\\treturn fract(sin(sn) * c);\\n}\\nstruct IncidentLight {\\n\\tvec3 color;\\n\\tvec3 direction;\\n\\tbool visible;\\n};\\nstruct ReflectedLight {\\n\\tvec3 directDiffuse;\\n\\tvec3 directSpecular;\\n\\tvec3 indirectDiffuse;\\n\\tvec3 indirectSpecular;\\n};\\nstruct GeometricContext {\\n\\tvec3 position;\\n\\tvec3 normal;\\n\\tvec3 viewDir;\\n};\\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\\n}\\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\\n\\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\\n}\\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\tfloat distance = dot( planeNormal, point - pointOnPlane );\\n\\treturn - distance * planeNormal + point;\\n}\\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn sign( dot( point - pointOnPlane, planeNormal ) );\\n}\\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\\n\\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\\n}\\nmat3 transposeMat3( const in mat3 m ) {\\n\\tmat3 tmp;\\n\\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\\n\\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\\n\\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\\n\\treturn tmp;\\n}\\nfloat linearToRelativeLuminance( const in vec3 color ) {\\n\\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\\n\\treturn dot( weights, color.rgb );\\n}\",cube_uv_reflection_fragment:\"#ifdef ENVMAP_TYPE_CUBE_UV\\n#define cubeUV_textureSize (1024.0)\\nint getFaceFromDirection(vec3 direction) {\\n\\tvec3 absDirection = abs(direction);\\n\\tint face = -1;\\n\\tif( absDirection.x > absDirection.z ) {\\n\\t\\tif(absDirection.x > absDirection.y )\\n\\t\\t\\tface = direction.x > 0.0 ? 0 : 3;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\telse {\\n\\t\\tif(absDirection.z > absDirection.y )\\n\\t\\t\\tface = direction.z > 0.0 ? 2 : 5;\\n\\t\\telse\\n\\t\\t\\tface = direction.y > 0.0 ? 1 : 4;\\n\\t}\\n\\treturn face;\\n}\\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\\n\\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\\n\\tfloat dxRoughness = dFdx(roughness);\\n\\tfloat dyRoughness = dFdy(roughness);\\n\\tvec3 dx = dFdx( vec * scale * dxRoughness );\\n\\tvec3 dy = dFdy( vec * scale * dyRoughness );\\n\\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\\n\\td = clamp(d, 1.0, cubeUV_rangeClamp);\\n\\tfloat mipLevel = 0.5 * log2(d);\\n\\treturn vec2(floor(mipLevel), fract(mipLevel));\\n}\\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\\n\\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\\n\\tfloat a = 16.0 * cubeUV_rcpTextureSize;\\n\\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\\n\\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\\n\\tfloat powScale = exp2_packed.x * exp2_packed.y;\\n\\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\\n\\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\\n\\tbool bRes = mipLevel == 0.0;\\n\\tscale =  bRes && (scale < a) ? a : scale;\\n\\tvec3 r;\\n\\tvec2 offset;\\n\\tint face = getFaceFromDirection(direction);\\n\\tfloat rcpPowScale = 1.0 / powScale;\\n\\tif( face == 0) {\\n\\t\\tr = vec3(direction.x, -direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\\n\\t}\\n\\telse if( face == 1) {\\n\\t\\tr = vec3(direction.y, direction.x, direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\\n\\t}\\n\\telse if( face == 2) {\\n\\t\\tr = vec3(direction.z, direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\\n\\t}\\n\\telse if( face == 3) {\\n\\t\\tr = vec3(direction.x, direction.z, direction.y);\\n\\t\\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\\n\\t}\\n\\telse if( face == 4) {\\n\\t\\tr = vec3(direction.y, direction.x, -direction.z);\\n\\t\\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\\n\\t}\\n\\telse {\\n\\t\\tr = vec3(direction.z, -direction.x, direction.y);\\n\\t\\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\\n\\t\\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\\n\\t}\\n\\tr = normalize(r);\\n\\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\\n\\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\\n\\tvec2 base = offset + vec2( texelOffset );\\n\\treturn base + s * ( scale - 2.0 * texelOffset );\\n}\\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\\n\\tfloat roughnessVal = roughness* cubeUV_maxLods3;\\n\\tfloat r1 = floor(roughnessVal);\\n\\tfloat r2 = r1 + 1.0;\\n\\tfloat t = fract(roughnessVal);\\n\\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\\n\\tfloat s = mipInfo.y;\\n\\tfloat level0 = mipInfo.x;\\n\\tfloat level1 = level0 + 1.0;\\n\\tlevel1 = level1 > 5.0 ? 5.0 : level1;\\n\\tlevel0 += min( floor( s + 0.5 ), 5.0 );\\n\\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\\n\\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\\n\\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\\n\\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\\n\\tvec4 result = mix(color10, color20, t);\\n\\treturn vec4(result.rgb, 1.0);\\n}\\n#endif\",defaultnormal_vertex:\"vec3 transformedNormal = normalMatrix * objectNormal;\\n#ifdef FLIP_SIDED\\n\\ttransformedNormal = - transformedNormal;\\n#endif\",displacementmap_pars_vertex:\"#ifdef USE_DISPLACEMENTMAP\\n\\tuniform sampler2D displacementMap;\\n\\tuniform float displacementScale;\\n\\tuniform float displacementBias;\\n#endif\",displacementmap_vertex:\"#ifdef USE_DISPLACEMENTMAP\\n\\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\\n#endif\",emissivemap_fragment:\"#ifdef USE_EMISSIVEMAP\\n\\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\\n\\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\\n\\ttotalEmissiveRadiance *= emissiveColor.rgb;\\n#endif\",emissivemap_pars_fragment:\"#ifdef USE_EMISSIVEMAP\\n\\tuniform sampler2D emissiveMap;\\n#endif\",encodings_fragment:\"gl_FragColor = linearToOutputTexel( gl_FragColor );\",encodings_pars_fragment:\"\\nvec4 LinearToLinear( in vec4 value ) {\\n\\treturn value;\\n}\\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\\n\\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\\n}\\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\\n\\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\\n}\\nvec4 sRGBToLinear( in vec4 value ) {\\n\\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\\n}\\nvec4 LinearTosRGB( in vec4 value ) {\\n\\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\\n}\\nvec4 RGBEToLinear( in vec4 value ) {\\n\\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\\n}\\nvec4 LinearToRGBE( in vec4 value ) {\\n\\tfloat maxComponent = max( max( value.r, value.g ), value.b );\\n\\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\\n\\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\\n}\\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\\n\\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\\n}\\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\\n\\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\\n\\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\\n\\tM = ceil( M * 255.0 ) / 255.0;\\n\\treturn vec4( value.rgb / ( M * maxRange ), M );\\n}\\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\\n\\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\\n}\\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\\n\\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\\n\\tfloat D = max( maxRange / maxRGB, 1.0 );\\n\\tD = min( floor( D ) / 255.0, 1.0 );\\n\\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\\n}\\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\\nvec4 LinearToLogLuv( in vec4 value )  {\\n\\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\\n\\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\\n\\tvec4 vResult;\\n\\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\\n\\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\\n\\tvResult.w = fract( Le );\\n\\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\\n\\treturn vResult;\\n}\\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\\nvec4 LogLuvToLinear( in vec4 value ) {\\n\\tfloat Le = value.z * 255.0 + value.w;\\n\\tvec3 Xp_Y_XYZp;\\n\\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\\n\\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\\n\\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\\n\\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\\n\\treturn vec4( max( vRGB, 0.0 ), 1.0 );\\n}\",envmap_fragment:\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#else\\n\\t\\tvec3 reflectVec = vReflect;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\\n\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\tvec2 sampleUV;\\n\\t\\treflectVec = normalize( reflectVec );\\n\\t\\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\\n\\t\\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\tvec4 envColor = texture2D( envMap, sampleUV );\\n\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\treflectVec = normalize( reflectVec );\\n\\t\\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\\n\\t\\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\\n\\t#else\\n\\t\\tvec4 envColor = vec4( 0.0 );\\n\\t#endif\\n\\tenvColor = envMapTexelToLinear( envColor );\\n\\t#ifdef ENVMAP_BLENDING_MULTIPLY\\n\\t\\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_MIX )\\n\\t\\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\\n\\t#elif defined( ENVMAP_BLENDING_ADD )\\n\\t\\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\\n\\t#endif\\n#endif\",envmap_pars_fragment:\"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\\n\\tuniform float reflectivity;\\n\\tuniform float envMapIntensity;\\n#endif\\n#ifdef USE_ENVMAP\\n\\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#endif\\n\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\tuniform samplerCube envMap;\\n\\t#else\\n\\t\\tuniform sampler2D envMap;\\n\\t#endif\\n\\tuniform float flipEnvMap;\\n\\tuniform int maxMipLevel;\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\\n\\t\\tuniform float refractionRatio;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t#endif\\n#endif\",envmap_pars_vertex:\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvarying vec3 vWorldPosition;\\n\\t#else\\n\\t\\tvarying vec3 vReflect;\\n\\t\\tuniform float refractionRatio;\\n\\t#endif\\n#endif\",envmap_physical_pars_fragment:\"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\\n\\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\\n\\t\\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\\n\\t\\t#else\\n\\t\\t\\tvec4 envMapColor = vec4( 0.0 );\\n\\t\\t#endif\\n\\t\\treturn PI * envMapColor.rgb * envMapIntensity;\\n\\t}\\n\\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\tfloat maxMIPLevelScalar = float( maxMIPLevel );\\n\\t\\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\\n\\t\\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\\n\\t}\\n\\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\\n\\t\\t#else\\n\\t\\t\\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\\n\\t\\t#endif\\n\\t\\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\\n\\t\\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\\n\\t\\t#ifdef ENVMAP_TYPE_CUBE\\n\\t\\t\\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\t\\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\\n\\t\\t\\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\\n\\t\\t#elif defined( ENVMAP_TYPE_EQUIREC )\\n\\t\\t\\tvec2 sampleUV;\\n\\t\\t\\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\\n\\t\\t\\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#elif defined( ENVMAP_TYPE_SPHERE )\\n\\t\\t\\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\\n\\t\\t\\t#ifdef TEXTURE_LOD_EXT\\n\\t\\t\\t\\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#else\\n\\t\\t\\t\\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\\n\\t\\t\\t#endif\\n\\t\\t\\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\\n\\t\\t#endif\\n\\t\\treturn envMapColor.rgb * envMapIntensity;\\n\\t}\\n#endif\",envmap_vertex:\"#ifdef USE_ENVMAP\\n\\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\\n\\t\\tvWorldPosition = worldPosition.xyz;\\n\\t#else\\n\\t\\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\\n\\t\\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\\n\\t\\t#ifdef ENVMAP_MODE_REFLECTION\\n\\t\\t\\tvReflect = reflect( cameraToVertex, worldNormal );\\n\\t\\t#else\\n\\t\\t\\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\\n\\t\\t#endif\\n\\t#endif\\n#endif\",fog_vertex:\"#ifdef USE_FOG\\n\\tfogDepth = -mvPosition.z;\\n#endif\",fog_pars_vertex:\"#ifdef USE_FOG\\n\\tvarying float fogDepth;\\n#endif\",fog_fragment:\"#ifdef USE_FOG\\n\\t#ifdef FOG_EXP2\\n\\t\\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\\n\\t#else\\n\\t\\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\\n\\t#endif\\n\\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\\n#endif\",fog_pars_fragment:\"#ifdef USE_FOG\\n\\tuniform vec3 fogColor;\\n\\tvarying float fogDepth;\\n\\t#ifdef FOG_EXP2\\n\\t\\tuniform float fogDensity;\\n\\t#else\\n\\t\\tuniform float fogNear;\\n\\t\\tuniform float fogFar;\\n\\t#endif\\n#endif\",gradientmap_pars_fragment:\"#ifdef TOON\\n\\tuniform sampler2D gradientMap;\\n\\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\\n\\t\\tfloat dotNL = dot( normal, lightDirection );\\n\\t\\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\\n\\t\\t#ifdef USE_GRADIENTMAP\\n\\t\\t\\treturn texture2D( gradientMap, coord ).rgb;\\n\\t\\t#else\\n\\t\\t\\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\\n\\t\\t#endif\\n\\t}\\n#endif\",lightmap_fragment:\"#ifdef USE_LIGHTMAP\\n\\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n#endif\",lightmap_pars_fragment:\"#ifdef USE_LIGHTMAP\\n\\tuniform sampler2D lightMap;\\n\\tuniform float lightMapIntensity;\\n#endif\",lights_lambert_vertex:\"vec3 diffuse = vec3( 1.0 );\\nGeometricContext geometry;\\ngeometry.position = mvPosition.xyz;\\ngeometry.normal = normalize( transformedNormal );\\ngeometry.viewDir = normalize( -mvPosition.xyz );\\nGeometricContext backGeometry;\\nbackGeometry.position = geometry.position;\\nbackGeometry.normal = -geometry.normal;\\nbackGeometry.viewDir = geometry.viewDir;\\nvLightFront = vec3( 0.0 );\\n#ifdef DOUBLE_SIDED\\n\\tvLightBack = vec3( 0.0 );\\n#endif\\nIncidentLight directLight;\\nfloat dotNL;\\nvec3 directLightColor_Diffuse;\\n#if NUM_POINT_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_DIR_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\\n\\t\\tdotNL = dot( geometry.normal, directLight.direction );\\n\\t\\tdirectLightColor_Diffuse = PI * directLight.color;\\n\\t\\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\\n\\t\\t#endif\\n\\t}\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\\n\\t\\t#endif\\n\\t}\\n#endif\",lights_pars_begin:\"uniform vec3 ambientLightColor;\\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\\n\\tvec3 irradiance = ambientLightColor;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treturn irradiance;\\n}\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tdirectLight.color = directionalLight.color;\\n\\t\\tdirectLight.direction = directionalLight.direction;\\n\\t\\tdirectLight.visible = true;\\n\\t}\\n#endif\\n#if NUM_POINT_LIGHTS > 0\\n\\tstruct PointLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t\\tfloat shadowCameraNear;\\n\\t\\tfloat shadowCameraFar;\\n\\t};\\n\\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\\n\\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\\n\\t\\tvec3 lVector = pointLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tdirectLight.color = pointLight.color;\\n\\t\\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\\n\\t\\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\\n\\t}\\n#endif\\n#if NUM_SPOT_LIGHTS > 0\\n\\tstruct SpotLight {\\n\\t\\tvec3 position;\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tfloat distance;\\n\\t\\tfloat decay;\\n\\t\\tfloat coneCos;\\n\\t\\tfloat penumbraCos;\\n\\t\\tint shadow;\\n\\t\\tfloat shadowBias;\\n\\t\\tfloat shadowRadius;\\n\\t\\tvec2 shadowMapSize;\\n\\t};\\n\\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\\n\\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\\n\\t\\tvec3 lVector = spotLight.position - geometry.position;\\n\\t\\tdirectLight.direction = normalize( lVector );\\n\\t\\tfloat lightDistance = length( lVector );\\n\\t\\tfloat angleCos = dot( directLight.direction, spotLight.direction );\\n\\t\\tif ( angleCos > spotLight.coneCos ) {\\n\\t\\t\\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\\n\\t\\t\\tdirectLight.color = spotLight.color;\\n\\t\\t\\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\\n\\t\\t\\tdirectLight.visible = true;\\n\\t\\t} else {\\n\\t\\t\\tdirectLight.color = vec3( 0.0 );\\n\\t\\t\\tdirectLight.visible = false;\\n\\t\\t}\\n\\t}\\n#endif\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tstruct RectAreaLight {\\n\\t\\tvec3 color;\\n\\t\\tvec3 position;\\n\\t\\tvec3 halfWidth;\\n\\t\\tvec3 halfHeight;\\n\\t};\\n\\tuniform sampler2D ltc_1;\\tuniform sampler2D ltc_2;\\n\\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\\n#endif\\n#if NUM_HEMI_LIGHTS > 0\\n\\tstruct HemisphereLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 skyColor;\\n\\t\\tvec3 groundColor;\\n\\t};\\n\\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\\n\\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\\n\\t\\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\\n\\t\\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\\n\\t\\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tirradiance *= PI;\\n\\t\\t#endif\\n\\t\\treturn irradiance;\\n\\t}\\n#endif\",lights_phong_fragment:\"BlinnPhongMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb;\\nmaterial.specularColor = specular;\\nmaterial.specularShininess = shininess;\\nmaterial.specularStrength = specularStrength;\",lights_phong_pars_fragment:\"varying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\nstruct BlinnPhongMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tvec3\\tspecularColor;\\n\\tfloat\\tspecularShininess;\\n\\tfloat\\tspecularStrength;\\n};\\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\t#ifdef TOON\\n\\t\\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\\n\\t#else\\n\\t\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\t\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#endif\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\\n}\\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_BlinnPhong\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_BlinnPhong\\n#define Material_LightProbeLOD( material )\\t(0)\",lights_physical_fragment:\"PhysicalMaterial material;\\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\\n#ifdef STANDARD\\n\\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\\n#else\\n\\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\\n\\tmaterial.clearCoat = saturate( clearCoat );\\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\\n#endif\",lights_physical_pars_fragment:\"struct PhysicalMaterial {\\n\\tvec3\\tdiffuseColor;\\n\\tfloat\\tspecularRoughness;\\n\\tvec3\\tspecularColor;\\n\\t#ifndef STANDARD\\n\\t\\tfloat clearCoat;\\n\\t\\tfloat clearCoatRoughness;\\n\\t#endif\\n};\\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\\n\\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\\n}\\n#if NUM_RECT_AREA_LIGHTS > 0\\n\\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\t\\tvec3 normal = geometry.normal;\\n\\t\\tvec3 viewDir = geometry.viewDir;\\n\\t\\tvec3 position = geometry.position;\\n\\t\\tvec3 lightPos = rectAreaLight.position;\\n\\t\\tvec3 halfWidth = rectAreaLight.halfWidth;\\n\\t\\tvec3 halfHeight = rectAreaLight.halfHeight;\\n\\t\\tvec3 lightColor = rectAreaLight.color;\\n\\t\\tfloat roughness = material.specularRoughness;\\n\\t\\tvec3 rectCoords[ 4 ];\\n\\t\\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\\t\\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\\n\\t\\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\\n\\t\\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\\n\\t\\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\\n\\t\\tvec4 t1 = texture2D( ltc_1, uv );\\n\\t\\tvec4 t2 = texture2D( ltc_2, uv );\\n\\t\\tmat3 mInv = mat3(\\n\\t\\t\\tvec3( t1.x, 0, t1.y ),\\n\\t\\t\\tvec3(    0, 1,    0 ),\\n\\t\\t\\tvec3( t1.z, 0, t1.w )\\n\\t\\t);\\n\\t\\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\\n\\t\\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\\n\\t\\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\\n\\t}\\n#endif\\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\\n\\tvec3 irradiance = dotNL * directLight.color;\\n\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\tirradiance *= PI;\\n\\t#endif\\n\\t#ifndef STANDARD\\n\\t\\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\\n\\t#else\\n\\t\\tfloat clearCoatDHR = 0.0;\\n\\t#endif\\n\\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\\n\\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\\n}\\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\\n\\t#ifndef STANDARD\\n\\t\\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\\n\\t\\tfloat dotNL = dotNV;\\n\\t\\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\\n\\t#else\\n\\t\\tfloat clearCoatDHR = 0.0;\\n\\t#endif\\n\\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\\n\\t#ifndef STANDARD\\n\\t\\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\\n\\t#endif\\n}\\n#define RE_Direct\\t\\t\\t\\tRE_Direct_Physical\\n#define RE_Direct_RectArea\\t\\tRE_Direct_RectArea_Physical\\n#define RE_IndirectDiffuse\\t\\tRE_IndirectDiffuse_Physical\\n#define RE_IndirectSpecular\\t\\tRE_IndirectSpecular_Physical\\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\\n\\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\\n}\",lights_fragment_begin:\"\\nGeometricContext geometry;\\ngeometry.position = - vViewPosition;\\ngeometry.normal = normal;\\ngeometry.viewDir = normalize( vViewPosition );\\nIncidentLight directLight;\\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tPointLight pointLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tSpotLight spotLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\\n\\tDirectionalLight directionalLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\\n\\t\\t#ifdef USE_SHADOWMAP\\n\\t\\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t\\t#endif\\n\\t\\tRE_Direct( directLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\\n\\tRectAreaLight rectAreaLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\\n\\t\\trectAreaLight = rectAreaLights[ i ];\\n\\t\\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\\n\\t}\\n#endif\\n#if defined( RE_IndirectDiffuse )\\n\\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\\n\\t#if ( NUM_HEMI_LIGHTS > 0 )\\n\\t\\t#pragma unroll_loop\\n\\t\\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\\n\\t\\t\\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\\n\\t\\t}\\n\\t#endif\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tvec3 radiance = vec3( 0.0 );\\n\\tvec3 clearCoatRadiance = vec3( 0.0 );\\n#endif\",lights_fragment_maps:\"#if defined( RE_IndirectDiffuse )\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\t\\t#ifndef PHYSICALLY_CORRECT_LIGHTS\\n\\t\\t\\tlightMapIrradiance *= PI;\\n\\t\\t#endif\\n\\t\\tirradiance += lightMapIrradiance;\\n\\t#endif\\n\\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\\n\\t\\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\\n\\t#endif\\n#endif\\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\\n\\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\\n\\t#ifndef STANDARD\\n\\t\\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\\n\\t#endif\\n#endif\",lights_fragment_end:\"#if defined( RE_IndirectDiffuse )\\n\\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\\n#endif\\n#if defined( RE_IndirectSpecular )\\n\\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\\n#endif\",logdepthbuf_fragment:\"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\\n#endif\",logdepthbuf_pars_fragment:\"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\\n\\tuniform float logDepthBufFC;\\n\\tvarying float vFragDepth;\\n#endif\",logdepthbuf_pars_vertex:\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvarying float vFragDepth;\\n\\t#else\\n\\t\\tuniform float logDepthBufFC;\\n\\t#endif\\n#endif\",logdepthbuf_vertex:\"#ifdef USE_LOGDEPTHBUF\\n\\t#ifdef USE_LOGDEPTHBUF_EXT\\n\\t\\tvFragDepth = 1.0 + gl_Position.w;\\n\\t#else\\n\\t\\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\\n\\t\\tgl_Position.z *= gl_Position.w;\\n\\t#endif\\n#endif\",map_fragment:\"#ifdef USE_MAP\\n\\tvec4 texelColor = texture2D( map, vUv );\\n\\ttexelColor = mapTexelToLinear( texelColor );\\n\\tdiffuseColor *= texelColor;\\n#endif\",map_pars_fragment:\"#ifdef USE_MAP\\n\\tuniform sampler2D map;\\n#endif\",map_particle_fragment:\"#ifdef USE_MAP\\n\\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\\n\\tvec4 mapTexel = texture2D( map, uv );\\n\\tdiffuseColor *= mapTexelToLinear( mapTexel );\\n#endif\",map_particle_pars_fragment:\"#ifdef USE_MAP\\n\\tuniform mat3 uvTransform;\\n\\tuniform sampler2D map;\\n#endif\",metalnessmap_fragment:\"float metalnessFactor = metalness;\\n#ifdef USE_METALNESSMAP\\n\\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\\n\\tmetalnessFactor *= texelMetalness.b;\\n#endif\",metalnessmap_pars_fragment:\"#ifdef USE_METALNESSMAP\\n\\tuniform sampler2D metalnessMap;\\n#endif\",morphnormal_vertex:\"#ifdef USE_MORPHNORMALS\\n\\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\\n\\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\\n\\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\\n\\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\\n#endif\",morphtarget_pars_vertex:\"#ifdef USE_MORPHTARGETS\\n\\t#ifndef USE_MORPHNORMALS\\n\\tuniform float morphTargetInfluences[ 8 ];\\n\\t#else\\n\\tuniform float morphTargetInfluences[ 4 ];\\n\\t#endif\\n#endif\",morphtarget_vertex:\"#ifdef USE_MORPHTARGETS\\n\\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\\n\\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\\n\\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\\n\\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\\n\\t#ifndef USE_MORPHNORMALS\\n\\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\\n\\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\\n\\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\\n\\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\\n\\t#endif\\n#endif\",normal_fragment_begin:\"#ifdef FLAT_SHADED\\n\\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\\n\\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\\n\\tvec3 normal = normalize( cross( fdx, fdy ) );\\n#else\\n\\tvec3 normal = normalize( vNormal );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\\t#endif\\n#endif\",normal_fragment_maps:\"#ifdef USE_NORMALMAP\\n\\t#ifdef OBJECTSPACE_NORMALMAP\\n\\t\\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\t#ifdef FLIP_SIDED\\n\\t\\t\\tnormal = - normal;\\n\\t\\t#endif\\n\\t\\t#ifdef DOUBLE_SIDED\\n\\t\\t\\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\\t\\t#endif\\n\\t\\tnormal = normalize( normalMatrix * normal );\\n\\t#else\\n\\t\\tnormal = perturbNormal2Arb( -vViewPosition, normal );\\n\\t#endif\\n#elif defined( USE_BUMPMAP )\\n\\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\\n#endif\",normalmap_pars_fragment:\"#ifdef USE_NORMALMAP\\n\\tuniform sampler2D normalMap;\\n\\tuniform vec2 normalScale;\\n\\t#ifdef OBJECTSPACE_NORMALMAP\\n\\t\\tuniform mat3 normalMatrix;\\n\\t#else\\n\\t\\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\\n\\t\\t\\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\\n\\t\\t\\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\\n\\t\\t\\tvec2 st0 = dFdx( vUv.st );\\n\\t\\t\\tvec2 st1 = dFdy( vUv.st );\\n\\t\\t\\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\\n\\t\\t\\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\\n\\t\\t\\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\\n\\t\\t\\tvec3 N = normalize( surf_norm );\\n\\t\\t\\tmat3 tsn = mat3( S, T, N );\\n\\t\\t\\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\\n\\t\\t\\tmapN.xy *= normalScale;\\n\\t\\t\\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\\n\\t\\t\\treturn normalize( tsn * mapN );\\n\\t\\t}\\n\\t#endif\\n#endif\",packing:\"vec3 packNormalToRGB( const in vec3 normal ) {\\n\\treturn normalize( normal ) * 0.5 + 0.5;\\n}\\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\\n\\treturn 2.0 * rgb.xyz - 1.0;\\n}\\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\\nconst float ShiftRight8 = 1. / 256.;\\nvec4 packDepthToRGBA( const in float v ) {\\n\\tvec4 r = vec4( fract( v * PackFactors ), v );\\n\\tr.yzw -= r.xyz * ShiftRight8;\\treturn r * PackUpscale;\\n}\\nfloat unpackRGBAToDepth( const in vec4 v ) {\\n\\treturn dot( v, UnpackFactors );\\n}\\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn ( viewZ + near ) / ( near - far );\\n}\\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\\n\\treturn linearClipZ * ( near - far ) - near;\\n}\\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\\n\\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\\n}\\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\\n\\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\\n}\",premultiplied_alpha_fragment:\"#ifdef PREMULTIPLIED_ALPHA\\n\\tgl_FragColor.rgb *= gl_FragColor.a;\\n#endif\",project_vertex:\"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\\ngl_Position = projectionMatrix * mvPosition;\",dithering_fragment:\"#if defined( DITHERING )\\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\\n#endif\",dithering_pars_fragment:\"#if defined( DITHERING )\\n\\tvec3 dithering( vec3 color ) {\\n\\t\\tfloat grid_position = rand( gl_FragCoord.xy );\\n\\t\\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\\n\\t\\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\\n\\t\\treturn color + dither_shift_RGB;\\n\\t}\\n#endif\",roughnessmap_fragment:\"float roughnessFactor = roughness;\\n#ifdef USE_ROUGHNESSMAP\\n\\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\\n\\troughnessFactor *= texelRoughness.g;\\n#endif\",roughnessmap_pars_fragment:\"#ifdef USE_ROUGHNESSMAP\\n\\tuniform sampler2D roughnessMap;\\n#endif\",shadowmap_pars_fragment:\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n\\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\\n\\t\\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\\n\\t}\\n\\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\\n\\t\\tconst vec2 offset = vec2( 0.0, 1.0 );\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / size;\\n\\t\\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\\n\\t\\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\\n\\t\\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\\n\\t\\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\\n\\t\\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\\n\\t\\tvec2 f = fract( uv * size + 0.5 );\\n\\t\\tfloat a = mix( lb, lt, f.y );\\n\\t\\tfloat b = mix( rb, rt, f.y );\\n\\t\\tfloat c = mix( a, b, f.x );\\n\\t\\treturn c;\\n\\t}\\n\\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\\n\\t\\tfloat shadow = 1.0;\\n\\t\\tshadowCoord.xyz /= shadowCoord.w;\\n\\t\\tshadowCoord.z += shadowBias;\\n\\t\\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n\\t\\tbool inFrustum = all( inFrustumVec );\\n\\t\\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n\\t\\tbool frustumTest = all( frustumTestVec );\\n\\t\\tif ( frustumTest ) {\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n\\t\\t\\tfloat dx0 = - texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy0 = - texelSize.y * shadowRadius;\\n\\t\\t\\tfloat dx1 = + texelSize.x * shadowRadius;\\n\\t\\t\\tfloat dy1 = + texelSize.y * shadowRadius;\\n\\t\\t\\tshadow = (\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\\n\\t\\t\\t\\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\\n\\t\\t#endif\\n\\t\\t}\\n\\t\\treturn shadow;\\n\\t}\\n\\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\\n\\t\\tvec3 absV = abs( v );\\n\\t\\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\\n\\t\\tabsV *= scaleToCube;\\n\\t\\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\\n\\t\\tvec2 planar = v.xy;\\n\\t\\tfloat almostATexel = 1.5 * texelSizeY;\\n\\t\\tfloat almostOne = 1.0 - almostATexel;\\n\\t\\tif ( absV.z >= almostOne ) {\\n\\t\\t\\tif ( v.z > 0.0 )\\n\\t\\t\\t\\tplanar.x = 4.0 - v.x;\\n\\t\\t} else if ( absV.x >= almostOne ) {\\n\\t\\t\\tfloat signX = sign( v.x );\\n\\t\\t\\tplanar.x = v.z * signX + 2.0 * signX;\\n\\t\\t} else if ( absV.y >= almostOne ) {\\n\\t\\t\\tfloat signY = sign( v.y );\\n\\t\\t\\tplanar.x = v.x + 2.0 * signY + 2.0;\\n\\t\\t\\tplanar.y = v.z * signY - 2.0;\\n\\t\\t}\\n\\t\\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\\n\\t}\\n\\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\\n\\t\\tvec3 lightToPosition = shadowCoord.xyz;\\n\\t\\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\\t\\tdp += shadowBias;\\n\\t\\tvec3 bd3D = normalize( lightToPosition );\\n\\t\\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\\n\\t\\t\\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\\n\\t\\t\\treturn (\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\\n\\t\\t\\t\\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\\n\\t\\t\\t) * ( 1.0 / 9.0 );\\n\\t\\t#else\\n\\t\\t\\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\\n\\t\\t#endif\\n\\t}\\n#endif\",shadowmap_pars_vertex:\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t\\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t\\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\\n\\t\\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t\\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\\n\\t\\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\\n\\t#endif\\n#endif\",shadowmap_vertex:\"#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\\n\\t}\\n\\t#endif\\n#endif\",shadowmask_pars_fragment:\"float getShadowMask() {\\n\\tfloat shadow = 1.0;\\n\\t#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHTS > 0\\n\\tDirectionalLight directionalLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n\\t\\tdirectionalLight = directionalLights[ i ];\\n\\t\\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_SPOT_LIGHTS > 0\\n\\tSpotLight spotLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\\n\\t\\tspotLight = spotLights[ i ];\\n\\t\\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#if NUM_POINT_LIGHTS > 0\\n\\tPointLight pointLight;\\n\\t#pragma unroll_loop\\n\\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\\n\\t\\tpointLight = pointLights[ i ];\\n\\t\\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\\n\\t}\\n\\t#endif\\n\\t#endif\\n\\treturn shadow;\\n}\",skinbase_vertex:\"#ifdef USE_SKINNING\\n\\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\\n\\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\\n\\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\\n\\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\\n#endif\",skinning_pars_vertex:\"#ifdef USE_SKINNING\\n\\tuniform mat4 bindMatrix;\\n\\tuniform mat4 bindMatrixInverse;\\n\\t#ifdef BONE_TEXTURE\\n\\t\\tuniform sampler2D boneTexture;\\n\\t\\tuniform int boneTextureSize;\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tfloat j = i * 4.0;\\n\\t\\t\\tfloat x = mod( j, float( boneTextureSize ) );\\n\\t\\t\\tfloat y = floor( j / float( boneTextureSize ) );\\n\\t\\t\\tfloat dx = 1.0 / float( boneTextureSize );\\n\\t\\t\\tfloat dy = 1.0 / float( boneTextureSize );\\n\\t\\t\\ty = dy * ( y + 0.5 );\\n\\t\\t\\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\\n\\t\\t\\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\\n\\t\\t\\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\\n\\t\\t\\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\\n\\t\\t\\tmat4 bone = mat4( v1, v2, v3, v4 );\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#else\\n\\t\\tuniform mat4 boneMatrices[ MAX_BONES ];\\n\\t\\tmat4 getBoneMatrix( const in float i ) {\\n\\t\\t\\tmat4 bone = boneMatrices[ int(i) ];\\n\\t\\t\\treturn bone;\\n\\t\\t}\\n\\t#endif\\n#endif\",skinning_vertex:\"#ifdef USE_SKINNING\\n\\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\\n\\tvec4 skinned = vec4( 0.0 );\\n\\tskinned += boneMatX * skinVertex * skinWeight.x;\\n\\tskinned += boneMatY * skinVertex * skinWeight.y;\\n\\tskinned += boneMatZ * skinVertex * skinWeight.z;\\n\\tskinned += boneMatW * skinVertex * skinWeight.w;\\n\\ttransformed = ( bindMatrixInverse * skinned ).xyz;\\n#endif\",skinnormal_vertex:\"#ifdef USE_SKINNING\\n\\tmat4 skinMatrix = mat4( 0.0 );\\n\\tskinMatrix += skinWeight.x * boneMatX;\\n\\tskinMatrix += skinWeight.y * boneMatY;\\n\\tskinMatrix += skinWeight.z * boneMatZ;\\n\\tskinMatrix += skinWeight.w * boneMatW;\\n\\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\\n\\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\\n#endif\",specularmap_fragment:\"float specularStrength;\\n#ifdef USE_SPECULARMAP\\n\\tvec4 texelSpecular = texture2D( specularMap, vUv );\\n\\tspecularStrength = texelSpecular.r;\\n#else\\n\\tspecularStrength = 1.0;\\n#endif\",specularmap_pars_fragment:\"#ifdef USE_SPECULARMAP\\n\\tuniform sampler2D specularMap;\\n#endif\",tonemapping_fragment:\"#if defined( TONE_MAPPING )\\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\\n#endif\",tonemapping_pars_fragment:\"#ifndef saturate\\n\\t#define saturate(a) clamp( a, 0.0, 1.0 )\\n#endif\\nuniform float toneMappingExposure;\\nuniform float toneMappingWhitePoint;\\nvec3 LinearToneMapping( vec3 color ) {\\n\\treturn toneMappingExposure * color;\\n}\\nvec3 ReinhardToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\treturn saturate( color / ( vec3( 1.0 ) + color ) );\\n}\\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\\nvec3 Uncharted2ToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\\n}\\nvec3 OptimizedCineonToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\tcolor = max( vec3( 0.0 ), color - 0.004 );\\n\\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\\n}\\nvec3 ACESFilmicToneMapping( vec3 color ) {\\n\\tcolor *= toneMappingExposure;\\n\\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\\n}\",uv_pars_fragment:\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n#endif\",uv_pars_vertex:\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvarying vec2 vUv;\\n\\tuniform mat3 uvTransform;\\n#endif\",uv_vertex:\"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\\n\\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\\n#endif\",uv2_pars_fragment:\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvarying vec2 vUv2;\\n#endif\",uv2_pars_vertex:\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tattribute vec2 uv2;\\n\\tvarying vec2 vUv2;\\n#endif\",uv2_vertex:\"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\\n\\tvUv2 = uv2;\\n#endif\",worldpos_vertex:\"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\\n\\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\\n#endif\",background_frag:\"uniform sampler2D t2D;\\nvarying vec2 vUv;\\nvoid main() {\\n\\tvec4 texColor = texture2D( t2D, vUv );\\n\\tgl_FragColor = mapTexelToLinear( texColor );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\",background_vert:\"varying vec2 vUv;\\nuniform mat3 uvTransform;\\nvoid main() {\\n\\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\\n\\tgl_Position = vec4( position.xy, 1.0, 1.0 );\\n}\",cube_frag:\"uniform samplerCube tCube;\\nuniform float tFlip;\\nuniform float opacity;\\nvarying vec3 vWorldDirection;\\nvoid main() {\\n\\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\\n\\tgl_FragColor = mapTexelToLinear( texColor );\\n\\tgl_FragColor.a *= opacity;\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\",cube_vert:\"varying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\tgl_Position.z = gl_Position.w;\\n}\",depth_frag:\"#if DEPTH_PACKING == 3200\\n\\tuniform float opacity;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tdiffuseColor.a = opacity;\\n\\t#endif\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <logdepthbuf_fragment>\\n\\t#if DEPTH_PACKING == 3200\\n\\t\\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\\n\\t#elif DEPTH_PACKING == 3201\\n\\t\\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\\n\\t#endif\\n}\",depth_vert:\"#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n}\",distanceRGBA_frag:\"#define DISTANCE\\nuniform vec3 referencePosition;\\nuniform float nearDistance;\\nuniform float farDistance;\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main () {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( 1.0 );\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\tfloat dist = length( vWorldPosition - referencePosition );\\n\\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\\n\\tdist = saturate( dist );\\n\\tgl_FragColor = packDepthToRGBA( dist );\\n}\",distanceRGBA_vert:\"#define DISTANCE\\nvarying vec3 vWorldPosition;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_DISPLACEMENTMAP\\n\\t\\t#include <beginnormal_vertex>\\n\\t\\t#include <morphnormal_vertex>\\n\\t\\t#include <skinnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvWorldPosition = worldPosition.xyz;\\n}\",equirect_frag:\"uniform sampler2D tEquirect;\\nvarying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvec3 direction = normalize( vWorldDirection );\\n\\tvec2 sampleUV;\\n\\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\\n\\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\\n\\tvec4 texColor = texture2D( tEquirect, sampleUV );\\n\\tgl_FragColor = mapTexelToLinear( texColor );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n}\",equirect_vert:\"varying vec3 vWorldDirection;\\n#include <common>\\nvoid main() {\\n\\tvWorldDirection = transformDirection( position, modelMatrix );\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n}\",linedashed_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\nuniform float dashSize;\\nuniform float totalSize;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\\n\\t\\tdiscard;\\n\\t}\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <color_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\",linedashed_vert:\"uniform float scale;\\nattribute float lineDistance;\\nvarying float vLineDistance;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\tvLineDistance = scale * lineDistance;\\n\\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\",meshbasic_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\t#ifdef USE_LIGHTMAP\\n\\t\\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\\n\\t#else\\n\\t\\treflectedLight.indirectDiffuse += vec3( 1.0 );\\n\\t#endif\\n\\t#include <aomap_fragment>\\n\\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\\n\\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\",meshbasic_vert:\"#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#ifdef USE_ENVMAP\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshlambert_frag:\"uniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float opacity;\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <fog_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <emissivemap_fragment>\\n\\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\\n\\t#include <lightmap_fragment>\\n\\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\\n\\t#ifdef DOUBLE_SIDED\\n\\t\\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\\n\\t#else\\n\\t\\treflectedLight.directDiffuse = vLightFront;\\n\\t#endif\\n\\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshlambert_vert:\"#define LAMBERT\\nvarying vec3 vLightFront;\\n#ifdef DOUBLE_SIDED\\n\\tvarying vec3 vLightBack;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <lights_lambert_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshmatcap_frag:\"#define MATCAP\\nuniform vec3 diffuse;\\nuniform float opacity;\\nuniform sampler2D matcap;\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tvec3 viewDir = normalize( vViewPosition );\\n\\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\\n\\tvec3 y = cross( viewDir, x );\\n\\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\\n\\t#ifdef USE_MATCAP\\n\\t\\tvec4 matcapColor = texture2D( matcap, uv );\\n\\t\\tmatcapColor = matcapTexelToLinear( matcapColor );\\n\\t#else\\n\\t\\tvec4 matcapColor = vec4( 1.0 );\\n\\t#endif\\n\\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\",meshmatcap_vert:\"#define MATCAP\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\t#ifndef FLAT_SHADED\\n\\t\\tvNormal = normalize( transformedNormal );\\n\\t#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n}\",meshphong_frag:\"#define PHONG\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform vec3 specular;\\nuniform float shininess;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <envmap_pars_fragment>\\n#include <gradientmap_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <lights_phong_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <specularmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <specularmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_phong_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\t#include <envmap_fragment>\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshphong_vert:\"#define PHONG\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <envmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <envmap_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",meshphysical_frag:\"#define PHYSICAL\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n#ifndef STANDARD\\n\\tuniform float clearCoat;\\n\\tuniform float clearCoatRoughness;\\n#endif\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <packing>\\n#include <dithering_pars_fragment>\\n#include <color_pars_fragment>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <map_pars_fragment>\\n#include <alphamap_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <lightmap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <bsdfs>\\n#include <cube_uv_reflection_fragment>\\n#include <envmap_pars_fragment>\\n#include <envmap_physical_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <lights_pars_begin>\\n#include <lights_physical_pars_fragment>\\n#include <shadowmap_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\\n\\tvec3 totalEmissiveRadiance = emissive;\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphamap_fragment>\\n\\t#include <alphatest_fragment>\\n\\t#include <roughnessmap_fragment>\\n\\t#include <metalnessmap_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\t#include <emissivemap_fragment>\\n\\t#include <lights_physical_fragment>\\n\\t#include <lights_fragment_begin>\\n\\t#include <lights_fragment_maps>\\n\\t#include <lights_fragment_end>\\n\\t#include <aomap_fragment>\\n\\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <dithering_fragment>\\n}\",meshphysical_vert:\"#define PHYSICAL\\nvarying vec3 vViewPosition;\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n\\t#include <color_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\tvViewPosition = - mvPosition.xyz;\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",normal_frag:\"#define NORMAL\\nuniform float opacity;\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <packing>\\n#include <uv_pars_fragment>\\n#include <bumpmap_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\nvoid main() {\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n\\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\\n}\",normal_vert:\"#define NORMAL\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\\n\\tvarying vec3 vViewPosition;\\n#endif\\n#ifndef FLAT_SHADED\\n\\tvarying vec3 vNormal;\\n#endif\\n#include <uv_pars_vertex>\\n#include <displacementmap_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\t#include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n#ifndef FLAT_SHADED\\n\\tvNormal = normalize( transformedNormal );\\n#endif\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <displacementmap_vertex>\\n\\t#include <project_vertex>\\n\\t#include <logdepthbuf_vertex>\\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\\n\\tvViewPosition = - mvPosition.xyz;\\n#endif\\n}\",points_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <color_pars_fragment>\\n#include <map_particle_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_particle_fragment>\\n\\t#include <color_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <premultiplied_alpha_fragment>\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\",points_vert:\"uniform float size;\\nuniform float scale;\\n#include <common>\\n#include <color_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <color_vertex>\\n\\t#include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <project_vertex>\\n\\tgl_PointSize = size;\\n\\t#ifdef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\\n\\t\\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\\n\\t#endif\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <fog_vertex>\\n}\",shadow_frag:\"uniform vec3 color;\\nuniform float opacity;\\n#include <common>\\n#include <packing>\\n#include <fog_pars_fragment>\\n#include <bsdfs>\\n#include <lights_pars_begin>\\n#include <shadowmap_pars_fragment>\\n#include <shadowmask_pars_fragment>\\nvoid main() {\\n\\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\\n\\t#include <fog_fragment>\\n}\",shadow_vert:\"#include <fog_pars_vertex>\\n#include <shadowmap_pars_vertex>\\nvoid main() {\\n\\t#include <begin_vertex>\\n\\t#include <project_vertex>\\n\\t#include <worldpos_vertex>\\n\\t#include <shadowmap_vertex>\\n\\t#include <fog_vertex>\\n}\",sprite_frag:\"uniform vec3 diffuse;\\nuniform float opacity;\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <map_pars_fragment>\\n#include <fog_pars_fragment>\\n#include <logdepthbuf_pars_fragment>\\n#include <clipping_planes_pars_fragment>\\nvoid main() {\\n\\t#include <clipping_planes_fragment>\\n\\tvec3 outgoingLight = vec3( 0.0 );\\n\\tvec4 diffuseColor = vec4( diffuse, opacity );\\n\\t#include <logdepthbuf_fragment>\\n\\t#include <map_fragment>\\n\\t#include <alphatest_fragment>\\n\\toutgoingLight = diffuseColor.rgb;\\n\\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\\n\\t#include <tonemapping_fragment>\\n\\t#include <encodings_fragment>\\n\\t#include <fog_fragment>\\n}\",sprite_vert:\"uniform float rotation;\\nuniform vec2 center;\\n#include <common>\\n#include <uv_pars_vertex>\\n#include <fog_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <clipping_planes_pars_vertex>\\nvoid main() {\\n\\t#include <uv_vertex>\\n\\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\\n\\tvec2 scale;\\n\\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\\n\\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\\n\\t#ifndef USE_SIZEATTENUATION\\n\\t\\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\\n\\t\\tif ( isPerspective ) scale *= - mvPosition.z;\\n\\t#endif\\n\\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\\n\\tvec2 rotatedPosition;\\n\\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\\n\\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\\n\\tmvPosition.xy += rotatedPosition;\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <clipping_planes_vertex>\\n\\t#include <fog_vertex>\\n}\"},oo={clone:g,merge:v},ao={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(y.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):\"number\"==typeof e?this.setHex(e):\"string\"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.b=this.g=this.r=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function e(e,t,i){return 0>i&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:.5>i?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function(t,i,n){return t=eo.euclideanModulo(t,1),i=eo.clamp(i,0,1),n=eo.clamp(n,0,1),0===i?this.r=this.g=this.b=n:(n=2*n-(i=.5>=n?n*(1+i):n+i-n*i),this.r=e(n,i,t+1/3),this.g=e(n,i,t),this.b=e(n,i,t-1/3)),this}}(),setStyle:function(e){function t(t){void 0!==t&&1>parseFloat(t)&&console.warn(\"THREE.Color: Alpha component of \"+e+\" will be ignored.\")}var i;if(i=/^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec(e)){var n=i[2];switch(i[1]){case\"rgb\":case\"rgba\":if(i=/^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\\d+)%\\s*,\\s*(\\d+)%\\s*,\\s*(\\d+)%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case\"hsl\":case\"hsla\":if(i=/^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)%\\s*,\\s*(\\d+)%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec(n)){n=parseFloat(i[1])/360;var r=parseInt(i[2],10)/100,o=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(n,r,o)}}}else if(i=/^#([A-Fa-f0-9]+)$/.exec(e)){if(3===(n=(i=i[1]).length))return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(6===n)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&0<e.length&&(void 0!==(i=ao[e])?this.setHex(i):console.warn(\"THREE.Color: Unknown color \"+e)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){return void 0===t&&(t=2),t=0<t?1/t:1,this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function e(e){return.04045>e?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),copyLinearToSRGB:function(){function e(e){return.0031308>e?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return(\"000000\"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn(\"THREE.Color: .getHSL() target is now required\"),e={h:0,s:0,l:0});var t,i=this.r,n=this.g,r=this.b,o=Math.max(i,n,r),a=Math.min(i,n,r),s=(a+o)/2;if(a===o)a=t=0;else{var l=o-a;switch(a=.5>=s?l/(o+a):l/(2-o-a),o){case i:t=(n-r)/l+(n<r?6:0);break;case n:t=(r-i)/l+2;break;case r:t=(i-n)/l+4}t/=6}return e.h=t,e.s=a,e.l=s,e},getStyle:function(){return\"rgb(\"+(255*this.r|0)+\",\"+(255*this.g|0)+\",\"+(255*this.b|0)+\")\"},offsetHSL:function(){var e={};return function(t,i,n){return this.getHSL(e),e.h+=t,e.s+=i,e.l+=n,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(){var e={h:0,s:0,l:0},t={h:0,s:0,l:0};return function(i,n){this.getHSL(e),i.getHSL(t),i=eo.lerp(e.h,t.h,n);var r=eo.lerp(e.s,t.s,n);return n=eo.lerp(e.l,t.l,n),this.setHSL(i,r,n),this}}(),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var so={common:{diffuse:{value:new y(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new a},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new i(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new y(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new y(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new a}},sprite:{diffuse:{value:new y(15658734)},opacity:{value:1},center:{value:new i(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new a}}},lo={basic:{uniforms:v([so.common,so.specularmap,so.envmap,so.aomap,so.lightmap,so.fog]),vertexShader:ro.meshbasic_vert,fragmentShader:ro.meshbasic_frag},lambert:{uniforms:v([so.common,so.specularmap,so.envmap,so.aomap,so.lightmap,so.emissivemap,so.fog,so.lights,{emissive:{value:new y(0)}}]),vertexShader:ro.meshlambert_vert,fragmentShader:ro.meshlambert_frag},phong:{uniforms:v([so.common,so.specularmap,so.envmap,so.aomap,so.lightmap,so.emissivemap,so.bumpmap,so.normalmap,so.displacementmap,so.gradientmap,so.fog,so.lights,{emissive:{value:new y(0)},specular:{value:new y(1118481)},shininess:{value:30}}]),vertexShader:ro.meshphong_vert,fragmentShader:ro.meshphong_frag},standard:{uniforms:v([so.common,so.envmap,so.aomap,so.lightmap,so.emissivemap,so.bumpmap,so.normalmap,so.displacementmap,so.roughnessmap,so.metalnessmap,so.fog,so.lights,{emissive:{value:new y(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ro.meshphysical_vert,fragmentShader:ro.meshphysical_frag},matcap:{uniforms:v([so.common,so.bumpmap,so.normalmap,so.displacementmap,so.fog,{matcap:{value:null}}]),vertexShader:ro.meshmatcap_vert,fragmentShader:ro.meshmatcap_frag},points:{uniforms:v([so.points,so.fog]),vertexShader:ro.points_vert,fragmentShader:ro.points_frag},dashed:{uniforms:v([so.common,so.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ro.linedashed_vert,fragmentShader:ro.linedashed_frag},depth:{uniforms:v([so.common,so.displacementmap]),vertexShader:ro.depth_vert,fragmentShader:ro.depth_frag},normal:{uniforms:v([so.common,so.bumpmap,so.normalmap,so.displacementmap,{opacity:{value:1}}]),vertexShader:ro.normal_vert,fragmentShader:ro.normal_frag},sprite:{uniforms:v([so.sprite,so.fog]),vertexShader:ro.sprite_vert,fragmentShader:ro.sprite_frag},background:{uniforms:{uvTransform:{value:new a},t2D:{value:null}},vertexShader:ro.background_vert,fragmentShader:ro.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ro.cube_vert,fragmentShader:ro.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ro.equirect_vert,fragmentShader:ro.equirect_frag},distanceRGBA:{uniforms:v([so.common,so.displacementmap,{referencePosition:{value:new o},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ro.distanceRGBA_vert,fragmentShader:ro.distanceRGBA_frag},shadow:{uniforms:v([so.lights,so.fog,{color:{value:new y(0)},opacity:{value:1}}]),vertexShader:ro.shadow_vert,fragmentShader:ro.shadow_frag}};lo.physical={uniforms:v([lo.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ro.meshphysical_vert,fragmentShader:ro.meshphysical_frag},Object.assign(w.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),M.RotationOrders=\"XYZ YZX ZXY XZY YXZ ZYX\".split(\" \"),M.DefaultOrder=\"XYZ\",Object.defineProperties(M.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(M.prototype,{isEuler:!0,set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var n=eo.clamp,r=e.elements;e=r[0];var o=r[4],a=r[8],s=r[1],l=r[5],c=r[9],h=r[2],u=r[6];return r=r[10],\"XYZ\"===(t=t||this._order)?(this._y=Math.asin(n(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(-c,r),this._z=Math.atan2(-o,e)):(this._x=Math.atan2(u,l),this._z=0)):\"YXZ\"===t?(this._x=Math.asin(-n(c,-1,1)),.99999>Math.abs(c)?(this._y=Math.atan2(a,r),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-h,e),this._z=0)):\"ZXY\"===t?(this._x=Math.asin(n(u,-1,1)),.99999>Math.abs(u)?(this._y=Math.atan2(-h,r),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(s,e))):\"ZYX\"===t?(this._y=Math.asin(-n(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(u,r),this._z=Math.atan2(s,e)):(this._x=0,this._z=Math.atan2(-o,l))):\"YZX\"===t?(this._z=Math.asin(n(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,e)):(this._x=0,this._y=Math.atan2(a,r))):\"XZY\"===t?(this._z=Math.asin(-n(o,-1,1)),.99999>Math.abs(o)?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,e)):(this._x=Math.atan2(-c,r),this._y=0)):console.warn(\"THREE.Euler: .setFromRotationMatrix() given unsupported order: \"+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new n;return function(t,i,n){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new r;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new o(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(E.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask=this.mask|1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var co=0;_.DefaultUp=new o(0,1,0),_.DefaultMatrixAutoUpdate=!0,_.prototype=Object.assign(Object.create(t.prototype),{constructor:_,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new r;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new r;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new o(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new o(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new o(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new o;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new o(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new o(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new o(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new n;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new r,t=new n,i=new o,a=new o;return function(n,r,o){n.isVector3?i.copy(n):i.set(n,r,o),n=this.parent,this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?t.lookAt(a,i,this.up):t.lookAt(i,a,this.up),this.quaternion.setFromRotationMatrix(t),n&&(t.extractRotation(n.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error(\"THREE.Object3D.add: object can't be added as a child of itself.\",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:\"added\"}),this.children.push(e)):console.error(\"THREE.Object3D.add: object not an instance of THREE.Object3D.\",e),this)},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}return-1!==(t=this.children.indexOf(e))&&(e.parent=null,e.dispatchEvent({type:\"removed\"}),this.children.splice(t,1)),this},getObjectById:function(e){return this.getObjectByProperty(\"id\",e)},getObjectByName:function(e){return this.getObjectByProperty(\"name\",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn(\"THREE.Object3D: .getWorldPosition() target is now required\"),e=new o),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new o,t=new o;return function(i){return void 0===i&&(console.warn(\"THREE.Object3D: .getWorldQuaternion() target is now required\"),i=new r),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,i,t),i}}(),getWorldScale:function(){var e=new o,t=new r;return function(i){return void 0===i&&(console.warn(\"THREE.Object3D: .getWorldScale() target is now required\"),i=new o),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(e){void 0===e&&(console.warn(\"THREE.Object3D: .getWorldDirection() target is now required\"),e=new o),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(t=0,i=(e=this.children).length;t<i;t++)e[t].updateWorldMatrix(!1,!0)},toJSON:function(e){function t(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}function i(e){var t,i=[];for(t in e){var n=e[t];delete n.metadata,i.push(n)}return i}var n=void 0===e||\"string\"==typeof e,r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:\"Object\",generator:\"Object3D.toJSON\"});var o={};if(o.uuid=this.uuid,o.type=this.type,\"\"!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),\"{}\"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){o.geometry=t(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes)if(a=a.shapes,Array.isArray(a))for(var s=0,l=a.length;s<l;s++)t(e.shapes,a[s]);else t(e.shapes,a)}if(void 0!==this.material)if(Array.isArray(this.material)){for(a=[],s=0,l=this.material.length;s<l;s++)a.push(t(e.materials,this.material[s]));o.material=a}else o.material=t(e.materials,this.material);if(0<this.children.length)for(o.children=[],s=0;s<this.children.length;s++)o.children.push(this.children[s].toJSON(e).object);if(n){n=i(e.geometries),s=i(e.materials),l=i(e.textures);var c=i(e.images);a=i(e.shapes),0<n.length&&(r.geometries=n),0<s.length&&(r.materials=s),0<l.length&&(r.textures=l),0<c.length&&(r.images=c),0<a.length&&(r.shapes=a)}return r.object=o,r},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}});var ho=0;S.prototype=Object.assign(Object.create(t.prototype),{constructor:S,isGeometry:!0,applyMatrix:function(e){for(var t=(new a).getNormalMatrix(e),i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);for(i=0,n=this.faces.length;i<n;i++){(e=this.faces[i]).normal.applyMatrix3(t).normalize();for(var r=0,o=e.vertexNormals.length;r<o;r++)e.vertexNormals[r].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:function(){var e=new n;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new n;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new n;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new n;return function(t,i,n){return e.makeTranslation(t,i,n),this.applyMatrix(e),this}}(),scale:function(){var e=new n;return function(t,i,n){return e.makeScale(t,i,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new _;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,r,a){var s=void 0===c?[]:[n.colors[e].clone(),n.colors[t].clone(),n.colors[r].clone()];a=new w(e,t,r,void 0===l?[]:[(new o).fromArray(l,3*e),(new o).fromArray(l,3*t),(new o).fromArray(l,3*r)],s,a),n.faces.push(a),void 0!==h&&n.faceVertexUvs[0].push([(new i).fromArray(h,2*e),(new i).fromArray(h,2*t),(new i).fromArray(h,2*r)]),void 0!==u&&n.faceVertexUvs[1].push([(new i).fromArray(u,2*e),(new i).fromArray(u,2*t),(new i).fromArray(u,2*r)])}var n=this,r=null!==e.index?e.index.array:void 0,a=e.attributes,s=a.position.array,l=void 0!==a.normal?a.normal.array:void 0,c=void 0!==a.color?a.color.array:void 0,h=void 0!==a.uv?a.uv.array:void 0,u=void 0!==a.uv2?a.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var p=a=0;a<s.length;a+=3,p+=2)n.vertices.push((new o).fromArray(s,a)),void 0!==c&&n.colors.push((new y).fromArray(c,a));var d=e.groups;if(0<d.length)for(a=0;a<d.length;a++){var f=(s=d[a]).start;for(p=f,f+=s.count;p<f;p+=3)void 0!==r?t(r[p],r[p+1],r[p+2],s.materialIndex):t(p,p+1,p+2,s.materialIndex)}else if(void 0!==r)for(a=0;a<r.length;a+=3)t(r[a],r[a+1],r[a+2]);else for(a=0;a<s.length/3;a+=3)t(a,a+1,a+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new o;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius;t=0===t?1:1/t;var i=new n;return i.set(t,0,0,-t*e.x,0,t,0,-t*e.y,0,0,t,-t*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new o,t=new o,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],a=this.vertices[r.a],s=this.vertices[r.b];e.subVectors(this.vertices[r.c],s),t.subVectors(a,s),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t;void 0===e&&(e=!0);var i=Array(this.vertices.length),n=0;for(t=this.vertices.length;n<t;n++)i[n]=new o;if(e){var r=new o,a=new o;for(e=0,n=this.faces.length;e<n;e++){t=this.faces[e];var s=this.vertices[t.a],l=this.vertices[t.b],c=this.vertices[t.c];r.subVectors(c,l),a.subVectors(s,l),r.cross(a),i[t.a].add(r),i[t.b].add(r),i[t.c].add(r)}}else for(this.computeFaceNormals(),e=0,n=this.faces.length;e<n;e++)i[(t=this.faces[e]).a].add(t.normal),i[t.b].add(t.normal),i[t.c].add(t.normal);for(n=0,t=this.vertices.length;n<t;n++)i[n].normalize();for(e=0,n=this.faces.length;e<n;e++)3===(s=(t=this.faces[e]).vertexNormals).length?(s[0].copy(i[t.a]),s[1].copy(i[t.b]),s[2].copy(i[t.c])):(s[0]=i[t.a].clone(),s[1]=i[t.b].clone(),s[2]=i[t.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e;this.computeFaceNormals();var t=0;for(e=this.faces.length;t<e;t++){var i=this.faces[t],n=i.vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i=0;for(t=this.faces.length;i<t;i++){var n=this.faces[i];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);var r=0;for(e=n.vertexNormals.length;r<e;r++)n.__originalVertexNormals[r]?n.__originalVertexNormals[r].copy(n.vertexNormals[r]):n.__originalVertexNormals[r]=n.vertexNormals[r].clone()}var a=new S;for(a.faces=this.faces,r=0,e=this.morphTargets.length;r<e;r++){if(!this.morphNormals[r]){this.morphNormals[r]={},this.morphNormals[r].faceNormals=[],this.morphNormals[r].vertexNormals=[],n=this.morphNormals[r].faceNormals;var s=this.morphNormals[r].vertexNormals;for(i=0,t=this.faces.length;i<t;i++){var l=new o,c={a:new o,b:new o,c:new o};n.push(l),s.push(c)}}for(s=this.morphNormals[r],a.vertices=this.morphTargets[r].vertices,a.computeFaceNormals(),a.computeVertexNormals(),i=0,t=this.faces.length;i<t;i++)n=this.faces[i],l=s.faceNormals[i],c=s.vertexNormals[i],l.copy(n.normal),c.a.copy(n.vertexNormals[0]),c.b.copy(n.vertexNormals[1]),c.c.copy(n.vertexNormals[2])}for(i=0,t=this.faces.length;i<t;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new d),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var n,r=this.vertices.length,o=this.vertices,s=e.vertices,l=this.faces,c=e.faces,h=this.faceVertexUvs[0],u=e.faceVertexUvs[0],p=this.colors,d=e.colors;void 0===i&&(i=0),void 0!==t&&(n=(new a).getNormalMatrix(t)),e=0;for(var f=s.length;e<f;e++){var m=s[e].clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(e=0,f=d.length;e<f;e++)p.push(d[e].clone());for(e=0,f=c.length;e<f;e++){var g=(s=c[e]).vertexNormals;for(d=s.vertexColors,(p=new w(s.a+r,s.b+r,s.c+r)).normal.copy(s.normal),void 0!==n&&p.normal.applyMatrix3(n).normalize(),t=0,o=g.length;t<o;t++)m=g[t].clone(),void 0!==n&&m.applyMatrix3(n).normalize(),p.vertexNormals.push(m);for(p.color.copy(s.color),t=0,o=d.length;t<o;t++)m=d[t],p.vertexColors.push(m.clone());p.materialIndex=s.materialIndex+i,l.push(p)}for(e=0,f=u.length;e<f;e++)if(n=[],void 0!==(i=u[e])){for(t=0,o=i.length;t<o;t++)n.push(i[t].clone());h.push(n)}}else console.error(\"THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.\",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error(\"THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.\",e)},mergeVertices:function(){var e,t={},i=[],n=[],r=Math.pow(10,4),o=0;for(e=this.vertices.length;o<e;o++){var a=this.vertices[o];void 0===t[a=Math.round(a.x*r)+\"_\"+Math.round(a.y*r)+\"_\"+Math.round(a.z*r)]?(t[a]=o,i.push(this.vertices[o]),n[o]=i.length-1):n[o]=n[t[a]]}for(t=[],o=0,e=this.faces.length;o<e;o++)for((r=this.faces[o]).a=n[r.a],r.b=n[r.b],r.c=n[r.c],r=[r.a,r.b,r.c],a=0;3>a;a++)if(r[a]===r[(a+1)%3]){t.push(o);break}for(o=t.length-1;0<=o;o--)for(r=t[o],this.faces.splice(r,1),n=0,e=this.faceVertexUvs.length;n<e;n++)this.faceVertexUvs[n].splice(r,1);return o=this.vertices.length-i.length,this.vertices=i,o},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var n=e[t];this.vertices.push(new o(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var n,r,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];for(o&&o.length===t&&(n=[]),a&&a.length===t&&(r=[]),i=0;i<t;i++){var s=e[i]._id;n&&n.push(o[s]),r&&r.push(a[s])}n&&(this.faceVertexUvs[0]=n),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){function e(e,t,i){return i?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==c[t]||(c[t]=l.length/3,l.push(e.x,e.y,e.z)),c[t]}function i(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==u[t]||(u[t]=h.length,h.push(e.getHex())),u[t]}function n(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=p.length/2,p.push(e.x,e.y)),d[t]}var r={metadata:{version:4.5,type:\"Geometry\",generator:\"Geometry.toJSON\"}};if(r.uuid=this.uuid,r.type=this.type,\"\"!==this.name&&(r.name=this.name),void 0!==this.parameters){var o,a=this.parameters;for(o in a)void 0!==a[o]&&(r[o]=a[o]);return r}for(a=[],o=0;o<this.vertices.length;o++){var s=this.vertices[o];a.push(s.x,s.y,s.z)}s=[];var l=[],c={},h=[],u={},p=[],d={};for(o=0;o<this.faces.length;o++){var f=this.faces[o],m=void 0!==this.faceVertexUvs[0][o],g=0<f.normal.length(),v=0<f.vertexNormals.length,y=1!==f.color.r||1!==f.color.g||1!==f.color.b,x=0<f.vertexColors.length,b=0;b=e(b,0,0),b=e(b,1,!0),b=e(b,2,!1),b=e(b,3,m),b=e(b,4,g),b=e(b,5,v),b=e(b,6,y),b=e(b,7,x),s.push(b),s.push(f.a,f.b,f.c),s.push(f.materialIndex),m&&(m=this.faceVertexUvs[0][o],s.push(n(m[0]),n(m[1]),n(m[2]))),g&&s.push(t(f.normal)),v&&(g=f.vertexNormals,s.push(t(g[0]),t(g[1]),t(g[2]))),y&&s.push(i(f.color)),x&&(f=f.vertexColors,s.push(i(f[0]),i(f[1]),i(f[2])))}return r.data={},r.data.vertices=a,r.data.normals=l,0<h.length&&(r.data.colors=h),0<p.length&&(r.data.uvs=[p]),r.data.faces=s,r},clone:function(){return(new S).copy(this)},copy:function(e){var t,i,n;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=e.name;var r=e.vertices,o=0;for(t=r.length;o<t;o++)this.vertices.push(r[o].clone());for(o=0,t=(r=e.colors).length;o<t;o++)this.colors.push(r[o].clone());for(o=0,t=(r=e.faces).length;o<t;o++)this.faces.push(r[o].clone());for(o=0,t=e.faceVertexUvs.length;o<t;o++){var a=e.faceVertexUvs[o];for(void 0===this.faceVertexUvs[o]&&(this.faceVertexUvs[o]=[]),r=0,i=a.length;r<i;r++){var s=a[r],l=[],c=0;for(n=s.length;c<n;c++)l.push(s[c].clone());this.faceVertexUvs[o].push(l)}}for(o=0,t=(c=e.morphTargets).length;o<t;o++){if((n={}).name=c[o].name,void 0!==c[o].vertices)for(n.vertices=[],r=0,i=c[o].vertices.length;r<i;r++)n.vertices.push(c[o].vertices[r].clone());if(void 0!==c[o].normals)for(n.normals=[],r=0,i=c[o].normals.length;r<i;r++)n.normals.push(c[o].normals[r].clone());this.morphTargets.push(n)}for(o=0,t=(c=e.morphNormals).length;o<t;o++){if(n={},void 0!==c[o].vertexNormals)for(n.vertexNormals=[],r=0,i=c[o].vertexNormals.length;r<i;r++)a=c[o].vertexNormals[r],(s={}).a=a.a.clone(),s.b=a.b.clone(),s.c=a.c.clone(),n.vertexNormals.push(s);if(void 0!==c[o].faceNormals)for(n.faceNormals=[],r=0,i=c[o].faceNormals.length;r<i;r++)n.faceNormals.push(c[o].faceNormals[r].clone());this.morphNormals.push(n)}for(o=0,t=(r=e.skinWeights).length;o<t;o++)this.skinWeights.push(r[o].clone());for(o=0,t=(r=e.skinIndices).length;o<t;o++)this.skinIndices.push(r[o].clone());for(o=0,t=(r=e.lineDistances).length;o<t;o++)this.lineDistances.push(r[o]);return null!==(o=e.boundingBox)&&(this.boundingBox=o.clone()),null!==(o=e.boundingSphere)&&(this.boundingSphere=o.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}}),Object.defineProperty(T.prototype,\"needsUpdate\",{set:function(e){!0===e&&this.version++}}),Object.assign(T.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError(\"THREE.BufferAttribute: array should be a Typed Array.\");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn(\"THREE.BufferAttribute.copyColorsArray(): color is undefined\",n),o=new y),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,o=e.length;r<o;r++){var a=e[r];void 0===a&&(console.warn(\"THREE.BufferAttribute.copyVector2sArray(): vector is undefined\",r),a=new i),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var a=e[n];void 0===a&&(console.warn(\"THREE.BufferAttribute.copyVector3sArray(): vector is undefined\",n),a=new o),t[i++]=a.x,t[i++]=a.y,t[i++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn(\"THREE.BufferAttribute.copyVector4sArray(): vector is undefined\",n),o=new l),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),A.prototype=Object.create(T.prototype),A.prototype.constructor=A,C.prototype=Object.create(T.prototype),C.prototype.constructor=C,R.prototype=Object.create(T.prototype),R.prototype.constructor=R,L.prototype=Object.create(T.prototype),L.prototype.constructor=L,P.prototype=Object.create(T.prototype),P.prototype.constructor=P,N.prototype=Object.create(T.prototype),N.prototype.constructor=N,B.prototype=Object.create(T.prototype),B.prototype.constructor=B,z.prototype=Object.create(T.prototype),z.prototype.constructor=z,O.prototype=Object.create(T.prototype),O.prototype.constructor=O,Object.assign(F.prototype,{computeGroups:function(e){var t=[],i=void 0;e=e.faces;for(var n=0;n<e.length;n++){var r=e[n];if(r.materialIndex!==i){i=r.materialIndex,void 0!==o&&(o.count=3*n-o.start,t.push(o));var o={start:3*n,materialIndex:i}}}void 0!==o&&(o.count=3*n-o.start,t.push(o)),this.groups=t},fromGeometry:function(e){var t=e.faces,n=e.vertices,r=e.faceVertexUvs,o=r[0]&&0<r[0].length,a=r[1]&&0<r[1].length,s=e.morphTargets,l=s.length;if(0<l){for(var c=[],h=0;h<l;h++)c[h]={name:s[h].name,data:[]};this.morphTargets.position=c}var u=e.morphNormals,p=u.length;if(0<p){var d=[];for(h=0;h<p;h++)d[h]={name:u[h].name,data:[]};this.morphTargets.normal=d}var f=e.skinIndices,m=e.skinWeights,g=f.length===n.length,v=m.length===n.length;for(0<n.length&&0===t.length&&console.error(\"THREE.DirectGeometry: Faceless geometries are not supported.\"),h=0;h<t.length;h++){var y=t[h];this.vertices.push(n[y.a],n[y.b],n[y.c]);var x=y.vertexNormals;for(3===x.length?this.normals.push(x[0],x[1],x[2]):(x=y.normal,this.normals.push(x,x,x)),3===(x=y.vertexColors).length?this.colors.push(x[0],x[1],x[2]):(x=y.color,this.colors.push(x,x,x)),!0===o&&(void 0!==(x=r[0][h])?this.uvs.push(x[0],x[1],x[2]):(console.warn(\"THREE.DirectGeometry.fromGeometry(): Undefined vertexUv \",h),this.uvs.push(new i,new i,new i))),!0===a&&(void 0!==(x=r[1][h])?this.uvs2.push(x[0],x[1],x[2]):(console.warn(\"THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 \",h),this.uvs2.push(new i,new i,new i))),x=0;x<l;x++){var b=s[x].vertices;c[x].data.push(b[y.a],b[y.b],b[y.c])}for(x=0;x<p;x++)b=u[x].vertexNormals[h],d[x].data.push(b.a,b.b,b.c);g&&this.skinIndices.push(f[y.a],f[y.b],f[y.c]),v&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var uo=1;D.prototype=Object.assign(Object.create(t.prototype),{constructor:D,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<I(e)?B:P)(e,1):this.index=e},addAttribute:function(e,t,i){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?\"index\"===e?(console.warn(\"THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.\"),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn(\"THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).\"),this.addAttribute(e,new T(t,i)))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;return void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0),void 0!==(t=this.attributes.normal)&&((new a).getNormalMatrix(e).applyToBufferAttribute(t),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new n;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new n;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new n;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new n;return function(t,i,n){return e.makeTranslation(t,i,n),this.applyMatrix(e),this}}(),scale:function(){var e=new n;return function(t,i,n){return e.makeScale(t,i,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new _;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new o;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){e=new z(3*t.vertices.length,3);var i=new z(3*t.colors.length,3);this.addAttribute(\"position\",e.copyVector3sArray(t.vertices)),this.addAttribute(\"color\",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length&&(e=new z(t.lineDistances.length,1),this.addAttribute(\"lineDistance\",e.copyArray(t.lineDistances))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i];t.push(r.x,r.y,r.z||0)}return this.addAttribute(\"position\",new z(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var i=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(i=void 0,t.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}return!0===t.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new F).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);for(var i in this.addAttribute(\"position\",new T(t,3).copyVector3sArray(e.vertices)),0<e.normals.length&&(t=new Float32Array(3*e.normals.length),this.addAttribute(\"normal\",new T(t,3).copyVector3sArray(e.normals))),0<e.colors.length&&(t=new Float32Array(3*e.colors.length),this.addAttribute(\"color\",new T(t,3).copyColorsArray(e.colors))),0<e.uvs.length&&(t=new Float32Array(2*e.uvs.length),this.addAttribute(\"uv\",new T(t,2).copyVector2sArray(e.uvs))),0<e.uvs2.length&&(t=new Float32Array(2*e.uvs2.length),this.addAttribute(\"uv2\",new T(t,2).copyVector2sArray(e.uvs2))),this.groups=e.groups,e.morphTargets){t=[];for(var n=e.morphTargets[i],r=0,o=n.length;r<o;r++){var a=n[r],s=new z(3*a.data.length,3);s.name=a.name,t.push(s.copyVector3sArray(a.data))}this.morphAttributes[i]=t}return 0<e.skinIndices.length&&(i=new z(4*e.skinIndices.length,4),this.addAttribute(\"skinIndex\",i.copyVector4sArray(e.skinIndices))),0<e.skinWeights.length&&(i=new z(4*e.skinWeights.length,4),this.addAttribute(\"skinWeight\",i.copyVector4sArray(e.skinWeights))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new p);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new p,t=new o;return function(){null===this.boundingSphere&&(this.boundingSphere=new d);var i=this.attributes.position;if(i){var n=this.boundingSphere.center;e.setFromBufferAttribute(i),e.getCenter(n);for(var r=0,o=0,a=i.count;o<a;o++)t.x=i.getX(o),t.y=i.getY(o),t.z=i.getZ(o),r=Math.max(r,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var i=t.position.array;if(void 0===t.normal)this.addAttribute(\"normal\",new T(new Float32Array(i.length),3));else for(var n=t.normal.array,r=0,a=n.length;r<a;r++)n[r]=0;n=t.normal.array;var s=new o,l=new o,c=new o,h=new o,u=new o;if(e){var p=e.array;for(r=0,a=e.count;r<a;r+=3){e=3*p[r+0];var d=3*p[r+1],f=3*p[r+2];s.fromArray(i,e),l.fromArray(i,d),c.fromArray(i,f),h.subVectors(c,l),u.subVectors(s,l),h.cross(u),n[e]+=h.x,n[e+1]+=h.y,n[e+2]+=h.z,n[d]+=h.x,n[d+1]+=h.y,n[d+2]+=h.z,n[f]+=h.x,n[f+1]+=h.y,n[f+2]+=h.z}}else for(r=0,a=i.length;r<a;r+=9)s.fromArray(i,r),l.fromArray(i,r+3),c.fromArray(i,r+6),h.subVectors(c,l),u.subVectors(s,l),h.cross(u),n[r]=h.x,n[r+1]=h.y,n[r+2]=h.z,n[r+3]=h.x,n[r+4]=h.y,n[r+5]=h.z,n[r+6]=h.x,n[r+7]=h.y,n[r+8]=h.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn(\"THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.\"));var i,n=this.attributes;for(i in n)if(void 0!==e.attributes[i]){var r=n[i].array,o=e.attributes[i],a=o.array,s=0;for(o=o.itemSize*t;s<a.length;s++,o++)r[o]=a[s]}return this}console.error(\"THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.\",e)},normalizeNormals:function(){var e=new o;return function(){for(var t=this.attributes.normal,i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.normalize(),t.setXYZ(i,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn(\"THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.\"),this;var e,t=new D,i=this.index.array,n=this.attributes;for(e in n){var r=n[e],o=r.array,a=r.itemSize,s=new o.constructor(i.length*a),l=0;r=0;for(var c=i.length;r<c;r++)for(var h=i[r]*a,u=0;u<a;u++)s[l++]=o[h++];t.addAttribute(e,new T(s,a))}for(r=0,c=(i=this.groups).length;r<c;r++)n=i[r],t.addGroup(n.start,n.count,n.materialIndex);return t},toJSON:function(){var e={metadata:{version:4.5,type:\"BufferGeometry\",generator:\"BufferGeometry.toJSON\"}};if(e.uuid=this.uuid,e.type=this.type,\"\"!==this.name&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;for(r in null!==i&&(t=Array.prototype.slice.call(i.array),e.data.index={type:i.array.constructor.name,array:t}),i=this.attributes){var n=i[r];t=Array.prototype.slice.call(n.array),e.data.attributes[r]={itemSize:n.itemSize,type:n.array.constructor.name,array:t,normalized:n.normalized}}var r=this.groups;return 0<r.length&&(e.data.groups=JSON.parse(JSON.stringify(r))),null!==(r=this.boundingSphere)&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e},clone:function(){return(new D).copy(this)},copy:function(e){var t;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=e.name;var i=e.index;for(a in null!==i&&this.setIndex(i.clone()),i=e.attributes)this.addAttribute(a,i[a].clone());var n=e.morphAttributes;for(a in n){var r=[],o=n[a];for(i=0,t=o.length;i<t;i++)r.push(o[i].clone());this.morphAttributes[a]=r}var a=e.groups;for(i=0,t=a.length;i<t;i++)n=a[i],this.addGroup(n.start,n.count,n.materialIndex);return null!==(a=e.boundingBox)&&(this.boundingBox=a.clone()),null!==(a=e.boundingSphere)&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}}),H.prototype=Object.create(S.prototype),H.prototype.constructor=H,j.prototype=Object.create(D.prototype),j.prototype.constructor=j,V.prototype=Object.create(S.prototype),V.prototype.constructor=V,k.prototype=Object.create(D.prototype),k.prototype.constructor=k;var po=0;U.prototype=Object.assign(Object.create(t.prototype),{constructor:U,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0===i)console.warn(\"THREE.Material: '\"+t+\"' parameter is undefined.\");else if(\"shading\"===t)console.warn(\"THREE.\"+this.type+\": .shading has been removed. Use the boolean .flatShading instead.\"),this.flatShading=1===i;else{var n=this[t];void 0===n?console.warn(\"THREE.\"+this.type+\": '\"+t+\"' is not a property of this material.\"):n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}},toJSON:function(e){function t(e){var t,i=[];for(t in e){var n=e[t];delete n.metadata,i.push(n)}return i}var i=void 0===e||\"string\"==typeof e;i&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:\"Material\",generator:\"Material.toJSON\"}};return n.uuid=this.uuid,n.type=this.type,\"\"!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),0!==this.vertexColors&&(n.vertexColors=this.vertexColors),1>this.opacity&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),\"round\"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),\"round\"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),\"{}\"!==JSON.stringify(this.userData)&&(n.userData=this.userData),i&&(i=t(e.textures),e=t(e.images),0<i.length&&(n.textures=i),0<e.length&&(n.images=e)),n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,i=null;if(null!==t){var n=t.length;i=Array(n);for(var r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:\"dispose\"})}}),G.prototype=Object.create(U.prototype),G.prototype.constructor=G,G.prototype.isShaderMaterial=!0,G.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=g(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},G.prototype.toJSON=function(e){var t=U.prototype.toJSON.call(this,e);for(var i in t.uniforms={},this.uniforms){var n=this.uniforms[i].value;t.uniforms[i]=n&&n.isTexture?{type:\"t\",value:n.toJSON(e).uuid}:n&&n.isColor?{type:\"c\",value:n.getHex()}:n&&n.isVector2?{type:\"v2\",value:n.toArray()}:n&&n.isVector3?{type:\"v3\",value:n.toArray()}:n&&n.isVector4?{type:\"v4\",value:n.toArray()}:n&&n.isMatrix4?{type:\"m4\",value:n.toArray()}:{value:n}}for(var r in 0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,e={},this.extensions)!0===this.extensions[r]&&(e[r]=!0);return 0<Object.keys(e).length&&(t.extensions=e),t},Object.assign(W.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn(\"THREE.Ray: .at() target is now required\"),t=new o),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new o;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){return void 0===t&&(console.warn(\"THREE.Ray: .closestPointToPoint() target is now required\"),t=new o),t.subVectors(e,this.origin),0>(e=t.dot(this.direction))?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new o;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return 0>i?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new o,t=new o,i=new o;return function(n,r,o,a){e.copy(n).add(r).multiplyScalar(.5),t.copy(r).sub(n).normalize(),i.copy(this.origin).sub(e);var s=.5*n.distanceTo(r),l=-this.direction.dot(t),c=i.dot(this.direction),h=-i.dot(t),u=i.lengthSq(),p=Math.abs(1-l*l);if(0<p){r=l*c-h;var d=s*p;0<=(n=l*h-c)?r>=-d?r<=d?l=(n*=s=1/p)*(n+l*(r*=s)+2*c)+r*(l*n+r+2*h)+u:(r=s,l=-(n=Math.max(0,-(l*r+c)))*n+r*(r+2*h)+u):(r=-s,l=-(n=Math.max(0,-(l*r+c)))*n+r*(r+2*h)+u):r<=-d?l=-(n=Math.max(0,-(-l*s+c)))*n+(r=0<n?-s:Math.min(Math.max(-s,-h),s))*(r+2*h)+u:r<=d?(n=0,l=(r=Math.min(Math.max(-s,-h),s))*(r+2*h)+u):l=-(n=Math.max(0,-(l*s+c)))*n+(r=0<n?s:Math.min(Math.max(-s,-h),s))*(r+2*h)+u}else r=0<l?-s:s,l=-(n=Math.max(0,-(l*r+c)))*n+r*(r+2*h)+u;return o&&o.copy(this.direction).multiplyScalar(n).add(this.origin),a&&a.copy(t).multiplyScalar(r).add(e),l}}(),intersectSphere:function(){var e=new o;return function(t,i){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),r=e.dot(e)-n*n;return r>(t=t.radius*t.radius)?null:(r=n-(t=Math.sqrt(t-r)),n+=t,0>r&&0>n?null:0>r?this.at(n,i):this.at(r,i))}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:0<=(e=-(this.origin.dot(e.normal)+e.constant)/t)?e:null},intersectPlane:function(e,t){return null===(e=this.distanceToPlane(e))?null:this.at(e,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t},intersectBox:function(e,t){var i=1/this.direction.x,n=1/this.direction.y,r=1/this.direction.z,o=this.origin;if(0<=i){var a=(e.min.x-o.x)*i;i*=e.max.x-o.x}else a=(e.max.x-o.x)*i,i*=e.min.x-o.x;if(0<=n){var s=(e.min.y-o.y)*n;n*=e.max.y-o.y}else s=(e.max.y-o.y)*n,n*=e.min.y-o.y;return a>n||s>i?null:((s>a||a!=a)&&(a=s),(n<i||i!=i)&&(i=n),0<=r?(s=(e.min.z-o.z)*r,e=(e.max.z-o.z)*r):(s=(e.max.z-o.z)*r,e=(e.min.z-o.z)*r),a>e||s>i?null:((s>a||a!=a)&&(a=s),(e<i||i!=i)&&(i=e),0>i?null:this.at(0<=a?a:i,t)))},intersectsBox:function(){var e=new o;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new o,t=new o,i=new o,n=new o;return function(r,o,a,s,l){if(t.subVectors(o,r),i.subVectors(a,r),n.crossVectors(t,i),0<(o=this.direction.dot(n))){if(s)return null;s=1}else{if(!(0>o))return null;s=-1,o=-o}return e.subVectors(this.origin,r),0>(r=s*this.direction.dot(i.crossVectors(e,i)))||0>(a=s*this.direction.dot(t.cross(e)))||r+a>o||0>(r=-s*e.dot(n))?null:this.at(r/o,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(q,{getNormal:function(){var e=new o;return function(t,i,n,r){return void 0===r&&(console.warn(\"THREE.Triangle: .getNormal() target is now required\"),r=new o),r.subVectors(n,i),e.subVectors(t,i),r.cross(e),0<(t=r.lengthSq())?r.multiplyScalar(1/Math.sqrt(t)):r.set(0,0,0)}}(),getBarycoord:function(){var e=new o,t=new o,i=new o;return function(n,r,a,s,l){e.subVectors(s,r),t.subVectors(a,r),i.subVectors(n,r),n=e.dot(e),r=e.dot(t),a=e.dot(i);var c=t.dot(t);s=t.dot(i);var h=n*c-r*r;return void 0===l&&(console.warn(\"THREE.Triangle: .getBarycoord() target is now required\"),l=new o),0===h?l.set(-2,-1,-1):(c=(c*a-r*s)*(h=1/h),n=(n*s-r*a)*h,l.set(1-c-n,n,c))}}(),containsPoint:function(){var e=new o;return function(t,i,n,r){return q.getBarycoord(t,i,n,r,e),0<=e.x&&0<=e.y&&1>=e.x+e.y}}(),getUV:function(){var e=new o;return function(t,i,n,r,o,a,s,l){return this.getBarycoord(t,i,n,r,e),l.set(0,0),l.addScaledVector(o,e.x),l.addScaledVector(a,e.y),l.addScaledVector(s,e.z),l}}()}),Object.assign(q.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new o,t=new o;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn(\"THREE.Triangle: .getMidpoint() target is now required\"),e=new o),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return q.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn(\"THREE.Triangle: .getPlane() target is now required\"),e=new o),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return q.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return q.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,i,n,r){return q.getUV(e,this.a,this.b,this.c,t,i,n,r)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new o,t=new o,i=new o,n=new o,r=new o,a=new o;return function(s,l){void 0===l&&(console.warn(\"THREE.Triangle: .closestPointToPoint() target is now required\"),l=new o);var c=this.a,h=this.b,u=this.c;e.subVectors(h,c),t.subVectors(u,c),n.subVectors(s,c);var p=e.dot(n),d=t.dot(n);if(0>=p&&0>=d)return l.copy(c);r.subVectors(s,h);var f=e.dot(r),m=t.dot(r);if(0<=f&&m<=f)return l.copy(h);var g=p*m-f*d;if(0>=g&&0<=p&&0>=f)return h=p/(p-f),l.copy(c).addScaledVector(e,h);a.subVectors(s,u),s=e.dot(a);var v=t.dot(a);return 0<=v&&s<=v?l.copy(u):0>=(p=s*d-p*v)&&0<=d&&0>=v?(g=d/(d-v),l.copy(c).addScaledVector(t,g)):0>=(d=f*v-s*m)&&0<=m-f&&0<=s-v?(i.subVectors(u,h),g=(m-f)/(m-f+(s-v)),l.copy(h).addScaledVector(i,g)):(h=p*(u=1/(d+p+g)),g*=u,l.copy(c).addScaledVector(e,h).addScaledVector(t,g))}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Q.prototype=Object.create(U.prototype),Q.prototype.constructor=Q,Q.prototype.isMeshBasicMaterial=!0,Q.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},X.prototype=Object.assign(Object.create(_.prototype),{constructor:X,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return _.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var i=e[t[0]];if(void 0!==i)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=i.length;e<t;e++){var n=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}else void 0!==(e=e.morphTargets)&&0<e.length&&console.error(\"THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.\")},raycast:function(){function e(e,t,i,n,r,o,a,s){return null===(1===t.side?n.intersectTriangle(a,o,r,!0,s):n.intersectTriangle(r,o,a,2!==t.side,s))?null:(x.copy(s),x.applyMatrix4(e.matrixWorld),(t=i.ray.origin.distanceTo(x))<i.near||t>i.far?null:{distance:t,point:x.clone(),object:e})}function t(t,n,r,o,a,s,u,p,d){return l.fromBufferAttribute(a,u),c.fromBufferAttribute(a,p),h.fromBufferAttribute(a,d),(t=e(t,n,r,o,l,c,h,y))&&(s&&(m.fromBufferAttribute(s,u),g.fromBufferAttribute(s,p),v.fromBufferAttribute(s,d),t.uv=q.getUV(y,l,c,h,m,g,v,new i)),s=new w(u,p,d),q.getNormal(l,c,h,s.normal),t.face=s),t}var r=new n,a=new W,s=new d,l=new o,c=new o,h=new o,u=new o,p=new o,f=new o,m=new i,g=new i,v=new i,y=new o,x=new o;return function(n,o){var d=this.geometry,x=this.material,b=this.matrixWorld;if(void 0!==x&&(null===d.boundingSphere&&d.computeBoundingSphere(),s.copy(d.boundingSphere),s.applyMatrix4(b),!1!==n.ray.intersectsSphere(s)&&(r.getInverse(b),a.copy(n.ray).applyMatrix4(r),null===d.boundingBox||!1!==a.intersectsBox(d.boundingBox))))if(d.isBufferGeometry){var w,M=d.index,E=d.attributes.position,_=d.attributes.uv,S=d.groups;if(d=d.drawRange,null!==M)if(Array.isArray(x)){var T=0;for(w=S.length;T<w;T++){var A=S[T],C=x[A.materialIndex];b=Math.max(A.start,d.start);var R=Math.min(A.start+A.count,d.start+d.count);for(A=b;A<R;A+=3){b=M.getX(A);var L=M.getX(A+1),P=M.getX(A+2);(b=t(this,C,n,a,E,_,b,L,P))&&(b.faceIndex=Math.floor(A/3),o.push(b))}}}else for(T=b=Math.max(0,d.start),w=R=Math.min(M.count,d.start+d.count);T<w;T+=3)b=M.getX(T),L=M.getX(T+1),P=M.getX(T+2),(b=t(this,x,n,a,E,_,b,L,P))&&(b.faceIndex=Math.floor(T/3),o.push(b));else if(void 0!==E)if(Array.isArray(x))for(T=0,w=S.length;T<w;T++)for(C=x[(A=S[T]).materialIndex],b=Math.max(A.start,d.start),R=Math.min(A.start+A.count,d.start+d.count),A=b;A<R;A+=3)(b=t(this,C,n,a,E,_,b=A,L=A+1,P=A+2))&&(b.faceIndex=Math.floor(A/3),o.push(b));else for(T=b=Math.max(0,d.start),w=R=Math.min(E.count,d.start+d.count);T<w;T+=3)(b=t(this,x,n,a,E,_,b=T,L=T+1,P=T+2))&&(b.faceIndex=Math.floor(T/3),o.push(b))}else if(d.isGeometry)for(E=Array.isArray(x),_=d.vertices,S=d.faces,0<(b=d.faceVertexUvs[0]).length&&(M=b),A=0,R=S.length;A<R;A++)if(L=S[A],void 0!==(b=E?x[L.materialIndex]:x)){if(T=_[L.a],w=_[L.b],C=_[L.c],!0===b.morphTargets){P=d.morphTargets;var N=this.morphTargetInfluences;l.set(0,0,0),c.set(0,0,0),h.set(0,0,0);for(var B=0,z=P.length;B<z;B++){var O=N[B];if(0!==O){var F=P[B].vertices;l.addScaledVector(u.subVectors(F[L.a],T),O),c.addScaledVector(p.subVectors(F[L.b],w),O),h.addScaledVector(f.subVectors(F[L.c],C),O)}}l.add(T),c.add(w),h.add(C),T=l,w=c,C=h}(b=e(this,b,n,a,T,w,C,y))&&(M&&M[A]&&(P=M[A],m.copy(P[0]),g.copy(P[1]),v.copy(P[2]),b.uv=q.getUV(y,T,w,C,m,g,v,new i)),b.face=L,b.faceIndex=A,o.push(b))}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ae.prototype=Object.create(s.prototype),ae.prototype.constructor=ae,ae.prototype.isCubeTexture=!0,Object.defineProperty(ae.prototype,\"images\",{get:function(){return this.image},set:function(e){this.image=e}}),se.prototype=Object.create(s.prototype),se.prototype.constructor=se,se.prototype.isDataTexture3D=!0;var fo=new s,mo=new se,go=new ae,vo=[],yo=[],xo=new Float32Array(16),bo=new Float32Array(9),wo=new Float32Array(4);Ie.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),he(t,e)},De.prototype.setValue=function(e,t,i){for(var n=this.seq,r=0,o=n.length;r!==o;++r){var a=n[r];a.setValue(e,t[a.id],i)}};var Mo=/([\\w\\d_]+)(\\])?(\\[|\\.)?/g;He.prototype.setValue=function(e,t,i){void 0!==(t=this.map[t])&&t.setValue(e,i,this.renderer)},He.prototype.setOptional=function(e,t,i){void 0!==(t=t[i])&&this.setValue(e,i,t)},He.upload=function(e,t,i,n){for(var r=0,o=t.length;r!==o;++r){var a=t[r],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,n)}},He.seqWithValue=function(e,t){for(var i=[],n=0,r=e.length;n!==r;++n){var o=e[n];o.id in t&&i.push(o)}return i};var Eo=0,_o=0;st.prototype=Object.create(U.prototype),st.prototype.constructor=st,st.prototype.isMeshDepthMaterial=!0,st.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},lt.prototype=Object.create(U.prototype),lt.prototype.constructor=lt,lt.prototype.isMeshDistanceMaterial=!0,lt.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},dt.prototype=Object.assign(Object.create(_.prototype),{constructor:dt,isGroup:!0}),ft.prototype=Object.assign(Object.create(_.prototype),{constructor:ft,isCamera:!0,copy:function(e,t){return _.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn(\"THREE.Camera: .getWorldDirection() target is now required\"),e=new o),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){_.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),mt.prototype=Object.assign(Object.create(ft.prototype),{constructor:mt,isPerspectiveCamera:!0,copy:function(e,t){return ft.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){e=.5*this.getFilmHeight()/e,this.fov=2*eo.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*eo.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*eo.RAD2DEG*Math.atan(Math.tan(.5*eo.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,n,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*eo.DEG2RAD*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;r+=o.offsetX*n/a,t-=o.offsetY*i/s,n*=o.width/a,i*=o.height/s}0!==(o=this.filmOffset)&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){return(e=_.prototype.toJSON.call(this,e)).object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),gt.prototype=Object.assign(Object.create(mt.prototype),{constructor:gt,isArrayCamera:!0});var So,To=new o,Ao=new o;wt.prototype.isFogExp2=!0,wt.prototype.clone=function(){return new wt(this.color,this.density)},wt.prototype.toJSON=function(){return{type:\"FogExp2\",color:this.color.getHex(),density:this.density}},Mt.prototype.isFog=!0,Mt.prototype.clone=function(){return new Mt(this.color,this.near,this.far)},Mt.prototype.toJSON=function(){return{type:\"Fog\",color:this.color.getHex(),near:this.near,far:this.far}},Et.prototype=Object.assign(Object.create(_.prototype),{constructor:Et,copy:function(e,t){return _.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=_.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),Object.defineProperty(_t.prototype,\"needsUpdate\",{set:function(e){!0===e&&this.version++}}),Object.assign(_t.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError(\"THREE.BufferAttribute: array should be a Typed Array.\");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(St.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(St.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}}),Tt.prototype=Object.create(U.prototype),Tt.prototype.constructor=Tt,Tt.prototype.isSpriteMaterial=!0,Tt.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},At.prototype=Object.assign(Object.create(_.prototype),{constructor:At,isSprite:!0,raycast:function(){function e(e,t,i,n,r,o){s.subVectors(e,i).addScalar(.5).multiply(n),void 0!==r?(l.x=o*s.x-r*s.y,l.y=r*s.x+o*s.y):l.copy(s),e.copy(t),e.x+=l.x,e.y+=l.y,e.applyMatrix4(c)}var t=new o,r=new o,a=new o,s=new i,l=new i,c=new n,h=new o,u=new o,p=new o,d=new i,f=new i,m=new i;return function(n,o){r.setFromMatrixScale(this.matrixWorld),c.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),a.setFromMatrixPosition(this.modelViewMatrix);var s=this.material.rotation;if(0!==s)var l=Math.cos(s),g=Math.sin(s);s=this.center,e(h.set(-.5,-.5,0),a,s,r,g,l),e(u.set(.5,-.5,0),a,s,r,g,l),e(p.set(.5,.5,0),a,s,r,g,l),d.set(0,0),f.set(1,0),m.set(1,1);var v=n.ray.intersectTriangle(h,u,p,!1,t);null===v&&(e(u.set(-.5,.5,0),a,s,r,g,l),f.set(0,1),null===(v=n.ray.intersectTriangle(h,p,u,!1,t)))||(g=n.ray.origin.distanceTo(t))<n.near||g>n.far||o.push({distance:g,point:t.clone(),uv:q.getUV(t,h,u,p,d,f,m,new i),face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return _.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),Ct.prototype=Object.assign(Object.create(_.prototype),{constructor:Ct,copy:function(e){_.prototype.copy.call(this,e,!1);for(var t=0,i=(e=e.levels).length;t<i;t++){var n=e[t];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,n=0;n<i.length&&!(t<i[n].distance);n++);i.splice(n,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object},raycast:function(){var e=new o;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(t,i)}}(),update:function(){var e=new o,t=new o;return function(i){var n=this.levels;if(1<n.length){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld),i=e.distanceTo(t),n[0].object.visible=!0;for(var r=1,o=n.length;r<o&&i>=n[r].distance;r++)n[r-1].object.visible=!1,n[r].object.visible=!0;for(;r<o;r++)n[r].object.visible=!1}}}(),toJSON:function(e){(e=_.prototype.toJSON.call(this,e)).object.levels=[];for(var t=this.levels,i=0,n=t.length;i<n;i++){var r=t[i];e.object.levels.push({object:r.object.uuid,distance:r.distance})}return e}}),Rt.prototype=Object.assign(Object.create(X.prototype),{constructor:Rt,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new l,t=this.geometry.attributes.skinWeight,i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var r=1/e.manhattanLength();1/0!==r?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){X.prototype.updateMatrixWorld.call(this,e),\"attached\"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):\"detached\"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn(\"THREE.SkinnedMesh: Unrecognized bindMode: \"+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Lt.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new n;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i=0;for(t=this.bones.length;i<t;i++)(e=this.bones[i])&&e.matrixWorld.getInverse(this.boneInverses[i]);for(i=0,t=this.bones.length;i<t;i++)(e=this.bones[i])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new n,t=new n;return function(){for(var i=this.bones,n=this.boneInverses,r=this.boneMatrices,o=this.boneTexture,a=0,s=i.length;a<s;a++)e.multiplyMatrices(i[a]?i[a].matrixWorld:t,n[a]),e.toArray(r,16*a);void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new Lt(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var n=this.bones[t];if(n.name===e)return n}}}),Pt.prototype=Object.assign(Object.create(_.prototype),{constructor:Pt,isBone:!0}),Nt.prototype=Object.create(U.prototype),Nt.prototype.constructor=Nt,Nt.prototype.isLineBasicMaterial=!0,Nt.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Bt.prototype=Object.assign(Object.create(_.prototype),{constructor:Bt,isLine:!0,computeLineDistances:function(){var e=new o,t=new o;return function(){var i=this.geometry;if(i.isBufferGeometry)if(null===i.index){for(var n=i.attributes.position,r=[0],o=1,a=n.count;o<a;o++)e.fromBufferAttribute(n,o-1),t.fromBufferAttribute(n,o),r[o]=r[o-1],r[o]+=e.distanceTo(t);i.addAttribute(\"lineDistance\",new z(r,1))}else console.warn(\"THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.\");else if(i.isGeometry)for(n=i.vertices,(r=i.lineDistances)[0]=0,o=1,a=n.length;o<a;o++)r[o]=r[o-1],r[o]+=n[o-1].distanceTo(n[o]);return this}}(),raycast:function(){var e=new n,t=new W,i=new d;return function(n,r){var a=n.linePrecision,s=this.geometry,l=this.matrixWorld;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(l),i.radius+=a,!1!==n.ray.intersectsSphere(i)){e.getInverse(l),t.copy(n.ray).applyMatrix4(e),a/=(this.scale.x+this.scale.y+this.scale.z)/3,a*=a;var c=new o,h=new o;l=new o;var u=new o,p=this&&this.isLineSegments?2:1;if(s.isBufferGeometry){var d=s.index,f=s.attributes.position.array;if(null!==d){s=0;for(var m=(d=d.array).length-1;s<m;s+=p){var g=d[s+1];c.fromArray(f,3*d[s]),h.fromArray(f,3*g),(g=t.distanceSqToSegment(c,h,u,l))>a||(u.applyMatrix4(this.matrixWorld),(g=n.ray.origin.distanceTo(u))<n.near||g>n.far||r.push({distance:g,point:l.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this}))}}else for(s=0,m=f.length/3-1;s<m;s+=p)c.fromArray(f,3*s),h.fromArray(f,3*s+3),(g=t.distanceSqToSegment(c,h,u,l))>a||(u.applyMatrix4(this.matrixWorld),(g=n.ray.origin.distanceTo(u))<n.near||g>n.far||r.push({distance:g,point:l.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this}))}else if(s.isGeometry)for(h=(c=s.vertices).length,s=0;s<h-1;s+=p)(g=t.distanceSqToSegment(c[s],c[s+1],u,l))>a||(u.applyMatrix4(this.matrixWorld),(g=n.ray.origin.distanceTo(u))<n.near||g>n.far||r.push({distance:g,point:l.clone().applyMatrix4(this.matrixWorld),index:s,face:null,faceIndex:null,object:this}))}}}(),copy:function(e){return _.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),zt.prototype=Object.assign(Object.create(Bt.prototype),{constructor:zt,isLineSegments:!0,computeLineDistances:function(){var e=new o,t=new o;return function(){var i=this.geometry;if(i.isBufferGeometry)if(null===i.index){for(var n=i.attributes.position,r=[],o=0,a=n.count;o<a;o+=2)e.fromBufferAttribute(n,o),t.fromBufferAttribute(n,o+1),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+e.distanceTo(t);i.addAttribute(\"lineDistance\",new z(r,1))}else console.warn(\"THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.\");else if(i.isGeometry)for(n=i.vertices,r=i.lineDistances,o=0,a=n.length;o<a;o+=2)e.copy(n[o]),t.copy(n[o+1]),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+e.distanceTo(t);return this}}()}),Ot.prototype=Object.assign(Object.create(Bt.prototype),{constructor:Ot,isLineLoop:!0}),Ft.prototype=Object.create(U.prototype),Ft.prototype.constructor=Ft,Ft.prototype.isPointsMaterial=!0,Ft.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},It.prototype=Object.assign(Object.create(_.prototype),{constructor:It,isPoints:!0,raycast:function(){var e=new n,t=new W,i=new d;return function(n,r){function a(e,i){var o=t.distanceSqToPoint(e);o<u&&(t.closestPointToPoint(e,p),p.applyMatrix4(c),(e=n.ray.origin.distanceTo(p))<n.near||e>n.far||r.push({distance:e,distanceToRay:Math.sqrt(o),point:p.clone(),index:i,face:null,object:s}))}var s=this,l=this.geometry,c=this.matrixWorld,h=n.params.Points.threshold;if(null===l.boundingSphere&&l.computeBoundingSphere(),i.copy(l.boundingSphere),i.applyMatrix4(c),i.radius+=h,!1!==n.ray.intersectsSphere(i)){e.getInverse(c),t.copy(n.ray).applyMatrix4(e);var u=(h/=(this.scale.x+this.scale.y+this.scale.z)/3)*h;h=new o;var p=new o;if(l.isBufferGeometry){var d=l.index;if(l=l.attributes.position.array,null!==d){var f=d.array;d=0;for(var m=f.length;d<m;d++){var g=f[d];h.fromArray(l,3*g),a(h,g)}}else for(d=0,f=l.length/3;d<f;d++)h.fromArray(l,3*d),a(h,d)}else for(d=0,f=(h=l.vertices).length;d<f;d++)a(h[d],d)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Dt.prototype=Object.assign(Object.create(s.prototype),{constructor:Dt,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Ht.prototype=Object.create(s.prototype),Ht.prototype.constructor=Ht,Ht.prototype.isCompressedTexture=!0,jt.prototype=Object.create(s.prototype),jt.prototype.constructor=jt,jt.prototype.isCanvasTexture=!0,Vt.prototype=Object.create(s.prototype),Vt.prototype.constructor=Vt,Vt.prototype.isDepthTexture=!0,kt.prototype=Object.create(D.prototype),kt.prototype.constructor=kt,Ut.prototype=Object.create(S.prototype),Ut.prototype.constructor=Ut,Gt.prototype=Object.create(D.prototype),Gt.prototype.constructor=Gt,Wt.prototype=Object.create(S.prototype),Wt.prototype.constructor=Wt,qt.prototype=Object.create(D.prototype),qt.prototype.constructor=qt,Qt.prototype=Object.create(S.prototype),Qt.prototype.constructor=Qt,Xt.prototype=Object.create(qt.prototype),Xt.prototype.constructor=Xt,Yt.prototype=Object.create(S.prototype),Yt.prototype.constructor=Yt,Zt.prototype=Object.create(qt.prototype),Zt.prototype.constructor=Zt,Jt.prototype=Object.create(S.prototype),Jt.prototype.constructor=Jt,Kt.prototype=Object.create(qt.prototype),Kt.prototype.constructor=Kt,$t.prototype=Object.create(S.prototype),$t.prototype.constructor=$t,ei.prototype=Object.create(qt.prototype),ei.prototype.constructor=ei,ti.prototype=Object.create(S.prototype),ti.prototype.constructor=ti,ii.prototype=Object.create(D.prototype),ii.prototype.constructor=ii,ni.prototype=Object.create(S.prototype),ni.prototype.constructor=ni,ri.prototype=Object.create(D.prototype),ri.prototype.constructor=ri,oi.prototype=Object.create(S.prototype),oi.prototype.constructor=oi,ai.prototype=Object.create(D.prototype),ai.prototype.constructor=ai;var Co=function(e,t,i){i=i||2;var n,r=t&&t.length,o=r?t[0]*i:e.length,a=si(e,0,o,i,!0),s=[];if(!a)return s;if(r){var l,c=i;r=[];var h=0;for(l=t.length;h<l;h++){var u=t[h]*c;(u=si(e,u,h<l-1?t[h+1]*c:e.length,c,!1))===u.next&&(u.steiner=!0),r.push(pi(u))}for(r.sort(ci),h=0;h<r.length;h++)(c=hi(t=r[h],c=a))&&li(t=yi(c,t),t.next),a=li(a,a.next)}if(e.length>80*i){var p=n=e[0],d=r=e[1];for(c=i;c<o;c+=i)(h=e[c])<p&&(p=h),(t=e[c+1])<d&&(d=t),h>n&&(n=h),t>r&&(r=t);n=0!==(n=Math.max(n-p,r-d))?1/n:0}return function e(t,i,n,r,o,a,s){if(t){if(!s&&a){var l=t,c=l;do{null===c.z&&(c.z=ui(c.x,c.y,r,o,a)),c.prevZ=c.prev,c=c.nextZ=c.next}while(c!==l);c.prevZ.nextZ=null,c.prevZ=null,l=c;var h,u,p,d,f=1;do{c=l;var m=l=null;for(u=0;c;){u++;var g=c;for(h=p=0;h<f&&(p++,g=g.nextZ);h++);for(d=f;0<p||0<d&&g;)0!==p&&(0===d||!g||c.z<=g.z)?(h=c,c=c.nextZ,p--):(h=g,g=g.nextZ,d--),m?m.nextZ=h:l=h,h.prevZ=m,m=h;c=g}m.nextZ=null,f*=2}while(1<u)}for(l=t;t.prev!==t.next;){if(c=t.prev,g=t.next,a)e:{d=r;var v=o,y=a;if(0<=fi(u=(m=t).prev,p=m,f=m.next))m=!1;else{var x=u.x>p.x?u.x>f.x?u.x:f.x:p.x>f.x?p.x:f.x,b=u.y>p.y?u.y>f.y?u.y:f.y:p.y>f.y?p.y:f.y;for(h=ui(u.x<p.x?u.x<f.x?u.x:f.x:p.x<f.x?p.x:f.x,u.y<p.y?u.y<f.y?u.y:f.y:p.y<f.y?p.y:f.y,d,v,y),d=ui(x,b,d,v,y),v=m.nextZ;v&&v.z<=d;){if(v!==m.prev&&v!==m.next&&di(u.x,u.y,p.x,p.y,f.x,f.y,v.x,v.y)&&0<=fi(v.prev,v,v.next)){m=!1;break e}v=v.nextZ}for(v=m.prevZ;v&&v.z>=h;){if(v!==m.prev&&v!==m.next&&di(u.x,u.y,p.x,p.y,f.x,f.y,v.x,v.y)&&0<=fi(v.prev,v,v.next)){m=!1;break e}v=v.prevZ}m=!0}}else e:if(m=t,u=m.prev,p=m,f=m.next,0<=fi(u,p,f))m=!1;else{for(h=m.next.next;h!==m.prev;){if(di(u.x,u.y,p.x,p.y,f.x,f.y,h.x,h.y)&&0<=fi(h.prev,h,h.next)){m=!1;break e}h=h.next}m=!0}if(m)i.push(c.i/n),i.push(t.i/n),i.push(g.i/n),bi(t),l=t=g.next;else if((t=g)===l){if(s){if(1===s){s=i,l=n,c=t;do{!mi(g=c.prev,m=c.next.next)&&gi(g,c,c.next,m)&&vi(g,m)&&vi(m,g)&&(s.push(g.i/l),s.push(c.i/l),s.push(m.i/l),bi(c),bi(c.next),c=t=m),c=c.next}while(c!==t);e(t=c,i,n,r,o,a,2)}else if(2===s)e:{s=t;do{for(l=s.next.next;l!==s.prev;){if(c=s.i!==l.i){if(g=l,m=(c=s).next.i!==g.i&&c.prev.i!==g.i){t:{m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==g.i&&m.next.i!==g.i&&gi(m,m.next,c,g)){m=!0;break t}m=m.next}while(m!==c);m=!1}m=!m}if(m=m&&vi(c,g)&&vi(g,c)){m=c,u=!1,p=(c.x+g.x)/2,g=(c.y+g.y)/2;do{m.y>g!=m.next.y>g&&m.next.y!==m.y&&p<(m.next.x-m.x)*(g-m.y)/(m.next.y-m.y)+m.x&&(u=!u),m=m.next}while(m!==c);m=u}c=m}if(c){t=yi(s,l),s=li(s,s.next),t=li(t,t.next),e(s,i,n,r,o,a),e(t,i,n,r,o,a);break e}l=l.next}s=s.next}while(s!==t)}}else e(li(t),i,n,r,o,a,1);break}}}}(a,s,i,p,d,n),s},Ro={area:function(e){for(var t=e.length,i=0,n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i},isClockWise:function(e){return 0>Ro.area(e)},triangulateShape:function(e,t){var i=[],n=[],r=[];Mi(e),Ei(i,e);var o=e.length;for(t.forEach(Mi),e=0;e<t.length;e++)n.push(o),o+=t[e].length,Ei(i,t[e]);for(t=Co(i,n),e=0;e<t.length;e+=3)r.push(t.slice(e,e+3));return r}};_i.prototype=Object.create(S.prototype),_i.prototype.constructor=_i,_i.prototype.toJSON=function(){var e=S.prototype.toJSON.call(this);return Ti(this.parameters.shapes,this.parameters.options,e)},Si.prototype=Object.create(D.prototype),Si.prototype.constructor=Si,Si.prototype.toJSON=function(){var e=D.prototype.toJSON.call(this);return Ti(this.parameters.shapes,this.parameters.options,e)};var Lo={generateTopUV:function(e,t,n,r,o){e=t[3*r],r=t[3*r+1];var a=t[3*o];return o=t[3*o+1],[new i(t[3*n],t[3*n+1]),new i(e,r),new i(a,o)]},generateSideWallUV:function(e,t,n,r,o,a){e=t[3*n];var s=t[3*n+1];n=t[3*n+2];var l=t[3*r],c=t[3*r+1];r=t[3*r+2];var h=t[3*o],u=t[3*o+1];o=t[3*o+2];var p=t[3*a],d=t[3*a+1];return t=t[3*a+2],.01>Math.abs(s-c)?[new i(e,1-n),new i(l,1-r),new i(h,1-o),new i(p,1-t)]:[new i(s,1-n),new i(c,1-r),new i(u,1-o),new i(d,1-t)]}};Ai.prototype=Object.create(S.prototype),Ai.prototype.constructor=Ai,Ci.prototype=Object.create(Si.prototype),Ci.prototype.constructor=Ci,Ri.prototype=Object.create(S.prototype),Ri.prototype.constructor=Ri,Li.prototype=Object.create(D.prototype),Li.prototype.constructor=Li,Pi.prototype=Object.create(S.prototype),Pi.prototype.constructor=Pi,Ni.prototype=Object.create(D.prototype),Ni.prototype.constructor=Ni,Bi.prototype=Object.create(S.prototype),Bi.prototype.constructor=Bi,zi.prototype=Object.create(D.prototype),zi.prototype.constructor=zi,Oi.prototype=Object.create(S.prototype),Oi.prototype.constructor=Oi,Oi.prototype.toJSON=function(){var e=S.prototype.toJSON.call(this);return Ii(this.parameters.shapes,e)},Fi.prototype=Object.create(D.prototype),Fi.prototype.constructor=Fi,Fi.prototype.toJSON=function(){var e=D.prototype.toJSON.call(this);return Ii(this.parameters.shapes,e)},Di.prototype=Object.create(D.prototype),Di.prototype.constructor=Di,Hi.prototype=Object.create(S.prototype),Hi.prototype.constructor=Hi,ji.prototype=Object.create(D.prototype),ji.prototype.constructor=ji,Vi.prototype=Object.create(Hi.prototype),Vi.prototype.constructor=Vi,ki.prototype=Object.create(ji.prototype),ki.prototype.constructor=ki,Ui.prototype=Object.create(S.prototype),Ui.prototype.constructor=Ui,Gi.prototype=Object.create(D.prototype),Gi.prototype.constructor=Gi;var Po=Object.freeze({WireframeGeometry:kt,ParametricGeometry:Ut,ParametricBufferGeometry:Gt,TetrahedronGeometry:Qt,TetrahedronBufferGeometry:Xt,OctahedronGeometry:Yt,OctahedronBufferGeometry:Zt,IcosahedronGeometry:Jt,IcosahedronBufferGeometry:Kt,DodecahedronGeometry:$t,DodecahedronBufferGeometry:ei,PolyhedronGeometry:Wt,PolyhedronBufferGeometry:qt,TubeGeometry:ti,TubeBufferGeometry:ii,TorusKnotGeometry:ni,TorusKnotBufferGeometry:ri,TorusGeometry:oi,TorusBufferGeometry:ai,TextGeometry:Ai,TextBufferGeometry:Ci,SphereGeometry:Ri,SphereBufferGeometry:Li,RingGeometry:Pi,RingBufferGeometry:Ni,PlaneGeometry:V,PlaneBufferGeometry:k,LatheGeometry:Bi,LatheBufferGeometry:zi,ShapeGeometry:Oi,ShapeBufferGeometry:Fi,ExtrudeGeometry:_i,ExtrudeBufferGeometry:Si,EdgesGeometry:Di,ConeGeometry:Vi,ConeBufferGeometry:ki,CylinderGeometry:Hi,CylinderBufferGeometry:ji,CircleGeometry:Ui,CircleBufferGeometry:Gi,BoxGeometry:H,BoxBufferGeometry:j});Wi.prototype=Object.create(U.prototype),Wi.prototype.constructor=Wi,Wi.prototype.isShadowMaterial=!0,Wi.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.color.copy(e.color),this},qi.prototype=Object.create(G.prototype),qi.prototype.constructor=qi,qi.prototype.isRawShaderMaterial=!0,Qi.prototype=Object.create(U.prototype),Qi.prototype.constructor=Qi,Qi.prototype.isMeshStandardMaterial=!0,Qi.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.defines={STANDARD:\"\"},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Xi.prototype=Object.create(Qi.prototype),Xi.prototype.constructor=Xi,Xi.prototype.isMeshPhysicalMaterial=!0,Xi.prototype.copy=function(e){return Qi.prototype.copy.call(this,e),this.defines={PHYSICAL:\"\"},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Yi.prototype=Object.create(U.prototype),Yi.prototype.constructor=Yi,Yi.prototype.isMeshPhongMaterial=!0,Yi.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Zi.prototype=Object.create(Yi.prototype),Zi.prototype.constructor=Zi,Zi.prototype.isMeshToonMaterial=!0,Zi.prototype.copy=function(e){return Yi.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},Ji.prototype=Object.create(U.prototype),Ji.prototype.constructor=Ji,Ji.prototype.isMeshNormalMaterial=!0,Ji.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ki.prototype=Object.create(U.prototype),Ki.prototype.constructor=Ki,Ki.prototype.isMeshLambertMaterial=!0,Ki.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},$i.prototype=Object.create(U.prototype),$i.prototype.constructor=$i,$i.prototype.isMeshMatcapMaterial=!0,$i.prototype.copy=function(e){return U.prototype.copy.call(this,e),this.defines={MATCAP:\"\"},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},en.prototype=Object.create(Nt.prototype),en.prototype.constructor=en,en.prototype.isLineDashedMaterial=!0,en.prototype.copy=function(e){return Nt.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var No=Object.freeze({ShadowMaterial:Wi,SpriteMaterial:Tt,RawShaderMaterial:qi,ShaderMaterial:G,PointsMaterial:Ft,MeshPhysicalMaterial:Xi,MeshStandardMaterial:Qi,MeshPhongMaterial:Yi,MeshToonMaterial:Zi,MeshNormalMaterial:Ji,MeshLambertMaterial:Ki,MeshDepthMaterial:st,MeshDistanceMaterial:lt,MeshBasicMaterial:Q,MeshMatcapMaterial:$i,LineDashedMaterial:en,LineBasicMaterial:Nt,Material:U}),Bo={arraySlice:function(e,t,i){return Bo.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:\"number\"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=Array(t),n=0;n!==t;++n)i[n]=n;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){for(var n=e.length,r=new e.constructor(n),o=0,a=0;a!==n;++o)for(var s=i[o]*t,l=0;l!==t;++l)r[a++]=e[s+l];return r},flattenJSON:function(e,t,i,n){for(var r=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[r++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[n])&&(t.push(o.time),i.push.apply(i,a)),o=e[r++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[n])&&(t.push(o.time),a.toArray(i,i.length)),o=e[r++]}while(void 0!==o);else do{void 0!==(a=o[n])&&(t.push(o.time),i.push(a)),o=e[r++]}while(void 0!==o)}}};Object.assign(tn.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{i:{n:if(!(e<n)){for(var o=i+2;;){if(void 0===n){if(e<r)break n;return this._cachedIndex=i=t.length,this.afterEnd_(i-1,e,r)}if(i===o)break;if(r=n,e<(n=t[++i]))break t}n=t.length;break i}if(e>=r)break e;for(e<(o=t[1])&&(i=2,r=o),o=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===o)break;if(n=r,e>=(r=t[--i-1]))break t}n=i,i=0}for(;i<n;)e<t[r=i+n>>>1]?n=r:i=r+1;if(n=t[i],void 0===(r=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return this._cachedIndex=i=t.length,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){var t=this.resultBuffer,i=this.sampleValues,n=this.valueSize;e*=n;for(var r=0;r!==n;++r)t[r]=i[e+r];return t},interpolate_:function(){throw Error(\"call to abstract method\")},intervalChanged_:function(){}}),Object.assign(tn.prototype,{beforeStart_:tn.prototype.copySampleValue_,afterEnd_:tn.prototype.copySampleValue_}),nn.prototype=Object.assign(Object.create(tn.prototype),{constructor:nn,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,i){var n=this.parameterPositions,r=e-2,o=e+1,a=n[r],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=e,a=2*t-i;break;case 2402:a=t+n[r=n.length-2]-n[r+1];break;default:r=e,a=i}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=e,s=2*i-t;break;case 2402:o=1,s=i+n[1]-n[0];break;default:o=e-1,s=t}e=.5*(i-t),n=this.valueSize,this._weightPrev=e/(t-a),this._weightNext=e/(s-i),this._offsetPrev=r*n,this._offsetNext=o*n},interpolate_:function(e,t,i,n){var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(e*=a)-a,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,u=this._weightNext,p=(i-t)/(n-t);for(t=-h*(n=(i=p*p)*p)+2*h*i-h*p,h=(1+h)*n+(-1.5-2*h)*i+(-.5+h)*p+1,p=(-1-u)*n+(1.5+u)*i+.5*p,u=u*n-u*i,i=0;i!==a;++i)r[i]=t*o[l+i]+h*o[s+i]+p*o[e+i]+u*o[c+i];return r}}),rn.prototype=Object.assign(Object.create(tn.prototype),{constructor:rn,interpolate_:function(e,t,i,n){var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(e*=a)-a;for(i=1-(t=(i-t)/(n-t)),n=0;n!==a;++n)r[n]=o[s+n]*i+o[e+n]*t;return r}}),on.prototype=Object.assign(Object.create(tn.prototype),{constructor:on,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(an,{toJSON:function(e){var t=e.constructor;if(void 0!==t.toJSON)t=t.toJSON(e);else{t={name:e.name,times:Bo.convertArray(e.times,Array),values:Bo.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(an.prototype,{constructor:an,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new on(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new rn(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new nn(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){switch(e){case 2300:var t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){if(t=\"unsupported interpolation for \"+this.ValueTypeName+\" keyframe track named \"+this.name,void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn(\"THREE.KeyframeTrack:\",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,n=i.length,r=0,o=n-1;r!==n&&i[r]<e;)++r;for(;-1!==o&&i[o]>t;)--o;return++o,0===r&&o===n||(r>=o&&(r=(o=Math.max(o,1))-1),e=this.getValueSize(),this.times=Bo.arraySlice(i,r,o),this.values=Bo.arraySlice(this.values,r*e,o*e)),this},validate:function(){var e=!0,t=this.getValueSize();0!=t-Math.floor(t)&&(console.error(\"THREE.KeyframeTrack: Invalid value size in track.\",this),e=!1);var i=this.times;t=this.values;var n=i.length;0===n&&(console.error(\"THREE.KeyframeTrack: Track is empty.\",this),e=!1);for(var r=null,o=0;o!==n;o++){var a=i[o];if(\"number\"==typeof a&&isNaN(a)){console.error(\"THREE.KeyframeTrack: Time is not a valid number.\",this,o,a),e=!1;break}if(null!==r&&r>a){console.error(\"THREE.KeyframeTrack: Out of order keys.\",this,o,a,r),e=!1;break}r=a}if(void 0!==t&&Bo.isTypedArray(t))for(o=0,i=t.length;o!==i;++o)if(n=t[o],isNaN(n)){console.error(\"THREE.KeyframeTrack: Value is not a valid number.\",this,o,n),e=!1;break}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),n=2302===this.getInterpolation(),r=1,o=e.length-1,a=1;a<o;++a){var s=!1,l=e[a];if(l!==e[a+1]&&(1!==a||l!==l[0]))if(n)s=!0;else{var c=a*i,h=c-i,u=c+i;for(l=0;l!==i;++l){var p=t[c+l];if(p!==t[h+l]||p!==t[u+l]){s=!0;break}}}if(s){if(a!==r)for(e[r]=e[a],s=a*i,c=r*i,l=0;l!==i;++l)t[c+l]=t[s+l];++r}}if(0<o){for(e[r]=e[o],s=o*i,c=r*i,l=0;l!==i;++l)t[c+l]=t[s+l];++r}return r!==e.length&&(this.times=Bo.arraySlice(e,0,r),this.values=Bo.arraySlice(t,0,r*i)),this}}),sn.prototype=Object.assign(Object.create(an.prototype),{constructor:sn,ValueTypeName:\"bool\",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ln.prototype=Object.assign(Object.create(an.prototype),{constructor:ln,ValueTypeName:\"color\"}),cn.prototype=Object.assign(Object.create(an.prototype),{constructor:cn,ValueTypeName:\"number\"}),hn.prototype=Object.assign(Object.create(tn.prototype),{constructor:hn,interpolate_:function(e,t,i,n){var o=this.resultBuffer,a=this.sampleValues,s=this.valueSize;for(t=(i-t)/(n-t),i=(e*=s)+s;e!==i;e+=4)r.slerpFlat(o,0,a,e-s,a,e,t);return o}}),un.prototype=Object.assign(Object.create(an.prototype),{constructor:un,ValueTypeName:\"quaternion\",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new hn(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),pn.prototype=Object.assign(Object.create(an.prototype),{constructor:pn,ValueTypeName:\"string\",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),dn.prototype=Object.assign(Object.create(an.prototype),{constructor:dn,ValueTypeName:\"vector\"}),Object.assign(fn,{parse:function(e){for(var t=[],i=e.tracks,n=1/(e.fps||1),r=0,o=i.length;r!==o;++r)t.push(mn(i[r]).scale(n));return new fn(e.name,e.duration,t)},toJSON:function(e){var t=[],i=e.tracks;e={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid};for(var n=0,r=i.length;n!==r;++n)t.push(an.toJSON(i[n]));return e},CreateFromMorphTargetSequence:function(e,t,i,n){for(var r=t.length,o=[],a=0;a<r;a++){var s=[],l=[];s.push((a+r-1)%r,a,(a+1)%r),l.push(0,1,0);var c=Bo.getKeyframeOrder(s);s=Bo.sortedArray(s,1,c),l=Bo.sortedArray(l,1,c),n||0!==s[0]||(s.push(r),l.push(l[0])),o.push(new cn(\".morphTargetInfluences[\"+t[a].name+\"]\",s,l).scale(1/i))}return new fn(e,-1,o)},findByName:function(e,t){var i=e;for(Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations),e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var n={},r=/^([\\w-]*?)([\\d]+)$/,o=0,a=e.length;o<a;o++){var s=e[o],l=s.name.match(r);if(l&&1<l.length){var c=l[1];(l=n[c])||(n[c]=l=[]),l.push(s)}}for(c in e=[],n)e.push(fn.CreateFromMorphTargetSequence(c,n[c],t,i));return e},parseAnimation:function(e,t){if(!e)return console.error(\"THREE.AnimationClip: No animation in JSONLoader data.\"),null;var i=function(e,t,i,n,r){if(0!==i.length){var o=[],a=[];Bo.flattenJSON(i,o,a,n),0!==o.length&&r.push(new e(t,o,a))}},n=[],r=e.name||\"default\",o=e.length||-1,a=e.fps||30;e=e.hierarchy||[];for(var s=0;s<e.length;s++){var l=e[s].keys;if(l&&0!==l.length)if(l[0].morphTargets){o={};for(var c=0;c<l.length;c++)if(l[c].morphTargets)for(var h=0;h<l[c].morphTargets.length;h++)o[l[c].morphTargets[h]]=-1;for(var u in o){var p=[],d=[];for(h=0;h!==l[c].morphTargets.length;++h){var f=l[c];p.push(f.time),d.push(f.morphTarget===u?1:0)}n.push(new cn(\".morphTargetInfluence[\"+u+\"]\",p,d))}o=o.length*(a||1)}else i(dn,(c=\".bones[\"+t[s].name+\"]\")+\".position\",l,\"pos\",n),i(un,c+\".quaternion\",l,\"rot\",n),i(dn,c+\".scale\",l,\"scl\",n)}return 0===n.length?null:new fn(r,o,n)}}),Object.assign(fn.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}});var zo={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Oo=new gn,Fo={};Object.assign(vn.prototype,{load:function(e,t,i,n){void 0===e&&(e=\"\"),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=zo.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;if(void 0===Fo[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){i=a[1];var s=!!a[2];a=a[3],a=decodeURIComponent(a),s&&(a=atob(a));try{var l=(this.responseType||\"\").toLowerCase();switch(l){case\"arraybuffer\":case\"blob\":var c=new Uint8Array(a.length);for(s=0;s<a.length;s++)c[s]=a.charCodeAt(s);var h=\"blob\"===l?new Blob([c.buffer],{type:i}):c.buffer;break;case\"document\":h=(new DOMParser).parseFromString(a,i);break;case\"json\":h=JSON.parse(a);break;default:h=a}setTimeout((function(){t&&t(h),r.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}),0)}}else{Fo[e]=[],Fo[e].push({onLoad:t,onProgress:i,onError:n});var u=new XMLHttpRequest;for(s in u.open(\"GET\",e,!0),u.addEventListener(\"load\",(function(t){var i=this.response;zo.add(e,i);var n=Fo[e];if(delete Fo[e],200===this.status||0===this.status){0===this.status&&console.warn(\"THREE.FileLoader: HTTP Status 0 received.\");for(var o=0,a=n.length;o<a;o++){var s=n[o];s.onLoad&&s.onLoad(i)}}else{for(o=0,a=n.length;o<a;o++)(s=n[o]).onError&&s.onError(t);r.manager.itemError(e)}r.manager.itemEnd(e)}),!1),u.addEventListener(\"progress\",(function(t){for(var i=Fo[e],n=0,r=i.length;n<r;n++){var o=i[n];o.onProgress&&o.onProgress(t)}}),!1),u.addEventListener(\"error\",(function(t){var i=Fo[e];delete Fo[e];for(var n=0,o=i.length;n<o;n++){var a=i[n];a.onError&&a.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),u.addEventListener(\"abort\",(function(t){var i=Fo[e];delete Fo[e];for(var n=0,o=i.length;n<o;n++){var a=i[n];a.onError&&a.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(u.responseType=this.responseType),void 0!==this.withCredentials&&(u.withCredentials=this.withCredentials),u.overrideMimeType&&u.overrideMimeType(void 0!==this.mimeType?this.mimeType:\"text/plain\"),this.requestHeader)u.setRequestHeader(s,this.requestHeader[s]);u.send(null)}return r.manager.itemStart(e),u}Fo[e].push({onLoad:t,onProgress:i,onError:n})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(yn.prototype,{load:function(e,t,i,n){var r=this,o=new vn(r.manager);o.setPath(r.path),o.load(e,(function(e){t(r.parse(JSON.parse(e)))}),i,n)},parse:function(e,t){for(var i=[],n=0;n<e.length;n++){var r=fn.parse(e[n]);i.push(r)}t(i)},setPath:function(e){return this.path=e,this}}),Object.assign(xn.prototype,{load:function(e,t,i,n){function r(r){l.load(e[r],(function(e){e=o._parser(e,!0),a[r]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},6===(c+=1)&&(1===e.mipmapCount&&(s.minFilter=1006),s.format=e.format,s.needsUpdate=!0,t&&t(s))}),i,n)}var o=this,a=[],s=new Ht;s.image=a;var l=new vn(this.manager);if(l.setPath(this.path),l.setResponseType(\"arraybuffer\"),Array.isArray(e))for(var c=0,h=0,u=e.length;h<u;++h)r(h);else l.load(e,(function(e){if((e=o._parser(e,!0)).isCubemap)for(var i=e.mipmaps.length/e.mipmapCount,n=0;n<i;n++){a[n]={mipmaps:[]};for(var r=0;r<e.mipmapCount;r++)a[n].mipmaps.push(e.mipmaps[n*e.mipmapCount+r]),a[n].format=e.format,a[n].width=e.width,a[n].height=e.height}else s.image.width=e.width,s.image.height=e.height,s.mipmaps=e.mipmaps;1===e.mipmapCount&&(s.minFilter=1006),s.format=e.format,s.needsUpdate=!0,t&&t(s)}),i,n);return s},setPath:function(e){return this.path=e,this}}),Object.assign(bn.prototype,{load:function(e,t,i,n){var r=this,o=new u,a=new vn(this.manager);return a.setResponseType(\"arraybuffer\"),a.setPath(this.path),a.load(e,(function(e){(e=r._parser(e))&&(void 0!==e.image?o.image=e.image:void 0!==e.data&&(o.image.width=e.width,o.image.height=e.height,o.image.data=e.data),o.wrapS=void 0!==e.wrapS?e.wrapS:1001,o.wrapT=void 0!==e.wrapT?e.wrapT:1001,o.magFilter=void 0!==e.magFilter?e.magFilter:1006,o.minFilter=void 0!==e.minFilter?e.minFilter:1008,o.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.format&&(o.format=e.format),void 0!==e.type&&(o.type=e.type),void 0!==e.mipmaps&&(o.mipmaps=e.mipmaps),1===e.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,t&&t(o,e))}),i,n),o},setPath:function(e){return this.path=e,this}}),Object.assign(wn.prototype,{crossOrigin:\"anonymous\",load:function(e,t,i,n){function r(){l.removeEventListener(\"load\",r,!1),l.removeEventListener(\"error\",o,!1),zo.add(e,this),t&&t(this),a.manager.itemEnd(e)}function o(t){l.removeEventListener(\"load\",r,!1),l.removeEventListener(\"error\",o,!1),n&&n(t),a.manager.itemError(e),a.manager.itemEnd(e)}void 0===e&&(e=\"\"),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,s=zo.get(e);if(void 0!==s)return a.manager.itemStart(e),setTimeout((function(){t&&t(s),a.manager.itemEnd(e)}),0),s;var l=document.createElementNS(\"http://www.w3.org/1999/xhtml\",\"img\");return l.addEventListener(\"load\",r,!1),l.addEventListener(\"error\",o,!1),\"data:\"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(l.crossOrigin=this.crossOrigin),a.manager.itemStart(e),l.src=e,l},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Mn.prototype,{crossOrigin:\"anonymous\",load:function(e,t,i,n){function r(i){a.load(e[i],(function(e){o.images[i]=e,6==++s&&(o.needsUpdate=!0,t&&t(o))}),void 0,n)}var o=new ae,a=new wn(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var s=0;for(i=0;i<e.length;++i)r(i);return o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(En.prototype,{crossOrigin:\"anonymous\",load:function(e,t,i,n){var r=new s,o=new wn(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(i){r.image=i,i=0<e.search(/\\.jpe?g($|\\?)/i)||0===e.search(/^data:image\\/jpeg/),r.format=i?1022:1023,r.needsUpdate=!0,void 0!==t&&t(r)}),i,n),r},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(_n.prototype,{getPoint:function(){return console.warn(\"THREE.Curve: .getPoint() not implemented.\"),null},getPointAt:function(e,t){return e=this.getUtoTmapping(e),this.getPoint(e,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i=[],n=this.getPoint(0),r=0;for(i.push(0),t=1;t<=e;t++){var o=this.getPoint(t/e);r+=o.distanceTo(n),i.push(r),n=o}return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i=this.getLengths(),n=i.length;t=t||e*i[n-1];for(var r,o=0,a=n-1;o<=a;)if(0>(r=i[e=Math.floor(o+(a-o)/2)]-t))o=e+1;else{if(!(0<r)){a=e;break}a=e-1}return i[e=a]===t?e/(n-1):(e+(t-(o=i[e]))/(i[e+1]-o))/(n-1)},getTangent:function(e){var t=e-1e-4;return 0>t&&(t=0),1<(e+=1e-4)&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},getTangentAt:function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},computeFrenetFrames:function(e,t){var i,r=new o,a=[],s=[],l=[],c=new o,h=new n;for(i=0;i<=e;i++){var u=i/e;a[i]=this.getTangentAt(u),a[i].normalize()}s[0]=new o,l[0]=new o,i=Number.MAX_VALUE,u=Math.abs(a[0].x);var p=Math.abs(a[0].y),d=Math.abs(a[0].z);for(u<=i&&(i=u,r.set(1,0,0)),p<=i&&(i=p,r.set(0,1,0)),d<=i&&r.set(0,0,1),c.crossVectors(a[0],r).normalize(),s[0].crossVectors(a[0],c),l[0].crossVectors(a[0],s[0]),i=1;i<=e;i++)s[i]=s[i-1].clone(),l[i]=l[i-1].clone(),c.crossVectors(a[i-1],a[i]),c.length()>Number.EPSILON&&(c.normalize(),r=Math.acos(eo.clamp(a[i-1].dot(a[i]),-1,1)),s[i].applyMatrix4(h.makeRotationAxis(c,r))),l[i].crossVectors(a[i],s[i]);if(!0===t)for(r=Math.acos(eo.clamp(s[0].dot(s[e]),-1,1)),r/=e,0<a[0].dot(c.crossVectors(s[0],s[e]))&&(r=-r),i=1;i<=e;i++)s[i].applyMatrix4(h.makeRotationAxis(a[i],r*i)),l[i].crossVectors(a[i],s[i]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:\"Curve\",generator:\"Curve.toJSON\"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Sn.prototype=Object.create(_n.prototype),Sn.prototype.constructor=Sn,Sn.prototype.isEllipseCurve=!0,Sn.prototype.getPoint=function(e,t){t=t||new i;for(var n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,o=Math.abs(r)<Number.EPSILON;0>r;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=o?0:n),!0!==this.aClockwise||o||(r=r===n?-n:r-n),n=this.aStartAngle+e*r,e=this.aX+this.xRadius*Math.cos(n);var a=this.aY+this.yRadius*Math.sin(n);return 0!==this.aRotation&&(n=Math.cos(this.aRotation),r=Math.sin(this.aRotation),e=(o=e-this.aX)*n-(a-=this.aY)*r+this.aX,a=o*r+a*n+this.aY),t.set(e,a)},Sn.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Sn.prototype.toJSON=function(){var e=_n.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Sn.prototype.fromJSON=function(e){return _n.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Tn.prototype=Object.create(Sn.prototype),Tn.prototype.constructor=Tn,Tn.prototype.isArcCurve=!0;var Io=new o,Do=new An,Ho=new An,jo=new An;Cn.prototype=Object.create(_n.prototype),Cn.prototype.constructor=Cn,Cn.prototype.isCatmullRomCurve3=!0,Cn.prototype.getPoint=function(e,t){t=t||new o;var i=this.points,n=i.length;e*=n-(this.closed?0:1);var r=Math.floor(e);if(e-=r,this.closed?r+=0<r?0:(Math.floor(Math.abs(r)/n)+1)*n:0===e&&r===n-1&&(r=n-2,e=1),this.closed||0<r)var a=i[(r-1)%n];else Io.subVectors(i[0],i[1]).add(i[0]),a=Io;var s=i[r%n],l=i[(r+1)%n];if(this.closed||r+2<n?i=i[(r+2)%n]:(Io.subVectors(i[n-1],i[n-2]).add(i[n-1]),i=Io),\"centripetal\"===this.curveType||\"chordal\"===this.curveType){var c=\"chordal\"===this.curveType?.5:.25;n=Math.pow(a.distanceToSquared(s),c),1e-4>(r=Math.pow(s.distanceToSquared(l),c))&&(r=1),1e-4>n&&(n=r),1e-4>(c=Math.pow(l.distanceToSquared(i),c))&&(c=r),Do.initNonuniformCatmullRom(a.x,s.x,l.x,i.x,n,r,c),Ho.initNonuniformCatmullRom(a.y,s.y,l.y,i.y,n,r,c),jo.initNonuniformCatmullRom(a.z,s.z,l.z,i.z,n,r,c)}else\"catmullrom\"===this.curveType&&(Do.initCatmullRom(a.x,s.x,l.x,i.x,this.tension),Ho.initCatmullRom(a.y,s.y,l.y,i.y,this.tension),jo.initCatmullRom(a.z,s.z,l.z,i.z,this.tension));return t.set(Do.calc(e),Ho.calc(e),jo.calc(e)),t},Cn.prototype.copy=function(e){_n.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Cn.prototype.toJSON=function(){var e=_n.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Cn.prototype.fromJSON=function(e){_n.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var n=e.points[t];this.points.push((new o).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Nn.prototype=Object.create(_n.prototype),Nn.prototype.constructor=Nn,Nn.prototype.isCubicBezierCurve=!0,Nn.prototype.getPoint=function(e,t){t=t||new i;var n=this.v0,r=this.v1,o=this.v2,a=this.v3;return t.set(Pn(e,n.x,r.x,o.x,a.x),Pn(e,n.y,r.y,o.y,a.y)),t},Nn.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Nn.prototype.toJSON=function(){var e=_n.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Nn.prototype.fromJSON=function(e){return _n.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Bn.prototype=Object.create(_n.prototype),Bn.prototype.constructor=Bn,Bn.prototype.isCubicBezierCurve3=!0,Bn.prototype.getPoint=function(e,t){t=t||new o;var i=this.v0,n=this.v1,r=this.v2,a=this.v3;return t.set(Pn(e,i.x,n.x,r.x,a.x),Pn(e,i.y,n.y,r.y,a.y),Pn(e,i.z,n.z,r.z,a.z)),t},Bn.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Bn.prototype.toJSON=function(){var e=_n.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Bn.prototype.fromJSON=function(e){return _n.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},zn.prototype=Object.create(_n.prototype),zn.prototype.constructor=zn,zn.prototype.isLineCurve=!0,zn.prototype.getPoint=function(e,t){return t=t||new i,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},zn.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},zn.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},zn.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},zn.prototype.toJSON=function(){var e=_n.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},zn.prototype.fromJSON=function(e){return _n.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},On.prototype=Object.create(_n.prototype),On.prototype.constructor=On,On.prototype.isLineCurve3=!0,On.prototype.getPoint=function(e,t){return t=t||new o,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},On.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},On.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},On.prototype.toJSON=function(){var e=_n.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},On.prototype.fromJSON=function(e){return _n.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Fn.prototype=Object.create(_n.prototype),Fn.prototype.constructor=Fn,Fn.prototype.isQuadraticBezierCurve=!0,Fn.prototype.getPoint=function(e,t){t=t||new i;var n=this.v0,r=this.v1,o=this.v2;return t.set(Ln(e,n.x,r.x,o.x),Ln(e,n.y,r.y,o.y)),t},Fn.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Fn.prototype.toJSON=function(){var e=_n.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Fn.prototype.fromJSON=function(e){return _n.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},In.prototype=Object.create(_n.prototype),In.prototype.constructor=In,In.prototype.isQuadraticBezierCurve3=!0,In.prototype.getPoint=function(e,t){t=t||new o;var i=this.v0,n=this.v1,r=this.v2;return t.set(Ln(e,i.x,n.x,r.x),Ln(e,i.y,n.y,r.y),Ln(e,i.z,n.z,r.z)),t},In.prototype.copy=function(e){return _n.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},In.prototype.toJSON=function(){var e=_n.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},In.prototype.fromJSON=function(e){return _n.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Dn.prototype=Object.create(_n.prototype),Dn.prototype.constructor=Dn,Dn.prototype.isSplineCurve=!0,Dn.prototype.getPoint=function(e,t){t=t||new i;var n=this.points,r=(n.length-1)*e;r-=e=Math.floor(r);var o=n[0===e?e:e-1],a=n[e],s=n[e>n.length-2?n.length-1:e+1];return n=n[e>n.length-3?n.length-1:e+2],t.set(Rn(r,o.x,a.x,s.x,n.x),Rn(r,o.y,a.y,s.y,n.y)),t},Dn.prototype.copy=function(e){_n.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this},Dn.prototype.toJSON=function(){var e=_n.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e},Dn.prototype.fromJSON=function(e){_n.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new i).fromArray(r))}return this};var Vo=Object.freeze({ArcCurve:Tn,CatmullRomCurve3:Cn,CubicBezierCurve:Nn,CubicBezierCurve3:Bn,EllipseCurve:Sn,LineCurve:zn,LineCurve3:On,QuadraticBezierCurve:Fn,QuadraticBezierCurve3:In,SplineCurve:Dn});Hn.prototype=Object.assign(Object.create(_n.prototype),{constructor:Hn,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new zn(t,e))},getPoint:function(e){var t=e*this.getLength(),i=this.getCurveLengths();for(e=0;e<i.length;){if(i[e]>=t)return t=i[e]-t,i=(e=this.curves[e]).getLength(),e.getPointAt(0===i?0:1-t/i);e++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],n=0,r=this.curves;n<r.length;n++){var o=r[n];o=o.getPoints(o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e);for(var a=0;a<o.length;a++){var s=o[a];t&&t.equals(s)||(i.push(s),t=s)}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){_n.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this},toJSON:function(){var e=_n.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e},fromJSON:function(e){_n.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var n=e.curves[t];this.curves.push((new Vo[n.type]).fromJSON(n))}return this}}),jn.prototype=Object.assign(Object.create(Hn.prototype),{constructor:jn,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var n=new zn(this.currentPoint.clone(),new i(e,t));this.curves.push(n),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,n,r){e=new Fn(this.currentPoint.clone(),new i(e,t),new i(n,r)),this.curves.push(e),this.currentPoint.set(n,r)},bezierCurveTo:function(e,t,n,r,o,a){e=new Nn(this.currentPoint.clone(),new i(e,t),new i(n,r),new i(o,a)),this.curves.push(e),this.currentPoint.set(o,a)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e);t=new Dn(t),this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,i,n,r,o){this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,n,r,o)},absarc:function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},ellipse:function(e,t,i,n,r,o,a,s){this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,n,r,o,a,s)},absellipse:function(e,t,i,n,r,o,a,s){e=new Sn(e,t,i,n,r,o,a,s),0<this.curves.length&&((t=e.getPoint(0)).equals(this.currentPoint)||this.lineTo(t.x,t.y)),this.curves.push(e),e=e.getPoint(1),this.currentPoint.copy(e)},copy:function(e){return Hn.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Hn.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Hn.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Vn.prototype=Object.assign(Object.create(jn.prototype),{constructor:Vn,getPointsHoles:function(e){for(var t=[],i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){jn.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this},toJSON:function(){var e=jn.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e},fromJSON:function(e){jn.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var n=e.holes[t];this.holes.push((new jn).fromJSON(n))}return this}}),kn.prototype=Object.assign(Object.create(_.prototype),{constructor:kn,isLight:!0,copy:function(e){return _.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){return(e=_.prototype.toJSON.call(this,e)).object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Un.prototype=Object.assign(Object.create(kn.prototype),{constructor:Un,isHemisphereLight:!0,copy:function(e){return kn.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Gn.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Wn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Wn,isSpotLightShadow:!0,update:function(e){var t=this.camera,i=2*eo.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height;e=e.distance||t.far,i===t.fov&&n===t.aspect&&e===t.far||(t.fov=i,t.aspect=n,t.far=e,t.updateProjectionMatrix())}}),qn.prototype=Object.assign(Object.create(kn.prototype),{constructor:qn,isSpotLight:!0,copy:function(e){return kn.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Qn.prototype=Object.assign(Object.create(kn.prototype),{constructor:Qn,isPointLight:!0,copy:function(e){return kn.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Xn.prototype=Object.assign(Object.create(ft.prototype),{constructor:Xn,isOrthographicCamera:!0,copy:function(e,t){return ft.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,n,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e;if(i+=e,e=n+t,t=n-t,null!==this.view&&this.view.enabled){i=this.zoom/(this.view.width/this.view.fullWidth),t=this.zoom/(this.view.height/this.view.fullHeight);var o=(this.right-this.left)/this.view.width;n=(this.top-this.bottom)/this.view.height,i=(r+=this.view.offsetX/i*o)+this.view.width/i*o,t=(e-=this.view.offsetY/t*n)-this.view.height/t*n}this.projectionMatrix.makeOrthographic(r,i,e,t,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){return(e=_.prototype.toJSON.call(this,e)).object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Yn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Yn}),Zn.prototype=Object.assign(Object.create(kn.prototype),{constructor:Zn,isDirectionalLight:!0,copy:function(e){return kn.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Jn.prototype=Object.assign(Object.create(kn.prototype),{constructor:Jn,isAmbientLight:!0}),Kn.prototype=Object.assign(Object.create(kn.prototype),{constructor:Kn,isRectAreaLight:!0,copy:function(e){return kn.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){return(e=kn.prototype.toJSON.call(this,e)).object.width=this.width,e.object.height=this.height,e}}),Object.assign($n.prototype,{load:function(e,t,i,n){var r=this,o=new vn(r.manager);o.setPath(r.path),o.load(e,(function(e){t(r.parse(JSON.parse(e)))}),i,n)},parse:function(e){function t(e){return void 0===r[e]&&console.warn(\"THREE.MaterialLoader: Undefined texture\",e),r[e]}var r=this.textures,a=new No[e.type];if(void 0!==e.uuid&&(a.uuid=e.uuid),void 0!==e.name&&(a.name=e.name),void 0!==e.color&&a.color.setHex(e.color),void 0!==e.roughness&&(a.roughness=e.roughness),void 0!==e.metalness&&(a.metalness=e.metalness),void 0!==e.emissive&&a.emissive.setHex(e.emissive),void 0!==e.specular&&a.specular.setHex(e.specular),void 0!==e.shininess&&(a.shininess=e.shininess),void 0!==e.clearCoat&&(a.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(a.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(a.vertexColors=e.vertexColors),void 0!==e.fog&&(a.fog=e.fog),void 0!==e.flatShading&&(a.flatShading=e.flatShading),void 0!==e.blending&&(a.blending=e.blending),void 0!==e.combine&&(a.combine=e.combine),void 0!==e.side&&(a.side=e.side),void 0!==e.opacity&&(a.opacity=e.opacity),void 0!==e.transparent&&(a.transparent=e.transparent),void 0!==e.alphaTest&&(a.alphaTest=e.alphaTest),void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(a.colorWrite=e.colorWrite),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(a.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(a.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(a.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(a.rotation=e.rotation),1!==e.linewidth&&(a.linewidth=e.linewidth),void 0!==e.dashSize&&(a.dashSize=e.dashSize),void 0!==e.gapSize&&(a.gapSize=e.gapSize),void 0!==e.scale&&(a.scale=e.scale),void 0!==e.polygonOffset&&(a.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(a.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(a.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(a.skinning=e.skinning),void 0!==e.morphTargets&&(a.morphTargets=e.morphTargets),void 0!==e.dithering&&(a.dithering=e.dithering),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.uniforms)for(var s in e.uniforms){var c=e.uniforms[s];switch(a.uniforms[s]={},c.type){case\"t\":a.uniforms[s].value=t(c.value);break;case\"c\":a.uniforms[s].value=(new y).setHex(c.value);break;case\"v2\":a.uniforms[s].value=(new i).fromArray(c.value);break;case\"v3\":a.uniforms[s].value=(new o).fromArray(c.value);break;case\"v4\":a.uniforms[s].value=(new l).fromArray(c.value);break;case\"m4\":a.uniforms[s].value=(new n).fromArray(c.value);break;default:a.uniforms[s].value=c.value}}if(void 0!==e.defines&&(a.defines=e.defines),void 0!==e.vertexShader&&(a.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(a.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var h in e.extensions)a.extensions[h]=e.extensions[h];return void 0!==e.shading&&(a.flatShading=1===e.shading),void 0!==e.size&&(a.size=e.size),void 0!==e.sizeAttenuation&&(a.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(a.map=t(e.map)),void 0!==e.alphaMap&&(a.alphaMap=t(e.alphaMap),a.transparent=!0),void 0!==e.bumpMap&&(a.bumpMap=t(e.bumpMap)),void 0!==e.bumpScale&&(a.bumpScale=e.bumpScale),void 0!==e.normalMap&&(a.normalMap=t(e.normalMap)),void 0!==e.normalMapType&&(a.normalMapType=e.normalMapType),void 0!==e.normalScale&&(s=e.normalScale,!1===Array.isArray(s)&&(s=[s,s]),a.normalScale=(new i).fromArray(s)),void 0!==e.displacementMap&&(a.displacementMap=t(e.displacementMap)),void 0!==e.displacementScale&&(a.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(a.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(a.roughnessMap=t(e.roughnessMap)),void 0!==e.metalnessMap&&(a.metalnessMap=t(e.metalnessMap)),void 0!==e.emissiveMap&&(a.emissiveMap=t(e.emissiveMap)),void 0!==e.emissiveIntensity&&(a.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(a.specularMap=t(e.specularMap)),void 0!==e.envMap&&(a.envMap=t(e.envMap)),void 0!==e.envMapIntensity&&(a.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(a.reflectivity=e.reflectivity),void 0!==e.lightMap&&(a.lightMap=t(e.lightMap)),void 0!==e.lightMapIntensity&&(a.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(a.aoMap=t(e.aoMap)),void 0!==e.aoMapIntensity&&(a.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(a.gradientMap=t(e.gradientMap)),a},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var ko={decodeText:function(e){if(\"undefined\"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t=\"\",i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf(\"/\");return-1===t?\"./\":e.substr(0,t+1)}};Object.assign(er.prototype,{load:function(e,t,i,n){var r=this,o=new vn(r.manager);o.setPath(r.path),o.load(e,(function(e){t(r.parse(JSON.parse(e)))}),i,n)},parse:function(e){var t=new D,i=e.data.index;void 0!==i&&(i=new Uo[i.type](i.array),t.setIndex(new T(i,1)));var n=e.data.attributes;for(a in n){var r=n[a];i=new Uo[r.type](r.array),t.addAttribute(a,new T(i,r.itemSize,r.normalized))}var a=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==a)for(i=0,n=a.length;i!==n;++i)r=a[i],t.addGroup(r.start,r.count,r.materialIndex);return void 0!==(a=e.data.boundingSphere)&&(i=new o,void 0!==a.center&&i.fromArray(a.center),t.boundingSphere=new d(i,a.radius)),e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var Uo={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:\"undefined\"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Object.assign(tr.prototype,{crossOrigin:\"anonymous\",load:function(e,t,i,n){var r=this,o=void 0===this.path?ko.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o,(o=new vn(r.manager)).setPath(this.path),o.load(e,(function(i){var o=null;try{o=JSON.parse(i)}catch(t){return void 0!==n&&n(t),void console.error(\"THREE:ObjectLoader: Can't parse \"+e+\".\",t.message)}void 0===(i=o.metadata)||void 0===i.type||\"geometry\"===i.type.toLowerCase()?console.error(\"THREE.ObjectLoader: Can't load \"+e):r.parse(o,t)}),i,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var i=this.parseShape(e.shapes);i=this.parseGeometries(e.geometries,i);var n=this.parseImages(e.images,(function(){void 0!==t&&t(r)}));n=this.parseTextures(e.textures,n),n=this.parseMaterials(e.materials,n);var r=this.parseObject(e.object,i,n);return e.animations&&(r.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0===t||t(r),r},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,n=e.length;i<n;i++){var r=(new Vn).fromJSON(e[i]);t[r.uuid]=r}return t},parseGeometries:function(e,t){var i={};if(void 0!==e)for(var n=new er,r=0,o=e.length;r<o;r++){var a=e[r];switch(a.type){case\"PlaneGeometry\":case\"PlaneBufferGeometry\":var s=new Po[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case\"BoxGeometry\":case\"BoxBufferGeometry\":case\"CubeGeometry\":s=new Po[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case\"CircleGeometry\":case\"CircleBufferGeometry\":s=new Po[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case\"CylinderGeometry\":case\"CylinderBufferGeometry\":s=new Po[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case\"ConeGeometry\":case\"ConeBufferGeometry\":s=new Po[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case\"SphereGeometry\":case\"SphereBufferGeometry\":s=new Po[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case\"DodecahedronGeometry\":case\"DodecahedronBufferGeometry\":case\"IcosahedronGeometry\":case\"IcosahedronBufferGeometry\":case\"OctahedronGeometry\":case\"OctahedronBufferGeometry\":case\"TetrahedronGeometry\":case\"TetrahedronBufferGeometry\":s=new Po[a.type](a.radius,a.detail);break;case\"RingGeometry\":case\"RingBufferGeometry\":s=new Po[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case\"TorusGeometry\":case\"TorusBufferGeometry\":s=new Po[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case\"TorusKnotGeometry\":case\"TorusKnotBufferGeometry\":s=new Po[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case\"LatheGeometry\":case\"LatheBufferGeometry\":s=new Po[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case\"PolyhedronGeometry\":case\"PolyhedronBufferGeometry\":s=new Po[a.type](a.vertices,a.indices,a.radius,a.details);break;case\"ShapeGeometry\":case\"ShapeBufferGeometry\":s=[];for(var l=0,c=a.shapes.length;l<c;l++){var h=t[a.shapes[l]];s.push(h)}s=new Po[a.type](s,a.curveSegments);break;case\"ExtrudeGeometry\":case\"ExtrudeBufferGeometry\":for(s=[],l=0,c=a.shapes.length;l<c;l++)h=t[a.shapes[l]],s.push(h);void 0!==(l=a.options.extrudePath)&&(a.options.extrudePath=(new Vo[l.type]).fromJSON(l)),s=new Po[a.type](s,a.options);break;case\"BufferGeometry\":s=n.parse(a);break;case\"Geometry\":\"THREE\"in window&&\"LegacyJSONLoader\"in THREE?s=(new THREE.LegacyJSONLoader).parse(a,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type \"Geometry\".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type \"'+a.type+'\"');continue}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),i[a.uuid]=s}return i},parseMaterials:function(e,t){var i={},n={};if(void 0!==e){var r=new $n;r.setTextures(t),t=0;for(var o=e.length;t<o;t++){var a=e[t];if(\"MultiMaterial\"===a.type){for(var s=[],l=0;l<a.materials.length;l++){var c=a.materials[l];void 0===i[c.uuid]&&(i[c.uuid]=r.parse(c)),s.push(i[c.uuid])}n[a.uuid]=s}else n[a.uuid]=r.parse(a),i[a.uuid]=n[a.uuid]}}return n},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],r=fn.parse(n);void 0!==n.uuid&&(r.uuid=n.uuid),t.push(r)}return t},parseImages:function(e,t){function i(e){return n.manager.itemStart(e),o.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}var n=this,r={};if(void 0!==e&&0<e.length){var o=new wn(t=new gn(t));o.setCrossOrigin(this.crossOrigin),t=0;for(var a=e.length;t<a;t++){var s=e[t],l=s.url;if(Array.isArray(l)){r[s.uuid]=[];for(var c=0,h=l.length;c<h;c++){var u=l[c];u=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(u)?u:n.resourcePath+u,r[s.uuid].push(i(u))}}else u=/^(\\/\\/)|([a-z]+:(\\/\\/)?)/i.test(s.url)?s.url:n.resourcePath+s.url,r[s.uuid]=i(u)}}return r},parseTextures:function(e,t){function i(e,t){return\"number\"==typeof e?e:(console.warn(\"THREE.ObjectLoader.parseTexture: Constant should be in numeric form.\",e),t[e])}var n={};if(void 0!==e)for(var r=0,o=e.length;r<o;r++){var a=e[r];void 0===a.image&&console.warn('THREE.ObjectLoader: No \"image\" specified for',a.uuid),void 0===t[a.image]&&console.warn(\"THREE.ObjectLoader: Undefined image\",a.image);var l=Array.isArray(t[a.image])?new ae(t[a.image]):new s(t[a.image]);l.needsUpdate=!0,l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.mapping&&(l.mapping=i(a.mapping,Go)),void 0!==a.offset&&l.offset.fromArray(a.offset),void 0!==a.repeat&&l.repeat.fromArray(a.repeat),void 0!==a.center&&l.center.fromArray(a.center),void 0!==a.rotation&&(l.rotation=a.rotation),void 0!==a.wrap&&(l.wrapS=i(a.wrap[0],Wo),l.wrapT=i(a.wrap[1],Wo)),void 0!==a.format&&(l.format=a.format),void 0!==a.type&&(l.type=a.type),void 0!==a.encoding&&(l.encoding=a.encoding),void 0!==a.minFilter&&(l.minFilter=i(a.minFilter,qo)),void 0!==a.magFilter&&(l.magFilter=i(a.magFilter,qo)),void 0!==a.anisotropy&&(l.anisotropy=a.anisotropy),void 0!==a.flipY&&(l.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(l.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(l.unpackAlignment=a.unpackAlignment),n[a.uuid]=l}return n},parseObject:function(e,t,i){function n(e){return void 0===t[e]&&console.warn(\"THREE.ObjectLoader: Undefined geometry\",e),t[e]}function r(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];void 0===i[o]&&console.warn(\"THREE.ObjectLoader: Undefined material\",o),t.push(i[o])}return t}return void 0===i[e]&&console.warn(\"THREE.ObjectLoader: Undefined material\",e),i[e]}}switch(e.type){case\"Scene\":var o=new Et;void 0!==e.background&&Number.isInteger(e.background)&&(o.background=new y(e.background)),void 0!==e.fog&&(\"Fog\"===e.fog.type?o.fog=new Mt(e.fog.color,e.fog.near,e.fog.far):\"FogExp2\"===e.fog.type&&(o.fog=new wt(e.fog.color,e.fog.density)));break;case\"PerspectiveCamera\":o=new mt(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case\"OrthographicCamera\":o=new Xn(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case\"AmbientLight\":o=new Jn(e.color,e.intensity);break;case\"DirectionalLight\":o=new Zn(e.color,e.intensity);break;case\"PointLight\":o=new Qn(e.color,e.intensity,e.distance,e.decay);break;case\"RectAreaLight\":o=new Kn(e.color,e.intensity,e.width,e.height);break;case\"SpotLight\":o=new qn(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case\"HemisphereLight\":o=new Un(e.color,e.groundColor,e.intensity);break;case\"SkinnedMesh\":console.warn(\"THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.\");case\"Mesh\":o=n(e.geometry);var a=r(e.material);o=o.bones&&0<o.bones.length?new Rt(o,a):new X(o,a);break;case\"LOD\":o=new Ct;break;case\"Line\":o=new Bt(n(e.geometry),r(e.material),e.mode);break;case\"LineLoop\":o=new Ot(n(e.geometry),r(e.material));break;case\"LineSegments\":o=new zt(n(e.geometry),r(e.material));break;case\"PointCloud\":case\"Points\":o=new It(n(e.geometry),r(e.material));break;case\"Sprite\":o=new At(r(e.material));break;case\"Group\":o=new dt;break;default:o=new _}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){a=e.children;for(var s=0;s<a.length;s++)o.add(this.parseObject(a[s],t,i))}if(\"LOD\"===e.type)for(e=e.levels,a=0;a<e.length;a++){s=e[a];var l=o.getObjectByProperty(\"uuid\",s.object);void 0!==l&&o.addLevel(l,s.distance)}return o}});var Go={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Wo={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},qo={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};ir.prototype={constructor:ir,setOptions:function(e){return this.options=e,this},load:function(e,t,i,n){void 0===e&&(e=\"\"),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=zo.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout((function(){t&&t(o),r.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,r.options)})).then((function(i){zo.add(e,i),t&&t(i),r.manager.itemEnd(e)})).catch((function(t){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}))},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(nr.prototype,{moveTo:function(e,t){this.currentPath=new jn,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,i,n){this.currentPath.quadraticCurveTo(e,t,i,n)},bezierCurveTo:function(e,t,i,n,r,o){this.currentPath.bezierCurveTo(e,t,i,n,r,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function i(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i],o=new Vn;o.curves=r.curves,t.push(o)}return t}function n(e,t){for(var i=t.length,n=!1,r=i-1,o=0;o<i;r=o++){var a=t[r],s=t[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(0>c&&(a=t[o],l=-l,s=t[r],c=-c),!(e.y<a.y||e.y>s.y))if(e.y===a.y){if(e.x===a.x)return!0}else{if(0==(r=c*(e.x-a.x)-l*(e.y-a.y)))return!0;0>r||(n=!n)}}else if(e.y===a.y&&(s.x<=e.x&&e.x<=a.x||a.x<=e.x&&e.x<=s.x))return!0}return n}var r=Ro.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);if(t=[],1===o.length){var a=o[0],s=new Vn;return s.curves=a.curves,t.push(s),t}var l=!r(o[0].getPoints());l=e?!l:l,s=[];var c=[],h=[],u=0;c[u]=void 0,h[u]=[];for(var p=0,d=o.length;p<d;p++){var f=(a=o[p]).getPoints(),m=r(f);(m=e?!m:m)?(!l&&c[u]&&u++,c[u]={s:new Vn,p:f},c[u].s.curves=a.curves,l&&u++,h[u]=[]):h[u].push({h:a,p:f[0]})}if(!c[0])return i(o);if(1<c.length){for(p=!1,e=[],r=0,o=c.length;r<o;r++)s[r]=[];for(r=0,o=c.length;r<o;r++)for(a=h[r],m=0;m<a.length;m++){for(l=a[m],u=!0,f=0;f<c.length;f++)n(l.p,c[f].p)&&(r!==f&&e.push({froms:r,tos:f,hole:m}),u?(u=!1,s[f].push(l)):p=!0);u&&s[r].push(l)}0<e.length&&(p||(h=s))}for(p=0,r=c.length;p<r;p++)for(s=c[p].s,t.push(s),o=0,a=(e=h[p]).length;o<a;o++)s.holes.push(e[o].h);return t}}),Object.assign(rr.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);var i=[],n=t;t=this.data;var r=Array.from?Array.from(e):String(e).split(\"\");n/=t.resolution;var o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*n;e=[];for(var a=0,s=0,l=0;l<r.length;l++){var c=r[l];if(\"\\n\"===c)a=0,s-=o;else{var h=n,u=a,p=s;if(c=t.glyphs[c]||t.glyphs[\"?\"]){var d=new nr;if(c.o)for(var f=c._cachedOutline||(c._cachedOutline=c.o.split(\" \")),m=0,g=f.length;m<g;)switch(f[m++]){case\"m\":var v=f[m++]*h+u,y=f[m++]*h+p;d.moveTo(v,y);break;case\"l\":v=f[m++]*h+u,y=f[m++]*h+p,d.lineTo(v,y);break;case\"q\":var x=f[m++]*h+u,b=f[m++]*h+p,w=f[m++]*h+u,M=f[m++]*h+p;d.quadraticCurveTo(w,M,x,b);break;case\"b\":x=f[m++]*h+u,b=f[m++]*h+p,w=f[m++]*h+u,M=f[m++]*h+p,v=f[m++]*h+u,y=f[m++]*h+p,d.bezierCurveTo(w,M,v,y,x,b)}h={offsetX:c.ha*h,path:d}}else h=void 0;a+=h.offsetX,e.push(h.path)}}for(t=0,r=e.length;t<r;t++)Array.prototype.push.apply(i,e[t].toShapes());return i}}),Object.assign(or.prototype,{load:function(e,t,i,n){var r=this,o=new vn(this.manager);o.setPath(this.path),o.load(e,(function(e){try{var i=JSON.parse(e)}catch(t){console.warn(\"THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead.\"),i=JSON.parse(e.substring(65,e.length-2))}e=r.parse(i),t&&t(e)}),i,n)},parse:function(e){return new rr(e)},setPath:function(e){return this.path=e,this}}),ar.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,n=t.length;i<n;i+=2){var r=t[i+1];if(t[i].test(e))return r}return null}},Object.assign(ar.prototype,{crossOrigin:\"anonymous\",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,i){for(var n=[],r=0;r<e.length;++r)n[r]=this.createMaterial(e[r],t,i);return n},createMaterial:function(){var e={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},t=new y,i=new En,n=new $n;return function(r,o,a){function s(e,t,n,r,s){e=o+e;var l=ar.Handlers.get(e);return null!==l?e=l.load(e):(i.setCrossOrigin(a),e=i.load(e)),void 0!==t&&(e.repeat.fromArray(t),1!==t[0]&&(e.wrapS=1e3),1!==t[1]&&(e.wrapT=1e3)),void 0!==n&&e.offset.fromArray(n),void 0!==r&&(\"repeat\"===r[0]&&(e.wrapS=1e3),\"mirror\"===r[0]&&(e.wrapS=1002),\"repeat\"===r[1]&&(e.wrapT=1e3),\"mirror\"===r[1]&&(e.wrapT=1002)),void 0!==s&&(e.anisotropy=s),t=eo.generateUUID(),c[t]=e,t}var l,c={},h={uuid:eo.generateUUID(),type:\"MeshLambertMaterial\"};for(l in r){var u=r[l];switch(l){case\"DbgColor\":case\"DbgIndex\":case\"opticalDensity\":case\"illumination\":break;case\"DbgName\":h.name=u;break;case\"blending\":h.blending=e[u];break;case\"colorAmbient\":case\"mapAmbient\":console.warn(\"THREE.Loader.createMaterial:\",l,\"is no longer supported.\");break;case\"colorDiffuse\":h.color=t.fromArray(u).getHex();break;case\"colorSpecular\":h.specular=t.fromArray(u).getHex();break;case\"colorEmissive\":h.emissive=t.fromArray(u).getHex();break;case\"specularCoef\":h.shininess=u;break;case\"shading\":\"basic\"===u.toLowerCase()&&(h.type=\"MeshBasicMaterial\"),\"phong\"===u.toLowerCase()&&(h.type=\"MeshPhongMaterial\"),\"standard\"===u.toLowerCase()&&(h.type=\"MeshStandardMaterial\");break;case\"mapDiffuse\":h.map=s(u,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case\"mapDiffuseRepeat\":case\"mapDiffuseOffset\":case\"mapDiffuseWrap\":case\"mapDiffuseAnisotropy\":break;case\"mapEmissive\":h.emissiveMap=s(u,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case\"mapEmissiveRepeat\":case\"mapEmissiveOffset\":case\"mapEmissiveWrap\":case\"mapEmissiveAnisotropy\":break;case\"mapLight\":h.lightMap=s(u,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case\"mapLightRepeat\":case\"mapLightOffset\":case\"mapLightWrap\":case\"mapLightAnisotropy\":break;case\"mapAO\":h.aoMap=s(u,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case\"mapAORepeat\":case\"mapAOOffset\":case\"mapAOWrap\":case\"mapAOAnisotropy\":break;case\"mapBump\":h.bumpMap=s(u,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case\"mapBumpScale\":h.bumpScale=u;break;case\"mapBumpRepeat\":case\"mapBumpOffset\":case\"mapBumpWrap\":case\"mapBumpAnisotropy\":break;case\"mapNormal\":h.normalMap=s(u,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case\"mapNormalFactor\":h.normalScale=u;break;case\"mapNormalRepeat\":case\"mapNormalOffset\":case\"mapNormalWrap\":case\"mapNormalAnisotropy\":break;case\"mapSpecular\":h.specularMap=s(u,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case\"mapSpecularRepeat\":case\"mapSpecularOffset\":case\"mapSpecularWrap\":case\"mapSpecularAnisotropy\":break;case\"mapMetalness\":h.metalnessMap=s(u,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case\"mapMetalnessRepeat\":case\"mapMetalnessOffset\":case\"mapMetalnessWrap\":case\"mapMetalnessAnisotropy\":break;case\"mapRoughness\":h.roughnessMap=s(u,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case\"mapRoughnessRepeat\":case\"mapRoughnessOffset\":case\"mapRoughnessWrap\":case\"mapRoughnessAnisotropy\":break;case\"mapAlpha\":h.alphaMap=s(u,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case\"mapAlphaRepeat\":case\"mapAlphaOffset\":case\"mapAlphaWrap\":case\"mapAlphaAnisotropy\":break;case\"flipSided\":h.side=1;break;case\"doubleSided\":h.side=2;break;case\"transparency\":console.warn(\"THREE.Loader.createMaterial: transparency has been renamed to opacity\"),h.opacity=u;break;case\"depthTest\":case\"depthWrite\":case\"colorWrite\":case\"opacity\":case\"reflectivity\":case\"transparent\":case\"visible\":case\"wireframe\":h[l]=u;break;case\"vertexColors\":!0===u&&(h.vertexColors=2),\"face\"===u&&(h.vertexColors=1);break;default:console.error(\"THREE.Loader.createMaterial: Unsupported\",l,u)}}return\"MeshBasicMaterial\"===h.type&&delete h.emissive,\"MeshPhongMaterial\"!==h.type&&delete h.specular,1>h.opacity&&(h.transparent=!0),n.setTextures(c),n.parse(h)}}()});var Qo,Xo,Yo,Zo={getContext:function(){return void 0===Qo&&(Qo=new(window.AudioContext||window.webkitAudioContext)),Qo},setContext:function(e){Qo=e}};Object.assign(sr.prototype,{load:function(e,t,i,n){var r=new vn(this.manager);r.setResponseType(\"arraybuffer\"),r.setPath(this.path),r.load(e,(function(e){e=e.slice(0),Zo.getContext().decodeAudioData(e,(function(e){t(e)}))}),i,n)},setPath:function(e){return this.path=e,this}}),Object.assign(lr.prototype,{update:function(){var e,t,i,r,o,a,s,l,c=new n,h=new n;return function(n){if(e!==this||t!==n.focus||i!==n.fov||r!==n.aspect*this.aspect||o!==n.near||a!==n.far||s!==n.zoom||l!==this.eyeSep){e=this,t=n.focus,i=n.fov,r=n.aspect*this.aspect,o=n.near,a=n.far,s=n.zoom;var u=n.projectionMatrix.clone(),p=(l=this.eyeSep/2)*o/t,d=o*Math.tan(eo.DEG2RAD*i*.5)/s;h.elements[12]=-l,c.elements[12]=l;var f=-d*r+p,m=d*r+p;u.elements[0]=2*o/(m-f),u.elements[8]=(m+f)/(m-f),this.cameraL.projectionMatrix.copy(u),f=-d*r-p,m=d*r-p,u.elements[0]=2*o/(m-f),u.elements[8]=(m+f)/(m-f),this.cameraR.projectionMatrix.copy(u)}this.cameraL.matrixWorld.copy(n.matrixWorld).multiply(h),this.cameraR.matrixWorld.copy(n.matrixWorld).multiply(c)}}()}),cr.prototype=Object.create(_.prototype),cr.prototype.constructor=cr,Object.assign(hr.prototype,{start:function(){this.oldTime=this.startTime=(\"undefined\"==typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=(\"undefined\"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),ur.prototype=Object.assign(Object.create(_.prototype),{constructor:ur,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new o,t=new r,i=new o,n=new o,a=new hr;return function(r){_.prototype.updateMatrixWorld.call(this,r),r=this.context.listener;var o=this.up;if(this.timeDelta=a.getDelta(),this.matrixWorld.decompose(e,t,i),n.set(0,0,-1).applyQuaternion(t),r.positionX){var s=this.context.currentTime+this.timeDelta;r.positionX.linearRampToValueAtTime(e.x,s),r.positionY.linearRampToValueAtTime(e.y,s),r.positionZ.linearRampToValueAtTime(e.z,s),r.forwardX.linearRampToValueAtTime(n.x,s),r.forwardY.linearRampToValueAtTime(n.y,s),r.forwardZ.linearRampToValueAtTime(n.z,s),r.upX.linearRampToValueAtTime(o.x,s),r.upY.linearRampToValueAtTime(o.y,s),r.upZ.linearRampToValueAtTime(o.z,s)}else r.setPosition(e.x,e.y,e.z),r.setOrientation(n.x,n.y,n.z,o.x,o.y,o.z)}}()}),pr.prototype=Object.assign(Object.create(_.prototype),{constructor:pr,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType=\"audioNode\",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType=\"mediaNode\",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType=\"buffer\",this.autoplay&&this.play(),this},play:function(){if(!0===this.isPlaying)console.warn(\"THREE.Audio: Audio is already playing.\");else{if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.detune.value=this.detune,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn(\"THREE.Audio: this Audio has no playback control.\")}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn(\"THREE.Audio: this Audio has no playback control.\")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn(\"THREE.Audio: this Audio has no playback control.\")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){return this.detune=e,!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn(\"THREE.Audio: this Audio has no playback control.\")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn(\"THREE.Audio: this Audio has no playback control.\"),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn(\"THREE.Audio: this Audio has no playback control.\")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),dr.prototype=Object.assign(Object.create(pr.prototype),{constructor:dr,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(){var e=new o,t=new r,i=new o,n=new o;return function(r){if(_.prototype.updateMatrixWorld.call(this,r),!1!==this.isPlaying)if(this.matrixWorld.decompose(e,t,i),n.set(0,0,1).applyQuaternion(t),(r=this.panner).positionX){var o=this.context.currentTime+this.listener.timeDelta;r.positionX.linearRampToValueAtTime(e.x,o),r.positionY.linearRampToValueAtTime(e.y,o),r.positionZ.linearRampToValueAtTime(e.z,o),r.orientationX.linearRampToValueAtTime(n.x,o),r.orientationY.linearRampToValueAtTime(n.y,o),r.orientationZ.linearRampToValueAtTime(n.z,o)}else r.setPosition(e.x,e.y,e.z),r.setOrientation(n.x,n.y,n.z)}}()}),Object.assign(fr.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),Object.assign(mr.prototype,{accumulate:function(e,t){var i=this.buffer,n=this.valueSize;e=e*n+n;var r=this.cumulativeWeight;if(0===r){for(r=0;r!==n;++r)i[e+r]=i[r];r=t}else r+=t,this._mixBufferRegion(i,e,0,t/r,n);this.cumulativeWeight=r},apply:function(e){var t=this.valueSize,i=this.buffer;e=e*t+t;var n=this.cumulativeWeight,r=this.binding;this.cumulativeWeight=0,1>n&&this._mixBufferRegion(i,e,3*t,1-n,t),n=t;for(var o=t+t;n!==o;++n)if(i[n]!==i[n+t]){r.setValue(i,e);break}},saveOriginalState:function(){var e=this.buffer,t=this.valueSize,i=3*t;this.binding.getValue(e,i);for(var n=t;n!==i;++n)e[n]=e[i+n%t];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(e,t,i,n,r){if(.5<=n)for(n=0;n!==r;++n)e[t+n]=e[i+n]},_slerp:function(e,t,i,n){r.slerpFlat(e,t,e,t,e,i,n)},_lerp:function(e,t,i,n,r){for(var o=1-n,a=0;a!==r;++a){var s=t+a;e[s]=e[s]*o+e[i+a]*n}}}),Object.assign(gr.prototype,{getValue:function(e,t){this.bind();var i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(vr,{Composite:gr,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new vr.Composite(e,t,i):new vr(e,t,i)},sanitizeNodeName:function(){var e=/[\\[\\]\\.:\\/]/g;return function(t){return t.replace(/\\s/g,\"_\").replace(e,\"\")}}(),parseTrackName:function(){var e=\"[^\"+\"\\\\[\\\\]\\\\.:\\\\/\".replace(\"\\\\.\",\"\")+\"]\",t=/((?:WC+[\\/:])*)/.source.replace(\"WC\",\"[^\\\\[\\\\]\\\\.:\\\\/]\");e=/(WCOD+)?/.source.replace(\"WCOD\",e);var i=/(?:\\.(WC+)(?:\\[(.+)\\])?)?/.source.replace(\"WC\",\"[^\\\\[\\\\]\\\\.:\\\\/]\"),n=/\\.(WC+)(?:\\[(.+)\\])?/.source.replace(\"WC\",\"[^\\\\[\\\\]\\\\.:\\\\/]\"),r=new RegExp(\"^\"+t+e+i+n+\"$\"),o=[\"material\",\"materials\",\"bones\"];return function(e){var t=r.exec(e);if(!t)throw Error(\"PropertyBinding: Cannot parse trackName: \"+e);var i=(t={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]}).nodeName&&t.nodeName.lastIndexOf(\".\");if(void 0!==i&&-1!==i){var n=t.nodeName.substring(i+1);-1!==o.indexOf(n)&&(t.nodeName=t.nodeName.substring(0,i),t.objectName=n)}if(null===t.propertyName||0===t.propertyName.length)throw Error(\"PropertyBinding: can not parse propertyName from trackName: \"+e);return t}}(),findNode:function(e,t){if(!t||\"\"===t||\"root\"===t||\".\"===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){var n=function(e){for(var i=0;i<e.length;i++){var r=e[i];if(r.name===t||r.uuid===t||(r=n(r.children)))return r}return null};if(e=n(e.children))return e}return null}}),Object.assign(vr.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)e[t++]=i[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(this.node=e=vr.findNode(this.rootNode,t.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case\"materials\":if(!e.material)return void console.error(\"THREE.PropertyBinding: Can not bind to material as node does not have a material.\",this);if(!e.material.materials)return void console.error(\"THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.\",this);e=e.material.materials;break;case\"bones\":if(!e.skeleton)return void console.error(\"THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.\",this);for(e=e.skeleton.bones,i=0;i<e.length;i++)if(e[i].name===o){o=i;break}break;default:if(void 0===e[i])return void console.error(\"THREE.PropertyBinding: Can not bind to objectName of node undefined.\",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error(\"THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.\",this,e);e=e[o]}}if(void 0===(o=e[n]))console.error(\"THREE.PropertyBinding: Trying to update property for track: \"+t.nodeName+\".\"+n+\" but it wasn't found.\",e);else{if(t=this.Versioning.None,this.targetObject=e,void 0!==e.needsUpdate?t=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(t=this.Versioning.MatrixWorldNeedsUpdate),i=this.BindingType.Direct,void 0!==r){if(\"morphTargetInfluences\"===n){if(!e.geometry)return void console.error(\"THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.\",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error(\"THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.\",this);for(i=0;i<this.node.geometry.morphAttributes.position.length;i++)if(e.geometry.morphAttributes.position[i].name===r){r=i;break}}else{if(!e.geometry.morphTargets)return void console.error(\"THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.\",this);for(i=0;i<this.node.geometry.morphTargets.length;i++)if(e.geometry.morphTargets[i].name===r){r=i;break}}}i=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(i=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(i=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[i],this.setValue=this.SetterByBindingTypeAndVersioning[i][t]}}else console.error(\"THREE.PropertyBinding: Trying to update node for track: \"+this.path+\" but it wasn't found.\")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(vr.prototype,{_getValue_unbound:vr.prototype.getValue,_setValue_unbound:vr.prototype.setValue}),Object.assign(yr.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,c=0,h=arguments.length;c!==h;++c){var u=arguments[c],p=u.uuid,d=n[p];if(void 0===d){d=t++,n[p]=d,e.push(u),p=0;for(var f=s;p!==f;++p)a[p].push(new vr(u,r[p],o[p]))}else if(d<i){l=e[d];var m=--i;for(n[(f=e[m]).uuid]=d,e[d]=f,n[p]=m,e[m]=u,p=0,f=s;p!==f;++p){var g=a[p],v=g[d];g[d]=g[m],void 0===v&&(v=new vr(u,r[p],o[p])),g[m]=v}}else e[d]!==l&&console.error(\"THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.\")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,r=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=i[l];if(void 0!==c&&c>=t){var h=t++,u=e[h];for(i[u.uuid]=c,e[c]=u,i[l]=h,e[h]=s,s=0,l=r;s!==l;++s){var p=(u=n[s])[c];u[c]=u[h],u[h]=p}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,o=r.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a].uuid,c=n[l];if(void 0!==c)if(delete n[l],c<i){var h=e[l=--i],u=--t,p=e[u];for(n[h.uuid]=c,e[c]=h,n[p.uuid]=l,e[l]=p,e.pop(),h=0,p=o;h!==p;++h){var d=r[h],f=d[u];d[c]=d[l],d[l]=f,d.pop()}}else for(n[(p=e[u=--t]).uuid]=c,e[c]=p,e.pop(),h=0,p=o;h!==p;++h)(d=r[h])[c]=d[u],d.pop()}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,n=i[e],r=this._bindings;if(void 0!==n)return r[n];var o=this._paths,a=this._parsedPaths,s=this._objects,l=this.nCachedObjects_,c=Array(s.length);for(n=r.length,i[e]=n,o.push(e),a.push(t),r.push(c),i=l,n=s.length;i!==n;++i)c[i]=new vr(s[i],e,t);return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var n=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];t[e[a]]=i,o[i]=s,o.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}}),Object.assign(xr.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){i=this._clip.duration;var n=e._clip.duration,r=i/n;e.warp(1,n/i,t),this.warp(r,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var n=this._mixer,r=n.time,o=this._timeScaleInterpolant,a=this.timeScale;return null===o&&(this._timeScaleInterpolant=o=n._lendControlInterpolant()),n=o.parameterPositions,o=o.sampleValues,n[0]=r,n[1]=r+i,o[0]=e/a,o[1]=t/a,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,n){if(this.enabled){var r=this._startTime;if(null!==r){if(0>(t=(e-r)*i)||0===i)return;this._startTime=null,t*=i}if(t*=this._updateTimeScale(e),i=this._updateTime(t),0<(e=this._updateWeight(e))){t=this._interpolants,r=this._propertyBindings;for(var o=0,a=t.length;o!==a;++o)t[o].evaluate(i),r[o].accumulate(n,e)}}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,i=this._clip.duration,n=this.loop,r=this._loopCount,o=2202===n;if(0===e)return-1===r?t:o&&1==(1&r)?i-t:t;if(2200===n)e:{if(-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1)),t>=i)t=i;else{if(!(0>t))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:0>e?-1:1})}else{if(-1===r&&(0<=e?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||0>t){t-=i*(n=Math.floor(t/i)),r+=Math.abs(n);var a=this.repetitions-r;0>=a?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?i:0,this._mixer.dispatchEvent({type:\"finished\",action:this,direction:0<e?1:-1})):(1===a?(e=0>e,this._setEndings(e,!e,o)):this._setEndings(!1,!1,o),this._loopCount=r,this._mixer.dispatchEvent({type:\"loop\",action:this,loopDelta:n}))}if(o&&1==(1&r))return this.time=t,i-t}return this.time=t},_setEndings:function(e,t,i){var n=this._interpolantSettings;i?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(e,t,i){var n=this._mixer,r=n.time,o=this._weightInterpolant;return null===o&&(this._weightInterpolant=o=n._lendControlInterpolant()),n=o.parameterPositions,o=o.sampleValues,n[0]=r,o[0]=t,n[1]=r+e,o[1]=i,this}}),br.prototype=Object.assign(Object.create(t.prototype),{constructor:br,_bindAction:function(e,t){var i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,o=e._propertyBindings;e=e._interpolants;var a=i.uuid,s=this._bindingsByRootAndName,l=s[a];for(void 0===l&&(l={},s[a]=l),s=0;s!==r;++s){var c=n[s],h=c.name,u=l[h];if(void 0===u){if(void 0!==(u=o[s])){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,h));continue}++(u=new mr(vr.create(i,h,t&&t._propertyBindings[s].binding.parsedPath),c.ValueTypeName,c.getValueSize())).referenceCount,this._addInactiveBinding(u,a,h)}o[s]=u,e[s].resultBuffer=u.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}for(i=0,n=(t=e._propertyBindings).length;i!==n;++i){var r=t[i];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,n=t.length;i!==n;++i){var r=t[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){return null!==(e=e._cacheIndex)&&e<this._nActiveActions},_addInactiveAction:function(e,t,i){var n=this._actions,r=this._actionsByClip,o=r[t];void 0===o?(o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o):(t=o.knownActions,e._byClipCacheIndex=t.length,t.push(e)),e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null,t=e._clip.uuid;var r=(n=(i=this._actionsByClip)[t]).knownActions,o=r[r.length-1],a=e._byClipCacheIndex;o._byClipCacheIndex=a,r[a]=o,r.pop(),e._byClipCacheIndex=null,delete n.actionByRoot[(e._localRoot||this._root).uuid],0===r.length&&delete i[t],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=0,i=(e=e._propertyBindings).length;t!==i;++t){var n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_addInactiveBinding:function(e,t,i){var n=this._bindingsByRootAndName,r=n[t],o=this._bindings;void 0===r&&(r={},n[t]=r),r[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,n=i.rootNode.uuid;i=i.path;var r=this._bindingsByRootAndName,o=r[n],a=t[t.length-1];e=e._cacheIndex,a._cacheIndex=e,t[e]=a,t.pop(),delete o[i];e:{for(var s in o)break e;delete r[n]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new rn(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var i=t||this._root,n=i.uuid;e=null!==(i=\"string\"==typeof e?fn.findByName(i,e):e)?i.uuid:e;var r=this._actionsByClip[e],o=null;if(void 0!==r){if(void 0!==(o=r.actionByRoot[n]))return o;o=r.knownActions[0],null===i&&(i=o._clip)}return null===i?null:(t=new xr(this,i,t),this._bindAction(t,o),this._addInactiveAction(t,e,n),t)},existingAction:function(e,t){var i=t||this._root;return t=i.uuid,i=\"string\"==typeof e?fn.findByName(i,e):e,void 0!==(e=this._actionsByClip[i?i.uuid:e])&&e.actionByRoot[t]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions,i=this._bindings,n=this._nActiveBindings,r=this._nActiveBindings=this._nActiveActions=0;r!==t;++r)e[r].reset();for(r=0;r!==n;++r)i[r].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1,a=0;a!==i;++a)t[a]._update(n,e,r,o);for(e=this._bindings,t=this._nActiveBindings,a=0;a!==t;++a)e[a].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions;e=e.uuid;var i=this._actionsByClip,n=i[e];if(void 0!==n){for(var r=0,o=(n=n.knownActions).length;r!==o;++r){var a=n[r];this._deactivateAction(a);var s=a._cacheIndex,l=t[t.length-1];a._cacheIndex=null,a._byClipCacheIndex=null,l._cacheIndex=s,t[s]=l,t.pop(),this._removeInactiveBindingsForAction(a)}delete i[e]}},uncacheRoot:function(e){e=e.uuid;var t=this._actionsByClip;for(n in t){var i=t[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var n=this._bindingsByRootAndName[e];if(void 0!==n)for(var r in n)(e=n[r]).restoreOriginalState(),this._removeInactiveBinding(e)},uncacheAction:function(e,t){null!==(e=this.existingAction(e,t))&&(this._deactivateAction(e),this._removeInactiveAction(e))}}),wr.prototype.clone=function(){return new wr(void 0===this.value.clone?this.value:this.value.clone())},Mr.prototype=Object.assign(Object.create(D.prototype),{constructor:Mr,isInstancedBufferGeometry:!0,copy:function(e){return D.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Er.prototype=Object.assign(Object.create(_t.prototype),{constructor:Er,isInstancedInterleavedBuffer:!0,copy:function(e){return _t.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),_r.prototype=Object.assign(Object.create(T.prototype),{constructor:_r,isInstancedBufferAttribute:!0,copy:function(e){return T.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Sr.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error(\"THREE.Raycaster: Unsupported camera type.\")},intersectObject:function(e,t,i){return Ar(e,this,i=i||[],t),i.sort(Tr),i},intersectObjects:function(e,t,i){if(i=i||[],!1===Array.isArray(e))return console.warn(\"THREE.Raycaster.intersectObjects: objects is not an Array.\"),i;for(var n=0,r=e.length;n<r;n++)Ar(e[n],this,i,t);return i.sort(Tr),i}}),Object.assign(Cr.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(e,i),this.phi=Math.acos(eo.clamp(t/this.radius,-1,1))),this}}),Object.assign(Rr.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}}),Object.assign(Lr.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new i;return function(t,i){return i=e.copy(i).multiplyScalar(.5),this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn(\"THREE.Box2: .getCenter() target is now required\"),e=new i),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn(\"THREE.Box2: .getSize() target is now required\"),e=new i),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn(\"THREE.Box2: .getParameter() target is now required\"),t=new i),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn(\"THREE.Box2: .clampPoint() target is now required\"),t=new i),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Pr.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn(\"THREE.Line3: .getCenter() target is now required\"),e=new o),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn(\"THREE.Line3: .delta() target is now required\"),e=new o),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn(\"THREE.Line3: .at() target is now required\"),t=new o),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new o,t=new o;return function(i,n){return e.subVectors(i,this.start),t.subVectors(this.end,this.start),i=t.dot(t),i=t.dot(e)/i,n&&(i=eo.clamp(i,0,1)),i}}(),closestPointToPoint:function(e,t,i){return e=this.closestPointToPointParameter(e,t),void 0===i&&(console.warn(\"THREE.Line3: .closestPointToPoint() target is now required\"),i=new o),this.delta(i).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Nr.prototype=Object.create(_.prototype),Nr.prototype.constructor=Nr,Nr.prototype.isImmediateRenderObject=!0,Br.prototype=Object.create(zt.prototype),Br.prototype.constructor=Br,Br.prototype.update=function(){var e=new o,t=new o,i=new a;return function(){var n=[\"a\",\"b\",\"c\"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,o=this.geometry.attributes.position,a=this.object.geometry;if(a&&a.isGeometry)for(var s=a.vertices,l=a.faces,c=a=0,h=l.length;c<h;c++)for(var u=l[c],p=0,d=u.vertexNormals.length;p<d;p++){var f=u.vertexNormals[p];e.copy(s[u[n[p]]]).applyMatrix4(r),t.copy(f).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(a,e.x,e.y,e.z),a+=1,o.setXYZ(a,t.x,t.y,t.z),a+=1}else if(a&&a.isBufferGeometry)for(n=a.attributes.position,s=a.attributes.normal,p=a=0,d=n.count;p<d;p++)e.set(n.getX(p),n.getY(p),n.getZ(p)).applyMatrix4(r),t.set(s.getX(p),s.getY(p),s.getZ(p)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(a,e.x,e.y,e.z),a+=1,o.setXYZ(a,t.x,t.y,t.z),a+=1;o.needsUpdate=!0}}(),zr.prototype=Object.create(_.prototype),zr.prototype.constructor=zr,zr.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},zr.prototype.update=function(){var e=new o;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),Or.prototype=Object.create(zt.prototype),Or.prototype.constructor=Or,Or.prototype.updateMatrixWorld=function(){var e=new o,t=new n,i=new n;return function(n){var r=this.bones,o=this.geometry,a=o.getAttribute(\"position\");i.getInverse(this.root.matrixWorld);for(var s=0,l=0;s<r.length;s++){var c=r[s];c.parent&&c.parent.isBone&&(t.multiplyMatrices(i,c.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(i,c.parent.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(l+1,e.x,e.y,e.z),l+=2)}o.getAttribute(\"position\").needsUpdate=!0,_.prototype.updateMatrixWorld.call(this,n)}}(),Fr.prototype=Object.create(X.prototype),Fr.prototype.constructor=Fr,Fr.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Fr.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},Ir.prototype=Object.create(Bt.prototype),Ir.prototype.constructor=Ir,Ir.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);1<t&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},Ir.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()},Dr.prototype=Object.create(_.prototype),Dr.prototype.constructor=Dr,Dr.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Dr.prototype.update=function(){var e=new o,t=new y,i=new y;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var r=n.geometry.getAttribute(\"color\");t.copy(this.light.color),i.copy(this.light.groundColor);for(var o=0,a=r.count;o<a;o++){var s=o<a/2?t:i;r.setXYZ(o,s.r,s.g,s.b)}r.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),Hr.prototype=Object.create(zt.prototype),Hr.prototype.constructor=Hr,jr.prototype=Object.create(zt.prototype),jr.prototype.constructor=jr,Vr.prototype=Object.create(zt.prototype),Vr.prototype.constructor=Vr,Vr.prototype.update=function(){var e=new o,t=new o,i=new a;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,r=this.geometry.attributes.position,o=this.object.geometry,a=o.vertices,s=0,l=0,c=(o=o.faces).length;l<c;l++){var h=o[l],u=h.normal;e.copy(a[h.a]).add(a[h.b]).add(a[h.c]).divideScalar(3).applyMatrix4(n),t.copy(u).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),r.setXYZ(s,e.x,e.y,e.z),s+=1,r.setXYZ(s,t.x,t.y,t.z),s+=1}r.needsUpdate=!0}}(),kr.prototype=Object.create(_.prototype),kr.prototype.constructor=kr,kr.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},kr.prototype.update=function(){var e=new o,t=new o,i=new o;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=i.length()}}(),Ur.prototype=Object.create(zt.prototype),Ur.prototype.constructor=Ur,Ur.prototype.update=function(){function e(e,o,a,s){if(n.set(o,a,s).unproject(r),void 0!==(e=i[e]))for(o=t.getAttribute(\"position\"),a=0,s=e.length;a<s;a++)o.setXYZ(e[a],n.x,n.y,n.z)}var t,i,n=new o,r=new ft;return function(){t=this.geometry,i=this.pointMap,r.projectionMatrix.copy(this.camera.projectionMatrix),e(\"c\",0,0,-1),e(\"t\",0,0,1),e(\"n1\",-1,-1,-1),e(\"n2\",1,-1,-1),e(\"n3\",-1,1,-1),e(\"n4\",1,1,-1),e(\"f1\",-1,-1,1),e(\"f2\",1,-1,1),e(\"f3\",-1,1,1),e(\"f4\",1,1,1),e(\"u1\",.7,1.1,-1),e(\"u2\",-.7,1.1,-1),e(\"u3\",0,2,-1),e(\"cf1\",-1,0,1),e(\"cf2\",1,0,1),e(\"cf3\",0,-1,1),e(\"cf4\",0,1,1),e(\"cn1\",-1,0,-1),e(\"cn2\",1,0,-1),e(\"cn3\",0,-1,-1),e(\"cn4\",0,1,-1),t.getAttribute(\"position\").needsUpdate=!0}}(),Gr.prototype=Object.create(zt.prototype),Gr.prototype.constructor=Gr,Gr.prototype.update=function(){var e=new p;return function(t){if(void 0!==t&&console.warn(\"THREE.BoxHelper: .update() has no longer arguments.\"),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){t=e.min;var i=e.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Gr.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Gr.prototype.copy=function(e){return zt.prototype.copy.call(this,e),this.object=e.object,this},Gr.prototype.clone=function(){return(new this.constructor).copy(this)},Wr.prototype=Object.create(zt.prototype),Wr.prototype.constructor=Wr,Wr.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),_.prototype.updateMatrixWorld.call(this,e))},qr.prototype=Object.create(Bt.prototype),qr.prototype.constructor=qr,qr.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;1e-8>Math.abs(t)&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=0>t?1:0,this.lookAt(this.plane.normal),_.prototype.updateMatrixWorld.call(this,e)},Qr.prototype=Object.create(_.prototype),Qr.prototype.constructor=Qr,Qr.prototype.setDirection=function(){var e,t=new o;return function(i){.99999<i.y?this.quaternion.set(0,0,0,1):-.99999>i.y?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),Qr.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},Qr.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Qr.prototype.copy=function(e){return _.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Qr.prototype.clone=function(){return(new this.constructor).copy(this)},Xr.prototype=Object.create(zt.prototype),Xr.prototype.constructor=Xr,_n.create=function(e,t){return console.log(\"THREE.Curve.create() has been deprecated\"),e.prototype=Object.create(_n.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Hn.prototype,{createPointsGeometry:function(e){return console.warn(\"THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.\"),e=this.getPoints(e),this.createGeometry(e)},createSpacedPointsGeometry:function(e){return console.warn(\"THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.\"),e=this.getSpacedPoints(e),this.createGeometry(e)},createGeometry:function(e){console.warn(\"THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.\");for(var t=new S,i=0,n=e.length;i<n;i++){var r=e[i];t.vertices.push(new o(r.x,r.y,r.z||0))}return t}}),Object.assign(jn.prototype,{fromPoints:function(e){console.warn(\"THREE.Path: .fromPoints() has been renamed to .setFromPoints().\"),this.setFromPoints(e)}}),Yr.prototype=Object.create(Cn.prototype),Zr.prototype=Object.create(Cn.prototype),Jr.prototype=Object.create(Cn.prototype),Object.assign(Jr.prototype,{initFromArray:function(){console.error(\"THREE.Spline: .initFromArray() has been removed.\")},getControlPointsArray:function(){console.error(\"THREE.Spline: .getControlPointsArray() has been removed.\")},reparametrizeByArcLength:function(){console.error(\"THREE.Spline: .reparametrizeByArcLength() has been removed.\")}}),Hr.prototype.setColors=function(){console.error(\"THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.\")},Or.prototype.update=function(){console.error(\"THREE.SkeletonHelper: update() no longer needs to be called.\")},Object.assign(ar.prototype,{extractUrlBase:function(e){return console.warn(\"THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.\"),ko.extractUrlBase(e)}}),Object.assign(tr.prototype,{setTexturePath:function(e){return console.warn(\"THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath().\"),this.setResourcePath(e)}}),Object.assign(Lr.prototype,{center:function(e){return console.warn(\"THREE.Box2: .center() has been renamed to .getCenter().\"),this.getCenter(e)},empty:function(){return console.warn(\"THREE.Box2: .empty() has been renamed to .isEmpty().\"),this.isEmpty()},isIntersectionBox:function(e){return console.warn(\"THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)},size:function(e){return console.warn(\"THREE.Box2: .size() has been renamed to .getSize().\"),this.getSize(e)}}),Object.assign(p.prototype,{center:function(e){return console.warn(\"THREE.Box3: .center() has been renamed to .getCenter().\"),this.getCenter(e)},empty:function(){return console.warn(\"THREE.Box3: .empty() has been renamed to .isEmpty().\"),this.isEmpty()},isIntersectionBox:function(e){return console.warn(\"THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn(\"THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().\"),this.intersectsSphere(e)},size:function(e){return console.warn(\"THREE.Box3: .size() has been renamed to .getSize().\"),this.getSize(e)}}),Pr.prototype.center=function(e){return console.warn(\"THREE.Line3: .center() has been renamed to .getCenter().\"),this.getCenter(e)},Object.assign(eo,{random16:function(){return console.warn(\"THREE.Math: .random16() has been deprecated. Use Math.random() instead.\"),Math.random()},nearestPowerOfTwo:function(e){return console.warn(\"THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().\"),eo.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn(\"THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().\"),eo.ceilPowerOfTwo(e)}}),Object.assign(a.prototype,{flattenToArrayOffset:function(e,t){return console.warn(\"THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.\"),this.toArray(e,t)},multiplyVector3:function(e){return console.warn(\"THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.\"),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error(\"THREE.Matrix3: .multiplyVector3Array() has been removed.\")},applyToBuffer:function(e){return console.warn(\"THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.\"),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error(\"THREE.Matrix3: .applyToVector3Array() has been removed.\")}}),Object.assign(n.prototype,{extractPosition:function(e){return console.warn(\"THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().\"),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn(\"THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.\"),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new o),console.warn(\"THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.\"),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn(\"THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().\"),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn(\"THREE.Matrix4: .multiplyToArray() has been removed.\")},multiplyVector3:function(e){return console.warn(\"THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn(\"THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error(\"THREE.Matrix4: .multiplyVector3Array() has been removed.\")},rotateAxis:function(e){console.warn(\"THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.\"),e.transformDirection(this)},crossVector:function(e){return console.warn(\"THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.\"),e.applyMatrix4(this)},translate:function(){console.error(\"THREE.Matrix4: .translate() has been removed.\")},rotateX:function(){console.error(\"THREE.Matrix4: .rotateX() has been removed.\")},rotateY:function(){console.error(\"THREE.Matrix4: .rotateY() has been removed.\")},rotateZ:function(){console.error(\"THREE.Matrix4: .rotateZ() has been removed.\")},rotateByAxis:function(){console.error(\"THREE.Matrix4: .rotateByAxis() has been removed.\")},applyToBuffer:function(e){return console.warn(\"THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.\"),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error(\"THREE.Matrix4: .applyToVector3Array() has been removed.\")},makeFrustum:function(e,t,i,n,r,o){return console.warn(\"THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.\"),this.makePerspective(e,t,n,i,r,o)}}),f.prototype.isIntersectionLine=function(e){return console.warn(\"THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().\"),this.intersectsLine(e)},r.prototype.multiplyVector3=function(e){return console.warn(\"THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.\"),e.applyQuaternion(this)},Object.assign(W.prototype,{isIntersectionBox:function(e){return console.warn(\"THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().\"),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn(\"THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().\"),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn(\"THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().\"),this.intersectsSphere(e)}}),Object.assign(q.prototype,{area:function(){return console.warn(\"THREE.Triangle: .area() has been renamed to .getArea().\"),this.getArea()},barycoordFromPoint:function(e,t){return console.warn(\"THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().\"),this.getBarycoord(e,t)},midpoint:function(e){return console.warn(\"THREE.Triangle: .midpoint() has been renamed to .getMidpoint().\"),this.getMidpoint(e)},normal:function(e){return console.warn(\"THREE.Triangle: .normal() has been renamed to .getNormal().\"),this.getNormal(e)},plane:function(e){return console.warn(\"THREE.Triangle: .plane() has been renamed to .getPlane().\"),this.getPlane(e)}}),Object.assign(q,{barycoordFromPoint:function(e,t,i,n,r){return console.warn(\"THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord().\"),q.getBarycoord(e,t,i,n,r)},normal:function(e,t,i,n){return console.warn(\"THREE.Triangle: .normal() has been renamed to .getNormal().\"),q.getNormal(e,t,i,n)}}),Object.assign(Vn.prototype,{extractAllPoints:function(e){return console.warn(\"THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.\"),this.extractPoints(e)},extrude:function(e){return console.warn(\"THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.\"),new _i(this,e)},makeGeometry:function(e){return console.warn(\"THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.\"),new Oi(this,e)}}),Object.assign(i.prototype,{fromAttribute:function(e,t,i){return console.warn(\"THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().\"),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn(\"THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().\"),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn(\"THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().\"),this.manhattanLength()}}),Object.assign(o.prototype,{setEulerFromRotationMatrix:function(){console.error(\"THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.\")},setEulerFromQuaternion:function(){console.error(\"THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.\")},getPositionFromMatrix:function(e){return console.warn(\"THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().\"),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn(\"THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().\"),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn(\"THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().\"),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn(\"THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.\"),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn(\"THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().\"),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn(\"THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().\"),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn(\"THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().\"),this.manhattanLength()}}),Object.assign(l.prototype,{fromAttribute:function(e,t,i){return console.warn(\"THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().\"),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn(\"THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().\"),this.manhattanLength()}}),Object.assign(S.prototype,{computeTangents:function(){console.error(\"THREE.Geometry: .computeTangents() has been removed.\")},computeLineDistances:function(){console.error(\"THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.\")}}),Object.assign(_.prototype,{getChildByName:function(e){return console.warn(\"THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().\"),this.getObjectByName(e)},renderDepth:function(){console.warn(\"THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.\")},translate:function(e,t){return console.warn(\"THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.\"),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error(\"THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.\")}}),Object.defineProperties(_.prototype,{eulerOrder:{get:function(){return console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\"),this.rotation.order},set:function(e){console.warn(\"THREE.Object3D: .eulerOrder is now .rotation.order.\"),this.rotation.order=e}},useQuaternion:{get:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")},set:function(){console.warn(\"THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.\")}}}),Object.defineProperties(Ct.prototype,{objects:{get:function(){return console.warn(\"THREE.LOD: .objects has been renamed to .levels.\"),this.levels}}}),Object.defineProperty(Lt.prototype,\"useVertexTexture\",{get:function(){console.warn(\"THREE.Skeleton: useVertexTexture has been removed.\")},set:function(){console.warn(\"THREE.Skeleton: useVertexTexture has been removed.\")}}),Rt.prototype.initBones=function(){console.error(\"THREE.SkinnedMesh: initBones() has been removed.\")},Object.defineProperty(_n.prototype,\"__arcLengthDivisions\",{get:function(){return console.warn(\"THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.\"),this.arcLengthDivisions},set:function(e){console.warn(\"THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.\"),this.arcLengthDivisions=e}}),mt.prototype.setLens=function(e,t){console.warn(\"THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.\"),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(kn.prototype,{onlyShadow:{set:function(){console.warn(\"THREE.Light: .onlyShadow has been removed.\")}},shadowCameraFov:{set:function(e){console.warn(\"THREE.Light: .shadowCameraFov is now .shadow.camera.fov.\"),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn(\"THREE.Light: .shadowCameraLeft is now .shadow.camera.left.\"),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn(\"THREE.Light: .shadowCameraRight is now .shadow.camera.right.\"),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn(\"THREE.Light: .shadowCameraTop is now .shadow.camera.top.\"),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn(\"THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.\"),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn(\"THREE.Light: .shadowCameraNear is now .shadow.camera.near.\"),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn(\"THREE.Light: .shadowCameraFar is now .shadow.camera.far.\"),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn(\"THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.\")}},shadowBias:{set:function(e){console.warn(\"THREE.Light: .shadowBias is now .shadow.bias.\"),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn(\"THREE.Light: .shadowDarkness has been removed.\")}},shadowMapWidth:{set:function(e){console.warn(\"THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.\"),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn(\"THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.\"),this.shadow.mapSize.height=e}}}),Object.defineProperties(T.prototype,{length:{get:function(){return console.warn(\"THREE.BufferAttribute: .length has been deprecated. Use .count instead.\"),this.array.length}},copyIndicesArray:function(){console.error(\"THREE.BufferAttribute: .copyIndicesArray() has been removed.\")}}),Object.assign(D.prototype,{addIndex:function(e){console.warn(\"THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().\"),this.setIndex(e)},addDrawCall:function(e,t,i){void 0!==i&&console.warn(\"THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.\"),console.warn(\"THREE.BufferGeometry: .addDrawCall() is now .addGroup().\"),this.addGroup(e,t)},clearDrawCalls:function(){console.warn(\"THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().\"),this.clearGroups()},computeTangents:function(){console.warn(\"THREE.BufferGeometry: .computeTangents() has been removed.\")},computeOffsets:function(){console.warn(\"THREE.BufferGeometry: .computeOffsets() has been removed.\")}}),Object.defineProperties(D.prototype,{drawcalls:{get:function(){return console.error(\"THREE.BufferGeometry: .drawcalls has been renamed to .groups.\"),this.groups}},offsets:{get:function(){return console.warn(\"THREE.BufferGeometry: .offsets has been renamed to .groups.\"),this.groups}}}),Object.assign(Si.prototype,{getArrays:function(){console.error(\"THREE.ExtrudeBufferGeometry: .getArrays() has been removed.\")},addShapeList:function(){console.error(\"THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.\")},addShape:function(){console.error(\"THREE.ExtrudeBufferGeometry: .addShape() has been removed.\")}}),Object.defineProperties(wr.prototype,{dynamic:{set:function(){console.warn(\"THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.\")}},onUpdate:{value:function(){return console.warn(\"THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.\"),this}}}),Object.defineProperties(U.prototype,{wrapAround:{get:function(){console.warn(\"THREE.Material: .wrapAround has been removed.\")},set:function(){console.warn(\"THREE.Material: .wrapAround has been removed.\")}},overdraw:{get:function(){console.warn(\"THREE.Material: .overdraw has been removed.\")},set:function(){console.warn(\"THREE.Material: .overdraw has been removed.\")}},wrapRGB:{get:function(){return console.warn(\"THREE.Material: .wrapRGB has been removed.\"),new y}},shading:{get:function(){console.error(\"THREE.\"+this.type+\": .shading has been removed. Use the boolean .flatShading instead.\")},set:function(e){console.warn(\"THREE.\"+this.type+\": .shading has been removed. Use the boolean .flatShading instead.\"),this.flatShading=1===e}}}),Object.defineProperties(Yi.prototype,{metal:{get:function(){return console.warn(\"THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.\"),!1},set:function(){console.warn(\"THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead\")}}}),Object.defineProperties(G.prototype,{derivatives:{get:function(){return console.warn(\"THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\"),this.extensions.derivatives},set:function(e){console.warn(\"THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.\"),this.extensions.derivatives=e}}}),Object.assign(bt.prototype,{clearTarget:function(e,t,i,n){console.warn(\"THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead.\"),this.setRenderTarget(e),this.clear(t,i,n)},animate:function(e){console.warn(\"THREE.WebGLRenderer: .animate() is now .setAnimationLoop().\"),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn(\"THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().\"),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn(\"THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().\"),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn(\"THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.\"),this.capabilities.precision},resetGLState:function(){return console.warn(\"THREE.WebGLRenderer: .resetGLState() is now .state.reset().\"),this.state.reset()},supportsFloatTextures:function(){return console.warn(\"THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).\"),this.extensions.get(\"OES_texture_float\")},supportsHalfFloatTextures:function(){return console.warn(\"THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).\"),this.extensions.get(\"OES_texture_half_float\")},supportsStandardDerivatives:function(){return console.warn(\"THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).\"),this.extensions.get(\"OES_standard_derivatives\")},supportsCompressedTextureS3TC:function(){return console.warn(\"THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).\"),this.extensions.get(\"WEBGL_compressed_texture_s3tc\")},supportsCompressedTexturePVRTC:function(){return console.warn(\"THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).\"),this.extensions.get(\"WEBGL_compressed_texture_pvrtc\")},supportsBlendMinMax:function(){return console.warn(\"THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).\"),this.extensions.get(\"EXT_blend_minmax\")},supportsVertexTextures:function(){return console.warn(\"THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.\"),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn(\"THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).\"),this.extensions.get(\"ANGLE_instanced_arrays\")},enableScissorTest:function(e){console.warn(\"THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().\"),this.setScissorTest(e)},initMaterial:function(){console.warn(\"THREE.WebGLRenderer: .initMaterial() has been removed.\")},addPrePlugin:function(){console.warn(\"THREE.WebGLRenderer: .addPrePlugin() has been removed.\")},addPostPlugin:function(){console.warn(\"THREE.WebGLRenderer: .addPostPlugin() has been removed.\")},updateShadowMap:function(){console.warn(\"THREE.WebGLRenderer: .updateShadowMap() has been removed.\")},setFaceCulling:function(){console.warn(\"THREE.WebGLRenderer: .setFaceCulling() has been removed.\")}}),Object.defineProperties(bt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn(\"THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.\"),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn(\"THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.\"),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.\")}}}),Object.defineProperties(ct.prototype,{cullFace:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.\")}},renderReverseSided:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.\")}},renderSingleSided:{get:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.\")},set:function(){console.warn(\"THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.\")}}}),Object.defineProperties(c.prototype,{wrapS:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\"),this.texture.wrapS},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.\"),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\"),this.texture.wrapT},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.\"),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\"),this.texture.magFilter},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.\"),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\"),this.texture.minFilter},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.\"),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\"),this.texture.anisotropy},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.\"),this.texture.anisotropy=e}},offset:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\"),this.texture.offset},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .offset is now .texture.offset.\"),this.texture.offset=e}},repeat:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\"),this.texture.repeat},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .repeat is now .texture.repeat.\"),this.texture.repeat=e}},format:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\"),this.texture.format},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .format is now .texture.format.\"),this.texture.format=e}},type:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\"),this.texture.type},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .type is now .texture.type.\"),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\"),this.texture.generateMipmaps},set:function(e){console.warn(\"THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.\"),this.texture.generateMipmaps=e}}}),Object.defineProperties(yt.prototype,{standing:{set:function(){console.warn(\"THREE.WebVRManager: .standing has been removed.\")}},userHeight:{set:function(){console.warn(\"THREE.WebVRManager: .userHeight has been removed.\")}}}),pr.prototype.load=function(e){console.warn(\"THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.\");var t=this;return(new sr).load(e,(function(e){t.setBuffer(e)})),this},fr.prototype.getData=function(){return console.warn(\"THREE.AudioAnalyser: .getData() is now .getFrequencyData().\"),this.getFrequencyData()},cr.prototype.updateCubeMap=function(e,t){return console.warn(\"THREE.CubeCamera: .updateCubeMap() is now .update().\"),this.update(e,t)},io.crossOrigin=void 0,io.loadTexture=function(e,t,i,n){console.warn(\"THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.\");var r=new En;return r.setCrossOrigin(this.crossOrigin),e=r.load(e,i,void 0,n),t&&(e.mapping=t),e},io.loadTextureCube=function(e,t,i,n){console.warn(\"THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.\");var r=new Mn;return r.setCrossOrigin(this.crossOrigin),e=r.load(e,i,void 0,n),t&&(e.mapping=t),e},io.loadCompressedTexture=function(){console.error(\"THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.\")},io.loadCompressedTextureCube=function(){console.error(\"THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.\")},e.WebGLRenderTargetCube=h,e.WebGLRenderTarget=c,e.WebGLRenderer=bt,e.ShaderLib=lo,e.UniformsLib=so,e.UniformsUtils=oo,e.ShaderChunk=ro,e.FogExp2=wt,e.Fog=Mt,e.Scene=Et,e.Sprite=At,e.LOD=Ct,e.SkinnedMesh=Rt,e.Skeleton=Lt,e.Bone=Pt,e.Mesh=X,e.LineSegments=zt,e.LineLoop=Ot,e.Line=Bt,e.Points=It,e.Group=dt,e.VideoTexture=Dt,e.DataTexture=u,e.DataTexture3D=se,e.CompressedTexture=Ht,e.CubeTexture=ae,e.CanvasTexture=jt,e.DepthTexture=Vt,e.Texture=s,e.AnimationLoader=yn,e.CompressedTextureLoader=xn,e.DataTextureLoader=bn,e.CubeTextureLoader=Mn,e.TextureLoader=En,e.ObjectLoader=tr,e.MaterialLoader=$n,e.BufferGeometryLoader=er,e.DefaultLoadingManager=Oo,e.LoadingManager=gn,e.ImageLoader=wn,e.ImageBitmapLoader=ir,e.FontLoader=or,e.FileLoader=vn,e.Loader=ar,e.LoaderUtils=ko,e.Cache=zo,e.AudioLoader=sr,e.SpotLightShadow=Wn,e.SpotLight=qn,e.PointLight=Qn,e.RectAreaLight=Kn,e.HemisphereLight=Un,e.DirectionalLightShadow=Yn,e.DirectionalLight=Zn,e.AmbientLight=Jn,e.LightShadow=Gn,e.Light=kn,e.StereoCamera=lr,e.PerspectiveCamera=mt,e.OrthographicCamera=Xn,e.CubeCamera=cr,e.ArrayCamera=gt,e.Camera=ft,e.AudioListener=ur,e.PositionalAudio=dr,e.AudioContext=Zo,e.AudioAnalyser=fr,e.Audio=pr,e.VectorKeyframeTrack=dn,e.StringKeyframeTrack=pn,e.QuaternionKeyframeTrack=un,e.NumberKeyframeTrack=cn,e.ColorKeyframeTrack=ln,e.BooleanKeyframeTrack=sn,e.PropertyMixer=mr,e.PropertyBinding=vr,e.KeyframeTrack=an,e.AnimationUtils=Bo,e.AnimationObjectGroup=yr,e.AnimationMixer=br,e.AnimationClip=fn,e.Uniform=wr,e.InstancedBufferGeometry=Mr,e.BufferGeometry=D,e.Geometry=S,e.InterleavedBufferAttribute=St,e.InstancedInterleavedBuffer=Er,e.InterleavedBuffer=_t,e.InstancedBufferAttribute=_r,e.Face3=w,e.Object3D=_,e.Raycaster=Sr,e.Layers=E,e.EventDispatcher=t,e.Clock=hr,e.QuaternionLinearInterpolant=hn,e.LinearInterpolant=rn,e.DiscreteInterpolant=on,e.CubicInterpolant=nn,e.Interpolant=tn,e.Triangle=q,e.Math=eo,e.Spherical=Cr,e.Cylindrical=Rr,e.Plane=f,e.Frustum=m,e.Sphere=d,e.Ray=W,e.Matrix4=n,e.Matrix3=a,e.Box3=p,e.Box2=Lr,e.Line3=Pr,e.Euler=M,e.Vector4=l,e.Vector3=o,e.Vector2=i,e.Quaternion=r,e.Color=y,e.ImmediateRenderObject=Nr,e.VertexNormalsHelper=Br,e.SpotLightHelper=zr,e.SkeletonHelper=Or,e.PointLightHelper=Fr,e.RectAreaLightHelper=Ir,e.HemisphereLightHelper=Dr,e.GridHelper=Hr,e.PolarGridHelper=jr,e.FaceNormalsHelper=Vr,e.DirectionalLightHelper=kr,e.CameraHelper=Ur,e.BoxHelper=Gr,e.Box3Helper=Wr,e.PlaneHelper=qr,e.ArrowHelper=Qr,e.AxesHelper=Xr,e.Shape=Vn,e.Path=jn,e.ShapePath=nr,e.Font=rr,e.CurvePath=Hn,e.Curve=_n,e.ImageUtils=io,e.ShapeUtils=Ro,e.WebGLUtils=pt,e.WireframeGeometry=kt,e.ParametricGeometry=Ut,e.ParametricBufferGeometry=Gt,e.TetrahedronGeometry=Qt,e.TetrahedronBufferGeometry=Xt,e.OctahedronGeometry=Yt,e.OctahedronBufferGeometry=Zt,e.IcosahedronGeometry=Jt,e.IcosahedronBufferGeometry=Kt,e.DodecahedronGeometry=$t,e.DodecahedronBufferGeometry=ei,e.PolyhedronGeometry=Wt,e.PolyhedronBufferGeometry=qt,e.TubeGeometry=ti,e.TubeBufferGeometry=ii,e.TorusKnotGeometry=ni,e.TorusKnotBufferGeometry=ri,e.TorusGeometry=oi,e.TorusBufferGeometry=ai,e.TextGeometry=Ai,e.TextBufferGeometry=Ci,e.SphereGeometry=Ri,e.SphereBufferGeometry=Li,e.RingGeometry=Pi,e.RingBufferGeometry=Ni,e.PlaneGeometry=V,e.PlaneBufferGeometry=k,e.LatheGeometry=Bi,e.LatheBufferGeometry=zi,e.ShapeGeometry=Oi,e.ShapeBufferGeometry=Fi,e.ExtrudeGeometry=_i,e.ExtrudeBufferGeometry=Si,e.EdgesGeometry=Di,e.ConeGeometry=Vi,e.ConeBufferGeometry=ki,e.CylinderGeometry=Hi,e.CylinderBufferGeometry=ji,e.CircleGeometry=Ui,e.CircleBufferGeometry=Gi,e.BoxGeometry=H,e.BoxBufferGeometry=j,e.ShadowMaterial=Wi,e.SpriteMaterial=Tt,e.RawShaderMaterial=qi,e.ShaderMaterial=G,e.PointsMaterial=Ft,e.MeshPhysicalMaterial=Xi,e.MeshStandardMaterial=Qi,e.MeshPhongMaterial=Yi,e.MeshToonMaterial=Zi,e.MeshNormalMaterial=Ji,e.MeshLambertMaterial=Ki,e.MeshDepthMaterial=st,e.MeshDistanceMaterial=lt,e.MeshBasicMaterial=Q,e.MeshMatcapMaterial=$i,e.LineDashedMaterial=en,e.LineBasicMaterial=Nt,e.Material=U,e.Float64BufferAttribute=O,e.Float32BufferAttribute=z,e.Uint32BufferAttribute=B,e.Int32BufferAttribute=N,e.Uint16BufferAttribute=P,e.Int16BufferAttribute=L,e.Uint8ClampedBufferAttribute=R,e.Uint8BufferAttribute=C,e.Int8BufferAttribute=A,e.BufferAttribute=T,e.ArcCurve=Tn,e.CatmullRomCurve3=Cn,e.CubicBezierCurve=Nn,e.CubicBezierCurve3=Bn,e.EllipseCurve=Sn,e.LineCurve=zn,e.LineCurve3=On,e.QuadraticBezierCurve=Fn,e.QuadraticBezierCurve3=In,e.SplineCurve=Dn,e.REVISION=\"100\",e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.MinEquation=103,e.MaxEquation=104,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.NeverDepth=0,e.AlwaysDepth=1,e.LessDepth=2,e.LessEqualDepth=3,e.EqualDepth=4,e.GreaterEqualDepth=5,e.GreaterDepth=6,e.NotEqualDepth=7,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.NoToneMapping=0,e.LinearToneMapping=1,e.ReinhardToneMapping=2,e.Uncharted2ToneMapping=3,e.CineonToneMapping=4,e.ACESFilmicToneMapping=5,e.UVMapping=300,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.SphericalReflectionMapping=305,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.RepeatWrapping=1e3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.HalfFloatType=1016,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedInt248Type=1020,e.AlphaFormat=1021,e.RGBFormat=1022,e.RGBAFormat=1023,e.LuminanceFormat=1024,e.LuminanceAlphaFormat=1025,e.RGBEFormat=1023,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.RedFormat=1028,e.RGB_S3TC_DXT1_Format=33776,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGB_ETC1_Format=36196,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.LoopOnce=2200,e.LoopRepeat=2201,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=2400,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=0,e.TriangleStripDrawMode=1,e.TriangleFanDrawMode=2,e.LinearEncoding=3e3,e.sRGBEncoding=3001,e.GammaEncoding=3007,e.RGBEEncoding=3002,e.LogLuvEncoding=3003,e.RGBM7Encoding=3004,e.RGBM16Encoding=3005,e.RGBDEncoding=3006,e.BasicDepthPacking=3200,e.RGBADepthPacking=3201,e.TangentSpaceNormalMap=0,e.ObjectSpaceNormalMap=1,e.CubeGeometry=H,e.Face4=function(e,t,i,n,r,o,a){return console.warn(\"THREE.Face4 has been removed. A THREE.Face3 will be created instead.\"),new w(e,t,i,r,o,a)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn(\"THREE.MeshFaceMaterial has been removed. Use an Array instead.\"),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn(\"THREE.MultiMaterial has been removed. Use an Array instead.\"),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.PointCloud=function(e,t){return console.warn(\"THREE.PointCloud has been renamed to THREE.Points.\"),new It(e,t)},e.Particle=function(e){return console.warn(\"THREE.Particle has been renamed to THREE.Sprite.\"),new At(e)},e.ParticleSystem=function(e,t){return console.warn(\"THREE.ParticleSystem has been renamed to THREE.Points.\"),new It(e,t)},e.PointCloudMaterial=function(e){return console.warn(\"THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.\"),new Ft(e)},e.ParticleBasicMaterial=function(e){return console.warn(\"THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.\"),new Ft(e)},e.ParticleSystemMaterial=function(e){return console.warn(\"THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.\"),new Ft(e)},e.Vertex=function(e,t,i){return console.warn(\"THREE.Vertex has been removed. Use THREE.Vector3 instead.\"),new o(e,t,i)},e.DynamicBufferAttribute=function(e,t){return console.warn(\"THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.\"),new T(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn(\"THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.\"),new A(e,t)},e.Uint8Attribute=function(e,t){return console.warn(\"THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.\"),new C(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn(\"THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.\"),new R(e,t)},e.Int16Attribute=function(e,t){return console.warn(\"THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.\"),new L(e,t)},e.Uint16Attribute=function(e,t){return console.warn(\"THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.\"),new P(e,t)},e.Int32Attribute=function(e,t){return console.warn(\"THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.\"),new N(e,t)},e.Uint32Attribute=function(e,t){return console.warn(\"THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.\"),new B(e,t)},e.Float32Attribute=function(e,t){return console.warn(\"THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.\"),new z(e,t)},e.Float64Attribute=function(e,t){return console.warn(\"THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.\"),new O(e,t)},e.ClosedSplineCurve3=Yr,e.SplineCurve3=Zr,e.Spline=Jr,e.AxisHelper=function(e){return console.warn(\"THREE.AxisHelper has been renamed to THREE.AxesHelper.\"),new Xr(e)},e.BoundingBoxHelper=function(e,t){return console.warn(\"THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.\"),new Gr(e,t)},e.EdgesHelper=function(e,t){return console.warn(\"THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.\"),new zt(new Di(e.geometry),new Nt({color:void 0!==t?t:16777215}))},e.WireframeHelper=function(e,t){return console.warn(\"THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.\"),new zt(new kt(e.geometry),new Nt({color:void 0!==t?t:16777215}))},e.XHRLoader=function(e){return console.warn(\"THREE.XHRLoader has been renamed to THREE.FileLoader.\"),new vn(e)},e.BinaryTextureLoader=function(e){return console.warn(\"THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.\"),new bn(e)},e.GeometryUtils={merge:function(e,t,i){if(console.warn(\"THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.\"),t.isMesh){t.matrixAutoUpdate&&t.updateMatrix();var n=t.matrix;t=t.geometry}e.merge(t,n,i)},center:function(e){return console.warn(\"THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.\"),e.center()}},e.Projector=function(){console.error(\"THREE.Projector has been moved to /examples/js/renderers/Projector.js.\"),this.projectVector=function(e,t){console.warn(\"THREE.Projector: .projectVector() is now vector.project().\"),e.project(t)},this.unprojectVector=function(e,t){console.warn(\"THREE.Projector: .unprojectVector() is now vector.unproject().\"),e.unproject(t)},this.pickingRay=function(){console.error(\"THREE.Projector: .pickingRay() is now raycaster.setFromCamera().\")}},e.CanvasRenderer=function(){console.error(\"THREE.CanvasRenderer has been removed\")},e.JSONLoader=function(){console.error(\"THREE.JSONLoader has been removed.\")},e.SceneUtils={createMultiMaterialObject:function(){console.error(\"THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js\")},detach:function(){console.error(\"THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js\")},attach:function(){console.error(\"THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js\")}},e.LensFlare=function(){console.error(\"THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js\")},Object.defineProperty(e,\"__esModule\",{value:!0})}(t)},function(e,t,i){e.exports=function e(t,i,n){function r(a,s){if(!i[a]){if(!t[a]){if(o)return o(a,!0);throw new Error(\"Cannot find module '\"+a+\"'\")}var l=i[a]={exports:{}};t[a][0].call(l.exports,(function(e){var i=t[a][1][e];return r(i||e)}),l,l.exports,e,t,i,n)}return i[a].exports}for(var o=!1,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(e,t){t.exports={name:\"cannon\",version:\"0.6.2\",description:\"A lightweight 3D physics engine written in JavaScript.\",homepage:\"https://github.com/schteppe/cannon.js\",author:\"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)\",keywords:[\"cannon.js\",\"cannon\",\"physics\",\"engine\",\"3d\"],main:\"./build/cannon.js\",engines:{node:\"*\"},repository:{type:\"git\",url:\"https://github.com/schteppe/cannon.js.git\"},bugs:{url:\"https://github.com/schteppe/cannon.js/issues\"},licenses:[{type:\"MIT\"}],devDependencies:{jshint:\"latest\",\"uglify-js\":\"latest\",nodeunit:\"^0.9.0\",grunt:\"~0.4.0\",\"grunt-contrib-jshint\":\"~0.1.1\",\"grunt-contrib-nodeunit\":\"^0.4.1\",\"grunt-contrib-concat\":\"~0.1.3\",\"grunt-contrib-uglify\":\"^0.5.1\",\"grunt-browserify\":\"^2.1.4\",\"grunt-contrib-yuidoc\":\"^0.5.2\",browserify:\"*\"},dependencies:{}}},{}],2:[function(e,t){t.exports={version:e(\"../package.json\").version,AABB:e(\"./collision/AABB\"),ArrayCollisionMatrix:e(\"./collision/ArrayCollisionMatrix\"),Body:e(\"./objects/Body\"),Box:e(\"./shapes/Box\"),Broadphase:e(\"./collision/Broadphase\"),Constraint:e(\"./constraints/Constraint\"),ContactEquation:e(\"./equations/ContactEquation\"),Narrowphase:e(\"./world/Narrowphase\"),ConeTwistConstraint:e(\"./constraints/ConeTwistConstraint\"),ContactMaterial:e(\"./material/ContactMaterial\"),ConvexPolyhedron:e(\"./shapes/ConvexPolyhedron\"),Cylinder:e(\"./shapes/Cylinder\"),DistanceConstraint:e(\"./constraints/DistanceConstraint\"),Equation:e(\"./equations/Equation\"),EventTarget:e(\"./utils/EventTarget\"),FrictionEquation:e(\"./equations/FrictionEquation\"),GSSolver:e(\"./solver/GSSolver\"),GridBroadphase:e(\"./collision/GridBroadphase\"),Heightfield:e(\"./shapes/Heightfield\"),HingeConstraint:e(\"./constraints/HingeConstraint\"),LockConstraint:e(\"./constraints/LockConstraint\"),Mat3:e(\"./math/Mat3\"),Material:e(\"./material/Material\"),NaiveBroadphase:e(\"./collision/NaiveBroadphase\"),ObjectCollisionMatrix:e(\"./collision/ObjectCollisionMatrix\"),Pool:e(\"./utils/Pool\"),Particle:e(\"./shapes/Particle\"),Plane:e(\"./shapes/Plane\"),PointToPointConstraint:e(\"./constraints/PointToPointConstraint\"),Quaternion:e(\"./math/Quaternion\"),Ray:e(\"./collision/Ray\"),RaycastVehicle:e(\"./objects/RaycastVehicle\"),RaycastResult:e(\"./collision/RaycastResult\"),RigidVehicle:e(\"./objects/RigidVehicle\"),RotationalEquation:e(\"./equations/RotationalEquation\"),RotationalMotorEquation:e(\"./equations/RotationalMotorEquation\"),SAPBroadphase:e(\"./collision/SAPBroadphase\"),SPHSystem:e(\"./objects/SPHSystem\"),Shape:e(\"./shapes/Shape\"),Solver:e(\"./solver/Solver\"),Sphere:e(\"./shapes/Sphere\"),SplitSolver:e(\"./solver/SplitSolver\"),Spring:e(\"./objects/Spring\"),Trimesh:e(\"./shapes/Trimesh\"),Vec3:e(\"./math/Vec3\"),Vec3Pool:e(\"./utils/Vec3Pool\"),World:e(\"./world/World\")}},{\"../package.json\":1,\"./collision/AABB\":3,\"./collision/ArrayCollisionMatrix\":4,\"./collision/Broadphase\":5,\"./collision/GridBroadphase\":6,\"./collision/NaiveBroadphase\":7,\"./collision/ObjectCollisionMatrix\":8,\"./collision/Ray\":9,\"./collision/RaycastResult\":10,\"./collision/SAPBroadphase\":11,\"./constraints/ConeTwistConstraint\":12,\"./constraints/Constraint\":13,\"./constraints/DistanceConstraint\":14,\"./constraints/HingeConstraint\":15,\"./constraints/LockConstraint\":16,\"./constraints/PointToPointConstraint\":17,\"./equations/ContactEquation\":19,\"./equations/Equation\":20,\"./equations/FrictionEquation\":21,\"./equations/RotationalEquation\":22,\"./equations/RotationalMotorEquation\":23,\"./material/ContactMaterial\":24,\"./material/Material\":25,\"./math/Mat3\":27,\"./math/Quaternion\":28,\"./math/Vec3\":30,\"./objects/Body\":31,\"./objects/RaycastVehicle\":32,\"./objects/RigidVehicle\":33,\"./objects/SPHSystem\":34,\"./objects/Spring\":35,\"./shapes/Box\":37,\"./shapes/ConvexPolyhedron\":38,\"./shapes/Cylinder\":39,\"./shapes/Heightfield\":40,\"./shapes/Particle\":41,\"./shapes/Plane\":42,\"./shapes/Shape\":43,\"./shapes/Sphere\":44,\"./shapes/Trimesh\":45,\"./solver/GSSolver\":46,\"./solver/Solver\":47,\"./solver/SplitSolver\":48,\"./utils/EventTarget\":49,\"./utils/Pool\":51,\"./utils/Vec3Pool\":54,\"./world/Narrowphase\":55,\"./world/World\":56}],3:[function(e,t){function i(e){e=e||{},this.lowerBound=new n,e.lowerBound&&this.lowerBound.copy(e.lowerBound),this.upperBound=new n,e.upperBound&&this.upperBound.copy(e.upperBound)}var n=e(\"../math/Vec3\");e(\"../utils/Utils\"),t.exports=i;var r=new n;i.prototype.setFromPoints=function(e,t,i,n){var o=this.lowerBound,a=this.upperBound,s=i;o.copy(e[0]),s&&s.vmult(o,o),a.copy(o);for(var l=1;l<e.length;l++){var c=e[l];s&&(s.vmult(c,r),c=r),c.x>a.x&&(a.x=c.x),c.x<o.x&&(o.x=c.x),c.y>a.y&&(a.y=c.y),c.y<o.y&&(o.y=c.y),c.z>a.z&&(a.z=c.z),c.z<o.z&&(o.z=c.z)}return t&&(t.vadd(o,o),t.vadd(a,a)),n&&(o.x-=n,o.y-=n,o.z-=n,a.x+=n,a.y+=n,a.z+=n),this},i.prototype.copy=function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this},i.prototype.clone=function(){return(new i).copy(this)},i.prototype.extend=function(e){var t=e.lowerBound.x;this.lowerBound.x>t&&(this.lowerBound.x=t);var i=e.upperBound.x;this.upperBound.x<i&&(this.upperBound.x=i),t=e.lowerBound.y,this.lowerBound.y>t&&(this.lowerBound.y=t),i=e.upperBound.y,this.upperBound.y<i&&(this.upperBound.y=i),t=e.lowerBound.z,this.lowerBound.z>t&&(this.lowerBound.z=t),i=e.upperBound.z,this.upperBound.z<i&&(this.upperBound.z=i)},i.prototype.overlaps=function(e){var t=this.lowerBound,i=this.upperBound,n=e.lowerBound,r=e.upperBound;return(n.x<=i.x&&i.x<=r.x||t.x<=r.x&&r.x<=i.x)&&(n.y<=i.y&&i.y<=r.y||t.y<=r.y&&r.y<=i.y)&&(n.z<=i.z&&i.z<=r.z||t.z<=r.z&&r.z<=i.z)},i.prototype.contains=function(e){var t=this.lowerBound,i=this.upperBound,n=e.lowerBound,r=e.upperBound;return t.x<=n.x&&i.x>=r.x&&t.y<=n.y&&i.y>=r.y&&t.z<=n.z&&i.z>=r.z},i.prototype.getCorners=function(e,t,i,n,r,o,a,s){var l=this.lowerBound,c=this.upperBound;e.copy(l),t.set(c.x,l.y,l.z),i.set(c.x,c.y,l.z),n.set(l.x,c.y,c.z),r.set(c.x,l.y,l.z),o.set(l.x,c.y,l.z),a.set(l.x,l.y,c.z),s.copy(c)};var o=[new n,new n,new n,new n,new n,new n,new n,new n];i.prototype.toLocalFrame=function(e,t){var i=o,n=i[0],r=i[1],a=i[2],s=i[3],l=i[4],c=i[5],h=i[6],u=i[7];this.getCorners(n,r,a,s,l,c,h,u);for(var p=0;8!==p;p++){var d=i[p];e.pointToLocal(d,d)}return t.setFromPoints(i)},i.prototype.toWorldFrame=function(e,t){var i=o,n=i[0],r=i[1],a=i[2],s=i[3],l=i[4],c=i[5],h=i[6],u=i[7];this.getCorners(n,r,a,s,l,c,h,u);for(var p=0;8!==p;p++){var d=i[p];e.pointToWorld(d,d)}return t.setFromPoints(i)}},{\"../math/Vec3\":30,\"../utils/Utils\":53}],4:[function(e,t){function i(){this.matrix=[]}t.exports=i,i.prototype.get=function(e,t){if(e=e.index,(t=t.index)>e){var i=t;t=e,e=i}return this.matrix[(e*(e+1)>>1)+t-1]},i.prototype.set=function(e,t,i){if(e=e.index,(t=t.index)>e){var n=t;t=e,e=n}this.matrix[(e*(e+1)>>1)+t-1]=i?1:0},i.prototype.reset=function(){for(var e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0},i.prototype.setNumObjects=function(e){this.matrix.length=e*(e-1)>>1}},{}],5:[function(e,t){function i(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var n=e(\"../objects/Body\"),r=e(\"../math/Vec3\"),o=e(\"../math/Quaternion\");e(\"../shapes/Shape\"),e(\"../shapes/Plane\"),t.exports=i,i.prototype.collisionPairs=function(){throw new Error(\"collisionPairs not implemented for this BroadPhase class!\")};var a=n.STATIC|n.KINEMATIC;i.prototype.needBroadphaseCollision=function(e,t){return 0!=(e.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&e.collisionFilterMask)&&(0==(e.type&a)&&e.sleepState!==n.SLEEPING||0==(t.type&a)&&t.sleepState!==n.SLEEPING)},i.prototype.intersectionTest=function(e,t,i,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,i,n):this.doBoundingSphereBroadphase(e,t,i,n)};var s=new r;new r,new o,new r,i.prototype.doBoundingSphereBroadphase=function(e,t,i,n){var r=s;t.position.vsub(e.position,r),Math.pow(e.boundingRadius+t.boundingRadius,2)>r.norm2()&&(i.push(e),n.push(t))},i.prototype.doBoundingBoxBroadphase=function(e,t,i,n){e.aabbNeedsUpdate&&e.computeAABB(),t.aabbNeedsUpdate&&t.computeAABB(),e.aabb.overlaps(t.aabb)&&(i.push(e),n.push(t))};var l={keys:[]},c=[],h=[];i.prototype.makePairsUnique=function(e,t){for(var i=l,n=c,r=h,o=e.length,a=0;a!==o;a++)n[a]=e[a],r[a]=t[a];for(e.length=0,t.length=0,a=0;a!==o;a++){var s=n[a].id,u=r[a].id;i[p=u>s?s+\",\"+u:u+\",\"+s]=a,i.keys.push(p)}for(a=0;a!==i.keys.length;a++){var p=i.keys.pop(),d=i[p];e.push(n[d]),t.push(r[d]),delete i[p]}},i.prototype.setWorld=function(){};var u=new r;i.boundingSphereCheck=function(e,t){var i=u;return e.position.vsub(t.position,i),Math.pow(e.shape.boundingSphereRadius+t.shape.boundingSphereRadius,2)>i.norm2()},i.prototype.aabbQuery=function(){return console.warn(\".aabbQuery is not implemented in this Broadphase subclass.\"),[]}},{\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/Body\":31,\"../shapes/Plane\":42,\"../shapes/Shape\":43}],6:[function(e,t){function i(e,t,i,o,a){n.apply(this),this.nx=i||10,this.ny=o||10,this.nz=a||10,this.aabbMin=e||new r(100,100,100),this.aabbMax=t||new r(-100,-100,-100);var s=this.nx*this.ny*this.nz;if(0>=s)throw\"GridBroadphase: Each dimension's n must be >0\";this.bins=[],this.binLengths=[],this.bins.length=s,this.binLengths.length=s;for(var l=0;s>l;l++)this.bins[l]=[],this.binLengths[l]=0}t.exports=i;var n=e(\"./Broadphase\"),r=e(\"../math/Vec3\"),o=e(\"../shapes/Shape\");i.prototype=new n,i.prototype.constructor=i;var a=new r;new r,i.prototype.collisionPairs=function(e,t,i){function n(e,t,i,n,r,o,a){var s=(e-x)*M|0,l=(t-b)*E|0,c=(i-w)*_|0,g=F((n-x)*M),v=F((r-b)*E),y=F((o-w)*_);0>s?s=0:s>=h&&(s=h-1),0>l?l=0:l>=u&&(l=u-1),0>c?c=0:c>=p&&(c=p-1),0>g?g=0:g>=h&&(g=h-1),0>v?v=0:v>=u&&(v=u-1),0>y?y=0:y>=p&&(y=p-1),l*=f,c*=m,g*=d,v*=f,y*=m;for(var S=s*=d;g>=S;S+=d)for(var T=l;v>=T;T+=f)for(var A=c;y>=A;A+=m){var C=S+T+A;N[C][B[C]++]=a}}for(var r=e.numObjects(),s=e.bodies,l=this.aabbMax,c=this.aabbMin,h=this.nx,u=this.ny,p=this.nz,d=u*p,f=p,m=1,g=l.x,v=l.y,y=l.z,x=c.x,b=c.y,w=c.z,M=h/(g-x),E=u/(v-b),_=p/(y-w),S=(g-x)/h,T=(v-b)/u,A=(y-w)/p,C=.5*Math.sqrt(S*S+T*T+A*A),R=o.types,L=R.SPHERE,P=R.PLANE,N=(R.BOX,R.COMPOUND,R.CONVEXPOLYHEDRON,this.bins),B=this.binLengths,z=this.bins.length,O=0;O!==z;O++)B[O]=0;var F=Math.ceil;for(c=Math.min,l=Math.max,O=0;O!==r;O++){var I=(ie=s[O]).shape;switch(I.type){case L:var D=ie.position.x,H=ie.position.y,j=ie.position.z,V=I.radius;n(D-V,H-V,j-V,D+V,H+V,j+V,ie);break;case P:I.worldNormalNeedsUpdate&&I.computeWorldNormal(ie.quaternion);var k=I.worldNormal,U=x+.5*S-ie.position.x,G=b+.5*T-ie.position.y,W=w+.5*A-ie.position.z,q=a;q.set(U,G,W);for(var Q=0,X=0;Q!==h;Q++,X+=d,q.y=G,q.x+=S)for(var Y=0,Z=0;Y!==u;Y++,Z+=f,q.z=W,q.y+=T)for(var J=0,K=0;J!==p;J++,K+=m,q.z+=A)if(q.dot(k)<C){var $=X+Z+K;N[$][B[$]++]=ie}break;default:ie.aabbNeedsUpdate&&ie.computeAABB(),n(ie.aabb.lowerBound.x,ie.aabb.lowerBound.y,ie.aabb.lowerBound.z,ie.aabb.upperBound.x,ie.aabb.upperBound.y,ie.aabb.upperBound.z,ie)}}for(O=0;O!==z;O++){var ee=B[O];if(ee>1){var te=N[O];for(Q=0;Q!==ee;Q++){var ie=te[Q];for(Y=0;Y!==Q;Y++){var ne=te[Y];this.needBroadphaseCollision(ie,ne)&&this.intersectionTest(ie,ne,t,i)}}}}this.makePairsUnique(t,i)}},{\"../math/Vec3\":30,\"../shapes/Shape\":43,\"./Broadphase\":5}],7:[function(e,t){function i(){n.apply(this)}t.exports=i;var n=e(\"./Broadphase\"),r=e(\"./AABB\");i.prototype=new n,i.prototype.constructor=i,i.prototype.collisionPairs=function(e,t,i){var n,r,o,a,s=e.bodies,l=s.length;for(n=0;n!==l;n++)for(r=0;r!==n;r++)o=s[n],a=s[r],this.needBroadphaseCollision(o,a)&&this.intersectionTest(o,a,t,i)},new r,i.prototype.aabbQuery=function(e,t,i){i=i||[];for(var n=0;n<e.bodies.length;n++){var r=e.bodies[n];r.aabbNeedsUpdate&&r.computeAABB(),r.aabb.overlaps(t)&&i.push(r)}return i}},{\"./AABB\":3,\"./Broadphase\":5}],8:[function(e,t){function i(){this.matrix={}}t.exports=i,i.prototype.get=function(e,t){if(e=e.id,(t=t.id)>e){var i=t;t=e,e=i}return e+\"-\"+t in this.matrix},i.prototype.set=function(e,t,i){if(e=e.id,(t=t.id)>e){var n=t;t=e,e=n}i?this.matrix[e+\"-\"+t]=!0:delete this.matrix[e+\"-\"+t]},i.prototype.reset=function(){this.matrix={}},i.prototype.setNumObjects=function(){}},{}],9:[function(e,t){function i(e,t){this.from=e?e.clone():new r,this.to=t?t.clone():new r,this._direction=new r,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=i.ANY,this.result=new s,this.hasHit=!1,this.callback=function(){}}function n(e,t,i,n){n.vsub(t,B),i.vsub(t,p),e.vsub(t,d);var r,o,a=B.dot(B),s=B.dot(p),l=B.dot(d),c=p.dot(p),h=p.dot(d);return(r=c*l-s*h)>=0&&(o=a*h-s*l)>=0&&a*c-s*s>r+o}t.exports=i;var r=e(\"../math/Vec3\"),o=e(\"../math/Quaternion\"),a=e(\"../math/Transform\"),s=(e(\"../shapes/ConvexPolyhedron\"),e(\"../shapes/Box\"),e(\"../collision/RaycastResult\")),l=e(\"../shapes/Shape\"),c=e(\"../collision/AABB\");i.prototype.constructor=i,i.CLOSEST=1,i.ANY=2,i.ALL=4;var h=new c,u=[];i.prototype.intersectWorld=function(e,t){return this.mode=t.mode||i.ANY,this.result=t.result||new s,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(h),u.length=0,e.broadphase.aabbQuery(e,h,u),this.intersectBodies(u),this.hasHit};var p=new r,d=new r;i.pointInTriangle=n;var f=new r,m=new o;i.prototype.intersectBody=function(e,t){t&&(this.result=t,this._updateDirection());var i=this.checkCollisionResponse;if((!i||e.collisionResponse)&&0!=(this.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&this.collisionFilterMask))for(var n=f,r=m,o=0,a=e.shapes.length;a>o;o++){var s=e.shapes[o];if((!i||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],r),e.quaternion.vmult(e.shapeOffsets[o],n),n.vadd(e.position,n),this.intersectShape(s,r,n,e),this.result._shouldStop))break}},i.prototype.intersectBodies=function(e,t){t&&(this.result=t,this._updateDirection());for(var i=0,n=e.length;!this.result._shouldStop&&n>i;i++)this.intersectBody(e[i])},i.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},i.prototype.intersectShape=function(e,t,i,n){if(!(function(e,t,i){i.vsub(e,B);var n=B.dot(t);return t.mult(n,z),z.vadd(e,z),i.distanceTo(z)}(this.from,this._direction,i)>e.boundingSphereRadius)){var r=this[e.type];r&&r.call(this,e,t,i,n)}};var g=(new r,new r,new r),v=new r,y=new r,x=new r;new r,new s,i.prototype.intersectBox=function(e,t,i,n){return this.intersectConvex(e.convexPolyhedronRepresentation,t,i,n)},i.prototype[l.types.BOX]=i.prototype.intersectBox,i.prototype.intersectPlane=function(e,t,i,n){var o=this.from,a=this.to,s=this._direction,l=new r(0,0,1);t.vmult(l,l);var c=new r;o.vsub(i,c);var h=c.dot(l);if(a.vsub(i,c),!(h*c.dot(l)>0||o.distanceTo(a)<h)){var u=l.dot(s);if(!(Math.abs(u)<this.precision)){var p=new r,d=new r,f=new r;o.vsub(i,p);var m=-l.dot(p)/u;s.scale(m,d),o.vadd(d,f),this.reportIntersection(l,f,e,n,-1)}}},i.prototype[l.types.PLANE]=i.prototype.intersectPlane,i.prototype.getAABB=function(e){var t=this.to,i=this.from;e.lowerBound.x=Math.min(t.x,i.x),e.lowerBound.y=Math.min(t.y,i.y),e.lowerBound.z=Math.min(t.z,i.z),e.upperBound.x=Math.max(t.x,i.x),e.upperBound.y=Math.max(t.y,i.y),e.upperBound.z=Math.max(t.z,i.z)};var b={faceList:[0]};i.prototype.intersectHeightfield=function(e,t,n,o){var s=(e.data,e.elementSize,new r),l=new i(this.from,this.to);a.pointToLocalFrame(n,t,l.from,l.from),a.pointToLocalFrame(n,t,l.to,l.to);var c=[],h=null,u=null,p=null,d=null,f=e.getIndexOfPosition(l.from.x,l.from.y,c,!1);if(f&&(h=c[0],u=c[1],p=c[0],d=c[1]),(f=e.getIndexOfPosition(l.to.x,l.to.y,c,!1))&&((null===h||c[0]<h)&&(h=c[0]),(null===p||c[0]>p)&&(p=c[0]),(null===u||c[1]<u)&&(u=c[1]),(null===d||c[1]>d)&&(d=c[1])),null!==h){var m=[];e.getRectMinMax(h,u,p,d,m);for(var g=h;p>=g;g++)for(var v=u;d>=v;v++){if(this.result._shouldStop)return;if(e.getConvexTrianglePillar(g,v,!1),a.pointToWorldFrame(n,t,e.pillarOffset,s),this.intersectConvex(e.pillarConvex,t,s,o,b),this.result._shouldStop)return;e.getConvexTrianglePillar(g,v,!0),a.pointToWorldFrame(n,t,e.pillarOffset,s),this.intersectConvex(e.pillarConvex,t,s,o,b)}}},i.prototype[l.types.HEIGHTFIELD]=i.prototype.intersectHeightfield;var w=new r,M=new r;i.prototype.intersectSphere=function(e,t,i,n){var r=this.from,o=this.to,a=e.radius,s=Math.pow(o.x-r.x,2)+Math.pow(o.y-r.y,2)+Math.pow(o.z-r.z,2),l=2*((o.x-r.x)*(r.x-i.x)+(o.y-r.y)*(r.y-i.y)+(o.z-r.z)*(r.z-i.z)),c=Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)+Math.pow(r.z-i.z,2)-Math.pow(a,2),h=Math.pow(l,2)-4*s*c,u=w,p=M;if(!(0>h))if(0===h)r.lerp(o,h,u),u.vsub(i,p),p.normalize(),this.reportIntersection(p,u,e,n,-1);else{var d=(-l-Math.sqrt(h))/(2*s),f=(-l+Math.sqrt(h))/(2*s);if(d>=0&&1>=d&&(r.lerp(o,d,u),u.vsub(i,p),p.normalize(),this.reportIntersection(p,u,e,n,-1)),this.result._shouldStop)return;f>=0&&1>=f&&(r.lerp(o,f,u),u.vsub(i,p),p.normalize(),this.reportIntersection(p,u,e,n,-1))}},i.prototype[l.types.SPHERE]=i.prototype.intersectSphere;var E=new r,_=(new r,new r,new r);i.prototype.intersectConvex=function(e,t,i,r,o){for(var a=E,s=_,l=o&&o.faceList||null,c=e.faces,h=e.vertices,u=e.faceNormals,p=this._direction,d=this.from,f=this.to,m=d.distanceTo(f),b=l?l.length:c.length,w=this.result,M=0;!w._shouldStop&&b>M;M++){var S=l?l[M]:M,T=c[S],A=u[S],C=t,R=i;s.copy(h[T[0]]),C.vmult(s,s),s.vadd(R,s),s.vsub(d,s),C.vmult(A,a);var L=p.dot(a);if(!(Math.abs(L)<this.precision)){var P=a.dot(s)/L;if(!(0>P)){p.mult(P,g),g.vadd(d,g),v.copy(h[T[0]]),C.vmult(v,v),R.vadd(v,v);for(var N=1;!w._shouldStop&&N<T.length-1;N++){y.copy(h[T[N]]),x.copy(h[T[N+1]]),C.vmult(y,y),C.vmult(x,x),R.vadd(y,y),R.vadd(x,x);var B=g.distanceTo(d);!n(g,v,y,x)&&!n(g,y,v,x)||B>m||this.reportIntersection(a,g,e,r,S)}}}}},i.prototype[l.types.CONVEXPOLYHEDRON]=i.prototype.intersectConvex;var S=new r,T=new r,A=new r,C=new r,R=new r,L=new r,P=(new c,[]),N=new a;i.prototype.intersectTrimesh=function(e,t,i,r,o){var s=S,l=P,c=N,h=_,u=T,p=A,d=C,f=L,m=R,b=(o&&o.faceList,e.indices),w=(e.vertices,e.faceNormals,this.from),M=this.to,E=this._direction;c.position.copy(i),c.quaternion.copy(t),a.vectorToLocalFrame(i,t,E,u),a.pointToLocalFrame(i,t,w,p),a.pointToLocalFrame(i,t,M,d);var B=p.distanceSquared(d);e.tree.rayQuery(this,c,l);for(var z=0,O=l.length;!this.result._shouldStop&&z!==O;z++){var F=l[z];e.getNormal(F,s),e.getVertex(b[3*F],v),v.vsub(p,h);var I=u.dot(s),D=s.dot(h)/I;if(!(0>D)){u.scale(D,g),g.vadd(p,g),e.getVertex(b[3*F+1],y),e.getVertex(b[3*F+2],x);var H=g.distanceSquared(p);!n(g,y,v,x)&&!n(g,v,y,x)||H>B||(a.vectorToWorldFrame(t,s,m),a.pointToWorldFrame(i,t,g,f),this.reportIntersection(m,f,e,r,F))}}l.length=0},i.prototype[l.types.TRIMESH]=i.prototype.intersectTrimesh,i.prototype.reportIntersection=function(e,t,n,r,o){var a=this.from,s=this.to,l=a.distanceTo(t),c=this.result;if(!(this.skipBackfaces&&e.dot(this._direction)>0))switch(c.hitFaceIndex=void 0!==o?o:-1,this.mode){case i.ALL:this.hasHit=!0,c.set(a,s,e,t,n,r,l),c.hasHit=!0,this.callback(c);break;case i.CLOSEST:(l<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(a,s,e,t,n,r,l));break;case i.ANY:this.hasHit=!0,c.hasHit=!0,c.set(a,s,e,t,n,r,l),c._shouldStop=!0}};var B=new r,z=new r},{\"../collision/AABB\":3,\"../collision/RaycastResult\":10,\"../math/Quaternion\":28,\"../math/Transform\":29,\"../math/Vec3\":30,\"../shapes/Box\":37,\"../shapes/ConvexPolyhedron\":38,\"../shapes/Shape\":43}],10:[function(e,t){function i(){this.rayFromWorld=new n,this.rayToWorld=new n,this.hitNormalWorld=new n,this.hitPointWorld=new n,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var n=e(\"../math/Vec3\");t.exports=i,i.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},i.prototype.abort=function(){this._shouldStop=!0},i.prototype.set=function(e,t,i,n,r,o,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(n),this.shape=r,this.body=o,this.distance=a}},{\"../math/Vec3\":30}],11:[function(e,t){function i(e){n.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var t=this.axisList;this._addBodyHandler=function(e){t.push(e.body)},this._removeBodyHandler=function(e){var i=t.indexOf(e.body);-1!==i&&t.splice(i,1)},e&&this.setWorld(e)}var n=(e(\"../shapes/Shape\"),e(\"../collision/Broadphase\"));t.exports=i,i.prototype=new n,i.prototype.setWorld=function(e){this.axisList.length=0;for(var t=0;t<e.bodies.length;t++)this.axisList.push(e.bodies[t]);e.removeEventListener(\"addBody\",this._addBodyHandler),e.removeEventListener(\"removeBody\",this._removeBodyHandler),e.addEventListener(\"addBody\",this._addBodyHandler),e.addEventListener(\"removeBody\",this._removeBodyHandler),this.world=e,this.dirty=!0},i.insertionSortX=function(e){for(var t=1,i=e.length;i>t;t++){for(var n=e[t],r=t-1;r>=0&&!(e[r].aabb.lowerBound.x<=n.aabb.lowerBound.x);r--)e[r+1]=e[r];e[r+1]=n}return e},i.insertionSortY=function(e){for(var t=1,i=e.length;i>t;t++){for(var n=e[t],r=t-1;r>=0&&!(e[r].aabb.lowerBound.y<=n.aabb.lowerBound.y);r--)e[r+1]=e[r];e[r+1]=n}return e},i.insertionSortZ=function(e){for(var t=1,i=e.length;i>t;t++){for(var n=e[t],r=t-1;r>=0&&!(e[r].aabb.lowerBound.z<=n.aabb.lowerBound.z);r--)e[r+1]=e[r];e[r+1]=n}return e},i.prototype.collisionPairs=function(e,t,n){var r,o,a=this.axisList,s=a.length,l=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),r=0;r!==s;r++){var c=a[r];for(o=r+1;s>o;o++){var h=a[o];if(this.needBroadphaseCollision(c,h)){if(!i.checkBounds(c,h,l))break;this.intersectionTest(c,h,t,n)}}}},i.prototype.sortList=function(){for(var e=this.axisList,t=this.axisIndex,n=e.length,r=0;r!==n;r++){var o=e[r];o.aabbNeedsUpdate&&o.computeAABB()}0===t?i.insertionSortX(e):1===t?i.insertionSortY(e):2===t&&i.insertionSortZ(e)},i.checkBounds=function(e,t,i){var n,r;return 0===i?(n=e.position.x,r=t.position.x):1===i?(n=e.position.y,r=t.position.y):2===i&&(n=e.position.z,r=t.position.z),n+e.boundingRadius>r-t.boundingRadius},i.prototype.autoDetectAxis=function(){for(var e=0,t=0,i=0,n=0,r=0,o=0,a=this.axisList,s=a.length,l=1/s,c=0;c!==s;c++){var h=a[c],u=h.position.x;e+=u,t+=u*u;var p=h.position.y;i+=p,n+=p*p;var d=h.position.z;r+=d,o+=d*d}var f=t-e*e*l,m=n-i*i*l,g=o-r*r*l;this.axisIndex=f>m?f>g?0:2:m>g?1:2},i.prototype.aabbQuery=function(e,t,i){i=i||[],this.dirty&&(this.sortList(),this.dirty=!1);var n=this.axisIndex,r=\"x\";1===n&&(r=\"y\"),2===n&&(r=\"z\");for(var o=this.axisList,a=(t.lowerBound[r],t.upperBound[r],0);a<o.length;a++){var s=o[a];s.aabbNeedsUpdate&&s.computeAABB(),s.aabb.overlaps(t)&&i.push(s)}return i}},{\"../collision/Broadphase\":5,\"../shapes/Shape\":43}],12:[function(e,t){function i(e,t,i){var s=void 0!==(i=i||{}).maxForce?i.maxForce:1e6,l=i.pivotA?i.pivotA.clone():new a,c=i.pivotB?i.pivotB.clone():new a;this.axisA=i.axisA?i.axisA.clone():new a,this.axisB=i.axisB?i.axisB.clone():new a,n.call(this,e,l,t,c,s),this.collideConnected=!!i.collideConnected,this.angle=void 0!==i.angle?i.angle:0;var h=this.coneEquation=new r(e,t,i),u=this.twistEquation=new o(e,t,i);this.twistAngle=void 0!==i.twistAngle?i.twistAngle:0,h.maxForce=0,h.minForce=-s,u.maxForce=0,u.minForce=-s,this.equations.push(h,u)}t.exports=i;var n=(e(\"./Constraint\"),e(\"./PointToPointConstraint\")),r=e(\"../equations/ConeEquation\"),o=e(\"../equations/RotationalEquation\"),a=(e(\"../equations/ContactEquation\"),e(\"../math/Vec3\"));i.prototype=new n,i.constructor=i,new a,new a,i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,i=this.coneEquation,r=this.twistEquation;n.prototype.update.call(this),e.vectorToWorldFrame(this.axisA,i.axisA),t.vectorToWorldFrame(this.axisB,i.axisB),this.axisA.tangents(r.axisA,r.axisA),e.vectorToWorldFrame(r.axisA,r.axisA),this.axisB.tangents(r.axisB,r.axisB),t.vectorToWorldFrame(r.axisB,r.axisB),i.angle=this.angle,r.maxAngle=this.twistAngle}},{\"../equations/ConeEquation\":18,\"../equations/ContactEquation\":19,\"../equations/RotationalEquation\":22,\"../math/Vec3\":30,\"./Constraint\":13,\"./PointToPointConstraint\":17}],13:[function(e,t){function i(e,t,r){r=n.defaults(r,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=i.idCounter++,this.collideConnected=r.collideConnected,r.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}t.exports=i;var n=e(\"../utils/Utils\");i.prototype.update=function(){throw new Error(\"method update() not implmemented in this Constraint subclass!\")},i.prototype.enable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!0},i.prototype.disable=function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!1},i.idCounter=0},{\"../utils/Utils\":53}],14:[function(e,t){function i(e,t,i,o){n.call(this,e,t),void 0===i&&(i=e.position.distanceTo(t.position)),void 0===o&&(o=1e6),this.distance=i;var a=this.distanceEquation=new r(e,t);this.equations.push(a),a.minForce=-o,a.maxForce=o}t.exports=i;var n=e(\"./Constraint\"),r=e(\"../equations/ContactEquation\");i.prototype=new n,i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,i=this.distanceEquation,n=.5*this.distance,r=i.ni;t.position.vsub(e.position,r),r.normalize(),r.mult(n,i.ri),r.mult(-n,i.rj)}},{\"../equations/ContactEquation\":19,\"./Constraint\":13}],15:[function(e,t){function i(e,t,i){var s=void 0!==(i=i||{}).maxForce?i.maxForce:1e6,l=i.pivotA?i.pivotA.clone():new a,c=i.pivotB?i.pivotB.clone():new a;n.call(this,e,l,t,c,s),(this.axisA=i.axisA?i.axisA.clone():new a(1,0,0)).normalize(),(this.axisB=i.axisB?i.axisB.clone():new a(1,0,0)).normalize();var h=this.rotationalEquation1=new r(e,t,i),u=this.rotationalEquation2=new r(e,t,i),p=this.motorEquation=new o(e,t,s);p.enabled=!1,this.equations.push(h,u,p)}t.exports=i;var n=(e(\"./Constraint\"),e(\"./PointToPointConstraint\")),r=e(\"../equations/RotationalEquation\"),o=e(\"../equations/RotationalMotorEquation\"),a=(e(\"../equations/ContactEquation\"),e(\"../math/Vec3\"));i.prototype=new n,i.constructor=i,i.prototype.enableMotor=function(){this.motorEquation.enabled=!0},i.prototype.disableMotor=function(){this.motorEquation.enabled=!1},i.prototype.setMotorSpeed=function(e){this.motorEquation.targetVelocity=e},i.prototype.setMotorMaxForce=function(e){this.motorEquation.maxForce=e,this.motorEquation.minForce=-e};var s=new a,l=new a;i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,i=this.motorEquation,r=this.rotationalEquation1,o=this.rotationalEquation2,a=s,c=l,h=this.axisA,u=this.axisB;n.prototype.update.call(this),e.quaternion.vmult(h,a),t.quaternion.vmult(u,c),a.tangents(r.axisA,o.axisA),r.axisB.copy(c),o.axisB.copy(c),this.motorEquation.enabled&&(e.quaternion.vmult(this.axisA,i.axisA),t.quaternion.vmult(this.axisB,i.axisB))}},{\"../equations/ContactEquation\":19,\"../equations/RotationalEquation\":22,\"../equations/RotationalMotorEquation\":23,\"../math/Vec3\":30,\"./Constraint\":13,\"./PointToPointConstraint\":17}],16:[function(e,t){function i(e,t,i){var a=void 0!==(i=i||{}).maxForce?i.maxForce:1e6,s=new o,l=new o,c=new o;e.position.vadd(t.position,c),c.scale(.5,c),t.pointToLocalFrame(c,l),e.pointToLocalFrame(c,s),n.call(this,e,s,t,l,a);var h=this.rotationalEquation1=new r(e,t,i),u=this.rotationalEquation2=new r(e,t,i),p=this.rotationalEquation3=new r(e,t,i);this.equations.push(h,u,p)}t.exports=i;var n=(e(\"./Constraint\"),e(\"./PointToPointConstraint\")),r=e(\"../equations/RotationalEquation\"),o=(e(\"../equations/RotationalMotorEquation\"),e(\"../equations/ContactEquation\"),e(\"../math/Vec3\"));i.prototype=new n,i.constructor=i,new o,new o,i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,i=(this.motorEquation,this.rotationalEquation1),r=this.rotationalEquation2,a=this.rotationalEquation3;n.prototype.update.call(this),e.vectorToWorldFrame(o.UNIT_X,i.axisA),t.vectorToWorldFrame(o.UNIT_Y,i.axisB),e.vectorToWorldFrame(o.UNIT_Y,r.axisA),t.vectorToWorldFrame(o.UNIT_Z,r.axisB),e.vectorToWorldFrame(o.UNIT_Z,a.axisA),t.vectorToWorldFrame(o.UNIT_X,a.axisB)}},{\"../equations/ContactEquation\":19,\"../equations/RotationalEquation\":22,\"../equations/RotationalMotorEquation\":23,\"../math/Vec3\":30,\"./Constraint\":13,\"./PointToPointConstraint\":17}],17:[function(e,t){function i(e,t,i,a,s){n.call(this,e,i),s=void 0!==s?s:1e6,this.pivotA=t?t.clone():new o,this.pivotB=a?a.clone():new o;var l=this.equationX=new r(e,i),c=this.equationY=new r(e,i),h=this.equationZ=new r(e,i);this.equations.push(l,c,h),l.minForce=c.minForce=h.minForce=-s,l.maxForce=c.maxForce=h.maxForce=s,l.ni.set(1,0,0),c.ni.set(0,1,0),h.ni.set(0,0,1)}t.exports=i;var n=e(\"./Constraint\"),r=e(\"../equations/ContactEquation\"),o=e(\"../math/Vec3\");i.prototype=new n,i.prototype.update=function(){var e=this.bodyA,t=this.bodyB,i=this.equationX,n=this.equationY,r=this.equationZ;e.quaternion.vmult(this.pivotA,i.ri),t.quaternion.vmult(this.pivotB,i.rj),n.ri.copy(i.ri),n.rj.copy(i.rj),r.ri.copy(i.ri),r.rj.copy(i.rj)}},{\"../equations/ContactEquation\":19,\"../math/Vec3\":30,\"./Constraint\":13}],18:[function(e,t){function i(e,t,i){var o=void 0!==(i=i||{}).maxForce?i.maxForce:1e6;r.call(this,e,t,-o,o),this.axisA=i.axisA?i.axisA.clone():new n(1,0,0),this.axisB=i.axisB?i.axisB.clone():new n(0,1,0),this.angle=void 0!==i.angle?i.angle:0}t.exports=i;var n=e(\"../math/Vec3\"),r=(e(\"../math/Mat3\"),e(\"./Equation\"));i.prototype=new r,i.prototype.constructor=i;var o=new n,a=new n;i.prototype.computeB=function(e){var t=this.a,i=this.b,n=this.axisA,r=this.axisB,s=o,l=a,c=this.jacobianElementA,h=this.jacobianElementB;return n.cross(r,s),r.cross(n,l),c.rotational.copy(l),h.rotational.copy(s),-(Math.cos(this.angle)-n.dot(r))*t-this.computeGW()*i-e*this.computeGiMf()}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],19:[function(e,t){function i(e,t,i){i=void 0!==i?i:1e6,n.call(this,e,t,0,i),this.restitution=0,this.ri=new r,this.rj=new r,this.ni=new r}t.exports=i;var n=e(\"./Equation\"),r=e(\"../math/Vec3\");e(\"../math/Mat3\"),i.prototype=new n,i.prototype.constructor=i;var o=new r,a=new r,s=new r;i.prototype.computeB=function(e){var t=this.a,i=this.b,n=this.bi,r=this.bj,l=this.ri,c=this.rj,h=o,u=a,p=n.velocity,d=n.angularVelocity,f=(n.force,n.torque,r.velocity),m=r.angularVelocity,g=(r.force,r.torque,s),v=this.jacobianElementA,y=this.jacobianElementB,x=this.ni;l.cross(x,h),c.cross(x,u),x.negate(v.spatial),h.negate(v.rotational),y.spatial.copy(x),y.rotational.copy(u),g.copy(r.position),g.vadd(c,g),g.vsub(n.position,g),g.vsub(l,g);var b=x.dot(g),w=this.restitution+1;return-b*t-(w*f.dot(x)-w*p.dot(x)+m.dot(u)-d.dot(h))*i-e*this.computeGiMf()};var l=new r,c=new r,h=new r,u=new r,p=new r;i.prototype.getImpactVelocityAlongNormal=function(){var e=l,t=c,i=h,n=u,r=p;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,n),this.bi.getVelocityAtWorldPoint(i,e),this.bj.getVelocityAtWorldPoint(n,t),e.vsub(t,r),this.ni.dot(r)}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],20:[function(e,t){function i(e,t,r,o){this.id=i.id++,this.minForce=void 0===r?-1e6:r,this.maxForce=void 0===o?1e6:o,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new n,this.jacobianElementB=new n,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}t.exports=i;var n=e(\"../math/JacobianElement\"),r=e(\"../math/Vec3\");i.prototype.constructor=i,i.id=0,i.prototype.setSpookParams=function(e,t,i){var n=t,r=e,o=i;this.a=4/(o*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(o*o*r*(1+4*n))},i.prototype.computeB=function(e,t,i){var n=this.computeGW();return-this.computeGq()*e-n*t-this.computeGiMf()*i},i.prototype.computeGq=function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.position,o=n.position;return e.spatial.dot(r)+t.spatial.dot(o)};var o=new r;i.prototype.computeGW=function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.velocity,a=n.velocity,s=i.angularVelocity||o,l=n.angularVelocity||o;return e.multiplyVectors(r,s)+t.multiplyVectors(a,l)},i.prototype.computeGWlambda=function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.vlambda,a=n.vlambda,s=i.wlambda||o,l=n.wlambda||o;return e.multiplyVectors(r,s)+t.multiplyVectors(a,l)};var a=new r,s=new r,l=new r,c=new r;i.prototype.computeGiMf=function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.force,o=i.torque,h=n.force,u=n.torque,p=i.invMassSolve,d=n.invMassSolve;return i.invInertiaWorldSolve?i.invInertiaWorldSolve.vmult(o,l):l.set(0,0,0),n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(u,c):c.set(0,0,0),r.mult(p,a),h.mult(d,s),e.multiplyVectors(a,l)+t.multiplyVectors(s,c)};var h=new r;i.prototype.computeGiMGt=function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.invMassSolve,o=n.invMassSolve,a=i.invInertiaWorldSolve,s=n.invInertiaWorldSolve,l=r+o;return a&&(a.vmult(e.rotational,h),l+=h.dot(e.rotational)),s&&(s.vmult(t.rotational,h),l+=h.dot(t.rotational)),l};var u=new r;new r,new r,new r,new r,new r,i.prototype.addToWlambda=function(e){var t=this.jacobianElementA,i=this.jacobianElementB,n=this.bi,r=this.bj,o=u;t.spatial.mult(n.invMassSolve*e,o),n.vlambda.vadd(o,n.vlambda),i.spatial.mult(r.invMassSolve*e,o),r.vlambda.vadd(o,r.vlambda),n.invInertiaWorldSolve&&(n.invInertiaWorldSolve.vmult(t.rotational,o),o.mult(e,o),n.wlambda.vadd(o,n.wlambda)),r.invInertiaWorldSolve&&(r.invInertiaWorldSolve.vmult(i.rotational,o),o.mult(e,o),r.wlambda.vadd(o,r.wlambda))},i.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{\"../math/JacobianElement\":26,\"../math/Vec3\":30}],21:[function(e,t){function i(e,t,i){n.call(this,e,t,-i,i),this.ri=new r,this.rj=new r,this.t=new r}t.exports=i;var n=e(\"./Equation\"),r=e(\"../math/Vec3\");e(\"../math/Mat3\"),i.prototype=new n,i.prototype.constructor=i;var o=new r,a=new r;i.prototype.computeB=function(e){var t=(this.a,this.b),i=(this.bi,this.bj,this.ri),n=this.rj,r=o,s=a,l=this.t;i.cross(l,r),n.cross(l,s);var c=this.jacobianElementA,h=this.jacobianElementB;return l.negate(c.spatial),r.negate(c.rotational),h.spatial.copy(l),h.rotational.copy(s),-this.computeGW()*t-e*this.computeGiMf()}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],22:[function(e,t){function i(e,t,i){var o=void 0!==(i=i||{}).maxForce?i.maxForce:1e6;r.call(this,e,t,-o,o),this.axisA=i.axisA?i.axisA.clone():new n(1,0,0),this.axisB=i.axisB?i.axisB.clone():new n(0,1,0),this.maxAngle=Math.PI/2}t.exports=i;var n=e(\"../math/Vec3\"),r=(e(\"../math/Mat3\"),e(\"./Equation\"));i.prototype=new r,i.prototype.constructor=i;var o=new n,a=new n;i.prototype.computeB=function(e){var t=this.a,i=this.b,n=this.axisA,r=this.axisB,s=o,l=a,c=this.jacobianElementA,h=this.jacobianElementB;return n.cross(r,s),r.cross(n,l),c.rotational.copy(l),h.rotational.copy(s),-(Math.cos(this.maxAngle)-n.dot(r))*t-this.computeGW()*i-e*this.computeGiMf()}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],23:[function(e,t){function i(e,t,i){i=void 0!==i?i:1e6,r.call(this,e,t,-i,i),this.axisA=new n,this.axisB=new n,this.targetVelocity=0}t.exports=i;var n=e(\"../math/Vec3\"),r=(e(\"../math/Mat3\"),e(\"./Equation\"));i.prototype=new r,i.prototype.constructor=i,i.prototype.computeB=function(e){var t=(this.a,this.b),i=(this.bi,this.bj,this.axisA),n=this.axisB,r=this.jacobianElementA,o=this.jacobianElementB;return r.rotational.copy(i),n.negate(o.rotational),-(this.computeGW()-this.targetVelocity)*t-e*this.computeGiMf()}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],24:[function(e,t){function i(e,t,r){r=n.defaults(r,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=i.idCounter++,this.materials=[e,t],this.friction=r.friction,this.restitution=r.restitution,this.contactEquationStiffness=r.contactEquationStiffness,this.contactEquationRelaxation=r.contactEquationRelaxation,this.frictionEquationStiffness=r.frictionEquationStiffness,this.frictionEquationRelaxation=r.frictionEquationRelaxation}var n=e(\"../utils/Utils\");t.exports=i,i.idCounter=0},{\"../utils/Utils\":53}],25:[function(e,t){function i(e){var t=\"\";\"string\"==typeof(e=e||{})?(t=e,e={}):\"object\"==typeof e&&(t=\"\"),this.name=t,this.id=i.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}t.exports=i,i.idCounter=0},{}],26:[function(e,t){function i(){this.spatial=new n,this.rotational=new n}t.exports=i;var n=e(\"./Vec3\");i.prototype.multiplyElement=function(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)},i.prototype.multiplyVectors=function(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}},{\"./Vec3\":30}],27:[function(e,t){function i(e){this.elements=e||[0,0,0,0,0,0,0,0,0]}t.exports=i;var n=e(\"./Vec3\");i.prototype.identity=function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1},i.prototype.setZero=function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0},i.prototype.setTrace=function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z},i.prototype.getTrace=function(e){e=e||new n;var t=this.elements;e.x=t[0],e.y=t[4],e.z=t[8]},i.prototype.vmult=function(e,t){t=t||new n;var i=this.elements,r=e.x,o=e.y,a=e.z;return t.x=i[0]*r+i[1]*o+i[2]*a,t.y=i[3]*r+i[4]*o+i[5]*a,t.z=i[6]*r+i[7]*o+i[8]*a,t},i.prototype.smult=function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e},i.prototype.mmult=function(e,t){for(var n=t||new i,r=0;3>r;r++)for(var o=0;3>o;o++){for(var a=0,s=0;3>s;s++)a+=e.elements[r+3*s]*this.elements[s+3*o];n.elements[r+3*o]=a}return n},i.prototype.scale=function(e,t){t=t||new i;for(var n=this.elements,r=t.elements,o=0;3!==o;o++)r[3*o+0]=e.x*n[3*o+0],r[3*o+1]=e.y*n[3*o+1],r[3*o+2]=e.z*n[3*o+2];return t},i.prototype.solve=function(e,t){t=t||new n;for(var i=[],r=0;12>r;r++)i.push(0);var o;for(r=0;3>r;r++)for(o=0;3>o;o++)i[r+4*o]=this.elements[r+3*o];i[3]=e.x,i[7]=e.y,i[11]=e.z;var a,s,l=3,c=l;do{if(0===i[(r=c-l)+4*r])for(o=r+1;c>o;o++)if(0!==i[r+4*o]){a=4;do{i[(s=4-a)+4*r]+=i[s+4*o]}while(--a);break}if(0!==i[r+4*r])for(o=r+1;c>o;o++){var h=i[r+4*o]/i[r+4*r];a=4;do{i[(s=4-a)+4*o]=r>=s?0:i[s+4*o]-i[s+4*r]*h}while(--a)}}while(--l);if(t.z=i[11]/i[10],t.y=(i[7]-i[6]*t.z)/i[5],t.x=(i[3]-i[2]*t.z-i[1]*t.y)/i[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||1/0===t.x||1/0===t.y||1/0===t.z)throw\"Could not solve equation! Got x=[\"+t.toString()+\"], b=[\"+e.toString()+\"], A=[\"+this.toString()+\"]\";return t},i.prototype.e=function(e,t,i){return void 0===i?this.elements[t+3*e]:void(this.elements[t+3*e]=i)},i.prototype.copy=function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this},i.prototype.toString=function(){for(var e=\"\",t=0;9>t;t++)e+=this.elements[t]+\",\";return e},i.prototype.reverse=function(e){e=e||new i;for(var t=[],n=0;18>n;n++)t.push(0);var r;for(n=0;3>n;n++)for(r=0;3>r;r++)t[n+6*r]=this.elements[n+3*r];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;var o,a,s=3,l=s;do{if(0===t[(n=l-s)+6*n])for(r=n+1;l>r;r++)if(0!==t[n+6*r]){o=6;do{t[(a=6-o)+6*n]+=t[a+6*r]}while(--o);break}if(0!==t[n+6*n])for(r=n+1;l>r;r++){var c=t[n+6*r]/t[n+6*n];o=6;do{t[(a=6-o)+6*r]=n>=a?0:t[a+6*r]-t[a+6*n]*c}while(--o)}}while(--s);n=2;do{r=n-1;do{c=t[n+6*r]/t[n+6*n],o=6;do{t[(a=6-o)+6*r]=t[a+6*r]-t[a+6*n]*c}while(--o)}while(r--)}while(--n);n=2;do{c=1/t[n+6*n],o=6;do{t[(a=6-o)+6*n]=t[a+6*n]*c}while(--o)}while(n--);n=2;do{r=2;do{if(a=t[3+r+6*n],isNaN(a)||1/0===a)throw\"Could not reverse! A=[\"+this.toString()+\"]\";e.e(n,r,a)}while(r--)}while(n--);return e},i.prototype.setRotationFromQuaternion=function(e){var t=e.x,i=e.y,n=e.z,r=e.w,o=t+t,a=i+i,s=n+n,l=t*o,c=t*a,h=t*s,u=i*a,p=i*s,d=n*s,f=r*o,m=r*a,g=r*s,v=this.elements;return v[0]=1-(u+d),v[1]=c-g,v[2]=h+m,v[3]=c+g,v[4]=1-(l+d),v[5]=p-f,v[6]=h-m,v[7]=p+f,v[8]=1-(l+u),this},i.prototype.transpose=function(e){for(var t=(e=e||new i).elements,n=this.elements,r=0;3!==r;r++)for(var o=0;3!==o;o++)t[3*r+o]=n[3*o+r];return e}},{\"./Vec3\":30}],28:[function(e,t){function i(e,t,i,n){this.x=void 0!==e?e:0,this.y=void 0!==t?t:0,this.z=void 0!==i?i:0,this.w=void 0!==n?n:1}t.exports=i;var n=e(\"./Vec3\");i.prototype.set=function(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n},i.prototype.toString=function(){return this.x+\",\"+this.y+\",\"+this.z+\",\"+this.w},i.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},i.prototype.setFromAxisAngle=function(e,t){var i=Math.sin(.5*t);this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(.5*t)},i.prototype.toAxisAngle=function(e){e=e||new n,this.normalize();var t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return.001>i?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]};var r=new n,o=new n;i.prototype.setFromVectors=function(e,t){if(e.isAntiparallelTo(t)){var i=r,n=o;e.tangents(i,n),this.setFromAxisAngle(i,Math.PI)}else{var a=e.cross(t);this.x=a.x,this.y=a.y,this.z=a.z,this.w=Math.sqrt(Math.pow(e.norm(),2)*Math.pow(t.norm(),2))+e.dot(t),this.normalize()}};var a=new n,s=new n,l=new n;i.prototype.mult=function(e,t){t=t||new i;var n=this.w,r=a,o=s,c=l;return r.set(this.x,this.y,this.z),o.set(e.x,e.y,e.z),t.w=n*e.w-r.dot(o),r.cross(o,c),t.x=n*o.x+e.w*r.x+c.x,t.y=n*o.y+e.w*r.y+c.y,t.z=n*o.z+e.w*r.z+c.z,t},i.prototype.inverse=function(e){var t=this.x,n=this.y,r=this.z,o=this.w;e=e||new i,this.conjugate(e);var a=1/(t*t+n*n+r*r+o*o);return e.x*=a,e.y*=a,e.z*=a,e.w*=a,e},i.prototype.conjugate=function(e){return(e=e||new i).x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e},i.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e)},i.prototype.normalizeFast=function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e)},i.prototype.vmult=function(e,t){t=t||new n;var i=e.x,r=e.y,o=e.z,a=this.x,s=this.y,l=this.z,c=this.w,h=c*i+s*o-l*r,u=c*r+l*i-a*o,p=c*o+a*r-s*i,d=-a*i-s*r-l*o;return t.x=h*c+d*-a+u*-l-p*-s,t.y=u*c+d*-s+p*-a-h*-l,t.z=p*c+d*-l+h*-s-u*-a,t},i.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},i.prototype.toEuler=function(e,t){t=t||\"YZX\";var i,n,r,o=this.x,a=this.y,s=this.z,l=this.w;switch(t){case\"YZX\":var c=o*a+s*l;if(c>.499&&(i=2*Math.atan2(o,l),n=Math.PI/2,r=0),-.499>c&&(i=-2*Math.atan2(o,l),n=-Math.PI/2,r=0),isNaN(i)){var h=o*o,u=a*a,p=s*s;i=Math.atan2(2*a*l-2*o*s,1-2*u-2*p),n=Math.asin(2*c),r=Math.atan2(2*o*l-2*a*s,1-2*h-2*p)}break;default:throw new Error(\"Euler order \"+t+\" not supported yet.\")}e.y=i,e.z=n,e.x=r},i.prototype.setFromEuler=function(e,t,i,n){n=n||\"XYZ\";var r=Math.cos(e/2),o=Math.cos(t/2),a=Math.cos(i/2),s=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(i/2);return\"XYZ\"===n?(this.x=s*o*a+r*l*c,this.y=r*l*a-s*o*c,this.z=r*o*c+s*l*a,this.w=r*o*a-s*l*c):\"YXZ\"===n?(this.x=s*o*a+r*l*c,this.y=r*l*a-s*o*c,this.z=r*o*c-s*l*a,this.w=r*o*a+s*l*c):\"ZXY\"===n?(this.x=s*o*a-r*l*c,this.y=r*l*a+s*o*c,this.z=r*o*c+s*l*a,this.w=r*o*a-s*l*c):\"ZYX\"===n?(this.x=s*o*a-r*l*c,this.y=r*l*a+s*o*c,this.z=r*o*c-s*l*a,this.w=r*o*a+s*l*c):\"YZX\"===n?(this.x=s*o*a+r*l*c,this.y=r*l*a+s*o*c,this.z=r*o*c-s*l*a,this.w=r*o*a-s*l*c):\"XZY\"===n&&(this.x=s*o*a-r*l*c,this.y=r*l*a-s*o*c,this.z=r*o*c+s*l*a,this.w=r*o*a+s*l*c),this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)}},{\"./Vec3\":30}],29:[function(e,t){function i(e){e=e||{},this.position=new n,e.position&&this.position.copy(e.position),this.quaternion=new r,e.quaternion&&this.quaternion.copy(e.quaternion)}var n=e(\"./Vec3\"),r=e(\"./Quaternion\");t.exports=i;var o=new r;i.pointToLocalFrame=function(e,t,i,r){return r=r||new n,i.vsub(e,r),t.conjugate(o),o.vmult(r,r),r},i.prototype.pointToLocal=function(e,t){return i.pointToLocalFrame(this.position,this.quaternion,e,t)},i.pointToWorldFrame=function(e,t,i,r){return r=r||new n,t.vmult(i,r),r.vadd(e,r),r},i.prototype.pointToWorld=function(e,t){return i.pointToWorldFrame(this.position,this.quaternion,e,t)},i.prototype.vectorToWorldFrame=function(e,t){return t=t||new n,this.quaternion.vmult(e,t),t},i.vectorToWorldFrame=function(e,t,i){return e.vmult(t,i),i},i.vectorToLocalFrame=function(e,t,i,r){return r=r||new n,t.w*=-1,t.vmult(i,r),t.w*=-1,r}},{\"./Quaternion\":28,\"./Vec3\":30}],30:[function(e,t){function i(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}t.exports=i;var n=e(\"./Mat3\");i.ZERO=new i(0,0,0),i.UNIT_X=new i(1,0,0),i.UNIT_Y=new i(0,1,0),i.UNIT_Z=new i(0,0,1),i.prototype.cross=function(e,t){var n=e.x,r=e.y,o=e.z,a=this.x,s=this.y,l=this.z;return(t=t||new i).x=s*o-l*r,t.y=l*n-a*o,t.z=a*r-s*n,t},i.prototype.set=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},i.prototype.setZero=function(){this.x=this.y=this.z=0},i.prototype.vadd=function(e,t){return t?(t.x=e.x+this.x,t.y=e.y+this.y,void(t.z=e.z+this.z)):new i(this.x+e.x,this.y+e.y,this.z+e.z)},i.prototype.vsub=function(e,t){return t?(t.x=this.x-e.x,t.y=this.y-e.y,void(t.z=this.z-e.z)):new i(this.x-e.x,this.y-e.y,this.z-e.z)},i.prototype.crossmat=function(){return new n([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},i.prototype.normalize=function(){var e=this.x,t=this.y,i=this.z,n=Math.sqrt(e*e+t*t+i*i);if(n>0){var r=1/n;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return n},i.prototype.unit=function(e){e=e||new i;var t=this.x,n=this.y,r=this.z,o=Math.sqrt(t*t+n*n+r*r);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=r*o):(e.x=1,e.y=0,e.z=0),e},i.prototype.norm=function(){var e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)},i.prototype.length=i.prototype.norm,i.prototype.norm2=function(){return this.dot(this)},i.prototype.lengthSquared=i.prototype.norm2,i.prototype.distanceTo=function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z;return Math.sqrt((r-t)*(r-t)+(o-i)*(o-i)+(a-n)*(a-n))},i.prototype.distanceSquared=function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z;return(r-t)*(r-t)+(o-i)*(o-i)+(a-n)*(a-n)},i.prototype.mult=function(e,t){t=t||new i;var n=this.x,r=this.y,o=this.z;return t.x=e*n,t.y=e*r,t.z=e*o,t},i.prototype.scale=i.prototype.mult,i.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},i.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},i.prototype.negate=function(e){return(e=e||new i).x=-this.x,e.y=-this.y,e.z=-this.z,e};var r=new i,o=new i;i.prototype.tangents=function(e,t){var i=this.norm();if(i>0){var n=r,a=1/i;n.set(this.x*a,this.y*a,this.z*a);var s=o;Math.abs(n.x)<.9?(s.set(1,0,0),n.cross(s,e)):(s.set(0,1,0),n.cross(s,e)),n.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)},i.prototype.toString=function(){return this.x+\",\"+this.y+\",\"+this.z},i.prototype.toArray=function(){return[this.x,this.y,this.z]},i.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},i.prototype.lerp=function(e,t,i){var n=this.x,r=this.y,o=this.z;i.x=n+(e.x-n)*t,i.y=r+(e.y-r)*t,i.z=o+(e.z-o)*t},i.prototype.almostEquals=function(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)},i.prototype.almostZero=function(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)};var a=new i;i.prototype.isAntiparallelTo=function(e,t){return this.negate(a),a.almostEquals(e,t)},i.prototype.clone=function(){return new i(this.x,this.y,this.z)}},{\"./Mat3\":27}],31:[function(e,t){function i(e){e=e||{},n.apply(this),this.id=i.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new r,this.collisionFilterGroup=\"number\"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=\"number\"==typeof e.collisionFilterMask?e.collisionFilterMask:1,this.collisionResponse=!0,this.position=new r,e.position&&this.position.copy(e.position),this.previousPosition=new r,this.initPosition=new r,this.velocity=new r,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new r,this.force=new r;var t=\"number\"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping=\"number\"==typeof e.linearDamping?e.linearDamping:.01,this.type=0>=t?i.STATIC:i.DYNAMIC,typeof e.type==typeof i.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new r,this.quaternion=new a,e.quaternion&&this.quaternion.copy(e.quaternion),this.initQuaternion=new a,this.angularVelocity=new r,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new r,this.interpolatedPosition=new r,this.interpolatedQuaternion=new a,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new r,this.invInertia=new r,this.invInertiaWorld=new o,this.invMassSolve=0,this.invInertiaSolve=new r,this.invInertiaWorldSolve=new o,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.aabb=new s,this.aabbNeedsUpdate=!0,this.wlambda=new r,e.shape&&this.addShape(e.shape),this.updateMassProperties()}t.exports=i;var n=e(\"../utils/EventTarget\"),r=(e(\"../shapes/Shape\"),e(\"../math/Vec3\")),o=e(\"../math/Mat3\"),a=e(\"../math/Quaternion\"),s=(e(\"../material/Material\"),e(\"../collision/AABB\")),l=e(\"../shapes/Box\");i.prototype=new n,i.prototype.constructor=i,i.DYNAMIC=1,i.STATIC=2,i.KINEMATIC=4,i.AWAKE=0,i.SLEEPY=1,i.SLEEPING=2,i.idCounter=0,i.prototype.wakeUp=function(){var e=this.sleepState;this.sleepState=0,e===i.SLEEPING&&this.dispatchEvent({type:\"wakeup\"})},i.prototype.sleep=function(){this.sleepState=i.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},i.sleepyEvent={type:\"sleepy\"},i.sleepEvent={type:\"sleep\"},i.prototype.sleepTick=function(e){if(this.allowSleep){var t=this.sleepState,n=this.velocity.norm2()+this.angularVelocity.norm2(),r=Math.pow(this.sleepSpeedLimit,2);t===i.AWAKE&&r>n?(this.sleepState=i.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(i.sleepyEvent)):t===i.SLEEPY&&n>r?this.wakeUp():t===i.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(i.sleepEvent))}},i.prototype.updateSolveMassProperties=function(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},i.prototype.pointToLocalFrame=function(e,t){return t=t||new r,e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t},i.prototype.vectorToLocalFrame=function(e,t){return t=t||new r,this.quaternion.conjugate().vmult(e,t),t},i.prototype.pointToWorldFrame=function(e,t){return t=t||new r,this.quaternion.vmult(e,t),t.vadd(this.position,t),t},i.prototype.vectorToWorldFrame=function(e,t){return t=t||new r,this.quaternion.vmult(e,t),t};var c=new r,h=new a;i.prototype.addShape=function(e,t,i){var n=new r,o=new a;return t&&n.copy(t),i&&o.copy(i),this.shapes.push(e),this.shapeOffsets.push(n),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},i.prototype.updateBoundingRadius=function(){for(var e=this.shapes,t=this.shapeOffsets,i=e.length,n=0,r=0;r!==i;r++){var o=e[r];o.updateBoundingSphereRadius();var a=t[r].norm(),s=o.boundingSphereRadius;a+s>n&&(n=a+s)}this.boundingRadius=n};var u=new s;i.prototype.computeAABB=function(){for(var e=this.shapes,t=this.shapeOffsets,i=this.shapeOrientations,n=e.length,r=c,o=h,a=this.quaternion,s=this.aabb,l=u,p=0;p!==n;p++){var d=e[p];i[p].mult(a,o),o.vmult(t[p],r),r.vadd(this.position,r),d.calculateWorldAABB(r,o,l.lowerBound,l.upperBound),0===p?s.copy(l):s.extend(l)}this.aabbNeedsUpdate=!1};var p=new o,d=new o;new o,i.prototype.updateInertiaWorld=function(e){var t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){var i=p,n=d;i.setRotationFromQuaternion(this.quaternion),i.transpose(n),i.scale(t,i),i.mmult(n,this.invInertiaWorld)}};var f=new r,m=new r;i.prototype.applyForce=function(e,t){if(this.type===i.DYNAMIC){var n=f;t.vsub(this.position,n);var r=m;n.cross(e,r),this.force.vadd(e,this.force),this.torque.vadd(r,this.torque)}};var g=new r,v=new r;i.prototype.applyLocalForce=function(e,t){if(this.type===i.DYNAMIC){var n=g,r=v;this.vectorToWorldFrame(e,n),this.pointToWorldFrame(t,r),this.applyForce(n,r)}};var y=new r,x=new r,b=new r;i.prototype.applyImpulse=function(e,t){if(this.type===i.DYNAMIC){var n=y;t.vsub(this.position,n);var r=x;r.copy(e),r.mult(this.invMass,r),this.velocity.vadd(r,this.velocity);var o=b;n.cross(e,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}};var w=new r,M=new r;i.prototype.applyLocalImpulse=function(e,t){if(this.type===i.DYNAMIC){var n=w,r=M;this.vectorToWorldFrame(e,n),this.pointToWorldFrame(t,r),this.applyImpulse(n,r)}};var E=new r;i.prototype.updateMassProperties=function(){var e=E;this.invMass=this.mass>0?1/this.mass:0;var t=this.inertia,i=this.fixedRotation;this.computeAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),l.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!i?1/t.x:0,t.y>0&&!i?1/t.y:0,t.z>0&&!i?1/t.z:0),this.updateInertiaWorld(!0)},i.prototype.getVelocityAtWorldPoint=function(e,t){var i=new r;return e.vsub(this.position,i),this.angularVelocity.cross(i,t),this.velocity.vadd(t,t),t}},{\"../collision/AABB\":3,\"../material/Material\":25,\"../math/Mat3\":27,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../shapes/Box\":37,\"../shapes/Shape\":43,\"../utils/EventTarget\":49}],32:[function(e,t){function i(e){this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==e.indexRightAxis?e.indexRightAxis:1,this.indexForwardAxis=void 0!==e.indexForwardAxis?e.indexForwardAxis:0,this.indexUpAxis=void 0!==e.indexUpAxis?e.indexUpAxis:2}function n(e,t,i,n,o){var a=0,s=i,l=x,c=b,h=w;return e.getVelocityAtWorldPoint(s,l),t.getVelocityAtWorldPoint(s,c),l.vsub(c,h),(a=-n.dot(h)*(1/(r(e,i,n)+r(t,i,n))))>o&&(a=o),-o>a&&(a=-o),a}function r(e,t,i){var n=M,r=E,o=_,a=S;return t.vsub(e.position,n),n.cross(i,r),e.invInertiaWorld.vmult(r,a),a.cross(n,o),e.invMass+i.dot(o)}function o(e,t,i,n,r,o){if(r.norm2()>1.1)return 0;var a=T,s=A,l=C;return e.getVelocityAtWorldPoint(t,a),i.getVelocityAtWorldPoint(n,s),a.vsub(s,l),-.2*r.dot(l)*(1/(e.invMass+i.invMass))}var a=(e(\"./Body\"),e(\"../math/Vec3\")),s=e(\"../math/Quaternion\"),l=(e(\"../collision/RaycastResult\"),e(\"../collision/Ray\")),c=e(\"../objects/WheelInfo\");t.exports=i;var h=(new a,new a,new a,new a),u=new a,p=new a;new l,i.prototype.addWheel=function(e){var t=new c(e=e||{}),i=this.wheelInfos.length;return this.wheelInfos.push(t),i},i.prototype.setSteeringValue=function(e,t){this.wheelInfos[t].steering=e},new a,i.prototype.applyEngineForce=function(e,t){this.wheelInfos[t].engineForce=e},i.prototype.setBrake=function(e,t){this.wheelInfos[t].brake=e},i.prototype.addToWorld=function(e){this.constraints,e.add(this.chassisBody);var t=this;this.preStepCallback=function(){t.updateVehicle(e.dt)},e.addEventListener(\"preStep\",this.preStepCallback),this.world=e},i.prototype.getVehicleAxisWorld=function(e,t){t.set(0===e?1:0,1===e?1:0,2===e?1:0),this.chassisBody.vectorToWorldFrame(t,t)},i.prototype.updateVehicle=function(e){for(var t=this.wheelInfos,i=t.length,n=this.chassisBody,r=0;i>r;r++)this.updateWheelTransform(r);this.currentVehicleSpeedKmHour=3.6*n.velocity.norm();var o=new a;for(this.getVehicleAxisWorld(this.indexForwardAxis,o),o.dot(n.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),r=0;i>r;r++)this.castRay(t[r]);this.updateSuspension(e);var s=new a,l=new a;for(r=0;i>r;r++){var c=(d=t[r]).suspensionForce;c>d.maxSuspensionForce&&(c=d.maxSuspensionForce),d.raycastResult.hitNormalWorld.scale(c*e,s),d.raycastResult.hitPointWorld.vsub(n.position,l),n.applyImpulse(s,d.raycastResult.hitPointWorld)}this.updateFriction(e);var h=new a,u=new a,p=new a;for(r=0;i>r;r++){var d=t[r];n.getVelocityAtWorldPoint(d.chassisConnectionPointWorld,p);var f=1;switch(this.indexUpAxis){case 1:f=-1}if(d.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,u);var m=u.dot(d.raycastResult.hitNormalWorld);d.raycastResult.hitNormalWorld.scale(m,h),u.vsub(h,u);var g=u.dot(p);d.deltaRotation=f*g*e/d.radius}!d.sliding&&d.isInContact||0===d.engineForce||!d.useCustomSlidingRotationalSpeed||(d.deltaRotation=(d.engineForce>0?1:-1)*d.customSlidingRotationalSpeed*e),Math.abs(d.brake)>Math.abs(d.engineForce)&&(d.deltaRotation=0),d.rotation+=d.deltaRotation,d.deltaRotation*=.99}},i.prototype.updateSuspension=function(){for(var e=this.chassisBody.mass,t=this.wheelInfos,i=t.length,n=0;i>n;n++){var r=t[n];if(r.isInContact){var o,a=r.suspensionRestLength-r.suspensionLength;o=r.suspensionStiffness*a*r.clippedInvContactDotSuspension;var s=r.suspensionRelativeVelocity;o-=(0>s?r.dampingCompression:r.dampingRelaxation)*s,r.suspensionForce=o*e,r.suspensionForce<0&&(r.suspensionForce=0)}else r.suspensionForce=0}},i.prototype.removeFromWorld=function(e){this.constraints,e.remove(this.chassisBody),e.removeEventListener(\"preStep\",this.preStepCallback),this.world=null};var d=new a,f=new a;i.prototype.castRay=function(e){var t=d,i=f;this.updateWheelTransformWorld(e);var n=this.chassisBody,r=-1,o=e.suspensionRestLength+e.radius;e.directionWorld.scale(o,t);var s=e.chassisConnectionPointWorld;s.vadd(t,i);var l=e.raycastResult;l.reset();var c=n.collisionResponse;n.collisionResponse=!1,this.world.rayTest(s,i,l),n.collisionResponse=c;var h=l.body;if(e.raycastResult.groundObject=0,h){r=l.distance,e.raycastResult.hitNormalWorld=l.hitNormalWorld,e.isInContact=!0;var u=l.distance;e.suspensionLength=u-e.radius;var p=e.suspensionRestLength-e.maxSuspensionTravel,m=e.suspensionRestLength+e.maxSuspensionTravel;e.suspensionLength<p&&(e.suspensionLength=p),e.suspensionLength>m&&(e.suspensionLength=m,e.raycastResult.reset());var g=e.raycastResult.hitNormalWorld.dot(e.directionWorld),v=new a;n.getVelocityAtWorldPoint(e.raycastResult.hitPointWorld,v);var y=e.raycastResult.hitNormalWorld.dot(v);if(g>=-.1)e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10;else{var x=-1/g;e.suspensionRelativeVelocity=y*x,e.clippedInvContactDotSuspension=x}}else e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.raycastResult.hitNormalWorld),e.clippedInvContactDotSuspension=1;return r},i.prototype.updateWheelTransformWorld=function(e){e.isInContact=!1;var t=this.chassisBody;t.pointToWorldFrame(e.chassisConnectionPointLocal,e.chassisConnectionPointWorld),t.vectorToWorldFrame(e.directionLocal,e.directionWorld),t.vectorToWorldFrame(e.axleLocal,e.axleWorld)},i.prototype.updateWheelTransform=function(e){var t=h,i=u,n=p,r=this.wheelInfos[e];this.updateWheelTransformWorld(r),r.directionLocal.scale(-1,t),i.copy(r.axleLocal),t.cross(i,n),n.normalize(),i.normalize();var o=r.steering,a=new s;a.setFromAxisAngle(t,o);var l=new s;l.setFromAxisAngle(i,r.rotation);var c=r.worldTransform.quaternion;this.chassisBody.quaternion.mult(a,c),c.mult(l,c),c.normalize();var d=r.worldTransform.position;d.copy(r.directionWorld),d.scale(r.suspensionLength,d),d.vadd(r.chassisConnectionPointWorld,d)};var m=[new a(1,0,0),new a(0,1,0),new a(0,0,1)];i.prototype.getWheelTransformWorld=function(e){return this.wheelInfos[e].worldTransform};var g=new a,v=[],y=[];i.prototype.updateFriction=function(e){for(var t=g,i=this.wheelInfos,r=i.length,s=this.chassisBody,l=y,c=v,h=0;r>h;h++)f=(A=i[h]).raycastResult.body,A.sideImpulse=0,A.forwardImpulse=0,l[h]||(l[h]=new a),c[h]||(c[h]=new a);for(h=0;r>h;h++)if(f=(A=i[h]).raycastResult.body){var u=c[h];this.getWheelTransformWorld(h).vectorToWorldFrame(m[this.indexRightAxis],u);var p=A.raycastResult.hitNormalWorld,d=u.dot(p);p.scale(d,t),u.vsub(t,u),u.normalize(),p.cross(u,l[h]),l[h].normalize(),A.sideImpulse=o(s,A.raycastResult.hitPointWorld,f,A.raycastResult.hitPointWorld,u),A.sideImpulse*=1}for(this.sliding=!1,h=0;r>h;h++){var f=(A=i[h]).raycastResult.body,x=0;if(A.slipInfo=1,f){var b=A.brake?A.brake:0;x=n(s,f,A.raycastResult.hitPointWorld,l[h],b);var w=b/(x+=A.engineForce*e);A.slipInfo*=w}if(A.forwardImpulse=0,A.skidInfo=1,f){A.skidInfo=1;var M=A.suspensionForce*e*A.frictionSlip,E=M*M;A.forwardImpulse=x;var _=.5*A.forwardImpulse,S=1*A.sideImpulse,T=_*_+S*S;A.sliding=!1,T>E&&(this.sliding=!0,A.sliding=!0,w=M/Math.sqrt(T),A.skidInfo*=w)}}if(this.sliding)for(h=0;r>h;h++)0!==(A=i[h]).sideImpulse&&A.skidInfo<1&&(A.forwardImpulse*=A.skidInfo,A.sideImpulse*=A.skidInfo);for(h=0;r>h;h++){var A=i[h],C=new a;if(C.copy(A.raycastResult.hitPointWorld),0!==A.forwardImpulse){var R=new a;l[h].scale(A.forwardImpulse,R),s.applyImpulse(R,C)}if(0!==A.sideImpulse){f=A.raycastResult.body;var L=new a;L.copy(A.raycastResult.hitPointWorld);var P=new a;c[h].scale(A.sideImpulse,P),s.pointToLocalFrame(C,C),C[\"xyz\"[this.indexUpAxis]]*=A.rollInfluence,s.pointToWorldFrame(C,C),s.applyImpulse(P,C),P.scale(-1,P),f.applyImpulse(P,L)}}};var x=new a,b=new a,w=new a,M=new a,E=new a,_=new a,S=new a,T=new a,A=new a,C=new a},{\"../collision/Ray\":9,\"../collision/RaycastResult\":10,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/WheelInfo\":36,\"./Body\":31}],33:[function(e,t){function i(e){if(this.wheelBodies=[],this.coordinateSystem=void 0===e.coordinateSystem?new a(1,2,3):e.coordinateSystem.clone(),this.chassisBody=e.chassisBody,!this.chassisBody){var t=new o(new a(5,2,.5));this.chassisBody=new n(1,t)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var n=e(\"./Body\"),r=e(\"../shapes/Sphere\"),o=e(\"../shapes/Box\"),a=e(\"../math/Vec3\"),s=e(\"../constraints/HingeConstraint\");t.exports=i,i.prototype.addWheel=function(e){var t=(e=e||{}).body;t||(t=new n(1,new r(1.2))),this.wheelBodies.push(t),this.wheelForces.push(0);var i=(new a,void 0!==e.position?e.position.clone():new a),o=new a;this.chassisBody.pointToWorldFrame(i,o),t.position.set(o.x,o.y,o.z);var l=void 0!==e.axis?e.axis.clone():new a(0,1,0);this.wheelAxes.push(l);var c=new s(this.chassisBody,t,{pivotA:i,axisA:l,pivotB:a.ZERO,axisB:l,collideConnected:!1});return this.constraints.push(c),this.wheelBodies.length-1},i.prototype.setSteeringValue=function(e,t){var i=this.wheelAxes[t],n=Math.cos(e),r=Math.sin(e),o=i.x,a=i.y;this.constraints[t].axisA.set(n*o-r*a,r*o+n*a,0)},i.prototype.setMotorSpeed=function(e,t){var i=this.constraints[t];i.enableMotor(),i.motorTargetVelocity=e},i.prototype.disableMotor=function(e){this.constraints[e].disableMotor()};var l=new a;i.prototype.setWheelForce=function(e,t){this.wheelForces[t]=e},i.prototype.applyWheelForce=function(e,t){var i=this.wheelAxes[t],n=this.wheelBodies[t],r=n.torque;i.scale(e,l),n.vectorToWorldFrame(l,l),r.vadd(l,r)},i.prototype.addToWorld=function(e){for(var t=this.constraints,i=this.wheelBodies.concat([this.chassisBody]),n=0;n<i.length;n++)e.add(i[n]);for(n=0;n<t.length;n++)e.addConstraint(t[n]);e.addEventListener(\"preStep\",this._update.bind(this))},i.prototype._update=function(){for(var e=this.wheelForces,t=0;t<e.length;t++)this.applyWheelForce(e[t],t)},i.prototype.removeFromWorld=function(e){for(var t=this.constraints,i=this.wheelBodies.concat([this.chassisBody]),n=0;n<i.length;n++)e.remove(i[n]);for(n=0;n<t.length;n++)e.removeConstraint(t[n])};var c=new a;i.prototype.getWheelSpeed=function(e){var t=this.wheelAxes[e],i=this.wheelBodies[e].angularVelocity;return this.chassisBody.vectorToWorldFrame(t,c),i.dot(c)}},{\"../constraints/HingeConstraint\":15,\"../math/Vec3\":30,\"../shapes/Box\":37,\"../shapes/Sphere\":44,\"./Body\":31}],34:[function(e,t){function i(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t.exports=i;var n=(e(\"../shapes/Shape\"),e(\"../math/Vec3\"));e(\"../math/Quaternion\"),e(\"../shapes/Particle\"),e(\"../objects/Body\"),e(\"../material/Material\"),i.prototype.add=function(e){this.particles.push(e),this.neighbors.length<this.particles.length&&this.neighbors.push([])},i.prototype.remove=function(e){var t=this.particles.indexOf(e);-1!==t&&(this.particles.splice(t,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var r=new n;i.prototype.getNeighbors=function(e,t){for(var i=this.particles.length,n=e.id,o=this.smoothingRadius*this.smoothingRadius,a=r,s=0;s!==i;s++){var l=this.particles[s];l.position.vsub(e.position,a),n!==l.id&&a.norm2()<o&&t.push(l)}};var o=new n,a=new n,s=new n,l=new n,c=new n,h=new n;i.prototype.update=function(){for(var e=this.particles.length,t=o,i=this.speedOfSound,n=this.eps,r=0;r!==e;r++){var u=this.particles[r];(_=this.neighbors[r]).length=0,this.getNeighbors(u,_),_.push(this.particles[r]);for(var p=_.length,d=0,f=0;f!==p;f++){u.position.vsub(_[f].position,t);var m=t.norm(),g=this.w(m);d+=_[f].mass*g}this.densities[r]=d,this.pressures[r]=i*i*(this.densities[r]-this.density)}var v=a,y=s,x=l,b=c,w=h;for(r=0;r!==e;r++){var M,E,_,S=this.particles[r];for(v.set(0,0,0),y.set(0,0,0),p=(_=this.neighbors[r]).length,f=0;f!==p;f++){var T=_[f];S.position.vsub(T.position,b);var A=b.norm();M=-T.mass*(this.pressures[r]/(this.densities[r]*this.densities[r]+n)+this.pressures[f]/(this.densities[f]*this.densities[f]+n)),this.gradw(b,x),x.mult(M,x),v.vadd(x,v),T.velocity.vsub(S.velocity,w),w.mult(1/(1e-4+this.densities[r]*this.densities[f])*this.viscosity*T.mass,w),E=this.nablaw(A),w.mult(E,w),y.vadd(w,y)}y.mult(S.mass,y),v.mult(S.mass,v),S.force.vadd(y,S.force),S.force.vadd(v,S.force)}},i.prototype.w=function(e){var t=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(t,9))*Math.pow(t*t-e*e,3)},i.prototype.gradw=function(e,t){var i=e.norm(),n=this.smoothingRadius;e.mult(945/(32*Math.PI*Math.pow(n,9))*Math.pow(n*n-i*i,2),t)},i.prototype.nablaw=function(e){var t=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(t,9))*(t*t-e*e)*(7*e*e-3*t*t)}},{\"../material/Material\":25,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/Body\":31,\"../shapes/Particle\":41,\"../shapes/Shape\":43}],35:[function(e,t){function i(e,t,i){i=i||{},this.restLength=\"number\"==typeof i.restLength?i.restLength:1,this.stiffness=i.stiffness||100,this.damping=i.damping||1,this.bodyA=e,this.bodyB=t,this.localAnchorA=new n,this.localAnchorB=new n,i.localAnchorA&&this.localAnchorA.copy(i.localAnchorA),i.localAnchorB&&this.localAnchorB.copy(i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB)}var n=e(\"../math/Vec3\");t.exports=i,i.prototype.setWorldAnchorA=function(e){this.bodyA.pointToLocalFrame(e,this.localAnchorA)},i.prototype.setWorldAnchorB=function(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)},i.prototype.getWorldAnchorA=function(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)},i.prototype.getWorldAnchorB=function(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)};var r=new n,o=new n,a=new n,s=new n,l=new n,c=new n,h=new n,u=new n,p=new n,d=new n,f=new n;i.prototype.applyForce=function(){var e=this.stiffness,t=this.damping,i=this.restLength,n=this.bodyA,m=this.bodyB,g=r,v=o,y=a,x=s,b=f,w=l,M=c,E=h,_=u,S=p,T=d;this.getWorldAnchorA(w),this.getWorldAnchorB(M),w.vsub(n.position,E),M.vsub(m.position,_),M.vsub(w,g);var A=g.norm();v.copy(g),v.normalize(),m.velocity.vsub(n.velocity,y),m.angularVelocity.cross(_,b),y.vadd(b,y),n.angularVelocity.cross(E,b),y.vsub(b,y),v.mult(-e*(A-i)-t*y.dot(v),x),n.force.vsub(x,n.force),m.force.vadd(x,m.force),E.cross(x,S),_.cross(x,T),n.torque.vsub(S,n.torque),m.torque.vadd(T,m.torque)}},{\"../math/Vec3\":30}],36:[function(e,t){function i(e){e=a.defaults(e,{chassisConnectionPointLocal:new n,chassisConnectionPointWorld:new n,directionLocal:new n,directionWorld:new n,axleLocal:new n,axleWorld:new n,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=e.maxSuspensionTravel,this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=e.chassisConnectionPointWorld.clone(),this.directionLocal=e.directionLocal.clone(),this.directionWorld=e.directionWorld.clone(),this.axleLocal=e.axleLocal.clone(),this.axleWorld=e.axleWorld.clone(),this.suspensionRestLength=e.suspensionRestLength,this.suspensionMaxLength=e.suspensionMaxLength,this.radius=e.radius,this.suspensionStiffness=e.suspensionStiffness,this.dampingCompression=e.dampingCompression,this.dampingRelaxation=e.dampingRelaxation,this.frictionSlip=e.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=e.rollInfluence,this.maxSuspensionForce=e.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=e.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new o,this.worldTransform=new r,this.isInContact=!1}var n=e(\"../math/Vec3\"),r=e(\"../math/Transform\"),o=e(\"../collision/RaycastResult\"),a=e(\"../utils/Utils\");t.exports=i;var s=new n,l=new n;s=new n,i.prototype.updateWheel=function(e){var t=this.raycastResult;if(this.isInContact){var i=t.hitNormalWorld.dot(t.directionWorld);t.hitPointWorld.vsub(e.position,l),e.getVelocityAtWorldPoint(l,s);var n=t.hitNormalWorld.dot(s);if(i>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var r=-1/i;this.suspensionRelativeVelocity=n*r,this.clippedInvContactDotSuspension=r}}else t.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{\"../collision/RaycastResult\":10,\"../math/Transform\":29,\"../math/Vec3\":30,\"../utils/Utils\":53}],37:[function(e,t){function i(e){n.call(this),this.type=n.types.BOX,this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}t.exports=i;var n=e(\"./Shape\"),r=e(\"../math/Vec3\"),o=e(\"./ConvexPolyhedron\");i.prototype=new n,i.prototype.constructor=i,i.prototype.updateConvexPolyhedronRepresentation=function(){var e=this.halfExtents.x,t=this.halfExtents.y,i=this.halfExtents.z,n=r,a=[new n(-e,-t,-i),new n(e,-t,-i),new n(e,t,-i),new n(-e,t,-i),new n(-e,-t,i),new n(e,-t,i),new n(e,t,i),new n(-e,t,i)],s=(new n(0,0,1),new n(0,1,0),new n(1,0,0),new o(a,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=s,s.material=this.material},i.prototype.calculateLocalInertia=function(e,t){return t=t||new r,i.calculateInertia(this.halfExtents,e,t),t},i.calculateInertia=function(e,t,i){var n=e;i.x=1/12*t*(2*n.y*2*n.y+2*n.z*2*n.z),i.y=1/12*t*(2*n.x*2*n.x+2*n.z*2*n.z),i.z=1/12*t*(2*n.y*2*n.y+2*n.x*2*n.x)},i.prototype.getSideNormals=function(e,t){var i=e,n=this.halfExtents;if(i[0].set(n.x,0,0),i[1].set(0,n.y,0),i[2].set(0,0,n.z),i[3].set(-n.x,0,0),i[4].set(0,-n.y,0),i[5].set(0,0,-n.z),void 0!==t)for(var r=0;r!==i.length;r++)t.vmult(i[r],i[r]);return i},i.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new r;new r,i.prototype.forEachWorldCorner=function(e,t,i){for(var n=this.halfExtents,r=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]],o=0;o<r.length;o++)a.set(r[o][0],r[o][1],r[o][2]),t.vmult(a,a),e.vadd(a,a),i(a.x,a.y,a.z)};var s=[new r,new r,new r,new r,new r,new r,new r,new r];i.prototype.calculateWorldAABB=function(e,t,i,n){var r=this.halfExtents;s[0].set(r.x,r.y,r.z),s[1].set(-r.x,r.y,r.z),s[2].set(-r.x,-r.y,r.z),s[3].set(-r.x,-r.y,-r.z),s[4].set(r.x,-r.y,-r.z),s[5].set(r.x,r.y,-r.z),s[6].set(-r.x,r.y,-r.z),s[7].set(r.x,-r.y,r.z);var o=s[0];t.vmult(o,o),e.vadd(o,o),n.copy(o),i.copy(o);for(var a=1;8>a;a++){o=s[a],t.vmult(o,o),e.vadd(o,o);var l=o.x,c=o.y,h=o.z;l>n.x&&(n.x=l),c>n.y&&(n.y=c),h>n.z&&(n.z=h),l<i.x&&(i.x=l),c<i.y&&(i.y=c),h<i.z&&(i.z=h)}}},{\"../math/Vec3\":30,\"./ConvexPolyhedron\":38,\"./Shape\":43}],38:[function(e,t){function i(e,t,i){n.call(this),this.type=n.types.CONVEXPOLYHEDRON,this.vertices=e||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=t||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=i?i.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}t.exports=i;var n=e(\"./Shape\"),r=e(\"../math/Vec3\"),o=(e(\"../math/Quaternion\"),e(\"../math/Transform\"));i.prototype=new n,i.prototype.constructor=i;var a=new r;i.prototype.computeEdges=function(){var e=this.faces,t=this.vertices,i=(t.length,this.uniqueEdges);i.length=0;for(var n=a,r=0;r!==e.length;r++)for(var o=e[r],s=o.length,l=0;l!==s;l++){var c=(l+1)%s;t[o[l]].vsub(t[o[c]],n),n.normalize();for(var h=!1,u=0;u!==i.length;u++)if(i[u].almostEquals(n)||i[u].almostEquals(n)){h=!0;break}h||i.push(n.clone())}},i.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error(\"Vertex \"+this.faces[e][t]+\" not found!\");var i=this.faceNormals[e]||new r;this.getFaceNormal(e,i),i.negate(i),this.faceNormals[e]=i;var n=this.vertices[this.faces[e][0]];if(i.dot(n)<0)for(console.error(\".faceNormals[\"+e+\"] = Vec3(\"+i.toString()+\") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.\"),t=0;t<this.faces[e].length;t++)console.warn(\".vertices[\"+this.faces[e][t]+\"] = Vec3(\"+this.vertices[this.faces[e][t]].toString()+\")\")}};var s=new r,l=new r;i.computeNormal=function(e,t,i,n){t.vsub(e,l),i.vsub(t,s),s.cross(l,n),n.isZero()||n.normalize()},i.prototype.getFaceNormal=function(e,t){var n=this.faces[e],r=this.vertices[n[0]],o=this.vertices[n[1]],a=this.vertices[n[2]];return i.computeNormal(r,o,a,t)};var c=new r;i.prototype.clipAgainstHull=function(e,t,i,n,o,a,s,l,h){for(var u=c,p=-1,d=-Number.MAX_VALUE,f=0;f<i.faces.length;f++){u.copy(i.faceNormals[f]),o.vmult(u,u);var m=u.dot(a);m>d&&(d=m,p=f)}for(var g=[],v=i.faces[p],y=v.length,x=0;y>x;x++){var b=i.vertices[v[x]],w=new r;w.copy(b),o.vmult(w,w),n.vadd(w,w),g.push(w)}p>=0&&this.clipFaceAgainstHull(a,e,t,g,s,l,h)};var h=new r,u=new r,p=new r,d=new r,f=new r,m=new r;i.prototype.findSeparatingAxis=function(e,t,i,n,r,o,a,s){var l=h,c=u,g=p,v=d,y=f,x=m,b=Number.MAX_VALUE,w=this;if(w.uniqueAxes)for(var M=0;M!==w.uniqueAxes.length;M++){if(i.vmult(w.uniqueAxes[M],l),!1===(T=w.testSepAxis(l,e,t,i,n,r)))return!1;b>T&&(b=T,o.copy(l))}else{var E=a?a.length:w.faces.length;for(M=0;E>M;M++){var _=a?a[M]:M;if(l.copy(w.faceNormals[_]),i.vmult(l,l),!1===(T=w.testSepAxis(l,e,t,i,n,r)))return!1;b>T&&(b=T,o.copy(l))}}if(e.uniqueAxes)for(M=0;M!==e.uniqueAxes.length;M++){if(r.vmult(e.uniqueAxes[M],c),!1===(T=w.testSepAxis(c,e,t,i,n,r)))return!1;b>T&&(b=T,o.copy(c))}else{var S=s?s.length:e.faces.length;for(M=0;S>M;M++){var T;if(_=s?s[M]:M,c.copy(e.faceNormals[_]),r.vmult(c,c),!1===(T=w.testSepAxis(c,e,t,i,n,r)))return!1;b>T&&(b=T,o.copy(c))}}for(var A=0;A!==w.uniqueEdges.length;A++){i.vmult(w.uniqueEdges[A],v);for(var C=0;C!==e.uniqueEdges.length;C++)if(r.vmult(e.uniqueEdges[C],y),v.cross(y,x),!x.almostZero()){x.normalize();var R=w.testSepAxis(x,e,t,i,n,r);if(!1===R)return!1;b>R&&(b=R,o.copy(x))}}return n.vsub(t,g),g.dot(o)>0&&o.negate(o),!0};var g=[],v=[];i.prototype.testSepAxis=function(e,t,n,r,o,a){i.project(this,e,n,r,g),i.project(t,e,o,a,v);var s=g[0],l=g[1],c=v[0],h=v[1];if(h>s||l>c)return!1;var u=s-h,p=c-l;return p>u?u:p};var y=new r,x=new r;i.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(y,x);var i=x.x-y.x,n=x.y-y.y,r=x.z-y.z;t.x=1/12*e*(2*n*2*n+2*r*2*r),t.y=1/12*e*(2*i*2*i+2*r*2*r),t.z=1/12*e*(2*n*2*n+2*i*2*i)},i.prototype.getPlaneConstantOfFace=function(e){var t=this.faces[e],i=this.faceNormals[e],n=this.vertices[t[0]];return-i.dot(n)};var b=new r,w=new r,M=new r,E=new r,_=new r,S=new r,T=new r,A=new r;i.prototype.clipFaceAgainstHull=function(e,t,i,n,r,o,a){for(var s=b,l=w,c=M,h=E,u=_,p=S,d=T,f=A,m=this,g=n,v=[],y=-1,x=Number.MAX_VALUE,C=0;C<m.faces.length;C++){s.copy(m.faceNormals[C]),i.vmult(s,s);var R=s.dot(e);x>R&&(x=R,y=C)}if(!(0>y)){var L=m.faces[y];L.connectedFaces=[];for(var P=0;P<m.faces.length;P++)for(var N=0;N<m.faces[P].length;N++)-1!==L.indexOf(m.faces[P][N])&&P!==y&&-1===L.connectedFaces.indexOf(P)&&L.connectedFaces.push(P);for(var B=(g.length,L.length),z=0;B>z;z++){var O=m.vertices[L[z]],F=m.vertices[L[(z+1)%B]];O.vsub(F,l),c.copy(l),i.vmult(c,c),t.vadd(c,c),h.copy(this.faceNormals[y]),i.vmult(h,h),t.vadd(h,h),c.cross(h,u),u.negate(u),p.copy(O),i.vmult(p,p),t.vadd(p,p);var I=(p.dot(u),L.connectedFaces[z]);d.copy(this.faceNormals[I]);var D=this.getPlaneConstantOfFace(I);f.copy(d),i.vmult(f,f);var H=D-f.dot(t);for(this.clipFaceAgainstPlane(g,v,f,H);g.length;)g.shift();for(;v.length;)g.push(v.shift())}for(d.copy(this.faceNormals[y]),D=this.getPlaneConstantOfFace(y),f.copy(d),i.vmult(f,f),H=D-f.dot(t),P=0;P<g.length;P++){var j=f.dot(g[P])+H;if(r>=j&&(console.log(\"clamped: depth=\"+j+\" to minDist=\"+r),j=r),o>=j){var V=g[P];if(0>=j){var k={point:V,normal:f,depth:j};a.push(k)}}}}},i.prototype.clipFaceAgainstPlane=function(e,t,i,n){var o,a,s=e.length;if(2>s)return t;var l=e[e.length-1],c=e[0];o=i.dot(l)+n;for(var h=0;s>h;h++){if(c=e[h],a=i.dot(c)+n,0>o)if(0>a)(u=new r).copy(c),t.push(u);else{var u=new r;l.lerp(c,o/(o-a),u),t.push(u)}else 0>a&&(u=new r,l.lerp(c,o/(o-a),u),t.push(u),t.push(c));l=c,o=a}return t},i.prototype.computeWorldVertices=function(e,t){for(var i=this.vertices.length;this.worldVertices.length<i;)this.worldVertices.push(new r);for(var n=this.vertices,o=this.worldVertices,a=0;a!==i;a++)t.vmult(n[a],o[a]),e.vadd(o[a],o[a]);this.worldVerticesNeedsUpdate=!1},new r,i.prototype.computeLocalAABB=function(e,t){var i=this.vertices.length,n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;i>r;r++){var o=n[r];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}},i.prototype.computeWorldFaceNormals=function(e){for(var t=this.faceNormals.length;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new r);for(var i=this.faceNormals,n=this.worldFaceNormals,o=0;o!==t;o++)e.vmult(i[o],n[o]);this.worldFaceNormalsNeedsUpdate=!1},i.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,i=0,n=t.length;i!==n;i++){var r=t[i].norm2();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)};var C=new r;i.prototype.calculateWorldAABB=function(e,t,i,n){for(var r,o,a,s,l,c,h=this.vertices.length,u=this.vertices,p=0;h>p;p++){C.copy(u[p]),t.vmult(C,C),e.vadd(C,C);var d=C;d.x<r||void 0===r?r=d.x:(d.x>s||void 0===s)&&(s=d.x),d.y<o||void 0===o?o=d.y:(d.y>l||void 0===l)&&(l=d.y),d.z<a||void 0===a?a=d.z:(d.z>c||void 0===c)&&(c=d.z)}i.set(r,o,a),n.set(s,l,c)},i.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},i.prototype.getAveragePointLocal=function(e){e=e||new r;for(var t=this.vertices.length,i=this.vertices,n=0;t>n;n++)e.vadd(i[n],e);return e.mult(1/t,e),e},i.prototype.transformAllPoints=function(e,t){var i=this.vertices.length,n=this.vertices;if(t){for(var r=0;i>r;r++){var o=n[r];t.vmult(o,o)}for(r=0;r<this.faceNormals.length;r++)o=this.faceNormals[r],t.vmult(o,o)}if(e)for(r=0;i>r;r++)(o=n[r]).vadd(e,o)};var R=new r,L=new r,P=new r;i.prototype.pointIsInside=function(e){var t=this.vertices.length,i=this.vertices,n=this.faces,r=this.faceNormals,o=this.faces.length,a=R;this.getAveragePointLocal(a);for(var s=0;o>s;s++){this.faces[s].length,t=r[s];var l=i[n[s][0]],c=L;e.vsub(l,c);var h=t.dot(c),u=P;a.vsub(l,u);var p=t.dot(u);if(0>h&&p>0||h>0&&0>p)return!1}return-1};var N=(new r,new r),B=new r;i.project=function(e,t,i,n,r){var a=e.vertices.length,s=N,l=0,c=0,h=B,u=e.vertices;h.setZero(),o.vectorToLocalFrame(i,n,t,s),o.pointToLocalFrame(i,n,h,h);var p=h.dot(s);c=l=u[0].dot(s);for(var d=1;a>d;d++){var f=u[d].dot(s);f>l&&(l=f),c>f&&(c=f)}if((c-=p)>(l-=p)){var m=c;c=l,l=m}r[0]=l,r[1]=c}},{\"../math/Quaternion\":28,\"../math/Transform\":29,\"../math/Vec3\":30,\"./Shape\":43}],39:[function(e,t){function i(e,t,i,a){var s=a,l=[],c=[],h=[],u=[],p=[],d=Math.cos,f=Math.sin;l.push(new r(t*d(0),t*f(0),.5*-i)),u.push(0),l.push(new r(e*d(0),e*f(0),.5*i)),p.push(1);for(var m=0;s>m;m++){var g=2*Math.PI/s*(m+1),v=2*Math.PI/s*(m+.5);s-1>m?(l.push(new r(t*d(g),t*f(g),.5*-i)),u.push(2*m+2),l.push(new r(e*d(g),e*f(g),.5*i)),p.push(2*m+3),h.push([2*m+2,2*m+3,2*m+1,2*m])):h.push([0,1,2*m+1,2*m]),(s%2==1||s/2>m)&&c.push(new r(d(v),f(v),0))}h.push(p),c.push(new r(0,0,1));var y=[];for(m=0;m<u.length;m++)y.push(u[u.length-m-1]);h.push(y),this.type=n.types.CONVEXPOLYHEDRON,o.call(this,l,h,c)}t.exports=i;var n=e(\"./Shape\"),r=e(\"../math/Vec3\"),o=(e(\"../math/Quaternion\"),e(\"./ConvexPolyhedron\"));i.prototype=new o},{\"../math/Quaternion\":28,\"../math/Vec3\":30,\"./ConvexPolyhedron\":38,\"./Shape\":43}],40:[function(e,t){function i(e,t){t=a.defaults(t,{maxValue:null,minValue:null,elementSize:1}),this.data=e,this.maxValue=t.maxValue,this.minValue=t.minValue,this.elementSize=t.elementSize,null===t.minValue&&this.updateMinValue(),null===t.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,n.call(this),this.pillarConvex=new r,this.pillarOffset=new o,this.type=n.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var n=e(\"./Shape\"),r=e(\"./ConvexPolyhedron\"),o=e(\"../math/Vec3\"),a=e(\"../utils/Utils\");t.exports=i,i.prototype=new n,i.prototype.update=function(){this._cachedPillars={}},i.prototype.updateMinValue=function(){for(var e=this.data,t=e[0][0],i=0;i!==e.length;i++)for(var n=0;n!==e[i].length;n++){var r=e[i][n];t>r&&(t=r)}this.minValue=t},i.prototype.updateMaxValue=function(){for(var e=this.data,t=e[0][0],i=0;i!==e.length;i++)for(var n=0;n!==e[i].length;n++){var r=e[i][n];r>t&&(t=r)}this.maxValue=t},i.prototype.setHeightValueAtIndex=function(e,t,i){this.data[e][t]=i,this.clearCachedConvexTrianglePillar(e,t,!1),e>0&&(this.clearCachedConvexTrianglePillar(e-1,t,!0),this.clearCachedConvexTrianglePillar(e-1,t,!1)),t>0&&(this.clearCachedConvexTrianglePillar(e,t-1,!0),this.clearCachedConvexTrianglePillar(e,t-1,!1)),t>0&&e>0&&this.clearCachedConvexTrianglePillar(e-1,t-1,!0)},i.prototype.getRectMinMax=function(e,t,i,n,r){r=r||[];for(var o=this.data,a=this.minValue,s=e;i>=s;s++)for(var l=t;n>=l;l++){var c=o[s][l];c>a&&(a=c)}r[0]=this.minValue,r[1]=a},i.prototype.getIndexOfPosition=function(e,t,i,n){var r=this.elementSize,o=this.data,a=Math.floor(e/r),s=Math.floor(t/r);return i[0]=a,i[1]=s,n&&(0>a&&(a=0),0>s&&(s=0),a>=o.length-1&&(a=o.length-1),s>=o[0].length-1&&(s=o[0].length-1)),!(0>a||0>s||a>=o.length-1||s>=o[0].length-1)},i.prototype.getHeightAt=function(e,t,i){var n=[];this.getIndexOfPosition(e,t,n,i);var r=[];return this.getRectMinMax(n[0],n[1]+1,n[0],n[1]+1,r),(r[0]+r[1])/2},i.prototype.getCacheConvexTrianglePillarKey=function(e,t,i){return e+\"_\"+t+\"_\"+(i?1:0)},i.prototype.getCachedConvexTrianglePillar=function(e,t,i){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,i)]},i.prototype.setCachedConvexTrianglePillar=function(e,t,i,n,r){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,i)]={convex:n,offset:r}},i.prototype.clearCachedConvexTrianglePillar=function(e,t,i){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,i)]},i.prototype.getConvexTrianglePillar=function(e,t,i){var n=this.pillarConvex,a=this.pillarOffset;if(this.cacheEnabled){if(s=this.getCachedConvexTrianglePillar(e,t,i))return this.pillarConvex=s.convex,void(this.pillarOffset=s.offset);n=new r,a=new o,this.pillarConvex=n,this.pillarOffset=a}var s=this.data,l=this.elementSize,c=n.faces;n.vertices.length=6;for(var h=0;6>h;h++)n.vertices[h]||(n.vertices[h]=new o);for(c.length=5,h=0;5>h;h++)c[h]||(c[h]=[]);var u=n.vertices,p=(Math.min(s[e][t],s[e+1][t],s[e][t+1],s[e+1][t+1])-this.minValue)/2+this.minValue;i?(a.set((e+.75)*l,(t+.75)*l,p),u[0].set(.25*l,.25*l,s[e+1][t+1]-p),u[1].set(-.75*l,.25*l,s[e][t+1]-p),u[2].set(.25*l,-.75*l,s[e+1][t]-p),u[3].set(.25*l,.25*l,-p-1),u[4].set(-.75*l,.25*l,-p-1),u[5].set(.25*l,-.75*l,-p-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=2,c[2][1]=5,c[2][2]=3,c[2][3]=0,c[3][0]=3,c[3][1]=4,c[3][2]=1,c[3][3]=0,c[4][0]=1,c[4][1]=4,c[4][2]=5,c[4][3]=2):(a.set((e+.25)*l,(t+.25)*l,p),u[0].set(-.25*l,-.25*l,s[e][t]-p),u[1].set(.75*l,-.25*l,s[e+1][t]-p),u[2].set(-.25*l,.75*l,s[e][t+1]-p),u[3].set(-.25*l,-.25*l,-p-1),u[4].set(.75*l,-.25*l,-p-1),u[5].set(-.25*l,.75*l,-p-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=0,c[2][1]=2,c[2][2]=5,c[2][3]=3,c[3][0]=1,c[3][1]=0,c[3][2]=3,c[3][3]=4,c[4][0]=4,c[4][1]=5,c[4][2]=2,c[4][3]=1),n.computeNormals(),n.computeEdges(),n.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(e,t,i,n,a)},i.prototype.calculateLocalInertia=function(e,t){return(t=t||new o).set(0,0,0),t},i.prototype.volume=function(){return Number.MAX_VALUE},i.prototype.calculateWorldAABB=function(e,t,i,n){i.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype.updateBoundingSphereRadius=function(){var e=this.data,t=this.elementSize;this.boundingSphereRadius=new o(e.length*t,e[0].length*t,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{\"../math/Vec3\":30,\"../utils/Utils\":53,\"./ConvexPolyhedron\":38,\"./Shape\":43}],41:[function(e,t){function i(){n.call(this),this.type=n.types.PARTICLE}t.exports=i;var n=e(\"./Shape\"),r=e(\"../math/Vec3\");i.prototype=new n,i.prototype.constructor=i,i.prototype.calculateLocalInertia=function(e,t){return(t=t||new r).set(0,0,0),t},i.prototype.volume=function(){return 0},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},i.prototype.calculateWorldAABB=function(e,t,i,n){i.copy(e),n.copy(e)}},{\"../math/Vec3\":30,\"./Shape\":43}],42:[function(e,t){function i(){n.call(this),this.type=n.types.PLANE,this.worldNormal=new r,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}t.exports=i;var n=e(\"./Shape\"),r=e(\"../math/Vec3\");i.prototype=new n,i.prototype.constructor=i,i.prototype.computeWorldNormal=function(e){var t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1},i.prototype.calculateLocalInertia=function(e,t){return t||new r},i.prototype.volume=function(){return Number.MAX_VALUE};var o=new r;i.prototype.calculateWorldAABB=function(e,t,i,n){o.set(0,0,1),t.vmult(o,o);var r=Number.MAX_VALUE;i.set(-r,-r,-r),n.set(r,r,r),1===o.x&&(n.x=e.x),1===o.y&&(n.y=e.y),1===o.z&&(n.z=e.z),-1===o.x&&(i.x=e.x),-1===o.y&&(i.y=e.y),-1===o.z&&(i.z=e.z)},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{\"../math/Vec3\":30,\"./Shape\":43}],43:[function(e,t){function i(){this.id=i.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t.exports=i;var i=e(\"./Shape\");e(\"../math/Vec3\"),e(\"../math/Quaternion\"),e(\"../material/Material\"),i.prototype.constructor=i,i.prototype.updateBoundingSphereRadius=function(){throw\"computeBoundingSphereRadius() not implemented for shape type \"+this.type},i.prototype.volume=function(){throw\"volume() not implemented for shape type \"+this.type},i.prototype.calculateLocalInertia=function(){throw\"calculateLocalInertia() not implemented for shape type \"+this.type},i.idCounter=0,i.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{\"../material/Material\":25,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"./Shape\":43}],44:[function(e,t){function i(e){if(n.call(this),this.radius=void 0!==e?Number(e):1,this.type=n.types.SPHERE,this.radius<0)throw new Error(\"The sphere radius cannot be negative.\");this.updateBoundingSphereRadius()}t.exports=i;var n=e(\"./Shape\"),r=e(\"../math/Vec3\");i.prototype=new n,i.prototype.constructor=i,i.prototype.calculateLocalInertia=function(e,t){t=t||new r;var i=2*e*this.radius*this.radius/5;return t.x=i,t.y=i,t.z=i,t},i.prototype.volume=function(){return 4*Math.PI*this.radius/3},i.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},i.prototype.calculateWorldAABB=function(e,t,i,n){for(var r=this.radius,o=[\"x\",\"y\",\"z\"],a=0;a<o.length;a++){var s=o[a];i[s]=e[s]-r,n[s]=e[s]+r}}},{\"../math/Vec3\":30,\"./Shape\":43}],45:[function(e,t){function i(e,t){n.call(this),this.type=n.types.TRIMESH,this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new a,this.edges=null,this.scale=new r(1,1,1),this.tree=new s,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}t.exports=i;var n=e(\"./Shape\"),r=e(\"../math/Vec3\"),o=(e(\"../math/Quaternion\"),e(\"../math/Transform\")),a=e(\"../collision/AABB\"),s=e(\"../utils/Octree\");i.prototype=new n,i.prototype.constructor=i;var l=new r;i.prototype.updateTree=function(){var e=this.tree;e.reset(),e.aabb.copy(this.aabb);var t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;for(var i=new a,n=new r,o=new r,s=new r,l=[n,o,s],c=0;c<this.indices.length/3;c++){var h=3*c;this._getUnscaledVertex(this.indices[h],n),this._getUnscaledVertex(this.indices[h+1],o),this._getUnscaledVertex(this.indices[h+2],s),i.setFromPoints(l),e.insert(i,c)}e.removeEmptyNodes()};var c=new a;i.prototype.getTrianglesInAABB=function(e,t){c.copy(e);var i=this.scale,n=i.x,r=i.y,o=i.z,a=c.lowerBound,s=c.upperBound;return a.x/=n,a.y/=r,a.z/=o,s.x/=n,s.y/=r,s.z/=o,this.tree.aabbQuery(c,t)},i.prototype.setScale=function(e){var t=this.scale.x===this.scale.y===this.scale.z,i=e.x===e.y===e.z;t&&i||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()},i.prototype.updateNormals=function(){for(var e=l,t=this.normals,n=0;n<this.indices.length/3;n++){var r=3*n,o=this.indices[r],a=this.indices[r+1],s=this.indices[r+2];this.getVertex(o,f),this.getVertex(a,m),this.getVertex(s,g),i.computeNormal(m,f,g,e),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z}},i.prototype.updateEdges=function(){for(var e={},t=function(){e[o>r?r+\"_\"+o:o+\"_\"+r]=!0},i=0;i<this.indices.length/3;i++){var n=3*i,r=this.indices[n],o=this.indices[n+1];this.indices[n+2],t(),t(),t()}var a=Object.keys(e);for(this.edges=new Int16Array(2*a.length),i=0;i<a.length;i++){var s=a[i].split(\"_\");this.edges[2*i]=parseInt(s[0],10),this.edges[2*i+1]=parseInt(s[1],10)}},i.prototype.getEdgeVertex=function(e,t,i){var n=this.edges[2*e+(t?1:0)];this.getVertex(n,i)};var h=new r,u=new r;i.prototype.getEdgeVector=function(e,t){var i=h,n=u;this.getEdgeVertex(e,0,i),this.getEdgeVertex(e,1,n),n.vsub(i,t)};var p=new r,d=new r;i.computeNormal=function(e,t,i,n){t.vsub(e,d),i.vsub(t,p),p.cross(d,n),n.isZero()||n.normalize()};var f=new r,m=new r,g=new r;i.prototype.getVertex=function(e,t){var i=this.scale;return this._getUnscaledVertex(e,t),t.x*=i.x,t.y*=i.y,t.z*=i.z,t},i.prototype._getUnscaledVertex=function(e,t){var i=3*e,n=this.vertices;return t.set(n[i],n[i+1],n[i+2])},i.prototype.getWorldVertex=function(e,t,i,n){return this.getVertex(e,n),o.pointToWorldFrame(t,i,n,n),n},i.prototype.getTriangleVertices=function(e,t,i,n){var r=3*e;this.getVertex(this.indices[r],t),this.getVertex(this.indices[r+1],i),this.getVertex(this.indices[r+2],n)},i.prototype.getNormal=function(e,t){var i=3*e;return t.set(this.normals[i],this.normals[i+1],this.normals[i+2])};var v=new a;i.prototype.calculateLocalInertia=function(e,t){this.computeLocalAABB(v);var i=v.upperBound.x-v.lowerBound.x,n=v.upperBound.y-v.lowerBound.y,r=v.upperBound.z-v.lowerBound.z;return t.set(1/12*e*(2*n*2*n+2*r*2*r),1/12*e*(2*i*2*i+2*r*2*r),1/12*e*(2*n*2*n+2*i*2*i))};var y=new r;i.prototype.computeLocalAABB=function(e){var t=e.lowerBound,i=e.upperBound,n=this.vertices.length,r=(this.vertices,y);this.getVertex(0,r),t.copy(r),i.copy(r);for(var o=0;o!==n;o++)this.getVertex(o,r),r.x<t.x?t.x=r.x:r.x>i.x&&(i.x=r.x),r.y<t.y?t.y=r.y:r.y>i.y&&(i.y=r.y),r.z<t.z?t.z=r.z:r.z>i.z&&(i.z=r.z)},i.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},i.prototype.updateBoundingSphereRadius=function(){for(var e=0,t=this.vertices,i=new r,n=0,o=t.length/3;n!==o;n++){this.getVertex(n,i);var a=i.norm2();a>e&&(e=a)}this.boundingSphereRadius=Math.sqrt(e)};var x=(new r,new o),b=new a;i.prototype.calculateWorldAABB=function(e,t,i,n){var r=x,o=b;r.position=e,r.quaternion=t,this.aabb.toWorldFrame(r,o),i.copy(o.lowerBound),n.copy(o.upperBound)},i.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},i.createTorus=function(e,t,n,r,o){e=e||1,t=t||.5,n=n||8,r=r||6,o=o||2*Math.PI;for(var a=[],s=[],l=0;n>=l;l++)for(var c=0;r>=c;c++){var h=c/r*o,u=l/n*Math.PI*2,p=(e+t*Math.cos(u))*Math.cos(h),d=(e+t*Math.cos(u))*Math.sin(h),f=t*Math.sin(u);a.push(p,d,f)}for(l=1;n>=l;l++)for(c=1;r>=c;c++){var m=(r+1)*l+c-1,g=(r+1)*(l-1)+c-1,v=(r+1)*(l-1)+c,y=(r+1)*l+c;s.push(m,g,y),s.push(g,v,y)}return new i(a,s)}},{\"../collision/AABB\":3,\"../math/Quaternion\":28,\"../math/Transform\":29,\"../math/Vec3\":30,\"../utils/Octree\":50,\"./Shape\":43}],46:[function(e,t){function i(){n.call(this),this.iterations=10,this.tolerance=1e-7}t.exports=i;var n=(e(\"../math/Vec3\"),e(\"../math/Quaternion\"),e(\"./Solver\"));i.prototype=new n;var r=[],o=[],a=[];i.prototype.solve=function(e,t){var i,n,s,l,c,h=0,u=this.iterations,p=this.tolerance*this.tolerance,d=this.equations,f=d.length,m=t.bodies,g=m.length,v=e;if(0!==f)for(var y=0;y!==g;y++)m[y].updateSolveMassProperties();var x=o,b=a,w=r;for(x.length=f,b.length=f,w.length=f,y=0;y!==f;y++){var M=d[y];w[y]=0,b[y]=M.computeB(v),x[y]=1/M.computeC()}if(0!==f){for(y=0;y!==g;y++){var E=(T=m[y]).vlambda,_=T.wlambda;E.set(0,0,0),_&&_.set(0,0,0)}for(h=0;h!==u;h++){l=0;for(var S=0;S!==f;S++)M=d[S],i=b[S],n=x[S],(c=w[S])+(s=n*(i-M.computeGWlambda()-M.eps*c))<M.minForce?s=M.minForce-c:c+s>M.maxForce&&(s=M.maxForce-c),w[S]+=s,l+=s>0?s:-s,M.addToWlambda(s);if(p>l*l)break}for(y=0;y!==g;y++){var T,A=(T=m[y]).velocity,C=T.angularVelocity;A.vadd(T.vlambda,A),C&&C.vadd(T.wlambda,C)}}return h}},{\"../math/Quaternion\":28,\"../math/Vec3\":30,\"./Solver\":47}],47:[function(e,t){function i(){this.equations=[]}t.exports=i,i.prototype.solve=function(){return 0},i.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)},i.prototype.removeEquation=function(e){var t=this.equations,i=t.indexOf(e);-1!==i&&t.splice(i,1)},i.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(e,t){function i(e){for(s.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=e,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function n(e){for(var t=e.length,i=0;i!==t;i++){var n=e[i];if(!(n.visited||n.body.type&p))return n}return!1}function r(e,t,i,r){for(d.push(e),e.visited=!0,t(e,i,r);d.length;)for(var o,a=d.pop();o=n(a.children);)o.visited=!0,t(o,i,r),d.push(o)}function o(e,t,i){t.push(e.body);for(var n=e.eqs.length,r=0;r!==n;r++){var o=e.eqs[r];-1===i.indexOf(o)&&i.push(o)}}function a(e,t){return t.id-e.id}t.exports=i;var s=(e(\"../math/Vec3\"),e(\"../math/Quaternion\"),e(\"./Solver\")),l=e(\"../objects/Body\");i.prototype=new s;var c=[],h=[],u={bodies:[]},p=l.STATIC,d=[];i.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},i.prototype.solve=function(e,t){for(var i=c,s=this.nodePool,l=t.bodies,p=this.equations,d=p.length,f=l.length,m=this.subsolver;s.length<f;)s.push(this.createNode());i.length=f;for(var g=0;f>g;g++)i[g]=s[g];for(g=0;g!==f;g++){var v=i[g];v.body=l[g],v.children.length=0,v.eqs.length=0,v.visited=!1}for(var y=0;y!==d;y++){var x=p[y],b=(g=l.indexOf(x.bi),l.indexOf(x.bj)),w=i[g],M=i[b];w.children.push(M),w.eqs.push(x),M.children.push(w),M.eqs.push(x)}var E,_=0,S=h;m.tolerance=this.tolerance,m.iterations=this.iterations;for(var T=u;E=n(i);){S.length=0,T.bodies.length=0,r(E,o,T.bodies,S);var A=S.length;for(S=S.sort(a),g=0;g!==A;g++)m.addEquation(S[g]);m.solve(e,T),m.removeAllEquations(),_++}return _}},{\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/Body\":31,\"./Solver\":47}],49:[function(e,t){var i=function(){};t.exports=i,i.prototype={constructor:i,addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t),this},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return this;var i=this._listeners;if(void 0===i[e])return this;var n=i[e].indexOf(t);return-1!==n&&i[e].splice(n,1),this},dispatchEvent:function(e){if(void 0===this._listeners)return this;var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=0,n=t.length;n>i;i++)t[i].call(this,e)}return this}}},{}],50:[function(e,t){function i(e){e=e||{},this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new r,this.data=[],this.children=[]}function n(e,t){(t=t||{}).root=null,t.aabb=e,i.call(this,t),this.maxDepth=void 0!==t.maxDepth?t.maxDepth:8}var r=e(\"../collision/AABB\"),o=e(\"../math/Vec3\");t.exports=n,n.prototype=new i,i.prototype.reset=function(){this.children.length=this.data.length=0},i.prototype.insert=function(e,t,i){var n=this.data;if(i=i||0,!this.aabb.contains(e))return!1;var r=this.children;if(i<(this.maxDepth||this.root.maxDepth)){var o=!1;r.length||(this.subdivide(),o=!0);for(var a=0;8!==a;a++)if(r[a].insert(e,t,i+1))return!0;o&&(r.length=0)}return n.push(t),!0};var a=new o;i.prototype.subdivide=function(){var e=this.aabb,t=e.lowerBound,n=e.upperBound,s=this.children;s.push(new i({aabb:new r({lowerBound:new o(0,0,0)})}),new i({aabb:new r({lowerBound:new o(1,0,0)})}),new i({aabb:new r({lowerBound:new o(1,1,0)})}),new i({aabb:new r({lowerBound:new o(1,1,1)})}),new i({aabb:new r({lowerBound:new o(0,1,1)})}),new i({aabb:new r({lowerBound:new o(0,0,1)})}),new i({aabb:new r({lowerBound:new o(1,0,1)})}),new i({aabb:new r({lowerBound:new o(0,1,0)})})),n.vsub(t,a),a.scale(.5,a);for(var l=this.root||this,c=0;8!==c;c++){var h=s[c];h.root=l;var u=h.aabb.lowerBound;u.x*=a.x,u.y*=a.y,u.z*=a.z,u.vadd(t,u),u.vadd(a,h.aabb.upperBound)}},i.prototype.aabbQuery=function(e,t){for(var i=(this.data,this.children,[this]);i.length;){var n=i.pop();n.aabb.overlaps(e)&&Array.prototype.push.apply(t,n.data),Array.prototype.push.apply(i,n.children)}return t};var s=new r;i.prototype.rayQuery=function(e,t,i){return e.getAABB(s),s.toLocalFrame(t,s),this.aabbQuery(s,i),i},i.prototype.removeEmptyNodes=function(){for(var e=[this];e.length;){for(var t=e.pop(),i=t.children.length-1;i>=0;i--)t.children[i].data.length||t.children.splice(i,1);Array.prototype.push.apply(e,t.children)}}},{\"../collision/AABB\":3,\"../math/Vec3\":30}],51:[function(e,t){function i(){this.objects=[],this.type=Object}t.exports=i,i.prototype.release=function(){for(var e=arguments.length,t=0;t!==e;t++)this.objects.push(arguments[t])},i.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},i.prototype.constructObject=function(){throw new Error(\"constructObject() not implemented in this Pool subclass yet!\")}},{}],52:[function(e,t){function i(){this.data={keys:[]}}t.exports=i,i.prototype.get=function(e,t){if(e>t){var i=t;t=e,e=i}return this.data[e+\"-\"+t]},i.prototype.set=function(e,t,i){if(e>t){var n=t;t=e,e=n}var r=e+\"-\"+t;this.get(e,t)||this.data.keys.push(r),this.data[r]=i},i.prototype.reset=function(){for(var e=this.data,t=e.keys;t.length>0;)delete e[t.pop()]}},{}],53:[function(e,t){function i(){}t.exports=i,i.defaults=function(e,t){for(var i in e=e||{},t)i in e||(e[i]=t[i]);return e}},{}],54:[function(e,t){function i(){r.call(this),this.type=n}t.exports=i;var n=e(\"../math/Vec3\"),r=e(\"./Pool\");i.prototype=new r,i.prototype.constructObject=function(){return new n}},{\"../math/Vec3\":30,\"./Pool\":51}],55:[function(e,t){function i(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new h,this.world=e,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function n(e,t,i){for(var n=null,r=e.length,o=0;o!==r;o++){var a=e[o],s=j;e[(o+1)%r].vsub(a,s);var l=V;s.cross(t,l);var c=k;i.vsub(a,c);var h=l.dot(c);if(!(null===n||h>0&&!0===n||0>=h&&!1===n))return!1;null===n&&(n=h>0)}return!0}t.exports=i;var r=e(\"../collision/AABB\"),o=e(\"../shapes/Shape\"),a=e(\"../collision/Ray\"),s=e(\"../math/Vec3\"),l=e(\"../math/Transform\"),c=(e(\"../shapes/ConvexPolyhedron\"),e(\"../math/Quaternion\")),h=(e(\"../solver/Solver\"),e(\"../utils/Vec3Pool\")),u=e(\"../equations/ContactEquation\"),p=e(\"../equations/FrictionEquation\");i.prototype.createContactEquation=function(e,t,i,n,r,o){var a;this.contactPointPool.length?((a=this.contactPointPool.pop()).bi=e,a.bj=t):a=new u(e,t),a.enabled=e.collisionResponse&&t.collisionResponse&&i.collisionResponse&&n.collisionResponse;var s=this.currentContactMaterial;a.restitution=s.restitution,a.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt);var l=i.material||e.material,c=n.material||t.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(a.restitution=l.restitution*c.restitution),a.si=r||i,a.sj=o||n,a},i.prototype.createFrictionEquationsFromContact=function(e,t){var i=e.bi,n=e.bj,r=e.si,o=e.sj,a=this.world,s=this.currentContactMaterial,l=s.friction,c=r.material||i.material,h=o.material||n.material;if(c&&h&&c.friction>=0&&h.friction>=0&&(l=c.friction*h.friction),l>0){var u=l*a.gravity.length(),d=i.invMass+n.invMass;d>0&&(d=1/d);var f=this.frictionEquationPool,m=f.length?f.pop():new p(i,n,u*d),g=f.length?f.pop():new p(i,n,u*d);return m.bi=g.bi=i,m.bj=g.bj=n,m.minForce=g.minForce=-u*d,m.maxForce=g.maxForce=u*d,m.ri.copy(e.ri),m.rj.copy(e.rj),g.ri.copy(e.ri),g.rj.copy(e.rj),e.ni.tangents(m.t,g.t),m.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),g.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),m.enabled=g.enabled=e.enabled,t.push(m,g),!0}return!1};var d=new s,f=new s,m=new s;i.prototype.createFrictionFromAverage=function(e){var t=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(t,this.frictionResult)&&1!==e){var i=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];d.setZero(),f.setZero(),m.setZero();for(var r=t.bi,o=(t.bj,0);o!==e;o++)(t=this.result[this.result.length-1-o]).bodyA!==r?(d.vadd(t.ni,d),f.vadd(t.ri,f),m.vadd(t.rj,m)):(d.vsub(t.ni,d),f.vadd(t.rj,f),m.vadd(t.ri,m));var a=1/e;f.scale(a,i.ri),m.scale(a,i.rj),n.ri.copy(i.ri),n.rj.copy(i.rj),d.normalize(),d.tangents(i.t,n.t)}};var g=new s,v=new s,y=new c,x=new c;i.prototype.getContacts=function(e,t,i,n,r,o,a){this.contactPointPool=r,this.frictionEquationPool=a,this.result=n,this.frictionResult=o;for(var s=y,l=x,c=g,h=v,u=0,p=e.length;u!==p;u++){var d=e[u],f=t[u],m=null;d.material&&f.material&&(m=i.getContactMaterial(d.material,f.material)||null);for(var b=0;b<d.shapes.length;b++){d.quaternion.mult(d.shapeOrientations[b],s),d.quaternion.vmult(d.shapeOffsets[b],c),c.vadd(d.position,c);for(var w=d.shapes[b],M=0;M<f.shapes.length;M++){f.quaternion.mult(f.shapeOrientations[M],l),f.quaternion.vmult(f.shapeOffsets[M],h),h.vadd(f.position,h);var E=f.shapes[M];if(!(c.distanceTo(h)>w.boundingSphereRadius+E.boundingSphereRadius)){var _=null;w.material&&E.material&&(_=i.getContactMaterial(w.material,E.material)||null),this.currentContactMaterial=_||m||i.defaultContactMaterial;var S=this[w.type|E.type];S&&(w.type<E.type?S.call(this,w,E,c,h,s,l,d,f,w,E):S.call(this,E,w,h,c,l,s,f,d,w,E))}}}}},i.prototype[o.types.BOX|o.types.BOX]=i.prototype.boxBox=function(e,t,i,n,r,o,a,s){e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,i,n,r,o,a,s,e,t)},i.prototype[o.types.BOX|o.types.CONVEXPOLYHEDRON]=i.prototype.boxConvex=function(e,t,i,n,r,o,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,i,n,r,o,a,s,e,t)},i.prototype[o.types.BOX|o.types.PARTICLE]=i.prototype.boxParticle=function(e,t,i,n,r,o,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,i,n,r,o,a,s,e,t)},i.prototype[o.types.SPHERE]=i.prototype.sphereSphere=function(e,t,i,n,r,o,a,s){var l=this.createContactEquation(a,s,e,t);n.vsub(i,l.ni),l.ni.normalize(),l.ri.copy(l.ni),l.rj.copy(l.ni),l.ri.mult(e.radius,l.ri),l.rj.mult(-t.radius,l.rj),l.ri.vadd(i,l.ri),l.ri.vsub(a.position,l.ri),l.rj.vadd(n,l.rj),l.rj.vsub(s.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)};var b=new s,w=new s,M=new s;i.prototype[o.types.PLANE|o.types.TRIMESH]=i.prototype.planeTrimesh=function(e,t,i,n,r,o,a,c){var h=new s,u=b;u.set(0,0,1),r.vmult(u,u);for(var p=0;p<t.vertices.length/3;p++){t.getVertex(p,h);var d=new s;d.copy(h),l.pointToWorldFrame(n,o,d,h);var f=w;if(h.vsub(i,f),0>=u.dot(f)){var m=this.createContactEquation(a,c,e,t);m.ni.copy(u);var g=M;u.scale(f.dot(u),g),h.vsub(g,g),m.ri.copy(g),m.ri.vsub(a.position,m.ri),m.rj.copy(h),m.rj.vsub(c.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}};var E=new s,_=new s,S=(new s,new s),T=new s,A=new s,C=new s,R=new s,L=new s,P=new s,N=new s,B=new s,z=new s,O=new s,F=new r,I=[];i.prototype[o.types.SPHERE|o.types.TRIMESH]=i.prototype.sphereTrimesh=function(e,t,i,n,r,o,s,c){var h=A,u=C,p=R,d=L,f=P,m=N,g=F,v=T,y=_,x=I;l.pointToLocalFrame(n,o,i,f);var b=e.radius;g.lowerBound.set(f.x-b,f.y-b,f.z-b),g.upperBound.set(f.x+b,f.y+b,f.z+b),t.getTrianglesInAABB(g,x);for(var w=S,M=e.radius*e.radius,D=0;D<x.length;D++)for(var H=0;3>H;H++)t.getVertex(t.indices[3*x[D]+H],w),w.vsub(f,y),y.norm2()<=M&&(v.copy(w),l.pointToWorldFrame(n,o,v,w),w.vsub(i,y),(k=this.createContactEquation(s,c,e,t)).ni.copy(y),k.ni.normalize(),k.ri.copy(k.ni),k.ri.scale(e.radius,k.ri),k.ri.vadd(i,k.ri),k.ri.vsub(s.position,k.ri),k.rj.copy(w),k.rj.vsub(c.position,k.rj),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult));for(D=0;D<x.length;D++)for(H=0;3>H;H++){t.getVertex(t.indices[3*x[D]+H],h),t.getVertex(t.indices[3*x[D]+(H+1)%3],u),u.vsub(h,p),f.vsub(u,m);var j=m.dot(p);f.vsub(h,m);var V=m.dot(p);if(V>0&&0>j&&(f.vsub(h,m),d.copy(p),d.normalize(),V=m.dot(d),d.scale(V,m),m.vadd(h,m),(X=m.distanceTo(f))<e.radius)){var k=this.createContactEquation(s,c,e,t);m.vsub(f,k.ni),k.ni.normalize(),k.ni.scale(e.radius,k.ri),l.pointToWorldFrame(n,o,m,m),m.vsub(c.position,k.rj),l.vectorToWorldFrame(o,k.ni,k.ni),l.vectorToWorldFrame(o,k.ri,k.ri),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}}for(var U=B,G=z,W=O,q=E,Q=(D=0,x.length);D!==Q;D++){t.getTriangleVertices(x[D],U,G,W),t.getNormal(x[D],q),f.vsub(U,m);var X=m.dot(q);q.scale(X,m),f.vsub(m,m),X=m.distanceTo(f),a.pointInTriangle(m,U,G,W)&&X<e.radius&&(k=this.createContactEquation(s,c,e,t),m.vsub(f,k.ni),k.ni.normalize(),k.ni.scale(e.radius,k.ri),l.pointToWorldFrame(n,o,m,m),m.vsub(c.position,k.rj),l.vectorToWorldFrame(o,k.ni,k.ni),l.vectorToWorldFrame(o,k.ri,k.ri),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult))}x.length=0};var D=new s,H=new s;i.prototype[o.types.SPHERE|o.types.PLANE]=i.prototype.spherePlane=function(e,t,i,n,r,o,a,s){var l=this.createContactEquation(a,s,e,t);if(l.ni.set(0,0,1),o.vmult(l.ni,l.ni),l.ni.negate(l.ni),l.ni.normalize(),l.ni.mult(e.radius,l.ri),i.vsub(n,D),l.ni.mult(l.ni.dot(D),H),D.vsub(H,l.rj),-D.dot(l.ni)<=e.radius){var c=l.ri,h=l.rj;c.vadd(i,c),c.vsub(a.position,c),h.vadd(n,h),h.vsub(s.position,h),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var j=new s,V=new s,k=new s,U=new s,G=new s,W=new s,q=new s,Q=[new s,new s,new s,new s,new s,new s],X=new s,Y=new s,Z=new s,J=new s;i.prototype[o.types.SPHERE|o.types.BOX]=i.prototype.sphereBox=function(e,t,i,n,r,o,a,s){var l=this.v3pool,c=Q;i.vsub(n,U),t.getSideNormals(c,o);for(var h=e.radius,u=!1,p=Y,d=Z,f=J,m=null,g=0,v=0,y=0,x=null,b=0,w=c.length;b!==w&&!1===u;b++){var M=G;M.copy(c[b]);var E=M.norm();M.normalize();var _=U.dot(M);if(E+h>_&&_>0){var S=W,T=q;S.copy(c[(b+1)%3]),T.copy(c[(b+2)%3]);var A=S.norm(),C=T.norm();S.normalize(),T.normalize();var R=U.dot(S),L=U.dot(T);if(A>R&&R>-A&&C>L&&L>-C){var P=Math.abs(_-E-h);(null===x||x>P)&&(x=P,v=R,y=L,m=E,p.copy(M),d.copy(S),f.copy(T),g++)}}}if(g){u=!0;var N=this.createContactEquation(a,s,e,t);p.mult(-h,N.ri),N.ni.copy(p),N.ni.negate(N.ni),p.mult(m,p),d.mult(v,d),p.vadd(d,p),f.mult(y,f),p.vadd(f,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(a.position,N.ri),N.rj.vadd(n,N.rj),N.rj.vsub(s.position,N.rj),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}for(var B=l.get(),z=X,O=0;2!==O&&!u;O++)for(var F=0;2!==F&&!u;F++)for(var I=0;2!==I&&!u;I++)B.set(0,0,0),O?B.vadd(c[0],B):B.vsub(c[0],B),F?B.vadd(c[1],B):B.vsub(c[1],B),I?B.vadd(c[2],B):B.vsub(c[2],B),n.vadd(B,z),z.vsub(i,z),z.norm2()<h*h&&(u=!0,(N=this.createContactEquation(a,s,e,t)).ri.copy(z),N.ri.normalize(),N.ni.copy(N.ri),N.ri.mult(h,N.ri),N.rj.copy(B),N.ri.vadd(i,N.ri),N.ri.vsub(a.position,N.ri),N.rj.vadd(n,N.rj),N.rj.vsub(s.position,N.rj),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult));l.release(B),B=null;var D=l.get(),H=l.get(),j=(N=l.get(),l.get()),V=(P=l.get(),c.length);for(O=0;O!==V&&!u;O++)for(F=0;F!==V&&!u;F++)if(O%3!=F%3){c[F].cross(c[O],D),D.normalize(),c[O].vadd(c[F],H),N.copy(i),N.vsub(H,N),N.vsub(n,N);var k=N.dot(D);for(D.mult(k,j),I=0;I===O%3||I===F%3;)I++;P.copy(i),P.vsub(j,P),P.vsub(H,P),P.vsub(n,P);var K=Math.abs(k),$=P.norm();if(K<c[I].norm()&&h>$){u=!0;var ee=this.createContactEquation(a,s,e,t);H.vadd(j,ee.rj),ee.rj.copy(ee.rj),P.negate(ee.ni),ee.ni.normalize(),ee.ri.copy(ee.rj),ee.ri.vadd(n,ee.ri),ee.ri.vsub(i,ee.ri),ee.ri.normalize(),ee.ri.mult(h,ee.ri),ee.ri.vadd(i,ee.ri),ee.ri.vsub(a.position,ee.ri),ee.rj.vadd(n,ee.rj),ee.rj.vsub(s.position,ee.rj),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult)}}l.release(D,H,N,j,P)};var K=new s,$=new s,ee=new s,te=new s,ie=new s,ne=new s,re=new s,oe=new s,ae=new s,se=new s;i.prototype[o.types.SPHERE|o.types.CONVEXPOLYHEDRON]=i.prototype.sphereConvex=function(e,t,i,r,o,a,s,l){var c=this.v3pool;i.vsub(r,K);for(var h=t.faceNormals,u=t.faces,p=t.vertices,d=e.radius,f=0;f!==p.length;f++){var m=p[f],g=ie;a.vmult(m,g),r.vadd(g,g);var v=te;if(g.vsub(i,v),v.norm2()<d*d)return y=!0,(N=this.createContactEquation(s,l,e,t)).ri.copy(v),N.ri.normalize(),N.ni.copy(N.ri),N.ri.mult(d,N.ri),g.vsub(r,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(s.position,N.ri),N.rj.vadd(r,N.rj),N.rj.vsub(l.position,N.rj),this.result.push(N),void this.createFrictionEquationsFromContact(N,this.frictionResult)}for(var y=!1,x=(f=0,u.length);f!==x&&!1===y;f++){var b=h[f],w=u[f],M=ne;a.vmult(b,M);var E=re;a.vmult(p[w[0]],E),E.vadd(r,E);var _=oe;M.mult(-d,_),i.vadd(_,_);var S=ae;_.vsub(E,S);var T=S.dot(M),A=se;if(i.vsub(E,A),0>T&&A.dot(M)>0){for(var C=[],R=0,L=w.length;R!==L;R++){var P=c.get();a.vmult(p[w[R]],P),r.vadd(P,P),C.push(P)}if(n(C,M,i)){y=!0;var N=this.createContactEquation(s,l,e,t);M.mult(-d,N.ri),M.negate(N.ni);var B=c.get();M.mult(-T,B);var z=c.get();M.mult(-d,z),i.vsub(r,N.rj),N.rj.vadd(z,N.rj),N.rj.vadd(B,N.rj),N.rj.vadd(r,N.rj),N.rj.vsub(l.position,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(s.position,N.ri),c.release(B),c.release(z),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult),R=0;for(var O=C.length;R!==O;R++)c.release(C[R]);return}for(R=0;R!==w.length;R++){var F=c.get(),I=c.get();a.vmult(p[w[(R+1)%w.length]],F),a.vmult(p[w[(R+2)%w.length]],I),r.vadd(F,F),r.vadd(I,I);var D=$;I.vsub(F,D);var H=ee;D.unit(H);var j=c.get(),V=c.get();i.vsub(F,V);var k=V.dot(H);H.mult(k,j),j.vadd(F,j);var U=c.get();if(j.vsub(i,U),k>0&&k*k<D.norm2()&&U.norm2()<d*d){for(N=this.createContactEquation(s,l,e,t),j.vsub(r,N.rj),j.vsub(i,N.ni),N.ni.normalize(),N.ni.mult(d,N.ri),N.rj.vadd(r,N.rj),N.rj.vsub(l.position,N.rj),N.ri.vadd(i,N.ri),N.ri.vsub(s.position,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult),R=0,O=C.length;R!==O;R++)c.release(C[R]);return c.release(F),c.release(I),c.release(j),c.release(U),void c.release(V)}c.release(F),c.release(I),c.release(j),c.release(U),c.release(V)}for(R=0,O=C.length;R!==O;R++)c.release(C[R])}}},new s,new s,i.prototype[o.types.PLANE|o.types.BOX]=i.prototype.planeBox=function(e,t,i,n,r,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.planeConvex(e,t.convexPolyhedronRepresentation,i,n,r,o,a,s)};var le=new s,ce=new s,he=new s,ue=new s;i.prototype[o.types.PLANE|o.types.CONVEXPOLYHEDRON]=i.prototype.planeConvex=function(e,t,i,n,r,o,a,s){var l=le,c=ce;c.set(0,0,1),r.vmult(c,c);for(var h=0,u=he,p=0;p!==t.vertices.length;p++)if(l.copy(t.vertices[p]),o.vmult(l,l),n.vadd(l,l),l.vsub(i,u),0>=c.dot(u)){var d=this.createContactEquation(a,s,e,t),f=ue;c.mult(c.dot(u),f),l.vsub(f,f),f.vsub(i,d.ri),d.ni.copy(c),l.vsub(n,d.rj),d.ri.vadd(i,d.ri),d.ri.vsub(a.position,d.ri),d.rj.vadd(n,d.rj),d.rj.vsub(s.position,d.rj),this.result.push(d),h++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(d,this.frictionResult)}this.enableFrictionReduction&&h&&this.createFrictionFromAverage(h)};var pe=new s,de=new s;i.prototype[o.types.CONVEXPOLYHEDRON]=i.prototype.convexConvex=function(e,t,i,n,r,o,a,s,l,c,h,u){var p=pe;if(!(i.distanceTo(n)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,i,r,n,o,p,h,u)){var d=[],f=de;e.clipAgainstHull(i,r,t,n,o,p,-100,100,d);for(var m=0,g=0;g!==d.length;g++){var v=this.createContactEquation(a,s,e,t,l,c),y=v.ri,x=v.rj;p.negate(v.ni),d[g].normal.negate(f),f.mult(d[g].depth,f),d[g].point.vadd(f,y),x.copy(d[g].point),y.vsub(i,y),x.vsub(n,x),y.vadd(i,y),y.vsub(a.position,y),x.vadd(n,x),x.vsub(s.position,x),this.result.push(v),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(v,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}};var fe=new s,me=new s,ge=new s;i.prototype[o.types.PLANE|o.types.PARTICLE]=i.prototype.planeParticle=function(e,t,i,n,r,o,a,s){var l=fe;l.set(0,0,1),a.quaternion.vmult(l,l);var c=me;if(n.vsub(a.position,c),0>=l.dot(c)){var h=this.createContactEquation(s,a,t,e);h.ni.copy(l),h.ni.negate(h.ni),h.ri.set(0,0,0);var u=ge;l.mult(l.dot(n),u),n.vsub(u,u),h.rj.copy(u),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}};var ve=new s;i.prototype[o.types.PARTICLE|o.types.SPHERE]=i.prototype.sphereParticle=function(e,t,i,n,r,o,a,s){var l=ve;if(l.set(0,0,1),n.vsub(i,l),l.norm2()<=e.radius*e.radius){var c=this.createContactEquation(s,a,t,e);l.normalize(),c.rj.copy(l),c.rj.mult(e.radius,c.rj),c.ni.copy(l),c.ni.negate(c.ni),c.ri.set(0,0,0),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}};var ye=new c,xe=new s,be=(new s,new s),we=new s,Me=new s;i.prototype[o.types.PARTICLE|o.types.CONVEXPOLYHEDRON]=i.prototype.convexParticle=function(e,t,i,n,r,o,a,s){var l=-1,c=be,h=Me,u=null,p=xe;if(p.copy(n),p.vsub(i,p),r.conjugate(ye),ye.vmult(p,p),e.pointIsInside(p)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(i,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(var d=0,f=e.faces.length;d!==f;d++){var m=[e.worldVertices[e.faces[d][0]]],g=e.worldFaceNormals[d];n.vsub(m[0],we);var v=-g.dot(we);(null===u||Math.abs(v)<Math.abs(u))&&(u=v,l=d,c.copy(g))}if(-1!==l){var y=this.createContactEquation(s,a,t,e);c.mult(u,h),h.vadd(n,h),h.vsub(i,h),y.rj.copy(h),c.negate(y.ni),y.ri.set(0,0,0);var x=y.ri,b=y.rj;x.vadd(n,x),x.vsub(s.position,x),b.vadd(i,b),b.vsub(a.position,b),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult)}else console.warn(\"Point found inside convex, but did not find penetrating face!\")}},i.prototype[o.types.BOX|o.types.HEIGHTFIELD]=i.prototype.boxHeightfield=function(e,t,i,n,r,o,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,i,n,r,o,a,s)};var Ee=new s,_e=new s,Se=[0];i.prototype[o.types.CONVEXPOLYHEDRON|o.types.HEIGHTFIELD]=i.prototype.convexHeightfield=function(e,t,i,n,r,o,a,s){var c=t.data,h=t.elementSize,u=e.boundingSphereRadius,p=_e,d=Se,f=Ee;l.pointToLocalFrame(n,o,i,f);var m=Math.floor((f.x-u)/h)-1,g=Math.ceil((f.x+u)/h)+1,v=Math.floor((f.y-u)/h)-1,y=Math.ceil((f.y+u)/h)+1;if(!(0>g||0>y||m>c.length||v>c[0].length)){0>m&&(m=0),0>g&&(g=0),0>v&&(v=0),0>y&&(y=0),m>=c.length&&(m=c.length-1),g>=c.length&&(g=c.length-1),y>=c[0].length&&(y=c[0].length-1),v>=c[0].length&&(v=c[0].length-1);var x=[];t.getRectMinMax(m,v,g,y,x);var b=x[0],w=x[1];if(!(f.z-u>w||f.z+u<b))for(var M=m;g>M;M++)for(var E=v;y>E;E++)t.getConvexTrianglePillar(M,E,!1),l.pointToWorldFrame(n,o,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,i,p,r,o,a,s,null,null,d,null),t.getConvexTrianglePillar(M,E,!0),l.pointToWorldFrame(n,o,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.convexConvex(e,t.pillarConvex,i,p,r,o,a,s,null,null,d,null)}};var Te=new s,Ae=new s;i.prototype[o.types.SPHERE|o.types.HEIGHTFIELD]=i.prototype.sphereHeightfield=function(e,t,i,n,r,o,a,s){var c=t.data,h=e.radius,u=t.elementSize,p=Ae,d=Te;l.pointToLocalFrame(n,o,i,d);var f=Math.floor((d.x-h)/u)-1,m=Math.ceil((d.x+h)/u)+1,g=Math.floor((d.y-h)/u)-1,v=Math.ceil((d.y+h)/u)+1;if(!(0>m||0>v||f>c.length||v>c[0].length)){0>f&&(f=0),0>m&&(m=0),0>g&&(g=0),0>v&&(v=0),f>=c.length&&(f=c.length-1),m>=c.length&&(m=c.length-1),v>=c[0].length&&(v=c[0].length-1),g>=c[0].length&&(g=c[0].length-1);var y=[];t.getRectMinMax(f,g,m,v,y);var x=y[0],b=y[1];if(!(d.z-h>b||d.z+h<x))for(var w=this.result,M=f;m>M;M++)for(var E=g;v>E;E++){var _=w.length;if(t.getConvexTrianglePillar(M,E,!1),l.pointToWorldFrame(n,o,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,i,p,r,o,a,s),t.getConvexTrianglePillar(M,E,!0),l.pointToWorldFrame(n,o,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&this.sphereConvex(e,t.pillarConvex,i,p,r,o,a,s),w.length-_>2)return}}}},{\"../collision/AABB\":3,\"../collision/Ray\":9,\"../equations/ContactEquation\":19,\"../equations/FrictionEquation\":21,\"../math/Quaternion\":28,\"../math/Transform\":29,\"../math/Vec3\":30,\"../shapes/ConvexPolyhedron\":38,\"../shapes/Shape\":43,\"../solver/Solver\":47,\"../utils/Vec3Pool\":54}],56:[function(e,t){function i(){l.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new r,this.broadphase=new v,this.bodies=[],this.solver=new a,this.constraints=[],this.narrowphase=new s(this),this.collisionMatrix=new c,this.collisionMatrixPrevious=new c,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new d,this.defaultMaterial=new h(\"default\"),this.defaultContactMaterial=new u(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:\"addBody\",body:null},this.removeBodyEvent={type:\"removeBody\",body:null}}t.exports=i;var n=e(\"../shapes/Shape\"),r=e(\"../math/Vec3\"),o=e(\"../math/Quaternion\"),a=e(\"../solver/GSSolver\"),s=(e(\"../utils/Vec3Pool\"),e(\"../equations/ContactEquation\"),e(\"../equations/FrictionEquation\"),e(\"./Narrowphase\")),l=e(\"../utils/EventTarget\"),c=e(\"../collision/ArrayCollisionMatrix\"),h=e(\"../material/Material\"),u=e(\"../material/ContactMaterial\"),p=e(\"../objects/Body\"),d=e(\"../utils/TupleDictionary\"),f=e(\"../collision/RaycastResult\"),m=e(\"../collision/AABB\"),g=e(\"../collision/Ray\"),v=e(\"../collision/NaiveBroadphase\");i.prototype=new l;var y=(new m,new g);if(i.prototype.getContactMaterial=function(e,t){return this.contactMaterialTable.get(e.id,t.id)},i.prototype.numObjects=function(){return this.bodies.length},i.prototype.collisionMatrixTick=function(){var e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset()},i.prototype.add=i.prototype.addBody=function(e){-1===this.bodies.indexOf(e)&&(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof p&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.dispatchEvent(this.addBodyEvent))},i.prototype.addConstraint=function(e){this.constraints.push(e)},i.prototype.removeConstraint=function(e){var t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)},i.prototype.rayTest=function(e,t,i){i instanceof f?this.raycastClosest(e,t,{skipBackfaces:!0},i):this.raycastAll(e,t,{skipBackfaces:!0},i)},i.prototype.raycastAll=function(e,t,i,n){return i.mode=g.ALL,i.from=e,i.to=t,i.callback=n,y.intersectWorld(this,i)},i.prototype.raycastAny=function(e,t,i,n){return i.mode=g.ANY,i.from=e,i.to=t,i.result=n,y.intersectWorld(this,i)},i.prototype.raycastClosest=function(e,t,i,n){return i.mode=g.CLOSEST,i.from=e,i.to=t,i.result=n,y.intersectWorld(this,i)},i.prototype.remove=function(e){e.world=null;var t=this.bodies.length-1,i=this.bodies,n=i.indexOf(e);if(-1!==n){i.splice(n,1);for(var r=0;r!==i.length;r++)i[r].index=r;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,this.dispatchEvent(this.removeBodyEvent)}},i.prototype.removeBody=i.prototype.remove,i.prototype.addMaterial=function(e){this.materials.push(e)},i.prototype.addContactMaterial=function(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)},\"undefined\"==typeof performance&&(performance={}),!performance.now){var x=Date.now();performance.timing&&performance.timing.navigationStart&&(x=performance.timing.navigationStart),performance.now=function(){return Date.now()-x}}var b=new r;i.prototype.step=function(e,t,i){if(i=i||10,0===(t=t||0))this.internalStep(e),this.time+=e;else{var n=Math.floor((this.time+t)/e)-Math.floor(this.time/e);n=Math.min(n,i);for(var r=performance.now(),o=0;o!==n&&(this.internalStep(e),!(performance.now()-r>1e3*e));o++);this.time+=t;for(var a=this.time%e/e,s=b,l=this.bodies,c=0;c!==l.length;c++){var h=l[c];h.type!==p.STATIC&&h.sleepState!==p.SLEEPING?(h.position.vsub(h.previousPosition,s),s.scale(a,s),h.position.vadd(s,h.interpolatedPosition)):(h.interpolatedPosition.copy(h.position),h.interpolatedQuaternion.copy(h.quaternion))}}};var w={type:\"postStep\"},M={type:\"preStep\"},E={type:\"collide\",body:null,contact:null},_=[],S=[],T=[],A=[],C=(new r,new r,new r,new r,new r,new r,new r,new r,new r,new o,new o),R=new o,L=new r;i.prototype.internalStep=function(e){this.dt=e;var t,i=this.contacts,r=T,o=A,a=this.numObjects(),s=this.bodies,l=this.solver,c=this.gravity,h=this.doProfiling,u=this.profile,d=p.DYNAMIC,f=this.constraints,m=S,g=(c.norm(),c.x),v=c.y,y=c.z,x=0;for(h&&(t=performance.now()),x=0;x!==a;x++)if((j=s[x]).type&d){var b=j.force,P=j.mass;b.x+=P*g,b.y+=P*v,b.z+=P*y}x=0;for(var N=this.subsystems.length;x!==N;x++)this.subsystems[x].update();h&&(t=performance.now()),r.length=0,o.length=0,this.broadphase.collisionPairs(this,r,o),h&&(u.broadphase=performance.now()-t);var B=f.length;for(x=0;x!==B;x++)if(!(k=f[x]).collideConnected)for(var z=r.length-1;z>=0;z-=1)(k.bodyA===r[z]&&k.bodyB===o[z]||k.bodyB===r[z]&&k.bodyA===o[z])&&(r.splice(z,1),o.splice(z,1));this.collisionMatrixTick(),h&&(t=performance.now());var O=_,F=i.length;for(x=0;x!==F;x++)O.push(i[x]);i.length=0;var I=this.frictionEquations.length;for(x=0;x!==I;x++)m.push(this.frictionEquations[x]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(r,o,this,i,O,this.frictionEquations,m),h&&(u.narrowphase=performance.now()-t),h&&(t=performance.now()),x=0;x<this.frictionEquations.length;x++)l.addEquation(this.frictionEquations[x]);for(var D=i.length,H=0;H!==D;H++){var j=(k=i[H]).bi,V=k.bj;k.si,k.sj,(j.material&&V.material&&this.getContactMaterial(j.material,V.material)||this.defaultContactMaterial).friction,j.material&&V.material&&(j.material.friction>=0&&V.material.friction>=0&&(j.material.friction,V.material.friction),j.material.restitution>=0&&V.material.restitution>=0&&(k.restitution=j.material.restitution*V.material.restitution)),l.addEquation(k),j.allowSleep&&j.type===p.DYNAMIC&&j.sleepState===p.SLEEPING&&V.sleepState===p.AWAKE&&V.type!==p.STATIC&&V.velocity.norm2()+V.angularVelocity.norm2()>=2*Math.pow(V.sleepSpeedLimit,2)&&(j._wakeUpAfterNarrowphase=!0),V.allowSleep&&V.type===p.DYNAMIC&&V.sleepState===p.SLEEPING&&j.sleepState===p.AWAKE&&j.type!==p.STATIC&&j.velocity.norm2()+j.angularVelocity.norm2()>=2*Math.pow(j.sleepSpeedLimit,2)&&(V._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(j,V,!0),this.collisionMatrixPrevious.get(j,V)||(E.body=V,E.contact=k,j.dispatchEvent(E),E.body=j,V.dispatchEvent(E))}for(h&&(u.makeContactConstraints=performance.now()-t,t=performance.now()),x=0;x!==a;x++)(j=s[x])._wakeUpAfterNarrowphase&&(j.wakeUp(),j._wakeUpAfterNarrowphase=!1);for(B=f.length,x=0;x!==B;x++){var k;(k=f[x]).update(),z=0;for(var U=k.equations.length;z!==U;z++){var G=k.equations[z];l.addEquation(G)}}l.solve(e,this),h&&(u.solve=performance.now()-t),l.removeAllEquations();var W=Math.pow;for(x=0;x!==a;x++)if((j=s[x]).type&d){var q=W(1-j.linearDamping,e),Q=j.velocity;Q.mult(q,Q);var X=j.angularVelocity;if(X){var Y=W(1-j.angularDamping,e);X.mult(Y,X)}}for(this.dispatchEvent(M),x=0;x!==a;x++)(j=s[x]).preStep&&j.preStep.call(j);h&&(t=performance.now());var Z=C,J=R,K=this.stepnumber,$=p.DYNAMIC|p.KINEMATIC,ee=K%(this.quatNormalizeSkip+1)==0,te=this.quatNormalizeFast,ie=.5*e;for(n.types.PLANE,n.types.CONVEXPOLYHEDRON,x=0;x!==a;x++){var ne=s[x],re=ne.force,oe=ne.torque;if(ne.type&$&&ne.sleepState!==p.SLEEPING){var ae=ne.velocity,se=ne.angularVelocity,le=ne.position,ce=ne.quaternion,he=ne.invMass,ue=ne.invInertiaWorld;ae.x+=re.x*he*e,ae.y+=re.y*he*e,ae.z+=re.z*he*e,ne.angularVelocity&&(ue.vmult(oe,L),L.mult(e,L),L.vadd(se,se)),le.x+=ae.x*e,le.y+=ae.y*e,le.z+=ae.z*e,ne.angularVelocity&&(Z.set(se.x,se.y,se.z,0),Z.mult(ce,J),ce.x+=ie*J.x,ce.y+=ie*J.y,ce.z+=ie*J.z,ce.w+=ie*J.w,ee&&(te?ce.normalizeFast():ce.normalize())),ne.aabb&&(ne.aabbNeedsUpdate=!0),ne.updateInertiaWorld&&ne.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,h&&(u.integrate=performance.now()-t),this.time+=e,this.stepnumber+=1,this.dispatchEvent(w),x=0;x!==a;x++){var pe=(j=s[x]).postStep;pe&&pe.call(j)}if(this.allowSleep)for(x=0;x!==a;x++)s[x].sleepTick(this.time)},i.prototype.clearForces=function(){for(var e=this.bodies,t=e.length,i=0;i!==t;i++){var n=e[i];n.force,n.torque,n.force.set(0,0,0),n.torque.set(0,0,0)}}},{\"../collision/AABB\":3,\"../collision/ArrayCollisionMatrix\":4,\"../collision/NaiveBroadphase\":7,\"../collision/Ray\":9,\"../collision/RaycastResult\":10,\"../equations/ContactEquation\":19,\"../equations/FrictionEquation\":21,\"../material/ContactMaterial\":24,\"../material/Material\":25,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/Body\":31,\"../shapes/Shape\":43,\"../solver/GSSolver\":46,\"../utils/EventTarget\":49,\"../utils/TupleDictionary\":52,\"../utils/Vec3Pool\":54,\"./Narrowphase\":55}]},{},[2])(2)},function(e,t,i){\"use strict\";i.r(t);class n{constructor(e){if(e){this.arr=[];for(let t=0,i=e.length;t<i;++t)this.arr.push(e[t])}else this.arr=[]}extend(e){if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)this.arr.push(e[t]);else this.arr.push(e)}clear(){this.arr=[]}isEqual(e){let t=this.arr.length;if(t!=e.arr.length)return!1;for(let i=t-1;i>-1;--i)if(this.arr[i]!=e.arr[i])return!1;return!0}getRefFrom(e){let t=e;for(let e=0,i=this.arr.length;e<i;++e)t=\"object\"==typeof t&&null!=t?Reflect.get(t,this.arr[e]):void 0;return t}existIn(e){for(let t=0,i=e.length;t<i;++t)if(this.isEqual(e[t]))return!0;return!1}indexIn(e){for(let t=0,i=e.length;t<i;++t)if(this.isEqual(e[t]))return t;return-1}buildPath(e){let t=e;for(let e=0,i=this.arr.length;e<i;++e)t.hasOwnProperty(this.arr[e])||Reflect.set(t,this.arr[e],{}),t=Reflect.get(t,this.arr[e]);return t}name(){return this.arr[this.arr.length-1]}isIn(e){let t=e;for(let e=0,i=this.arr.length;e<i;++e){if(\"object\"!=typeof t||null==t||!t.hasOwnProperty(this.arr[e]))return!1;t=Reflect.get(t,this.arr[e])}return!0}getObject(e){let t=e;for(let e=0,i=this.arr.length-1;e<i;++e)t=Reflect.get(t,this.arr[e]);return t}isParent(e){if(this.arr.length>e.arr.length)return!1;for(let t=0,i=this.arr.length;t<i;++t)if(this.arr[t]!=e.arr[t])return!1;return!0}}var r=function(){const e=Symbol.for(\"metaDataKey\"),t={},i=Object.getPrototypeOf((async function(){})).constructor,r=/.*?\\(\\{([^)]*)\\}\\)/;let o=!1,a=!1,s=!1,l={};const c=async function(i){let r=[],o=i.getObject(t),a=new n(i.arr);a.arr.pop(),o[i.name()]=await i.getRefFrom(h)[e].function(o,t,function(e,t,i){let r=new n,o=new n(t.arr);o.arr.pop();return new Proxy(e,{set(e,t,o,a){r.extend(t),r.existIn(i)||i.push(new n(r.arr)),Reflect.set(e,t,o,a)},get:function(t,i,a){if(t==e&&(r=new n(o.arr)),i!=Symbol.unscopables)return r.extend(i),Reflect.get(t,i,a)},has:(t,i)=>!!e.hasOwnProperty(i)})}(o,i,r),t[e].compositeProxy,a.arr),r.push(new n(i.arr)),s=!0,b(r)};t[e]={updateQueue:[],metaTree:{}};let h=t[e].metaTree,u=t[e].updateQueue;h[e]={type:\"root\",affectedFunctions:[],inputProps:[],externalLinks:[]};const p=function(e,i){let r,o=i.getRefFrom(t),a=[];Object.assign(o,e);for(let t in e)r=new n(i.arr),r.extend(t),a.push(new n(r.arr)),r.isIn(h)||g(r);s=!0,b(a)},d=function(){a=!1;let t=[];if(!arguments[0])throw console.error(\"at least an address need for remove link\");for(let e of l.property)if(e.existIn(t)||t.push(new n(e.arr)),!e.isIn(h))throw console.error(\"removeLink address not found\");for(let i=0;i<t.length;++i){let n=t[i].getRefFrom(h)[e].externalLinks;for(let r=0;r<n.length;++r){let o=n[r].getRefFrom(h)[e].externalLinks,a=t[i].indexIn(o);a>-1&&o.splice(a,1)}t[i].getRefFrom(h)[e].externalLinks=[]}},f=function(){o=!1;let i=[];if(!arguments[1])throw console.error(\"at least two address need for linking\");for(let e of l.property)e.existIn(i)||i.push(new n(e.arr)),e.isIn(h)||(e.buildPath(t),g(e));let r=[...i];for(let t=0;t<i.length;++t){let o=i[t].getRefFrom(h)[e].externalLinks;for(let e=0;e<o.length;++e)o[e].existIn(r)||r.push(new n(o[e].arr))}for(let t=0;t<r.length;++t){let i=r.filter(e=>!r[t].isEqual(e));r[t].getRefFrom(h)[e].externalLinks=[...i]}s=!0,b([...y(i[0])])},m=function(r,o){let a,s,l=[],u=v(r),p=v((function(){})).body+\"with (arguments[2]) {\"+u.body+\"}\";if(!u.paraString)throw console.error(\"Function must have at least one input parameter\");u.paraArray.forEach(e=>{let t=new n(o.arr);t.extend(e),l.push(new n(t.arr))}),s=\"{\"+u.paraString+\"}\",a=new i(s,p),Object.defineProperty(a,\"name\",{value:r.name,configurable:!0});let d=new n(o.arr);d.extend(r.name),d.isIn(h)||g(d);let f=d.getRefFrom(h)[e];f.function=a,f.type=\"func\",d.isIn(t)||(d.buildPath(t),d.getObject(t)[r.name]=void 0);for(let i=0,r=l.length;i<r;++i)f.inputProps.push(new n(l[i].arr)),l[i].isIn(h)||g(l[i]),l[i].getRefFrom(h)[e].affectedFunctions.push(new n(d.arr)),l[i].isIn(t)||(l[i].buildPath(t),l[i].getObject(t)[l[i].name()]=void 0);w(d)&&c(d)},g=function(t){let i=h;for(let n=0,r=t.arr.length;n<r;++n)i.hasOwnProperty(t.arr[n])||(Reflect.set(i,t.arr[n],{}),i[t.arr[n]][e]={type:\"prop\",affectedFunctions:[],inputProps:[],externalLinks:[]}),i=Reflect.get(i,t.arr[n])},v=function(e){let t={},i=e.toString(),n=i.match(r);n&&(t.paraString=n[1],t.paraArray=t.paraString.split(\",\").map(e=>e.trim()));let o=i.slice(i.indexOf(\")\")+1,i.lastIndexOf(\"}\"));return t.body=o.slice(o.indexOf(\"{\")+1),t},y=function(i){let r=i.getRefFrom(h);if(!r)return[];let o=r[e].externalLinks,a=[];if(0==o.length)return o;let s=i.getObject(t);for(let e=0,r=o.length;e<r;++e){let r=o[e].getObject(t);r[o[e].name()]!==s[i.name()]&&(r[o[e].name()]=s[i.name()],a.push(new n(o[e].arr)))}return a},x=function(e){if(\"object\"!=typeof e)throw console.error(\"configuration properties: 'upPropagation' = boolian \");e.upPropagation&&e.upPropagation},b=function(t){let i=[new n],r=[];do{for(let e=0,r=t.length;e<r;++e){let r=new n(t[e].arr);for(;r.arr.length>1;)r.arr.pop(),r.existIn(i)||r.existIn(t)||i.push(new n(r.arr))}for(let e=0,r=i.length;e<r;++e)t.push(new n(i[e].arr));r=[];for(let e=0,i=t.length;e<i;++e)r.push(...y(t[e]));r.length>0&&t.push(...r)}while(r.length>0);for(let i=0,r=t.length;i<r;++i){let r=t[i].getRefFrom(h);if(r){let t=r[e].affectedFunctions;for(let e=0,i=t.length;e<i;++e)t[e].existIn(u)||w(t[e])&&u.push(new n(t[e].arr))}}for(;u.length>0;)c(u.shift());s=!1},w=function(i){let n=i.getRefFrom(h)[e].inputProps;for(let e=0,i=n.length;e<i;++e)if(void 0===n[e].getRefFrom(t))return!1;return!0},M=function(e,t,i,r){e==this.sourceObj&&(this.addressRecorder=new n(this.sourceAddress.arr));let o=this.addressRecorder;if(o.extend(t),Reflect.set(e,t,i,r),o.isIn(h)){let e=o.getRefFrom(h),t=Object.keys(e);for(let i of t)delete e[i]}else g(o);return s=!0,b([new n(o.arr)]),!0},E=function(i,r,c){i==this.sourceObj&&(this.addressRecorder=new n(this.sourceAddress.arr));let u=this.addressRecorder;if(o||a)return i[e]&&\"courier\"==i[e].name||l.property.push(new n(u.arr)),l.property[l.property.length-1].extend(r),new Proxy(l,{get:E,set:M,sourceObj:l,sourceAddress:new n(u.arr)});switch(r){case\"set\":return function(){p(arguments[0],new n(u.arr))};case\"addFunction\":return function(){m(arguments[0],new n(u.arr))};case\"addLink\":return o=!0,l={property:[]},l[e]={name:\"courier\"},f;case\"removeLink\":return a=!0,l={property:[]},l[e]={name:\"courier\"},d;case\"compositeRunningFunctions\":return s;case\"getParentComposite\":return t;case\"isCompositeProxy\":return!0;case\"getCurrentAddress\":return new n(u.arr);case\"getProxyLessObject\":return u.getRefFrom(t);case\"updateItself\":return s=!0,b([new n(u.arr)]),!0;case\"composerConfig\":return x}u.extend(r),u.isIn(h)||g(u);let v=Reflect.get(i,r,c);return\"object\"==typeof v&&null!=v?new Proxy(v,{get:E,set:M,sourceObj:v,sourceAddress:new n(u.arr)}):v},_=new Proxy(t,{get:E,set:M,sourceObj:t,sourceAddress:new n});return t[e].compositeProxy=_,_};function o({camera:e}){return o||mainComposite.loadedObjects.push(e),!0}function a({cameraFocalLenght:e,cameraNearView:t,cameraFarView:i}){return new THREE.PerspectiveCamera(e,window.innerWidth/window.innerHeight,t,i)}function s({camera:e,position:t}){return e.position.x=t.x,e.position.y=t.y,e.position.z=t.z,!0}function l({camera:e,quaternion:t}){return e.quaternion.x=t.x,e.quaternion.y=t.y,e.quaternion.z=t.z,e.quaternion.w=t.w,!0}function c({camera:e,three:t}){return function(){t.renderer.setSize(window.innerWidth,window.innerHeight),e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix()}}function h({active:e,cameraUpdateFunction:t}){return e?(h||window.addEventListener(\"resize\",t),!0):(h&&window.removeEventListener(\"resize\",t),!1)}function u({activate:e,camera:t}){e&&t&&(mainComposite.activeCamera=t)}function p(e,t){t.loadedObjects=e.loadedObjects.getProxyLessObject,t.three=e.three.getProxyLessObject,t.self=t,t.mainComposite=e,t.addFunction(f),t.addFunction(d),t.addFunction(C),t.addFunction(v),t.addFunction(S),t.addFunction(E),t.addFunction(M),t.addFunction(T),t.addFunction(A),t.addFunction(_),t.addFunction(b),t.addFunction(y),t.addFunction(x),t.addFunction(g),t.addFunction(w),t.addFunction(m),null==t.geometryName&&(t.geometryName=\"plane\"),null==t.materialName&&(t.materialName=\"lambert\"),null==t.color&&(t.color=16777215),null==t.scale&&(t.scale=1),null==t.positio&&(t.position=new THREE.Vector3(0,0,0)),null==t.quaternio&&(t.quaternion=new THREE.Quaternion),null==t.visible&&(t.visible=!0),null==t.active&&(t.active=!0),null==t.widthSegments&&(t.widthSegments=32),null==t.heightSegments&&(t.heightSegments=32),null==t.radialSegments&&(t.radialSegments=32),null==t.cylinderHeightSegments&&(t.cylinderHeightSegments=1),null==t.shininess&&(t.shininess=30),null==t.castShadow&&(t.castShadow=!0),null==t.receiveShadow&&(t.receiveShadow=!0),null==t.materialIndex&&(t.materialIndex=[0])}function d({texture:e}){return d||mainComposite.loadedObjects.push(e),!0}function f({mesh:e}){return f||mainComposite.loadedObjects.push(e),!0}function m({mesh:e,heightData:t}){if(\"plane\"==geometryName)for(let i=0;i<e.geometry.vertices.length;i++)e.geometry.vertices[i].z=t[i]}const g=function({mesh:e,active:t,three:i}){return t&&g!=e?(i.scene.add(e),e):t||g!=e?void 0:(i.scene.remove(e),!1)},v=function({mesh:e,visible:t}){return e.visible=t,!0},y=function({mesh:e,shininess:t}){if(\"phong\"==materialName)if(1==E.length&&void 0===textureFileName&&void 0===C)e.material.shininess=t;else for(let i=0,n=E.length;i<n;++i)e.material[i].shininess=t},x=function({mesh:e,castShadow:t,receiveShadow:i}){e.castShadow=t,e.receiveShadow=i},b=function({mesh:e,position:t}){e.position.set(t.x,t.y,t.z)},w=function({mesh:e,quaternion:t}){return e.quaternion.set(t.x,t.y,t.z,t.w),!0},M=function({geometry:e,material:t,readyToCreateMesh:i}){return 1==t.length&&void 0===textureFileName&&void 0===C?new THREE.Mesh(e,t[0]):new THREE.Mesh(e,t)},E=function({materialName:e,dimension:t}){let i=[];switch(e){case\"lambert\":i.push(new THREE.MeshLambertMaterial);break;case\"basic\":i.push(new THREE.MeshBasicMaterial);break;case\"phong\":i.push(new THREE.MeshPhongMaterial);break;default:console.error(`materialName ${e} not found`)}return void 0===textureFileName&&void 0===C&&(readyToCreateMesh=!0),i},_=function({texture:e,material:t,geometry:i,materialIndex:n}){for(let i=0,n=e.length;i<n;++i)i>=t.length&&t.push(t[0].clone()),t[i].map=e[i];let r=0;switch(geometryName){case\"plane\":for(let e=0;e<i.faces.length;++e)i.faces[e].materialIndex=n[r],++r,r>=n.length&&(r=0);break;case\"box\":for(let e=0;e<i.faces.length;++e)i.faces[e].materialIndex=n[r],++r,r>=n.length&&(r=0);break;case\"sphere\":for(let e=0;e<i.faces.length;++e)i.faces[e].materialIndex=n[r],++r,r>=n.length&&(r=0);break;case\"cylinder\":let e=dimension.radiusBottom,t=e/2,o=dimension.radiusTop,a=o/2;for(let r=0;r<i.faces.length;++r){let s=i.faces[r],l=!s.normal.x&&!s.normal.z;s.normal.y<-.98&&s.normal.y>-1.01&&l?(i.faceVertexUvs[0][r][0].u=(i.vertices[s.a].x+t)/e,i.faceVertexUvs[0][r][0].v=(i.vertices[s.a].z+t)/e,i.faceVertexUvs[0][r][1].u=(i.vertices[s.b].x+t)/e,i.faceVertexUvs[0][r][1].v=(i.vertices[s.b].z+t)/e,i.faceVertexUvs[0][r][2].u=(i.vertices[s.c].x+t)/e,i.faceVertexUvs[0][r][2].v=(i.vertices[s.c].z+t)/e,s.materialIndex=3==n.length?n[2]:0):s.normal.y>.98&&s.normal.y<1.01&&l?(i.faceVertexUvs[0][r][0].u=(i.vertices[s.a].x+a)/o,i.faceVertexUvs[0][r][0].v=(i.vertices[s.a].z+a)/o,i.faceVertexUvs[0][r][1].u=(i.vertices[s.b].x+a)/o,i.faceVertexUvs[0][r][1].v=(i.vertices[s.b].z+a)/o,i.faceVertexUvs[0][r][2].u=(i.vertices[s.c].x+a)/o,i.faceVertexUvs[0][r][2].v=(i.vertices[s.c].z+a)/o,s.materialIndex=3==n.length?n[0]:0):s.materialIndex=3==n.length?n[1]:0}break;case\"polyhedron\":for(let e=0;e<i.faces.length;++e)i.faces[e].materialIndex=n[r],++r,r>=n.length&&(r=0);default:console.error(`geometryName ${geometryName} not found`)}return readyToCreateMesh=!0,!0},S=function({geometryName:e,dimension:t}){let i;switch(e){case\"plane\":i=new THREE.PlaneGeometry(t.length,t.width,t.xSeg,t.Yseg);break;case\"box\":i=new THREE.BoxGeometry(t.length,t.width,t.height);break;case\"sphere\":i=new THREE.SphereGeometry(t.radius,widthSegments,heightSegments);break;case\"cylinder\":i=new THREE.CylinderGeometry(t.radiusTop,t.radiusBottom,t.height,radialSegments,cylinderHeightSegments);break;case\"polyhedron\":t.radius||(t.radius=1),void 0===t.detail&&(t.detail=1),i=new THREE.PolyhedronGeometry(t.vertices,t.faces,t.radius,t.detail);break;default:console.error(`geometryName ${e} not found`)}return i},T=function({scale:e,mesh:t}){return t.scale.set(e,e,e),!0},A=function({color:e,mesh:t}){if(E.length>0)for(let t=0,i=E.length;t<i;++t)E[t].color.setHex(e);return!0},C=async function({textureFileName:e}){let t=[],i=[];Array.isArray(e)?i=[...e]:i.push(e);for(let e=0,n=i.length;e<n;++e)t.push(await(new THREE.TextureLoader).load(i[e])),t[t.length-1].anisotropy=16;return t};function R(e,t){t.cannon=e.cannon.getProxyLessObject,t.collisionGroupsNames=e.collisionGroupsNames.getProxyLessObject,t.materials=e.physicSettings.materials.getProxyLessObject,t.mainComposite=e,t.self=t,t.totalConstraints=0,t.physicMaterial||(t.physicMaterial=\"objectMaterial\"),t.linearDamping||(t.linearDamping=.15),t.angularDamping||(t.angularDamping=.15),t.allowSleep||(t.allowSleep=!1),t.cylinderSegments||(t.cylinderSegments=16),void 0===t.physicStatus&&(t.physicStatus=!0),null==t.sleep&&(t.sleep=!1),null==t.bodyType&&(t.bodyType=\"dynamic\"),null==t.groupName&&(t.groupName=\"all\"),null==t.collisionGroups&&(t.collisionGroups=[\"all\"]),t.addFunction(k),t.addFunction(V),t.addFunction(D),t.addFunction(I),t.addFunction(H),t.addFunction(F),t.addFunction(O),t.addFunction(z),t.addFunction(N),t.addFunction(B),t.addFunction(P),t.addFunction(j),t.addFunction(L)}function L({reset:e,body:t}){t.linearDamping=linearDamping,t.angularDamping=angularDamping,t.position.set(position.x,position.y,position.z),t.previousPosition.set(position.x,position.y,position.z),t.interpolatedPosition.set(position.x,position.y,position.z),t.initPosition.set(position.x,position.y,position.z),t.quaternion.set(quaternion.x,quaternion.y,quaternion.z,quaternion.w),t.initQuaternion.set(quaternion.x,quaternion.y,quaternion.z,quaternion.w),t.interpolatedQuaternion.set(quaternion.x,quaternion.y,quaternion.z,quaternion.w),t.velocity.setZero(),t.initVelocity.setZero(),t.angularVelocity.setZero(),t.initAngularVelocity.setZero(),t.force.setZero(),t.torque.setZero(),t.sleepState=0,t.timeLastSleepy=0,t._wakeUpAfterNarrowphase=!1}function P({collisionGroupCode:e,contactGroupsMask:t,body:i}){i.collisionFilterGroup=e,i.collisionFilterMask=t}function N({groupName:e}){return collisionGroupsNames.includes(e)||collisionGroupsNames.push(e),Math.pow(2,collisionGroupsNames.indexOf(e))}function B({collisionGroups:e}){let t=0;for(let i of e){if(collisionGroupsNames.includes(i)||collisionGroupsNames.push(i),\"all\"==i)return-1;t|=Math.pow(2,collisionGroupsNames.indexOf(i))}return t}function z({body:e,allowSleep:t}){e.allowSleep=t}function O({body:e}){return addToLoadedObjects||mainComposite.loadedObjects.push(e),!0}function F({sleep:e}){e?timeStamp&&mainComposite.removeLink(self.timeStamp):mainComposite.addLink(mainComposite.timeStamp,self.timeStamp)}const I=function({timeStamp:e,body:t}){let i=t.position,n=t.quaternion;position=i,quaternion=n};function D({materials:e,physicMaterial:t}){return t in e?e[t]:void 0}function H({body:e,physicStatus:t,totalConstraints:i}){if(t&&!H)return cannon.addBody(e),!0;!H||t||null!=j&&j||0!=i||mainComposite.getProxyLessObject.removeBodies.push(e)}function j({body:e,collisionCallback:t,enableCollisionCallback:i}){return i&&!j?(e.addEventListener(\"collide\",t),!0):j&&!i?(e.removeEventListener(\"collide\"),physicStatus=physicStatus,!1):void 0}function V({mesh:e,getMaterial:t,shape:i,mass:n}){if(V)return V;let r=new CANNON.Body({mass:n,shape:i,material:t,allowSleep:allowSleep});switch(bodyType){case\"dynamic\":r.type=CANNON.Body.DYNAMIC;break;case\"kinematic\":r.type=CANNON.Body.KINEMATIC;break;case\"static\":r.type=CANNON.Body.STATIC}return reset=!0,r}function k({geometryName:e,dimension:t,scale:i}){let n;switch(e){case\"plane\":n=heightData?new CANNON.Heightfield(heightData,{elementSize:t.width/t.xSeg}):new CANNON.Plane;break;case\"box\":n=new CANNON.Box(new CANNON.Vec3(t.length*i/2,t.width*i/2,t.height*i/2));break;case\"sphere\":n=new CANNON.Sphere(t.radius*i);break;case\"cylinder\":n=new CANNON.Cylinder(t.radiusTop,t.radiusBottom,t.height,cylinderSegments);let e=new CANNON.Quaternion;e.setFromAxisAngle(new CANNON.Vec3(1,0,0),-Math.PI/2);let r=new CANNON.Vec3(0,0,0);n.transformAllPoints(r,e);break;case\"polyhedron\":let o=[],a=[];for(let e=0,i=t.vertices.length/3;e<i;++e)o.push(new CANNON.Vec3(t.vertices[e],t.vertices[e+1],t.vertices[e+2]));for(let e=0,i=t.faces.length/3;e<i;++e)a.push([t.faces[e],t.faces[e+1],t.faces[e+2]]);n=new CANNON.ConvexPolyhedron(o,a)}return n}function U({setGeometries:e}){return U||mainComposite.loadedObjects.push(selfProxy),!0}function G({WorldPosition:e,worldDimension:t,allLoaded:i,thickness:n}){let r=t.x,o=t.y,a=t.z,s=n;return selfProxy.components[1].position={x:0,y:0,z:-a/2},selfProxy.components[1].dimension={length:r*scale,width:o*scale,height:s*scale},selfProxy.components[0].position={x:0,y:0,z:a/2},selfProxy.components[0].dimension={length:r*scale,width:o*scale,height:s*scale},selfProxy.components[4].position={x:0,y:o/2,z:0},selfProxy.components[4].dimension={length:r*scale,width:s*scale,height:a*scale},selfProxy.components[5].position={x:0,y:-o/2,z:0},selfProxy.components[5].dimension={length:r*scale,width:s*scale,height:a*scale},selfProxy.components[2].position={x:-r/2,y:0,z:0},selfProxy.components[2].dimension={length:s*scale,width:o*scale,height:a*scale},selfProxy.components[3].position={x:+r/2,y:0,z:0},selfProxy.components[3].dimension={length:s*scale,width:o*scale,height:a*scale},!0}const W=function({texture0:e,texture1:t,texture2:i,texture3:n,texture4:r,texture5:o}){return!0};async function q(e){let t,i=0;e.running=!0,e.cannonSafeStep=.016;let n=e.cannonSafeStep;function r(i){let o=e.actualInterval;o+=(i-t)/1e3,o>=n&&!1===e.compositeRunningFunctions&&(e.set({timeStamp:i,actualInterval:o,rendering:!0,framesInterval:i-t}),t=i),requestAnimationFrame(r)}requestAnimationFrame((function o(a){if(e.startUp)return;let s=e.actualInterval;if(i>2)return setTimeout(()=>{document.getElementById(\"loading\").classList.add(\"hide\")},1e3),document.body.appendChild(e.three.renderer.domElement.getProxyLessObject),e.startUp=a,void requestAnimationFrame(r);void 0===t&&(t=a),s+=(a-t)/1e3,s>=n&&!1===e.compositeRunningFunctions&&(e.set({timeStamp:a,actualInterval:s,rendering:!0,framesInterval:a-t}),++i),t=a,setTimeout(()=>{requestAnimationFrame(o)},250)}))}const Q={frameRate:60,maxSubStep:3};function X({light:e}){return X||mainComposite.loadedObjects.push(e),!0}function Y({light:e,intensity:t}){return e.intensity=t,!0}function Z({light:e,color:t}){return e.color=new THREE.Color(t),!0}function J({light:e,position:t}){e.position.x=t.x,e.position.y=t.y,e.position.z=t.z}function K({light:e,targetPosition:t,castShadow:i,shadowMapDarkness:n,shadowMapSizeWidth:r,shadowMapSizeHeight:o,shadowCameraNear:a,shadowCameraFar:s,skyColor:l,groundColor:c,distance:h,width:u,height:p}){return\"spot\"!=lightType&&\"directional\"!=lightType&&\"point\"!=lightType||(e.castShadow=i,e.shadowMapDarkness=n,e.shadow.mapSize.width=r,e.shadow.mapSize.height=o,e.shadow.camera.near=a,e.shadow.camera.far=s),\"directional\"==lightType&&(e.target.position.x=t.x,e.target.position.y=t.y,e.target.position.z=t.z),\"hemisphere\"==lightType&&(e.skyColor=new THREE.Color(l),e.groundColor=new THREE.Color(c)),\"point\"!=lightType&&\"spot\"!=lightType||(e.distance=h),\"rectangular\"==lightType&&(e.width=u,e.height=p,e.lookAt(t)),!0}function $({lightType:e}){let t;switch(e){case\"ambient\":t=new THREE.AmbientLight(color,intensity);break;case\"spot\":t=new THREE.SpotLight(color,intensity);break;case\"directional\":t=new THREE.DirectionalLight(color,intensity);break;case\"hemisphere\":t=new THREE.HemisphereLight(skyColor,groundColor,intensity);break;case\"point\":t=new THREE.PointLight(color,intensity,distance);break;case\"rectangular\":t=new THREE.RectAreaLight(color,intensity,width,height);let e=new THREE.RectAreaLightHelper(t);t.add(e)}return t}function ee({light:e,visible:t}){t&&ee!=e&&three.scene.add(e),t||ee!=e||three.scene.remove(e)}function te({contactMaterials:e}){for(let t of e)if(!t.added){let e=materials[t.material1],i=materials[t.material2];e.name=t.material1,i.name=t.material2,cannon.addContactMaterial(new CANNON.ContactMaterial(e,i,{friction:t.friction,restitution:t.restitution})),t.added=!0}}const ie=function(){let e=new CANNON.World;e.broadphase=new CANNON.NaiveBroadphase;let t=new CANNON.GSSolver;return e.solver=new CANNON.SplitSolver(t),e.allowSleep=!0,e.solver.iterations=7,e.solver.tolerance=.01,e.defaultContactMaterial.contactEquationStiffness=1e6,e.defaultContactMaterial.contactEquationRelaxation=10,e.defaultContactMaterial.friction=.2,e},ne=function({gravity:e,cannon:t}){return t.gravity.set(e.x,e.y,e.z),!0};function re({addToCompoundBody:e}){return addToLoadedObjects||mainComposite.loadedObjects.push(k),!0}function oe({body:e,shape:t}){if(oe)return oe;let i=e.position,n=new THREE.Quaternion(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w),r=new THREE.Quaternion(quaternion.x,quaternion.y,quaternion.z,quaternion.w),o=new THREE.Vector3(position.x-i.x,position.y-i.y,position.z-i.z);return n.normalize().inverse(),o.applyQuaternion(n),r.multiply(n),compoundBodyShapeNumber=e.shapes.length,e.addShape(t,new CANNON.Vec3(o.x,o.y,o.z),new CANNON.Quaternion(r.x,r.y,r.z,r.w)),t}const ae=function({timeStamp:e,body:t}){let i=t.position,n=t.quaternion;position=i,quaternion=n;for(let e of components){let r=e.compoundBodyShapeNumber,o=t.shapeOffsets[r],a=t.shapeOrientations[r];if(a&&o){let t=new THREE.Quaternion(n.x,n.y,n.z,n.w),r=new THREE.Quaternion(a.x,a.y,a.z,a.w),s=new THREE.Vector3(o.x,o.y,o.z);s.applyQuaternion(t),t.multiply(r),e.mesh.position.set(s.x+i.x,s.y+i.y,s.z+i.z),e.mesh.quaternion.set(t.x,t.y,t.z,t.w)}}};function se({bodies:e}){for(let t of e)linkedBodies.push(void 0),proxiedComposite.addLink(t.body,selfProxy.linkedBodies[linkedBodies.length-1]);return!0}function le({linkedBodies:e}){let t=void 0;for(let i=addedIndex;i<e.length;++i){if(!e[i])return;t?(constraints.push(new CANNON.LockConstraint(e[i],t,{maxForce:maxForce})),mainComposite.loadedObjects.push(constraints[constraints.length-1]),t=e[i],addedIndex=i):t=e[i]}return!0}function ce({active:e,addLockConstraint:t}){if(e&&!ce){for(let e of constraints)cannon.addConstraint(e),e.enable();for(let e of bodies)++e.self.totalConstraints;return!0}if(!e&&ce){for(let e of constraints)e.disable(),cannon.removeConstraint(e);for(let e of bodies)--e.self.totalConstraints;return!1}}function he({pointConstraint:e}){return he||mainComposite.loadedObjects.push(e),!0}function ue({bodyA:e}){return proxiedComposite.addLink(e.body,selfProxy.bodyABody),!0}function pe({bodyB:e}){return proxiedComposite.addLink(e.body,selfProxy.bodyBBody),!0}function de({offsetA:e}){return new CANNON.Vec3(e.x,e.y,e.z)}function fe({offsetB:e}){return new CANNON.Vec3(e.x,e.y,e.z)}function me({bodyABody:e,bodyBBody:t,pivotA:i,pivotB:n,maxForce:r,cannon:o}){if(me)return me;return new CANNON.PointToPointConstraint(e,i,t,n,r)}function ge({active:e,pointConstraint:t}){return e&&!ge?(cannon.addConstraint(t),t.enable(),++bodyA.self.totalConstraints,++bodyB.self.totalConstraints,!0):!e&&ge?(t.disable(),cannon.removeConstraint(t),--bodyA.self.totalConstraints,--bodyB.self.totalConstraints,!1):void 0}function ve({distanceConstraint:e}){return ve||mainComposite.loadedObjects.push(e),!0}function ye({bodyA:e}){return proxiedComposite.addLink(e.body,selfProxy.bodyABody),!0}function xe({bodyB:e}){return proxiedComposite.addLink(e.body,selfProxy.bodyBBody),!0}function be({bodyABody:e,bodyBBody:t,maxForce:i,cannon:n}){if(be)return be;let r=new CANNON.DistanceConstraint(e,t);return distance&&(r.distance=distance),r.maxForce=i,r}function we({active:e,distanceConstraint:t}){return e&&!we?(cannon.addConstraint(t),t.enable(),++bodyA.self.totalConstraints,++bodyB.self.totalConstraints,!0):!e&&we?(t.disable(),cannon.removeConstraint(t),--bodyA.self.totalConstraints,--bodyB.self.totalConstraints,!1):void 0}function Me({hingeConstraint:e}){return Me||mainComposite.loadedObjects.push(e),!0}function Ee({bodyA:e}){return proxiedComposite.addLink(e.body,selfProxy.bodyABody),!0}function _e({bodyB:e}){return proxiedComposite.addLink(e.body,selfProxy.bodyBBody),!0}function Se({offsetA:e}){return new CANNON.Vec3(e.x,e.y,e.z)}function Te({offsetB:e}){return new CANNON.Vec3(e.x,e.y,e.z)}function Ae({bodyABody:e,bodyBBody:t,pivotA:i,pivotB:n,maxForce:r,cannon:o}){if(Ae)return Ae;let a=new CANNON.HingeConstraint(e,t,{pivotA:i,pivotB:n,maxForce:r});return axisA&&(a.axisA=axisA),axisB&&(a.axisB=axisB),a}function Ce({active:e,hingeConstraint:t}){return e&&!Ce?(cannon.addConstraint(t),t.enable(),++bodyA.self.totalConstraints,++bodyB.self.totalConstraints,!0):!e&&Ce?(t.disable(),cannon.removeConstraint(t),--bodyA.self.totalConstraints,--bodyB.self.totalConstraints,!1):void 0}function Re({motor:e,hingeConstraint:t}){return e?t.enableMotor():t.disableMotor(),!0}function Le({speed:e,hingeConstraint:t}){t.setMotorSpeed(e)}function Pe({chassis:e}){return proxiedComposite.addLink(e[0].body,proxiedComposite.vehicles[currentAddress[currentAddress.length-1]].chassisBody),!0}function Ne({wheelForce:e,addToWorld:t,wheelSpeed:i}){for(let t=0;t<wheels.length;t++)wheels[t].engine&&(wheels[t].leftHand?(Be.constraints[t].enableMotor(),Be.constraints[t].setMotorMaxForce(e),Be.constraints[t].setMotorSpeed(i)):(Be.constraints[t].enableMotor(),Be.constraints[t].setMotorMaxForce(-1*e),Be.constraints[t].setMotorSpeed(-1*i))),wheels[t].steering&&(wheels[t].leftHand,Be.setSteeringValue(Math.PI/16,t));return!0}function Be({chassisBody:e}){return chassis.compoundPosition?position=new CANNON.Vec3(chassis.compoundPosition.x,chassis.compoundPosition.y,chassis.compoundPosition.z):position=new CANNON.Vec3(e.position.x,e.position.y,e.position.z),new CANNON.RigidVehicle({chassisBody:e})}function ze({rigidVehicle:e,position:t}){e.position=new CANNON.Vec3(t.x,t.y,t.z)}function Oe({rigidVehicle:e,quaternion:t}){e.chassisBody.quaternion=new CANNON.Quaternion(t.x,t.y,t.z,t.w)}function Fe({wheels:e}){for(let t of e)linkedWheelsBodies.push(void 0),proxiedComposite.addLink(t.body.body,proxiedComposite.vehicles[currentAddress[currentAddress.length-1]].linkedWheelsBodies[linkedWheelsBodies.length-1]);return!0}function Ie({rigidVehicle:e,linkedWheelsBodies:t}){for(let e of t)if(!e)return;for(let i=0,n=t.length;i<n;++i){let n=t[i],r=new CANNON.Vec3(n.position.x-position.x,n.position.y-position.y,n.position.z-position.z);e.addWheel({body:n,position:r,quaternion:n.quaternion,isFrontWheel:wheels[i].steering,frictionSlip:5,axis:wheels[i].axis,direction:wheels[i].direction})}for(let t=0;t<e.wheelBodies.length;t++)e.wheelBodies[t].angularDamping=.4;return!0}function De({addWheelToVehicle:e,cannon:t}){return Be.addToWorld(t),!0}function He({wheels:e,addToWorld:t}){for(let t=0;t<e.length;t++)ke.applyEngineForce(e[t].engine,t),ke.setSteeringValue(e[t].steering,t),ke.setBrake(e[t].brake,t);return!0}function je({chassis:e}){return proxiedComposite.addLink(e[0].body,proxiedComposite.vehicles[currentAddress[currentAddress.length-1]].chassisBody),!0}function Ve({timeStamp:e,addWheelToVehicle:t}){let i=new CANNON.Quaternion;i.setFromAxisAngle(new CANNON.Vec3(0,0,1).normalize(),Math.PI/2);for(let e=0;e<ke.wheelInfos.length;e++){ke.updateWheelTransform(e);let t=ke.wheelInfos[e].worldTransform;linkedWheelsBodies[e].position.copy(t.position),linkedWheelsBodies[e].quaternion=t.quaternion.mult(i)}}function ke({chassisBody:e}){return chassis.compoundPosition?position=new CANNON.Vec3(chassis.compoundPosition.x,chassis.compoundPosition.y,chassis.compoundPosition.z):position=new CANNON.Vec3(e.position.x,e.position.y,e.position.z),new CANNON.RaycastVehicle({chassisBody:e,indexForwardAxis:2,indexRightAxis:0,indexUpAxis:1})}function Ue({raycastVehicle:e,position:t}){e.position=new CANNON.Vec3(t.x,t.y,t.z)}function Ge({raycastVehicle:e,quaternion:t}){console.log(\"set quat\"),e.chassisBody.quaternion=new CANNON.Quaternion(t.x,t.y,t.z,t.w)}function We({wheels:e}){if(We)return!0;We=!0;for(let t of e)linkedWheelsBodies.push(void 0),proxiedComposite.addLink(t.body.body,proxiedComposite.vehicles[currentAddress[currentAddress.length-1]].linkedWheelsBodies[linkedWheelsBodies.length-1]);return!0}function qe({raycastVehicle:e,linkedWheelsBodies:t}){if(qe)return!0;for(let e of t)if(!e)return;for(let i=0,n=t.length;i<n;++i){let n=t[i];wheelOptions.chassisConnectionPointLocal=new CANNON.Vec3(n.position.x-position.x,n.position.y-position.y,n.position.z-position.z),wheelOptions.radius=wheels[i].body.dimension.radiusTop,e.addWheel(wheelOptions)}return!0}function Qe({addWheelToVehicle:e,cannon:t}){return ke.addToWorld(t),!0}function Xe({turningLeft:e,turningRight:t,actualInterval:i}){if(!t&&!e)return!1;if(t){let e=steering+i*turningSpeed;e>absMaxSteering&&(e=absMaxSteering),steering=e}if(e){let e=steering-i*turningSpeed;e<-absMaxSteering&&(e=-absMaxSteering),steering=e}}function Ye({headBodiesLoaded:e,buildRoadTrain:t}){return Ye||(mainComposite.loadedObjects.push(e),mainComposite.loadedObjects.push(t)),!0}function Ze({wheelsBodies:e,suspensionsBodies:t,chassisBody:i}){if(Ze)return!0;for(let t of e)if(!t)return;for(let e of t)if(!e)return;return!0}function Je({wheelsInfo:e}){if(Je)return!0;let t=self;wheels=[],wheelsBodies=[],suspensions=[],suspensionsBodies=[],cabinParts=[],gapRatio=.95;let i,n,r,o,a,s,l=position.x,c=position.y,h=position.z,u=new THREE.Quaternion(quaternion.x,quaternion.y,quaternion.z,quaternion.w),p=0,d=0;for(let e of t.wheelsInfo){let o=t.wheels;o.push({});let a=o[o.length-1],s=new THREE.Vector3(e.doubleWheelGap/2+(e.width-e.doubleWheelGap)/4,0,0),f=new THREE.Vector3(e.doubleWheelGap/2+(e.width-e.doubleWheelGap)/4,0,0),m=new THREE.Vector3(e.axelLength,e.radius-e.axelHeight,e.distance);e.left?(i=Math.PI/2,f.x=-f.x):(s.x=-s.x,m.x=-m.x,i=-Math.PI/2),a.localPos=new THREE.Vector3(m.x,m.y,m.z),m.applyQuaternion(u);let g=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,0,1).normalize(),i);a.correctionQuat=new THREE.Quaternion(g.x,g.y,g.z,g.w);let v=new THREE.Quaternion(u.x,u.y,u.z,u.w);v.multiply(g);let y=[],x=e.doubleWheelGap?e.axelDiameter:e.radius;mainComposite.utils.addObject(a),a.set({geometryName:\"cylinder\",dimension:{radiusTop:x,radiusBottom:x,height:.99*e.width},position:{x:l+m.x,y:c+m.y,z:h+m.z},color:e.color,quaternion:new THREE.Quaternion(v.x,v.y,v.z,v.w),materialName:\"basic\",shinines:0,textureFileName:e.textureFileName,materialIndex:[0,1,2],visible:!1,sleep:!0,groupName:\"wheel\",collisionGroups:[\"ground\",\"obstacle\"]}),y.push(a),e.doubleWheelGap&&(f.applyQuaternion(u),s.applyQuaternion(u),f.add(a.position),s.add(a.position),a.wheelIn={},mainComposite.utils.addObject(a.wheelIn),a.wheelIn.set({geometryName:\"cylinder\",dimension:{radiusTop:e.radius,radiusBottom:e.radius,height:(e.width-e.doubleWheelGap)/2},position:{x:f.x,y:f.y,z:f.z},color:e.color,quaternion:new THREE.Quaternion(v.x,v.y,v.z,v.w),materialName:\"lambert\",shinines:0,textureFileName:e.textureFileName,materialIndex:[0,1,2],visible:!1,sleep:!0}),y.push(a.wheelIn),a.wheelOut={},mainComposite.utils.addObject(a.wheelOut),a.wheelOut.set({geometryName:\"cylinder\",dimension:{radiusTop:e.radius,radiusBottom:e.radius,height:(e.width-e.doubleWheelGap)/2},position:{x:s.x,y:s.y,z:s.z},color:e.color,quaternion:new THREE.Quaternion(v.x,v.y,v.z,v.w),materialName:\"lambert\",shinines:0,textureFileName:e.textureFileName,materialIndex:[0,1,2],visible:!1,sleep:!0}),y.push(a.wheelOut));let b=(e.axelLength-e.width/2)*t.gapRatio;mainComposite.utils.makePhysicCompound(y),a.set({angularDamping:e.angularDamping,linearDamping:0,physicMaterial:e.wheelMaterial,mass:e.wheelMass,wheelLeft:e.left,wheelSteering:e.steering,driving:e.engine,stiffness:e.stiffness,damping:e.damping,springLenght:e.springLegth,allowSleep:!1,susLength:b,physicStatus:!1});let w=t.suspensions,M=new THREE.Vector3(e.axelLength-e.width/2-b/2,0,e.distance);e.left||(M.x*=-1),w.push({});let E=w[w.length-1];E.localSusPos=new THREE.Vector3(M.x,M.y,M.z),M.applyQuaternion(u),mainComposite.utils.addObject(E),E.set({geometryName:\"box\",dimension:{height:e.axelDiameter,width:e.axelDiameter,length:b},position:{x:l+M.x,y:c+M.y,z:h+M.z},quaternion:new THREE.Quaternion(u.x,u.y,u.z,u.w),color:e.susColor,materialName:\"basic\",shinines:0,visible:!1,sleep:!0}),mainComposite.utils.addPhysicBody(E),E.set({physicMaterial:e.axelMaterial,mass:e.axelMass,allowSleep:!1,physicStatus:!1,groupName:\"suspension\",collisionGroups:[\"chassis\"]}),e.distance+2*e.axelDiameter>p&&(p=e.distance+2*e.axelDiameter),e.distance-2*e.axelDiameter<d&&(d=e.distance-2*e.axelDiameter),r=2*(e.axelLength-e.radius),(!n||n>r)&&(n=r)}t.chassisWidth||(t.chassisWidth=n),t.chassisFrontLength||(t.chassisFrontLength=p),t.chassisRearLength||(t.chassisRearLength=d),t.chassisLength=t.chassisFrontLength-t.chassisRearLength,Math.abs(chassisFrontLength)<Math.abs(chassisRearLength)?(o=2*Math.abs(t.chassisFrontLength),s=-t.chassisFrontLength+(t.chassisRearLength+t.chassisFrontLength)/2):(o=2*Math.abs(t.chassisRearLength),s=-t.chassisRearLength+(t.chassisRearLength+t.chassisFrontLength)/2),a=t.chassisLength-o,t.chassisTop={},mainComposite.utils.addObject(t.chassisTop);let f=new THREE.Vector3(0,t.axelsVerticalFreedom,(t.chassisFrontLength+t.chassisRearLength)/2);f.applyQuaternion(u),t.chassisTop.set({geometryName:\"box\",dimension:{height:t.chassisLength,width:t.chassisTickness,length:t.chassisWidth},position:{x:l+f.x,y:c+f.y,z:h+f.z},quaternion:new THREE.Quaternion(u.x,u.y,u.z,u.w),color:t.chassisColor,textureFileName:[\"/textures/bed.png\"],materialName:\"lambert\",visible:!1,sleep:!0}),t.chassis={},mainComposite.utils.addObject(t.chassis);let m=new THREE.Vector3(0,-t.axelsVerticalFreedom,0);m.applyQuaternion(u),t.chassis.set({geometryName:\"box\",dimension:{height:o,width:t.chassisTickness,length:t.chassisWidth},position:{x:l+m.x,y:c+m.y,z:h+m.z},quaternion:new THREE.Quaternion(u.x,u.y,u.z,u.w),color:t.chassisColor,textureFileName:[\"/textures/bed.png\"],materialName:\"lambert\",visible:!1,sleep:!0,groupName:\"chassis\",collisionGroups:[\"suspension\",\"obstacle\",\"ground\",\"chassis\"],physicMaterial:\"chassisMaterial\"});let g=[t.chassis,t.chassisTop];if(0!=a){t.chassisExtension={},mainComposite.utils.addObject(t.chassisExtension);let e=new THREE.Vector3(0,-t.axelsVerticalFreedom,s);e.applyQuaternion(u),t.chassisExtension.set({geometryName:\"box\",dimension:{height:a,width:t.chassisTickness,length:t.chassisWidth},position:{x:l+e.x,y:c+e.y,z:h+e.z},quaternion:new THREE.Quaternion(u.x,u.y,u.z,u.w),color:t.chassisColor,textureFileName:[\"/textures/bed.png\"],materialName:\"lambert\",visible:!1,sleep:!0}),g.push(t.chassisExtension)}if(t.cabinInfo)for(let e of cabinInfo){t.cabinParts.push(e);let i=t.cabinParts[t.cabinParts.length-1];mainComposite.utils.addObject(i);let n=new THREE.Vector3(e.localPosition.x,e.localPosition.y,e.localPosition.z),r=new THREE.Quaternion(e.localQuaternion.x,e.localQuaternion.y,e.localQuaternion.z,e.localQuaternion.w);n.applyQuaternion(u),n.add(new THREE.Vector3(l,c,h)),r.multiply(u),i.set({position:n,quaternion:r,visible:!1,sleep:!0}),t.cabinPhysic?g.push(i):(mainComposite.addLink(t.position,i.chassisPos),mainComposite.addLink(t.quaternion,i.chassisQuat),mainComposite.addLink(t.chassis.visible,i.visible),mainComposite.addLink(mainComposite.timeStamp,i.timeStamp),i.addFunction(v))}mainComposite.utils.makePhysicCompound(g),t.chassis.set({mass:t.chassisMass,physicStatus:!1}),mainComposite.addLink(t.chassis.position,t.position),mainComposite.addLink(t.chassis.quaternion,t.quaternion);for(let e=0,i=t.wheels.length;e<i;++e)t.addLink(t.wheels[e].body,t.wheelsBodies[e]),t.addLink(t.suspensions[e].body,t.suspensionsBodies[e]);return t.addLink(t.chassis.body,t.chassisBody),!0;function v({chassisPos:e,chassisQuat:t,mesh:i,timeStamp:n}){let r=new THREE.Vector3(localPosition.x,localPosition.y,localPosition.z),o=new THREE.Quaternion(localQuaternion.x,localQuaternion.y,localQuaternion.z,localQuaternion.w),a=new THREE.Vector3(e.x,e.y,e.z),s=new THREE.Quaternion(t.x,t.y,t.z,t.w);r.applyQuaternion(s),r.add(a),o.multiply(s),i.position.set(r.x,r.y,r.z),i.quaternion.set(o.x,o.y,o.z,o.w)}}function Ke({setConstraint:e}){return Ke||mainComposite.loadedObjects.push(e),!0}function $e({towedRoadTrain:e}){roadTrain.addLink(e.chassis.body,roadTrain.frontTowing.otherBody),roadTrain.addLink(roadTrain.chassis.body,roadTrain.frontTowing.thisBody),roadTrain.addLink(roadTrain.enable,roadTrain.frontTowing.thisEnable),roadTrain.addLink(e.enable,roadTrain.frontTowing.otherEnable)}function et({thisTowingPosition:e,otherTowingPosition:t,thisBody:i,otherBody:n}){if(et)return et;let r=new CANNON.Vec3(e.x,e.y,e.z),o=new CANNON.Vec3(t.x,t.y,t.z);return constraint=new CANNON.PointToPointConstraint(i,r,n,o),constraint}function tt({setConstraint:e,thisEnable:t,otherEnable:i}){return e&&t&&i&&!tt?(roadTrain.cannon.addConstraint(e),!0):(tt&&roadTrain.cannon.removeConstraint(e),!1)}function it(e,t){t.loadedObjects=e.loadedObjects.getProxyLessObject,t.addFunction(nt),t.self=t,t.mainComposite=e,t.cannon=e.cannon,e.addLink(e.actualInterval,t.actualInterval),function(e){e.turningSpeed=Math.PI/6/1.2,e.absMaxSteering=Math.PI/6,e.turningLeft=!1,e.turningRight=!1,e.drivingForward=!0,e.steering=0,e.touchSpan=200,e.addFunction(Xe)}(t),function(e){e.frontTowing={roadTrain:e},e.frontTowing.constraint=void 0,e.frontTowing.mainComposite=e.mainComposite,e.frontTowing.addFunction($e),e.frontTowing.addFunction(et),e.frontTowing.loadedObjects=e.mainComposite.loadedObjects.getProxyLessObject,e.frontTowing.addFunction(Ke),e.frontTowing.addFunction(tt)}(t),function(e){e.wheels=void 0,e.wheelsBodies=void 0,e.suspensions=void 0,e.suspensionsBodies=void 0,e.cabinParts=void 0,e.gapRatio=.95,e.position||(e.position={x:0,y:0,z:0}),e.quaternion||(e.quaternion={x:0,y:0,z:0,w:1}),e.addFunction(Je),e.addFunction(Ze),e.addFunction(Ye)}(t),t.allWheels=[],t.axelSprings=[],t.enable||(t.enable=!1),t.suspensionRestLenght||(t.suspensionRestLenght=0),t.speed||(t.speed=0),t.engineForce||(t.engineForce=30),t.addFunction(ct),t.addFunction(st),t.addFunction(at),t.addFunction(lt),t.addFunction(ot),t.addFunction(rt)}function nt({setHingeConstraints:e}){return nt||mainComposite.loadedObjects.push(self),!0}function rt({resetPos:e,resetQuat:t}){let i=new THREE.Vector3(0,-axelsVerticalFreedom,0);i.applyQuaternion(t),self.chassis.set({position:i.add(e),quaternion:t,reset:!0});for(let i=0,n=allWheels.length;i<n;++i){let n=t.clone(),r=new THREE.Vector3(wheels[i].localPos.x,wheels[i].localPos.y,wheels[i].localPos.z),o=new THREE.Quaternion(wheels[i].correctionQuat.x,wheels[i].correctionQuat.y,wheels[i].correctionQuat.z,wheels[i].correctionQuat.w);r.applyQuaternion(n),r.add(e),n.multiply(o),wheels[i].self.set({position:r,quaternion:n,reset:!0});let a=new THREE.Vector3(suspensions[i].localSusPos.x,suspensions[i].localSusPos.y,suspensions[i].localSusPos.z);n=t.clone(),a.applyQuaternion(n),a.add(e),suspensions[i].self.set({position:a,quaternion:n,reset:!0})}e=void 0,t=void 0}function ot({newPos:e,newQuat:t,setHingeConstraints:i,setNewPos:n}){if(enable)return!1;let r=new THREE.Vector3(0,-axelsVerticalFreedom,0);r.applyQuaternion(new THREE.Quaternion(t.x,t.y,t.z,t.w)),chassisBody.position=new CANNON.Vec3(r.x+e.x,r.y+e.y,r.z+e.z),chassisBody.quaternion=new CANNON.Quaternion(t.x,t.y,t.z,t.w);for(let i=0,n=allWheels.length;i<n;++i){let n=new THREE.Quaternion(t.x,t.y,t.z,t.w),r=new THREE.Vector3(wheels[i].localPos.x,wheels[i].localPos.y,wheels[i].localPos.z),o=new THREE.Quaternion(wheels[i].correctionQuat.x,wheels[i].correctionQuat.y,wheels[i].correctionQuat.z,wheels[i].correctionQuat.w);r.applyQuaternion(n),r.add(e),n.multiply(o),wheels[i].body.position=new CANNON.Vec3(r.x,r.y,r.z),wheels[i].body.quaternion=new CANNON.Quaternion(n.x,n.y,n.z,n.w);let a=new THREE.Vector3(suspensions[i].localSusPos.x,suspensions[i].localSusPos.y,suspensions[i].localSusPos.z);n=new THREE.Quaternion(t.x,t.y,t.z,t.w),a.applyQuaternion(n),a.add(e),suspensions[i].body.position=new CANNON.Vec3(a.x,a.y,a.z),suspensions[i].body.quaternion=new CANNON.Quaternion(n.x,n.y,n.z,n.w)}enable=!0}function at({roadtrainStatus:e,engineForce:t,speed:i}){if(e)for(let e of allWheels)if(e.driving){let n=e.wheelConstraint;0==t?n.disableMotor():(n.setMotorMaxForce(t),e.isLeft?n.setMotorSpeed(i):n.setMotorSpeed(-i),n.enableMotor())}}function st({steering:e,roadtrainStatus:t}){if(t){let t=Math.cos(e),i=Math.sin(e);for(let e of allWheels)e.steering&&(e.isLeft?(e.wheelConstraint.axisA.x=t,e.wheelConstraint.axisA.z=i):(e.wheelConstraint.axisA.x=-t,e.wheelConstraint.axisA.z=-i),e.wheelConstraint.update())}}function lt({setHingeConstraints:e,enable:t}){if(t&&lt)return!0;if(!t&&!lt)return!1;if(t&&!lt){for(let e=0,t=allWheels.length;e<t;++e)self.wheels[e].set({visible:!0,physicStatus:!0,sleep:!1,enableCollisionCallback:!0}),self.suspensions[e].set({visible:!0,physicStatus:!0,sleep:!1,enableCollisionCallback:!0}),cannon.addConstraint(allWheels[e].wheelConstraint),cannon.addConstraint(allWheels[e].suspensionConstraint),allWheels[e].wheelConstraint.rotationalEquation1.setSpookParams(1e10,4,1/120),allWheels[e].wheelConstraint.rotationalEquation2.setSpookParams(1e10,4,1/120),allWheels[e].suspensionConstraint.rotationalEquation1.setSpookParams(1e10,4,1/120),allWheels[e].suspensionConstraint.rotationalEquation2.setSpookParams(1e10,4,1/120);return self.chassis.set({visible:!0,physicStatus:!0,sleep:!1,enableCollisionCallback:!0}),!0}if(!t&&lt){for(let e=0,t=allWheels.length;e<t;++e)self.wheels[e].set({visible:!1,physicStatus:!1,sleep:!0,enableCollisionCallback:!1}),self.suspensions[e].set({visible:!1,physicStatus:!1,sleep:!0,enableCollisionCallback:!1}),cannon.removeConstraint(allWheels[e].wheelConstraint),cannon.removeConstraint(allWheels[e].suspensionConstraint);return self.chassis.set({visible:!1,physicStatus:!1,sleep:!0,enableCollisionCallback:!1}),!1}}function ct({headBodiesLoaded:e,cannon:t}){if(ct)return!0;let i,n,r=new CANNON.Vec3(0,0,0),o=new THREE.Quaternion(chassisBody.quaternion.x,chassisBody.quaternion.y,chassisBody.quaternion.z,chassisBody.quaternion.w).normalize().inverse();for(let e=0,t=wheelsBodies.length;e<t;++e){let t={},a=new THREE.Vector3(wheelsBodies[e].position.x-suspensionsBodies[e].position.x,wheelsBodies[e].position.y-suspensionsBodies[e].position.y,wheelsBodies[e].position.z-suspensionsBodies[e].position.z);a.applyQuaternion(o),wheels[e].wheelLeft&&(t.isLeft=!0,i=new CANNON.Vec3(1,0,0),n=new CANNON.Vec3(0,1,0)),wheels[e].wheelLeft||(t.isLeft=!1,i=new CANNON.Vec3(-1,0,0),n=new CANNON.Vec3(0,1,0)),t.wheelConstraint=new CANNON.HingeConstraint(suspensionsBodies[e],wheelsBodies[e],{pivotA:new CANNON.Vec3(a.x,a.y,a.z),axisA:i,pivotB:r,axisB:n,maxForce:1e6,collideConnected:!1}),t.wheelConstraint.collideConnected=!1,wheels[e].wheelSteering?t.steering=!0:t.steering=!1,wheels[e].driving?t.driving=!0:t.driving=!1;let s=new THREE.Vector3(suspensionsBodies[e].position.x-chassisBody.position.x,suspensionsBodies[e].position.y-chassisBody.position.y,suspensionsBodies[e].position.z-chassisBody.position.z);s.applyQuaternion(o);let l=new THREE.Vector3(-i.x*wheels[e].susLength,0,0),c=new THREE.Vector3(l.x,0,0),h=new THREE.Vector3(c.x+s.x,c.y+s.y,c.z+s.z);t.suspensionConstraint=new CANNON.HingeConstraint(chassisBody,suspensionsBodies[e],{pivotA:new CANNON.Vec3(h.x,h.y,h.z),axisA:new CANNON.Vec3(0,0,1),pivotB:new CANNON.Vec3(l.x,l.y,l.z),axisB:new CANNON.Vec3(0,0,1),maxForce:1e6});let u=new THREE.Vector3(wheelsBodies[e].position.x-chassisBody.position.x,wheelsBodies[e].position.y-chassisBody.position.y,wheelsBodies[e].position.z-chassisBody.position.z);u.applyQuaternion(o),u.y=u.y-wheels[e].springLenght,axelSprings.push(new CANNON.Spring(chassisBody,suspensionsBodies[e],{restLength:suspensionRestLenght,stiffness:wheels[e].stiffness,damping:wheels[e].damping,localAnchorA:new CANNON.Vec3(u.x,u.y,u.z),localAnchorB:a})),allWheels.push(t)}return t.addEventListener(\"postStep\",(function(e){if(lt)for(let e=0,t=axelSprings.length;e<t;++e)axelSprings[e].applyForce()})),!0}const ht=function({timeStamp:e,three:t,activeCamera:i,cannon:n}){t.renderer.render(t.scene,i);let r=actualInterval,o=cannonSafeStep;for(removeBodies.length>0&&n.remove(removeBodies.pop());r>=o;)n.step(o),r-=o;return actualInterval=r,!0};function ut({cameraTransitionPlot:e,newAnimationFrame:t}){let i=cameras.cameraT.camera;if(0==e.length&&null==transitionData)return void(e=void 0);if(activeCamera!=i&&(self.cameras.cameraT.active=!0),null==transitionData){let t=e.shift(),n=t.startCam.getProxyLessObject.camera;transitionData={endCam:t.endCam.getProxyLessObject.camera,proxyEndCam:t.endCam,movingSpeed:t.movingSpeed,rotatingSpeed:t.rotatingSpeed,movingType:t.movingType,rotatingType:t.rotatingType,startTime:timeStamp},i.position.x=n.position.x,i.position.y=n.position.y,i.position.z=n.position.z,i.quaternion.x=n.quaternion.x,i.quaternion.y=n.quaternion.y,i.quaternion.z=n.quaternion.z,i.quaternion.w=n.quaternion.w}let n=(timeStamp-transitionData.startTime)/transitionData.movingSpeed,r=(timeStamp-transitionData.startTime)/transitionData.rotatingSpeed;n=Math.pow(n,transitionData.movingType),r=Math.pow(r,transitionData.rotatingType);let o=i.position,a=i.quaternion;a.slerp(transitionData.endCam.quaternion,n>1?1:n),o.lerp(transitionData.endCam.position,r>1?1:r),o.distanceToSquared(transitionData.endCam.position)<.01&&a.angleTo(transitionData.endCam.quaternion)<.01&&(transitionData.proxyEndCam.active=!0,transitionData=void 0)}function pt({newAnimationFrame:e}){if(startUp)return;let t=cameras.camera3.camera;if(activeCamera!=t&&activeCamera!=cameras.cameraT.camera)return;let i=roadTrains[0].position,n=roadTrains[0].quaternion,r=roadTrains[0].visibleTrailers+1,o=t.position,a=new THREE.Vector3(0,0,-10*r);a.applyQuaternion(n),o.x=a.x+i.x,o.y=a.y+i.y+2+2*r,o.z=a.z+i.z,t.lookAt(new THREE.Vector3(i.x,i.y,i.z))}function dt({newAnimationFrame:e}){if(startUp)return;let t=cameras.camera11.camera;if(activeCamera!=t&&activeCamera!=cameras.cameraT.camera)return;let i=roadTrains[0].position,n=roadTrains[0].quaternion,r=roadTrains[0].visibleTrailers+1,o=t.position,a=new THREE.Vector3(0,0,-10*r);a.applyQuaternion(n),o.x=a.x+i.x,o.y=a.y+i.y+2+2*r,o.z=a.z+i.z,t.lookAt(new THREE.Vector3(i.x,i.y,i.z))}function ft({newAnimationFrame:e}){if(startUp)return;let t=cameras.camera12.camera;if(activeCamera!=t&&activeCamera!=cameras.cameraT.camera)return;let i=roadTrains[0].position,n=roadTrains[0].quaternion,r=roadTrains[0].visibleTrailers+1,o=t.position,a=new THREE.Vector3(0,0,-10*r);a.applyQuaternion(n),o.x=a.x+i.x,o.y=a.y+i.y+2+2*r,o.z=a.z+i.z,t.lookAt(new THREE.Vector3(i.x,i.y,i.z))}function mt({newAnimationFrame:e}){let t=cameras.camera7.camera;if(activeCamera!=t&&activeCamera!=cameras.cameraT.camera)return;let i=roadTrains[0].position,n=roadTrains[0].quaternion,r=t.position,o=new THREE.Vector3(0,4,12);o.applyQuaternion(n),r.x=o.x+i.x,r.y=o.y+i.y,r.z=o.z+i.z,t.lookAt(new THREE.Vector3(i.x,i.y,i.z))}function gt({newAnimationFrame:e}){let t=cameras.camera8.camera;if(activeCamera!=t&&activeCamera!=cameras.cameraT.camera)return;let i=roadTrains[0].position,n=new THREE.Quaternion(roadTrains[0].quaternion.x,roadTrains[0].quaternion.y,roadTrains[0].quaternion.z,roadTrains[0].quaternion.w),r=t.position,o=new THREE.Vector3(2,1.5,-15),a=new THREE.Vector3(2,1.5,12);a.applyQuaternion(n),a.add(i),o.applyQuaternion(n),r.x=o.x+i.x,r.y=o.y+i.y,r.z=o.z+i.z,t.lookAt(new THREE.Vector3(a.x,a.y,a.z))}function vt({newAnimationFrame:e}){let t=cameras.camera9.camera;if(activeCamera!=t&&activeCamera!=cameras.cameraT.camera)return;let i=roadTrains[0].position,n=roadTrains[0].quaternion,r=roadTrains[0].visibleTrailers+1,o=t.position,a=new THREE.Vector3(0,0,-10*r);a.applyQuaternion(n),o.x=a.x+i.x,o.y=-502,o.z=a.z+i.z-10,t.lookAt(new THREE.Vector3(i.x,i.y,i.z))}function yt({newAnimationFrame:e}){let t=cameras.camera10.camera;if(activeCamera!=t&&activeCamera!=cameras.cameraT.camera)return;let i=roadTrains[0].position,n=roadTrains[0].quaternion,r=t.position,o=new THREE.Vector3(0,4,2),a=new THREE.Vector3(0,2,8);a.applyQuaternion(n),a.add(i),o.applyQuaternion(n),r.x=o.x+i.x,r.y=o.y+i.y,r.z=o.z+i.z,t.lookAt(a)}function xt(){let e=[\"/textures/tyreInside.png\",\"/textures/tyreTexture.png\",\"/textures/tyreOutside.png\"],t=16777215,i=[];return i.push({radius:.65,width:.3,axelLength:1.63,axelHeight:.8,axelDiameter:.15,distance:3.1,stiffness:220,damping:60,springLegth:.8,steering:!0,engine:!0,left:!0,wheelMass:1,axelMass:25,textureFileName:e,color:t,susColor:3355443,wheelMaterial:\"frontWheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0}),i.push({radius:.65,width:.3,axelLength:1.63,axelHeight:.8,axelDiameter:.15,distance:3.1,stiffness:220,damping:60,springLegth:.8,steering:!0,engine:!0,left:!1,wheelMass:1,axelMass:25,textureFileName:e,color:t,susColor:3355443,wheelMaterial:\"frontWheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0}),i.push({radius:.65,width:.6+.07,axelLength:1.4,axelHeight:.8,axelDiameter:.15,distance:-1.9,stiffness:170,damping:30,springLegth:.8,steering:!1,engine:!0,left:!0,wheelMass:1,axelMass:25,textureFileName:e,color:t,susColor:3355443,wheelMaterial:\"fakeWheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0,doubleWheelGap:.07}),i.push({radius:.65,width:.6+.07,axelLength:1.4,axelHeight:.8,axelDiameter:.15,distance:-1.9,stiffness:170,damping:30,springLegth:.8,steering:!1,engine:!0,left:!1,wheelMass:1,axelMass:25,textureFileName:e,susColor:3355443,color:t,wheelMaterial:\"fakeWheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0,doubleWheelGap:.07}),i.push({radius:.65,width:.6+.07,axelLength:1.4,axelHeight:.8,axelDiameter:.15,distance:-3.5,stiffness:170,damping:30,springLegth:.8,steering:!1,engine:!0,left:!0,wheelMass:1,axelMass:25,textureFileName:e,susColor:3355443,color:t,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0,doubleWheelGap:.07}),i.push({radius:.65,width:.6+.07,axelLength:1.4,axelHeight:.8,axelDiameter:.15,distance:-3.5,stiffness:170,damping:30,springLegth:.8,steering:!1,engine:!0,left:!1,wheelMass:1,axelMass:25,textureFileName:e,susColor:3355443,color:t,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0,doubleWheelGap:.07}),i}function bt(){let e=[\"/textures/tyreInside.png\",\"/textures/tyreTexture.png\",\"/textures/tyreOutside.png\"],t=[];return t.push({radius:.65,width:.6+.07,axelLength:1.4,axelHeight:.8,axelDiameter:.1,distance:.5,stiffness:70,damping:30,springLegth:.8,steering:!1,engine:!1,left:!0,wheelMass:1,axelMass:5,textureFileName:e,susColor:3355443,color:16777215,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0,doubleWheelGap:.07}),t.push({radius:.65,width:.6+.07,axelLength:1.4,axelHeight:.8,axelDiameter:.1,distance:.5,stiffness:70,damping:30,springLegth:.8,steering:!1,engine:!1,left:!1,wheelMass:1,axelMass:5,textureFileName:e,susColor:3355443,color:16777215,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0,doubleWheelGap:.07}),t.push({radius:.65,width:.6+.07,axelLength:1.4,axelHeight:.8,axelDiameter:.1,distance:-1.5,stiffness:70,damping:30,springLegth:.8,steering:!1,engine:!1,left:!0,wheelMass:1,axelMass:5,textureFileName:e,susColor:3355443,color:16777215,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0,doubleWheelGap:.07}),t.push({radius:.65,width:.6+.07,axelLength:1.4,axelHeight:.8,axelDiameter:.1,distance:-1.5,stiffness:70,damping:30,springLegth:.8,steering:!1,engine:!1,left:!1,wheelMass:1,axelMass:5,textureFileName:e,susColor:3355443,color:16777215,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0,doubleWheelGap:.07}),t}function wt(){let e=[\"/textures/tyreInside.png\",\"/textures/tyreTexture.png\",\"/textures/tyreOutside.png\"],t=[];return t.push({radius:.65,width:.3,axelLength:1.4,axelHeight:.8,axelDiameter:.1,distance:7,stiffness:40,damping:30,springLegth:.8,steering:!1,engine:!1,left:!0,wheelMass:1,axelMass:5,textureFileName:e,susColor:3355443,color:16777215,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0}),t.push({radius:.65,width:.3,axelLength:1.4,axelHeight:.8,axelDiameter:.1,distance:7,stiffness:40,damping:30,springLegth:.8,steering:!1,engine:!1,left:!1,wheelMass:1,axelMass:5,textureFileName:e,susColor:3355443,color:16777215,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0}),t.push({radius:.65,width:.3,axelLength:1.4,axelHeight:.8,axelDiameter:.1,distance:-1.5,stiffness:40,damping:30,springLegth:.8,steering:!1,engine:!1,left:!0,wheelMass:1,axelMass:5,textureFileName:e,susColor:3355443,color:16777215,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0}),t.push({radius:.65,width:.3,axelLength:1.4,axelHeight:.8,axelDiameter:.1,distance:-1.5,stiffness:40,damping:30,springLegth:.8,steering:!1,engine:!1,left:!1,wheelMass:1,axelMass:5,textureFileName:e,susColor:3355443,color:16777215,wheelMaterial:\"wheelMaterial\",axelMaterial:\"objectMaterial\",angularDamping:0}),t}function Mt(){let e=[];return e.push({geometryName:\"box\",dimension:{height:4,width:2,length:2.1},localPosition:new THREE.Vector3(0,1.1,2.6),localQuaternion:new THREE.Quaternion(0,0,0,1),color:16777215,materialName:\"lambert\",textureFileName:[\"/textures/bodyColor.png\",\"/textures/hoodFront.png\"],materialIndex:[0,0,0,0,0,0,0,0,1,1,0,0],groupName:\"cabin\"}),e.push({geometryName:\"box\",dimension:{height:2,width:2.7,length:2.4},localPosition:new THREE.Vector3(0,1.5,1.3),localQuaternion:new THREE.Quaternion(0,0,0,1),color:16777215,materialName:\"lambert\",textureFileName:[\"/textures/cabinLeft.png\",\"/textures/cabinRight.png\",\"/textures/bodyColor.png\",\"/textures/bodyColor.png\",\"/textures/windShield.png\",\"/textures/bodyColor.png\"],materialIndex:[0,0,1,1,3,3,3,3,4,4,3,3]}),e.push({geometryName:\"box\",dimension:{height:.1,width:.5,length:3.4},localPosition:new THREE.Vector3(0,0,-4.35),localQuaternion:new THREE.Quaternion(0,0,0,1),textureFileName:[\"/textures/bodyColor.png\",\"/textures/backLights.png\"],materialIndex:[0,0,0,0,0,0,0,0,0,0,1,1],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"box\",dimension:{height:.52,width:1.2,length:3.4},localPosition:new THREE.Vector3(0,.6,4.15),localQuaternion:new THREE.Quaternion(0,0,0,1),color:16777215,textureFileName:[\"/textures/bodyColor.png\",\"/textures/frontLights.png\"],materialIndex:[0,0,0,0,0,0,0,0,1,1,0,0],materialName:\"lambert\"}),e.push({geometryName:\"box\",dimension:{height:3.2,width:.5,length:.9},localPosition:new THREE.Vector3(1.25,.4,.5),localQuaternion:new THREE.Quaternion(0,0,0,1),color:16777215,textureFileName:[\"/textures/bodyColor.png\"],materialName:\"lambert\"}),e.push({geometryName:\"box\",dimension:{height:3.2,width:.5,length:.9},localPosition:new THREE.Vector3(-1.25,.4,.5),localQuaternion:new THREE.Quaternion(0,0,0,1),textureFileName:[\"/textures/bodyColor.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"box\",dimension:{height:1,width:.1,length:.9},localPosition:new THREE.Vector3(1.25,1.15,3.4),localQuaternion:new THREE.Quaternion(0,0,0,1),color:16777215,textureFileName:[\"/textures/bodyColor.png\"],materialName:\"lambert\"}),e.push({geometryName:\"box\",dimension:{height:1.2,width:.1,length:.9},localPosition:new THREE.Vector3(1.25,.46+.4,2.4),localQuaternion:(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/6),textureFileName:[\"/textures/bodyColor.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"box\",dimension:{height:1,width:.1,length:.9},localPosition:new THREE.Vector3(-1.25,1.15,3.4),localQuaternion:new THREE.Quaternion(0,0,0,1),textureFileName:[\"/textures/bodyColor.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"box\",dimension:{height:1.2,width:.1,length:.9},localPosition:new THREE.Vector3(-1.25,.46+.4,2.4),localQuaternion:(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/6),textureFileName:[\"/textures/bodyColor.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"cylinder\",dimension:{radiusTop:.5,radiusBottom:.5,height:.3},radialSegments:32,cylinderHeightSegments:1,localPosition:new THREE.Vector3(0,.4,-2),localQuaternion:new THREE.Quaternion(0,0,0,1),textureFileName:[\"/textures/fifthWheel.png\",\"/textures/fifthWheelSide.png\",\"/textures/fifthWheel.png\"],materialIndex:[0,1,2],color:16777215,materialName:\"lambert\"}),e}function Et(){let e=[];return e.push({geometryName:\"box\",dimension:{height:.5,width:1,length:2},localPosition:new THREE.Vector3(0,.2,1),localQuaternion:new THREE.Quaternion(0,0,0,1),textureFileName:[\"/textures/bed.png\"],color:16777215,materialName:\"lambert\",groupName:\"cabin\",collisionGroups:[\"obstacle\"]}),e.push({geometryName:\"box\",dimension:{height:.5,width:1,length:2},localPosition:new THREE.Vector3(0,.2,-2),localQuaternion:new THREE.Quaternion(0,0,0,1),textureFileName:[\"/textures/bed.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"cylinder\",dimension:{radiusTop:1.1,radiusBottom:1.1,height:9},localPosition:new THREE.Vector3(0,1.7,3),radialSegments:32,cylinderHeightSegments:1,localQuaternion:(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0).normalize(),-Math.PI/2),textureFileName:[\"/textures/tanker.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"sphere\",dimension:{radius:1.1},localPosition:new THREE.Vector3(0,1.7,-1.5),widthSegments:32,heightSegments:32,localQuaternion:new THREE.Quaternion,textureFileName:[\"/textures/tanker.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"sphere\",dimension:{radius:1.1},localPosition:new THREE.Vector3(0,1.7,7.5),widthSegments:32,heightSegments:32,localQuaternion:new THREE.Quaternion,textureFileName:[\"/textures/tanker.png\"],color:16777215,materialName:\"lambert\"}),e}function _t(){let e=[];return e.push({geometryName:\"cylinder\",dimension:{radiusTop:1.1,radiusBottom:1.1,height:9},localPosition:new THREE.Vector3(0,1.5,3),radialSegments:32,cylinderHeightSegments:1,localQuaternion:(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0).normalize(),-Math.PI/2),textureFileName:[\"/textures/tanker.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"sphere\",dimension:{radius:1.1},localPosition:new THREE.Vector3(0,1.5,-1.5),widthSegments:32,heightSegments:32,localQuaternion:new THREE.Quaternion,textureFileName:[\"/textures/tanker.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"sphere\",dimension:{radius:1.1},localPosition:new THREE.Vector3(0,1.5,7.5),widthSegments:32,heightSegments:32,localQuaternion:new THREE.Quaternion,textureFileName:[\"/textures/tanker.png\"],color:16777215,materialName:\"lambert\"}),e.push({geometryName:\"box\",dimension:{height:5.3,width:.2,length:.2},localPosition:new THREE.Vector3(0,0,10.5),localQuaternion:new THREE.Quaternion(0,0,0,1),textureFileName:[\"/textures/bed.png\"],color:16777215,materialName:\"lambert\"}),e}function St({addTrailer:e}){return St||mainComposite.loadedObjects.push(e),!0}function Tt({visibleTrailers:e,chassisBody:t}){let i=mainComposite.roadTrains;if(e>0&&e<i.length-1&&1==i[e-1].enable&&!i[e].enable){let t=i[e].towingGap,n=i[e].towingRatio,r=e-1,o=i[r].position,a=new THREE.Quaternion(i[r].quaternion.x,i[r].quaternion.y,i[r].quaternion.z,i[r].quaternion.w),s=new THREE.Vector3(0,axelsVerticalFreedom,-t);s.applyQuaternion(a);let l=new THREE.Vector3(o.x+s.x,o.y+s.y,o.z+s.z);i[e].set({newPos:l,newQuat:a,setNewPos:!0}),i[e].frontTowing.set({thisTowingPosition:{x:0,y:0,z:t*(1-n)},otherTowingPosition:{x:0,y:0,z:-t*n},towedRoadTrain:i[r]})}return!0}function At({newAnimationFrame:e,startUp:t}){let i=timeStamp-t,n=cameras.camera3.camera,r=roadTrains[0].position,o=roadTrains[0].quaternion,a=roadTrains[0].visibleTrailers+1,s=n.position,l=i;l>2500&&(l=2500),l=2500*Math.pow(1-l/2500,2);let c=new THREE.Vector3(0,l,-(10+l));c.applyQuaternion(o),s.x=c.x+r.x,s.y=c.y+r.y+2+2*a,s.z=c.z+r.z,n.lookAt(new THREE.Vector3(r.x,r.y,r.z)),i>2500&&(t=void 0,self.activateControls())}function Ct(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=r.clone();s.multiply(i),e.objects=[{}],e.constraints=[],e.parts=[],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"box\",dimension:{height:3,width:3,length:3},position:new THREE.Vector3(0,1.6,0).add(n).applyQuaternion(i).add(t),quaternion:s,textureFileName:[\"/textures/box.jpg\"],color:16777215,materialName:\"lambert\"}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:1,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function Rt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=r.clone();s.multiply(i),e.objects=[{}],e.constraints=[],e.parts=[],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"cylinder\",dimension:{radiusTop:.8,radiusBottom:.8,height:2.2},position:new THREE.Vector3(0,2,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:16777215,materialName:\"lambert\",textureFileName:[\"/textures/barrelTop.jpg\",\"/textures/barrelSide.jpg\",\"/textures/barrelBottom.jpg\"],materialIndex:[0,1,2]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:10,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function Lt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{}],e.constraints=[],e.parts=[{},{},{},{}],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"box\",dimension:{height:.1,width:.8,length:8},position:new THREE.Vector3(0,2,0).add(n).applyQuaternion(i).add(t),quaternion:s,textureFileName:[\"/textures/barrierSide.png\"],color:16777215,materialName:\"basic\"}),a.utils.addObject(e.parts[0]),e.parts[0].set({geometryName:\"box\",textureFileName:[\"/textures/barrierStand.png\"],dimension:{height:.1,width:1.4,length:.8},position:new THREE.Vector3(-3,.9,0).add(n).applyQuaternion(i).add(t),quaternion:s,materialName:\"phong\"}),a.utils.addObject(e.parts[1]),e.parts[1].set({geometryName:\"box\",textureFileName:[\"/textures/barrierStand.png\"],dimension:{height:.1,width:1.4,length:.8},position:new THREE.Vector3(3,.9,0).add(n).applyQuaternion(i).add(t),quaternion:s,materialName:\"phong\"}),a.utils.addObject(e.parts[2]),e.parts[2].set({geometryName:\"box\",textureFileName:[\"/textures/barrierStand.png\"],dimension:{height:.8,width:.2,length:.8},position:new THREE.Vector3(-3,.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,materialName:\"phong\"}),a.utils.addObject(e.parts[3]),e.parts[3].set({geometryName:\"box\",textureFileName:[\"/textures/barrierStand.png\"],dimension:{height:.8,width:.2,length:.8},position:new THREE.Vector3(3,.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,materialName:\"phong\"}),a.utils.makePhysicCompound([e.objects[0],...e.parts]),e.objects[0].set({mass:2,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function Pt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{}],e.constraints=[],e.parts=[{},{}],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"box\",dimension:{height:1,width:.1,length:1},position:new THREE.Vector3(0,.05,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:16777215,textureFileName:[\"/textures/coneBaseSide.png\",\"/textures/coneBaseTop.png\",\"/textures/coneBaseBottom.png\"],materialIndex:[0,0,0,0,1,1,2,2,2,2,0,0],materialName:\"basic\"}),a.utils.addObject(e.parts[0]),e.parts[0].set({geometryName:\"cylinder\",dimension:{radiusTop:.04,radiusBottom:.45,height:1.5},position:new THREE.Vector3(0,.8,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/coneTop.png\",\"/textures/coneSide.png\"],materialIndex:[0,1,0]}),a.utils.makePhysicCompound([e.objects[0],...e.parts]),e.objects[0].set({mass:.5,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function Nt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{}],e.constraints=[],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:2},position:new THREE.Vector3(0,2.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/jupiter.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:300,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function Bt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{}],e.constraints=[],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:1.5},position:new THREE.Vector3(0,1.6,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/earth.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:220,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function zt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{}],e.constraints=[],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:8},position:new THREE.Vector3(0,4.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/venus.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:500,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function Ot(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{}],e.constraints=[],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:2.5},position:new THREE.Vector3(0,2.6,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/mars.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:200,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function Ft(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{}],e.constraints=[],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:3.5},position:new THREE.Vector3(0,3.6,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/mercury.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:600,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function It(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{}],e.constraints=[],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:1},position:new THREE.Vector3(0,1.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/pluto.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:2e3,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function Dt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{}],e.constraints=[],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:1.8},position:new THREE.Vector3(0,1.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/sun.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:500,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"})}function Ht(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{},{}],e.constraints=[{}],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:1.5},position:new THREE.Vector3(0,1.6,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/earth.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[1]),e.objects[1].set({geometryName:\"sphere\",dimension:{radius:.1},position:new THREE.Vector3(0,1.6,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\"}),a.utils.addPhysicBody(e.objects[1]),e.objects[1].set({mass:0,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.newHingeConstraint(e.constraints[0]),e.constraints[0].axisA=new CANNON.Vec3(0,1,0),e.constraints[0].axisB=new CANNON.Vec3(0,1,0),e.constraints[0].set({bodyA:e.objects[1],bodyB:e.objects[0],offsetA:{x:0,y:0,z:0},offsetB:{x:0,y:0,z:0},motor:!0,speed:-1,active:!1})}function jt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{},{}],e.constraints=[{}],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:3},position:new THREE.Vector3(0,3.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/mars.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[1]),e.objects[1].set({geometryName:\"sphere\",dimension:{radius:.1},position:new THREE.Vector3(0,3.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\"}),a.utils.addPhysicBody(e.objects[1]),e.objects[1].set({mass:0,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.newHingeConstraint(e.constraints[0]),e.constraints[0].axisA=new CANNON.Vec3(0,1,0),e.constraints[0].axisB=new CANNON.Vec3(0,1,0),e.constraints[0].set({bodyA:e.objects[1],bodyB:e.objects[0],offsetA:{x:0,y:0,z:0},offsetB:{x:0,y:0,z:0},motor:!0,speed:1,active:!1})}function Vt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{},{}],e.constraints=[{}],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:2},position:new THREE.Vector3(0,2.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/venus.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[1]),e.objects[1].set({geometryName:\"sphere\",dimension:{radius:.1},position:new THREE.Vector3(0,2.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\"}),a.utils.addPhysicBody(e.objects[1]),e.objects[1].set({mass:0,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.newHingeConstraint(e.constraints[0]),e.constraints[0].axisA=new CANNON.Vec3(0,1,0),e.constraints[0].axisB=new CANNON.Vec3(0,1,0),e.constraints[0].set({bodyA:e.objects[1],bodyB:e.objects[0],offsetA:{x:0,y:0,z:0},offsetB:{x:0,y:0,z:0},motor:!0,speed:-2,active:!1})}function kt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{},{}],e.constraints=[{}],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:1.2},position:new THREE.Vector3(0,1.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/jupiter.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[1]),e.objects[1].set({geometryName:\"sphere\",dimension:{radius:.1},position:new THREE.Vector3(0,1.1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\"}),a.utils.addPhysicBody(e.objects[1]),e.objects[1].set({mass:0,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.newHingeConstraint(e.constraints[0]),e.constraints[0].axisA=new CANNON.Vec3(0,1,0),e.constraints[0].axisB=new CANNON.Vec3(0,1,0),e.constraints[0].set({bodyA:e.objects[1],bodyB:e.objects[0],offsetA:{x:0,y:0,z:0},offsetB:{x:0,y:0,z:0},motor:!0,speed:-3,active:!1})}function Ut(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{},{}],e.constraints=[{}],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:2.5},position:new THREE.Vector3(0,2.6,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/mercury.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[1]),e.objects[1].set({geometryName:\"sphere\",dimension:{radius:.1},position:new THREE.Vector3(0,2.6,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\"}),a.utils.addPhysicBody(e.objects[1]),e.objects[1].set({mass:0,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.newHingeConstraint(e.constraints[0]),e.constraints[0].axisA=new CANNON.Vec3(0,1,0),e.constraints[0].axisB=new CANNON.Vec3(0,1,0),e.constraints[0].set({bodyA:e.objects[1],bodyB:e.objects[0],offsetA:{x:0,y:0,z:0},offsetB:{x:0,y:0,z:0},motor:!0,speed:2,active:!1})}function Gt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{},{}],e.constraints=[{}],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:1.3},position:new THREE.Vector3(0,1.4,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/haumea.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[1]),e.objects[1].set({geometryName:\"sphere\",dimension:{radius:.1},position:new THREE.Vector3(0,1.4,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\"}),a.utils.addPhysicBody(e.objects[1]),e.objects[1].set({mass:0,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.newHingeConstraint(e.constraints[0]),e.constraints[0].axisA=new CANNON.Vec3(0,1,0),e.constraints[0].axisB=new CANNON.Vec3(0,1,0),e.constraints[0].set({bodyA:e.objects[1],bodyB:e.objects[0],offsetA:{x:0,y:0,z:0},offsetB:{x:0,y:0,z:0},motor:!0,speed:4,active:!1})}function Wt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{},{},{}],e.constraints=[{},{}],a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:1.5},position:new THREE.Vector3(2,1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/sun.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[1]),e.objects[1].set({geometryName:\"sphere\",dimension:{radius:.7},position:new THREE.Vector3(-4,1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/ceres.jpg\"]}),a.utils.addPhysicBody(e.objects[1]),e.objects[1].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[2]),e.objects[2].set({geometryName:\"sphere\",dimension:{radius:.4},position:new THREE.Vector3(2,1,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\"}),a.utils.addPhysicBody(e.objects[2]),e.objects[2].set({mass:0,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.newHingeConstraint(e.constraints[0]),e.constraints[0].axisA=new CANNON.Vec3(0,1,0),e.constraints[0].axisB=new CANNON.Vec3(0,1,0),e.constraints[0].set({bodyA:e.objects[2],bodyB:e.objects[1],offsetA:{x:0,y:0,z:0},offsetB:{x:6,y:0,z:0},motor:!0,speed:-2,active:!1}),a.utils.newHingeConstraint(e.constraints[1]),e.constraints[1].axisA=new CANNON.Vec3(0,1,0),e.constraints[1].axisB=new CANNON.Vec3(0,1,0),e.constraints[1].set({bodyA:e.objects[0],bodyB:e.objects[2],offsetA:{x:0,y:0,z:0},offsetB:{x:0,y:0,z:0},motor:!0,speed:2,active:!1})}function qt(e,t,i,n=new THREE.Vector3(0,0,0),r=new THREE.Quaternion(0,0,0,1),o){let a=e.getParentComposite,s=new THREE.Quaternion(r.x,r.y,r.z,r.w);s.multiply(i),e.objects=[{},{},{}],e.constraints=[{},{}];a.utils.addObject(e.objects[0]),e.objects[0].set({geometryName:\"sphere\",dimension:{radius:12},position:new THREE.Vector3(0,12,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/jupiter.jpg\"]}),a.utils.addPhysicBody(e.objects[0]),e.objects[0].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[1]),e.objects[1].set({geometryName:\"sphere\",dimension:{radius:1.5},position:new THREE.Vector3(27,12,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\",textureFileName:[\"/textures/haumea.jpg\"]}),a.utils.addPhysicBody(e.objects[1]),e.objects[1].set({mass:100,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.addObject(e.objects[2]),e.objects[2].set({geometryName:\"sphere\",dimension:{radius:11},position:new THREE.Vector3(0,12,0).add(n).applyQuaternion(i).add(t),quaternion:s,color:184549375,materialName:\"basic\"}),a.utils.addPhysicBody(e.objects[2]),e.objects[2].set({mass:0,allowSleep:!0,sleep:!0,physicStatus:!1,visible:o,groupName:\"obstacle\",collisionGroups:[\"wheel\",\"ground\",\"chassis\",\"obstacle\"],physicMaterial:\"objectMaterial\"}),a.utils.newHingeConstraint(e.constraints[0]),e.constraints[0].axisA=new CANNON.Vec3(0,1,0),e.constraints[0].axisB=new CANNON.Vec3(0,1,0),e.constraints[0].set({bodyA:e.objects[2],bodyB:e.objects[1],offsetA:{x:0,y:0,z:0},offsetB:{x:-27,y:0,z:0},motor:!0,speed:-2,active:!1}),a.utils.newHingeConstraint(e.constraints[1]),e.constraints[1].axisA=new CANNON.Vec3(0,1,0),e.constraints[1].axisB=new CANNON.Vec3(0,1,0),e.constraints[1].set({bodyA:e.objects[0],bodyB:e.objects[2],offsetA:{x:0,y:0,z:0},offsetB:{x:0,y:0,z:0},motor:!0,speed:2,active:!1})}function Qt({currentStandingBlock:e}){if(e==Qt)return e;let t=road[e];return t.plot&&null==t.plotRuned&&(t.plotRuned=!0,t.plot(self)),e}function Xt({currentStandingBlock:e}){if(e==Xt)return e;standingTime=0;let t=road[e];t.checkPoint&&(checkPoint.speed=t.checkPoint.speed,checkPoint.camera=t.checkPoint.camera,checkPoint.block=e);let i=e+t.frontVisibleBlocks,n=e+t.rearVisibleBlocks;i>road.length-1&&(i=road.length-1),n<0&&(n=0);let r=e+t.frontActiveBlocks,o=e+t.rearActiveBlocks;r>road.length-1&&(r=road.length-1),o<0&&(o=0);for(let t=n;t<=i;++t)t>=o&&t<=r?null==road[t].active&&(road[t].active=!0,a(t,!0,!0,!1)):t==n||t==i&&t!=e?a(t,!1,!1,!0):a(t,!1,!0,!1);if(0!=road[e].enablingObstacles.length&&road[e].checkPoint)throw console.error(\"checkpoint block cannot be where obstacle enablig will happen\");if(road[e].enablingObstacles)for(let t of road[e].enablingObstacles)s(t,!0,!0,!1);if(road[e].disablingObstacles)for(let t of road[e].disablingObstacles)s(t,!1,!0,!1);return e;function a(e,t,i,n){if(self.road[e].block.set({physicStatus:t,visible:i,sleep:n,enableCollisionCallback:t}),road[e].blockObstacles){let t=road[e].blockObstacles;for(let e of t)for(obj of e.objects)obj.self.set({visible:i})}}function s(e,t,i,n){for(obj of e.objects)obj.self.set({sleep:n,physicStatus:t,visible:i});for(let i of e.constraints)i.self.set({active:t})}}function Yt({newAnimationFrame:e}){let t=4;if(0==roadTrains[0].speed&&(t=10),standingTime+=actualInterval,standingTime>t||cheating){cheating=!1;for(let e=0,t=road.length;e<t;++e){road[e].active=void 0,road[e].plotRuned=void 0,self.road[e].block.set({physicStatus:!1,visible:!1,sleep:!0,enableCollisionCallback:!1});for(let t=0;t<road[e].blockObstacles.length;++t){for(let i of road[e].blockObstacles[t].constraints)i.self.set({active:!1});for(let i=0;i<road[e].blockObstacles[t].objects.length;++i){let n=road[e].blockObstacles[t].objects[i];n.self.set({position:n.iniPos.clone(),quaternion:n.iniQuat.clone(),reset:!0,physicStatus:!1,visible:!1})}}}return!0}}function Zt({performReset:e,newAnimationFrame:t}){if(0==removeBodies.length){let e=new THREE.Vector3(0,2,-7),t=road[checkPoint.block].position.clone(),i=road[checkPoint.block].quaternion,n=new THREE.Vector3(0,1,0).normalize().applyQuaternion(i).normalize();i=(new THREE.Quaternion).setFromAxisAngle(n,Math.PI).multiply(i),e.applyQuaternion(i),t.add(e),roadTrains[0].self.set({resetPos:t.clone(),resetQuat:i,speed:0,steering:0}),checkPoint.camera.active=!0;for(let e=1;e<=roadTrains[0].visibleTrailers;++e){let n=roadTrains[e].towingGap,r=new THREE.Vector3(0,roadTrains[0].axelsVerticalFreedom,-n);r.applyQuaternion(i),t=t.add(r),roadTrains[e].self.set({resetPos:t.clone(),resetQuat:i})}Xt=void 0,self.currentStandingBlock=checkPoint.block,void 0}}const Jt=function(){let e=r();return e.composerConfig({upPropagation:!1}),e.loadedObjects=[],e.three=function(e){let t={};return t.scene=new THREE.Scene,t.renderer=new THREE.WebGLRenderer,t.renderer.shadowMap.enabled=!0,t.renderer.shadowMap.type=THREE.PCFSoftShadowMap,t.renderer.setPixelRatio(window.devicePixelRatio>2?2:window.devicePixelRatio),t.renderer.setSize(window.innerWidth,window.innerHeight),e.loadedObjects.push(t),t}(e),e.activeCamera=void 0,e.collisionGroupsNames=[\"all\"],e.utils={},e.utils.addCamera=function(t){!function(e,t){t.loadedObjects=e.loadedObjects.getProxyLessObject,t.addFunction(o),t.three=e.three.getProxyLessObject,t.mainComposite=e,t.position={x:0,y:0,z:0},t.quaternion={x:0,y:0,z:0,w:0},t.addFunction(a),t.addFunction(h),t.addFunction(s),t.addFunction(l),t.addFunction(u),t.addFunction(c)}(e,t)},e.utils.addLight=function(t){!function(e,t){t.loadedObjects=e.loadedObjects.getProxyLessObject,t.addFunction(X),t.mainComposite=e,t.color=16777215,t.intensity=.5,t.visible=!0,t.position=new THREE.Vector3(0,0,0),t.targetPosition=new THREE.Vector3(0,0,0),t.castShadow=!1,t.shadowMapDarkness=1,t.shadowMapSizeWidth=4096,t.shadowMapSizeHeight=4096,t.shadowCameraNear=.5,t.shadowCameraFar=4096,t.skyColor=16777147,t.groundColor=526368,t.distance=0,t.width=350,t.height=200,t.addFunction($),t.addFunction(ee),t.addFunction(Y),t.addFunction(Z),t.addFunction(K),t.addFunction(J),e.addLink(e.three,t.three)}(e,t)},e.utils.addObject=function(t){p(e,t)},e.utils.addSkyBox=function(t){!function(e,t){t.loadedObjects=e.loadedObjects.getProxyLessObject,t.addFunction(U),t.mainComposite=e,t.scale=1,t.visible=!1,t.WorldPosition={x:0,y:0,z:0},t.filesExtension=\".png\",t.thickness=1,t.geometryName=void 0,t.physicBody=!0,t.components=[],t.selfProxy=t;for(let i=0,n=t.worldFileNames.length;i<n;++i)t.components[i]={},p(e,t.components[i]),R(e,t.components[i]),e.addLink(t.components[i].texture,t[\"texture\"+String(i)]),t.components[i].set({bodyType:\"static\",mass:0,physicMaterial:\"groundMaterial\",geometryName:\"box\",receiveShadow:5==i,sleep:!0,textureFileName:t.textureFilePath+t.worldFileNames[i]+t.filesExtension});t.addFunction(W),t.addFunction(G);for(let i of[\"scale\",\"visible\"])e.addLink(t[i],t.components[0][i],t.components[1][i],t.components[2][i],t.components[3][i],t.components[4][i],t.components[5][i])}(e,t)},e.utils.addPhysicBody=function(t){R(e,t)},e.utils.makePhysicCompound=function(t){!function(e,t){t[0].cannon=e.cannon.getProxyLessObject,t[0].materials=e.physicSettings.materials.getProxyLessObject,t[0].collisionGroupsNames=e.collisionGroupsNames.getProxyLessObject,t[0].mainComposite=e,t[0].self=t[0],t[0].totalConstraints=0,t[0].physicMaterial||(t[0].physicMaterial=\"objectMaterial\"),t[0].linearDamping||(t[0].linearDamping=.15),t[0].angularDamping||(t[0].angularDamping=.15),t[0].cylinderSegments||(t[0].cylinderSegments=16),null==t[0].widthSegments&&(t[0].widthSegments=32),null==t[0].heightSegments&&(t[0].heightSegments=32),null==t[0].radialSegments&&(t[0].radialSegments=32),null==t[0].cylinderHeightSegments&&(t[0].cylinderHeightSegments=1),t[0].allowSleep||(t[0].allowSleep=!1),void 0===t[0].physicStatus&&(t[0].physicStatus=!0),null==t[0].sleep&&(t[0].sleep=!1),null==t[0].timeStamp&&(t[0].timeStamp=0),null==t[0].bodyType&&(t[0].bodyType=\"dynamic\"),null==t[0].groupName&&(t[0].groupName=\"all\"),null==t[0].collisionGroups&&(t[0].collisionGroups=[\"all\"]),t[0].addFunction(H),t[0].addFunction(F),t[0].addFunction(D),t[0].addFunction(k),t[0].addFunction(V),t[0].addFunction(ae),t[0].addFunction(z),t[0].addFunction(N),t[0].addFunction(B),t[0].addFunction(P),t[0].addFunction(j),t[0].addFunction(L),t[0].components=[];for(let i=1,n=t.length;i<n;++i)t[0].components.push(t[i].getProxyLessObject),t[i].cylinderSegments||(t[i].cylinderSegments=16),t[i].addFunction(k),t[i].addFunction(re),t[i].addFunction(oe),t[i].mainComposite=e,e.addLink(t[0].body,t[i].body),e.addLink(t[0].visible,t[i].visible),t[i].cylinderSegments||(t[i].cylinderSegments=16),null==t[i].widthSegments&&(t[i].widthSegments=32),null==t[i].heightSegments&&(t[i].heightSegments=32),null==t[i].radialSegments&&(t[i].radialSegments=32),null==t[i].cylinderHeightSegments&&(t[i].cylinderHeightSegments=1),t[i].compoundBodyShapeNumber=void 0}(e,t)},e.utils.newLockConstraint=function(t){!function(e,t){t.loadedObjects=e.loadedObjects.getProxyLessObject,t.mainComposite=e,e.addLink(e.cannon,t.cannon),t.selfProxy=t,t.self=t,t.constraints=[],t.linkedBodies=[],t.addedIndex=0,t.active=!0,t.maxForce=1e6,t.addFunction(se),t.addFunction(le),t.addFunction(ce)}(e,t)},e.utils.newPointsConstraint=function(t){!function(e,t){t.loadedObjects=e.loadedObjects.getProxyLessObject,t.addFunction(he),t.mainComposite=e,e.addLink(e.cannon,t.cannon),t.selfProxy=t,t.self=t,t.active=!0,t.maxForce=1e6,t.offsetA={x:0,y:0,z:0},t.offsetB={x:0,y:0,z:0},t.addFunction(ue),t.addFunction(pe),t.addFunction(me),t.addFunction(ge),t.addFunction(de),t.addFunction(fe)}(e,t)},e.utils.newDistanceConstraint=function(t){!function(e,t){t.loadedObjects=e.loadedObjects.getProxyLessObject,t.mainComposite=e,t.addFunction(ve),e.addLink(e.cannon,t.cannon),t.selfProxy=t,t.self=t,t.active=!0,t.maxForce=1e6,t.distance=void 0,t.addFunction(ye),t.addFunction(xe),t.addFunction(be),t.addFunction(we)}(e,t)},e.utils.newHingeConstraint=function(t){!function(e,t){t.loadedObjects=e.loadedObjects.getProxyLessObject,t.addFunction(Me),t.mainComposite=e,e.addLink(e.cannon,t.cannon),t.selfProxy=t,t.self=t,t.active=!0,t.maxForce=1e6,t.offsetA={x:0,y:0,z:0},t.offsetB={x:0,y:0,z:0},t.addFunction(Ee),t.addFunction(_e),t.addFunction(Ae),t.addFunction(Ce),t.addFunction(Se),t.addFunction(Te),t.addFunction(Re),t.addFunction(Le)}(e,t)},e.utils.newRigidVehicle=function(t){!function(e,t){e.vehicles[t]={};let i=e.vehicles[t];e.addLink(e.cannon,i.cannon),i.linkedWheelsBodies=[],i.angularDamping=.4,i.position=void 0,i.quaternion=void 0,i.wheelForce=void 0,i.wheelSpeed=void 0,i.addFunction(Pe),i.addFunction(Be),i.addFunction(Fe),i.addFunction(Ie),i.addFunction(De),i.addFunction(ze),i.addFunction(Oe),i.addFunction(Ne)}(e,t)},e.utils.newRayCastVehicle=function(t){!function(e,t){e.vehicles[t]={};let i=e.vehicles[t];e.addLink(e.cannon,i.cannon),e.addLink(e.timeStamp,i.timeStamp),i.linkedWheelsBodies=[],i.angularDamping=.4,i.position=void 0,i.quaternion=void 0,i.wheelOptions={radius:9,directionLocal:new CANNON.Vec3(0,-1,0),suspensionStiffness:43,suspensionRestLength:.18,frictionSlip:1e4,dampingRelaxation:1,dampingCompression:1,maxSuspensionForce:1e4,rollInfluence:0,axleLocal:new CANNON.Vec3(-1,0,0),chassisConnectionPointLocal:new CANNON.Vec3(1,0,1),maxSuspensionTravel:10,customSlidingRotationalSpeed:30,useCustomSlidingRotationalSpeed:!0},i.addFunction(je),i.addFunction(ke),i.addFunction(We),i.addFunction(qe),i.addFunction(Qe),i.addFunction(Ue),i.addFunction(Ge),i.addFunction(Ve),i.addFunction(He)}(e,t)},e.utils.newRoadTrain=function(t){it(e,t)},e.utils.start=q,e.self=e,e.cameras={},e.worlds={},e.lights={},function(e){e.physicSettings={},e.cannon=ie(),e.loadedObjects.push(e.cannon.getProxyLessObject),e.addLink(e.cannon,e.physicSettings.cannon),e.physicSettings.addFunction(ne),e.physicSettings.gravity={x:0,y:-10,z:0},e.physicSettings.materials={},e.physicSettings.contactMaterials=[],e.physicSettings.addFunction(te),e.physicSettings.materials.groundMaterial=new CANNON.Material({name:\"groundMaterial\"}),e.physicSettings.materials.objectMaterial=new CANNON.Material({name:\"objectMaterial\"}),e.physicSettings.materials.wheelMaterial=new CANNON.Material({name:\"wheelMaterial\"}),e.physicSettings.materials.fakeWheelMaterial=new CANNON.Material({name:\"fakeWheelMaterial\"}),e.physicSettings.materials.chassisMaterial=new CANNON.Material({name:\"chassisMaterial\"}),e.physicSettings.materials.frontWheelMaterial=new CANNON.Material({name:\"frontWheelMaterial\"}),e.physicSettings.contactMaterials[0]={material1:\"groundMaterial\",material2:\"objectMaterial\",friction:.4,restitution:.4},e.physicSettings.contactMaterials[1]={material1:\"groundMaterial\",material2:\"wheelMaterial\",friction:1.4,restitution:0},e.physicSettings.contactMaterials[2]={material1:\"objectMaterial\",material2:\"wheelMaterial\",friction:1,restitution:.2},e.physicSettings.contactMaterials[3]={material1:\"objectMaterial\",material2:\"fakeWheelMaterial\",friction:.1,restitution:0},e.physicSettings.contactMaterials[4]={material1:\"groundMaterial\",material2:\"fakeWheelMaterial\",friction:.1,restitution:0},e.physicSettings.contactMaterials[5]={material1:\"objectMaterial\",material2:\"chassisMaterial\",friction:.3,restitution:.2},e.physicSettings.contactMaterials[6]={material1:\"groundMaterial\",material2:\"frontWheelMaterial\",friction:1.7,restitution:0}}(e),e.actualInterval=0,e.running=!1,e.settings=Q,e.addFunction(ht),e.loadedObjects.push(e),e.removeBodies=[],e}();var Kt;Jt.cheating=!1,console.log(Jt),(Kt=Jt).cameras.camera3={},Kt.utils.addCamera(Kt.cameras.camera3),Kt.cameras.camera3.set({cameraFocalLenght:75,cameraNearView:.01,cameraFarView:800,active:!0}),Kt.cameras.camera10={},Kt.utils.addCamera(Kt.cameras.camera10),Kt.cameras.camera10.set({cameraFocalLenght:75,cameraNearView:.01,cameraFarView:800,active:!1}),Kt.cameras.camera7={},Kt.utils.addCamera(Kt.cameras.camera7),Kt.cameras.camera7.set({cameraFocalLenght:75,cameraNearView:.01,cameraFarView:800,active:!1}),Kt.cameras.camera8={},Kt.utils.addCamera(Kt.cameras.camera8),Kt.cameras.camera8.set({cameraFocalLenght:75,cameraNearView:.01,cameraFarView:800,active:!1}),Kt.cameras.camera9={},Kt.utils.addCamera(Kt.cameras.camera9),Kt.cameras.camera9.set({cameraFocalLenght:75,cameraNearView:.01,cameraFarView:800,active:!1}),Kt.cameras.cameraT={},Kt.utils.addCamera(Kt.cameras.cameraT),Kt.cameras.cameraT.set({cameraFocalLenght:75,cameraNearView:.01,cameraFarView:800,active:!1}),Kt.cameras.camera11={},Kt.utils.addCamera(Kt.cameras.camera11),Kt.cameras.camera11.set({cameraFocalLenght:75,cameraNearView:.01,cameraFarView:800,active:!1}),Kt.cameras.camera12={},Kt.utils.addCamera(Kt.cameras.camera12),Kt.cameras.camera12.set({cameraFocalLenght:75,cameraNearView:.01,cameraFarView:800,active:!1}),function(e){e.lights.ambient1={},e.utils.addLight(e.lights.ambient1),e.lights.ambient1.set({lightType:\"ambient\",intensity:.5}),e.lights.directional={},e.utils.addLight(e.lights.directional),e.lights.directional.set({lightType:\"directional\",intensity:.7,position:{x:0,y:500,z:0},targetPosition:new THREE.Vector3(0,0,0)})}(Jt),function(e){let t=e.getProxyLessObject.three.scene,i=new THREE.Geometry;for(let e=0;e<5e3;e++){let e=new THREE.Vector3;e.x=THREE.Math.randFloatSpread(3e3),e.y=THREE.Math.randFloatSpread(1e3),e.z=THREE.Math.randFloatSpread(3e3),i.vertices.push(e)}let n=new THREE.PointsMaterial({color:8947848}),r=new THREE.Points(i,n);t.add(r),e.loadedObjects.push(r)}(Jt),function(e){let t,i,n,r,o,a,s,l,c,h,u,p,d,f,m,g,v=e.getProxyLessObject,y=function(e){let t=Math.PI/16;return[{width:15,length:30,tickness:.8,position:{x:0,y:0,z:0},quaternion:{x:0,y:0,z:0,w:1},color:16777215,materialName:\"lambert\",physicMaterial:\"groundMaterial\",offset:{x:0,y:.01,z:0},textureFileName:[\"/textures/road1.png\",\"/textures/roadTrain.png\"],materialIndex:[0,0,0,0,0,0,0,0,1,1,0,0],frontActiveBlocks:4,rearActiveBlocks:-4,frontVisibleBlocks:9,rearVisibleBlocks:-5},{plot:e=>{e.roadTrains[0].speed=15},up:t,obstacles:[{build:Pt,localPos:{x:-5,y:.4,z:-15},enablingDistance:0,disablingDistance:2}]},{up:t,obstacles:[{build:Pt,localPos:{x:4,y:.4,z:-10},enablingDistance:0,disablingDistance:2}]},{up:t,obstacles:[{build:Bt,localPos:{x:-1,y:5,z:-7},enablingDistance:-2,disablingDistance:1}]},{down:t},{down:t},{down:t},{plot:e=>{e.roadTrains[0].speed=8},down:t,obstacles:[{build:zt,localPos:{x:0,y:18,z:-7},enablingDistance:1,disablingDistance:8}]},{plot:e=>{e.cameraTransitionPlot=[{startCam:e.cameras.camera3,endCam:e.cameras.camera10,movingSpeed:500,movingType:2,rotatingSpeed:500,rotatingType:2},{startCam:e.cameras.camera10,endCam:e.cameras.camera7,movingSpeed:500,movingType:3,rotatingSpeed:500,rotatingType:1}]},frontVisibleBlocks:9,rearVisibleBlocks:-8,obstacles:[{build:Pt,localPos:{x:4,y:.4,z:0},enablingDistance:0,disablingDistance:2},{build:Pt,localPos:{x:-4,y:.4,z:-10},enablingDistance:0,disablingDistance:2}]},{obstacles:[{build:Pt,localPos:{x:0,y:.4,z:10},enablingDistance:0,disablingDistance:2},{build:Pt,localPos:{x:4,y:.4,z:0},enablingDistance:0,disablingDistance:2},{build:Pt,localPos:{x:-4,y:.4,z:-10},enablingDistance:0,disablingDistance:2}]},{uo:t,obstacles:[{build:Pt,localPos:{x:2,y:.4,z:10},enablingDistance:0,disablingDistance:2},{build:Pt,localPos:{x:-5,y:.4,z:0},enablingDistance:0,disablingDistance:2},{build:Pt,localPos:{x:5,y:.4,z:-10},enablingDistance:0,disablingDistance:2}]},{left:2*t,obstacles:[{build:Lt,localPos:{x:4,y:.5,z:10},enablingDistance:0,disablingDistance:2}],plot:e=>{e.cameraTransitionPlot=[{startCam:e.cameras.camera7,endCam:e.cameras.camera3,movingSpeed:1500,movingType:2,rotatingSpeed:1500,rotatingType:1}]}},{obstacles:[{build:Ct,localPos:{x:-5,y:.4,z:0},enablingDistance:-1,disablingDistance:3},{build:Ct,localPos:{x:0,y:.4,z:0},enablingDistance:-1,disablingDistance:3},{build:Ct,localPos:{x:5,y:.4,z:0},enablingDistance:-1,disablingDistance:3},{build:Ct,localPos:{x:-3,y:3.4,z:0},enablingDistance:-1,disablingDistance:3},{build:Ct,localPos:{x:0,y:6.4,z:0},enablingDistance:-1,disablingDistance:3},{build:Ct,localPos:{x:3,y:3.4,z:0},enablingDistance:-1,disablingDistance:3}]},{},{checkPoint:{speed:18,camera:e.cameras.camera3},left:2*t},{plot:e=>{e.roadTrains[0].speed=14},left:2*t},{left:2*t,obstacles:[{build:Lt,localPos:{x:4,y:.6,z:10},enablingDistance:0,disablingDistance:1}]},{left:t,obstacles:[{build:Ht,localPos:{x:-3,y:2,z:10},enablingDistance:-2,disablingDistance:1},{build:Vt,localPos:{x:3,y:2,z:0},enablingDistance:-2,disablingDistance:1},{build:jt,localPos:{x:-3,y:2,z:-10},enablingDistance:-2,disablingDistance:1}]},{textureNumber:0,obstacles:[{build:Pt,localPos:{x:-3,y:.4,z:0},enablingDistance:-1,disablingDistance:1},{build:kt,localPos:{x:-3,y:2,z:10},enablingDistance:-1,disablingDistance:1},{build:Ut,localPos:{x:3,y:2,z:0},enablingDistance:-1,disablingDistance:1},{build:Gt,localPos:{x:-3,y:2,z:-10},enablingDistance:-1,disablingDistance:1}]},{right:2*t,obstacles:[{build:Rt,localPos:{x:-2,y:2,z:0},enablingDistance:0,disablingDistance:2},{build:Rt,localPos:{x:-2,y:.4,z:0},enablingDistance:0,disablingDistance:2},{build:Rt,localPos:{x:0,y:.4,z:0},enablingDistance:0,disablingDistance:2},{build:Rt,localPos:{x:2,y:.4,z:0},enablingDistance:0,disablingDistance:2},{build:Rt,localPos:{x:4,y:.4,z:0},enablingDistance:0,disablingDistance:2}]},{right:2*t,plot:e=>{e.roadTrains[0].speed=20}},{right:2*t,checkPoint:{speed:20,camera:e.cameras.camera11},frontActiveBlocks:6},{right:2*t,plot:e=>{e.framesInterval<25&&(e.roadTrains[0].visibleTrailers<2&&++e.roadTrains[0].visibleTrailers,e.activeCamera==e.cameras.camera3&&(e.cameraTransitionPlot=[{startCam:e.cameras.camera3,endCam:e.cameras.camera11,movingSpeed:3e3,movingType:1,rotatingSpeed:1500,rotatingType:3}]))}},{right:2*t},{up:1*t},{up:1*t,obstacles:[{build:Rt,localPos:{x:-2,y:.4,z:-4},enablingDistance:0,disablingDistance:2},{build:Rt,localPos:{x:4,y:.4,z:4},enablingDistance:0,disablingDistance:2}]},{obstacles:[{build:Rt,localPos:{x:-2,y:.4,z:-3},enablingDistance:0,disablingDistance:2}],up:2*t},{obstacles:[{build:Pt,localPos:{x:4,y:.4,z:0},enablingDistance:0,disablingDistance:-1}]},{obstacles:[{build:Bt,localPos:{x:4,y:50,z:0},enablingDistance:-4,disablingDistance:-1}]},{obstacles:[{build:Ft,localPos:{x:8,y:50,z:0},enablingDistance:-4,disablingDistance:-1}]},{obstacles:[{build:Ot,localPos:{x:2,y:50,z:0},enablingDistance:-4,disablingDistance:-1}]},{obstacles:[{build:Dt,localPos:{x:4,y:50,z:0},enablingDistance:-4,disablingDistance:-1}]},{obstacles:[{build:Lt,localPos:{x:4,y:.4,z:10},enablingDistance:0,disablingDistance:1}],plot:e=>{e.roadTrains[0].speed=20}},{checkPoint:{speed:20,camera:e.cameras.camera11}},{obstacles:[{build:Lt,localPos:{x:-4,y:.4,z:10},enablingDistance:0,disablingDistance:1}]},{obstacles:[{build:Rt,localPos:{x:-3,y:.4,z:-7},enablingDistance:-1,disablingDistance:2},{build:Rt,localPos:{x:3,y:.4,z:7},enablingDistance:-1,disablingDistance:2}]},{obstacles:[{build:qt,localPos:{x:24,y:-8,z:0},enablingDistance:-2,disablingDistance:2},{build:Rt,localPos:{x:-3,y:.4,z:0},enablingDistance:-2,disablingDistance:1},{build:Rt,localPos:{x:-3,y:.4,z:-5},enablingDistance:-2,disablingDistance:1},{build:Rt,localPos:{x:-3,y:.4,z:-8},enablingDistance:-2,disablingDistance:1}]},{obstacles:[{build:It,localPos:{x:4,y:15,z:0},enablingDistance:0,disablingDistance:3}]},{obstacles:[{build:Wt,localPos:{x:-5,y:1,z:0},enablingDistance:-2,disablingDistance:2},{build:Rt,localPos:{x:4,y:.4,z:-10},enablingDistance:-2,disablingDistance:1},{build:Rt,localPos:{x:-4,y:.4,z:10},enablingDistance:-2,disablingDistance:1}]},{down:t,plot:e=>{e.roadTrains[0].speed=25}},{checkPoint:{speed:25,camera:e.cameras.camera11}},{down:t,plot:e=>{e.framesInterval<25&&(e.roadTrains[0].visibleTrailers<2&&++e.roadTrains[0].visibleTrailers,e.activeCamera==e.cameras.camera11&&(e.cameraTransitionPlot=[{startCam:e.cameras.camera11,endCam:e.cameras.camera12,movingSpeed:3e3,movingType:1,rotatingSpeed:1500,rotatingType:3}]))}},{down:t,obstacles:[{build:Ft,localPos:{x:-2,y:15,z:0},enablingDistance:0,disablingDistance:3}]},{},{obstacles:[{build:Nt,localPos:{x:0,y:15,z:0},enablingDistance:0,disablingDistance:3}]},{up:t,obstacles:[{build:Lt,localPos:{x:4,y:.4,z:10},enablingDistance:0,disablingDistance:3}]},{},{left:3*t,offset:{x:0,y:-.05,z:0}},{right:2*t},{right:2*t},{right:2*t},{right:2*t},{right:2*t,obstacles:[{build:Lt,localPos:{x:4,y:.4,z:10},enablingDistance:0,disablingDistance:3},{build:Lt,localPos:{x:4,y:.4,z:-10},enablingDistance:0,disablingDistance:3}]},{},{},{}]}(e);e.road=y,e.checkPoint={block:0,speed:10,camera:e.cameras.camera3};let x=new THREE.Vector3(1,0,0),b=new THREE.Vector3(0,1,0),w=y[0].frontVisibleBlocks;for(let t=0,i=y.length;t<i;++t)e.road[t].block={},e.road[t].enablingObstacles=[],e.road[t].disablingObstacles=[];for(let M=0,E=y.length;M<E;++M){let E=y[M];if(E.active=void 0,void 0!==E.width&&(t=E.width),void 0!==E.length&&(i=E.length),void 0!==E.tickness&&(n=E.tickness),void 0!==E.color&&(a=E.color),void 0!==E.materialName&&(s=E.materialName),void 0!==E.physicMaterial&&(l=E.physicMaterial),void 0!==E.offset&&(c=E.offset),void 0!==E.frontVisibleBlocks?m=E.frontVisibleBlocks:E.frontVisibleBlocks=m,void 0!==E.rearVisibleBlocks?g=E.rearVisibleBlocks:E.rearVisibleBlocks=g,void 0!==E.frontActiveBlocks?d=E.frontActiveBlocks:E.frontActiveBlocks=d,void 0!==E.rearActiveBlocks?f=E.rearActiveBlocks:E.rearActiveBlocks=f,\"textureFileName\"in E?(h=E.textureFileName,p=E.materialIndex,u=void 0):h=void 0,\"textureNumber\"in E?u=E.textureNumber:void 0===u&&void 0===h&&(u=M-1),void 0===E.position){let e,a=y[M-1],s=new THREE.Quaternion(a.quaternion.x,a.quaternion.y,a.quaternion.z,a.quaternion.w);E.up&&(e=(new THREE.Quaternion).setFromAxisAngle(x,E.up)),E.down&&(e=(new THREE.Quaternion).setFromAxisAngle(x,-E.down)),E.left&&(e=(new THREE.Quaternion).setFromAxisAngle(b,E.left)),E.right&&(e=(new THREE.Quaternion).setFromAxisAngle(b,-E.right)),void 0!==e&&s.multiply(e),o=new THREE.Quaternion(s.x,s.y,s.z,s.w),r=E.up||E.down||E.right?new THREE.Vector3(c.x+t/2,c.y-n/2,c.z-i/2).applyQuaternion(o).add(a.leftCorner):new THREE.Vector3(c.x-t/2,c.y-n/2,c.z-i/2).applyQuaternion(o).add(a.rightCorner)}void 0!==E.position&&(r=new THREE.Vector3(E.position.x,E.position.y,E.position.z)),void 0!==E.quaternion&&(o=new THREE.Quaternion(E.quaternion.x,E.quaternion.y,E.quaternion.z,E.quaternion.w)),E.rightCorner=new THREE.Vector3(t/2,n/2,-i/2).applyQuaternion(o).add(r),E.leftCorner=new THREE.Vector3(-t/2,n/2,-i/2).applyQuaternion(o).add(r),E.rearRightCorner=new THREE.Vector3(t/2,n/2,i/2).applyQuaternion(o).add(r),E.rearLeftCorner=new THREE.Vector3(-t/2,n/2,i/2).applyQuaternion(o).add(r),E.bigX=Math.max(E.rightCorner.x,E.leftCorner.x,E.rearRightCorner.x,E.rearLeftCorner.x),E.smallX=Math.min(E.rightCorner.x,E.leftCorner.x,E.rearRightCorner.x,E.rearLeftCorner.x),E.bigZ=Math.max(E.rightCorner.z,E.leftCorner.z,E.rearRightCorner.z,E.rearLeftCorner.z),E.smallZ=Math.min(E.rightCorner.z,E.leftCorner.z,E.rearRightCorner.z,E.rearLeftCorner.z),E.position=r,E.quaternion=o,null!=u&&void 0===h&&(e.addLink(e.road[u].block.texture,e.road[M].block.texture),e.addLink(e.road[u].block.materialIndex,e.road[M].block.materialIndex)),e.utils.addObject(e.road[M].block),e.road[M].block.set({geometryName:\"box\",dimension:{height:i,width:n,length:t},position:r,quaternion:o,color:a,materialName:s,physicMaterial:l,textureFileName:h,materialIndex:p,sleep:!0,physicStatus:0==M,visible:!1}),e.utils.addPhysicBody(e.road[M].block),e.road[M].block.set({mass:0,allowSleep:!0,sleep:!0,groupName:\"ground\",collisionGroups:[\"wheel\",\"obstacle\",\"chassis\"],enableCollisionCallback:!0,collisionCallback:function(t){t.body.collisionFilterGroup==v.roadTrains[0].wheelsBodies[0].collisionFilterGroup&&(M>v.currentStandingBlock||null==v.currentStandingBlock)&&(e.currentStandingBlock=M)}}),e.road[M].blockObstacles=[];let _=e.road[M].blockObstacles;if(null!=E.obstacles)for(let t of E.obstacles){_.push({});let i=_[_.length-1];t.build(i,r,o,t.localPos,t.localQuat,M<=w);for(let e of i.objects)e.iniPos=e.position.clone(),e.iniQuat=e.quaternion.clone();e.road[M+t.enablingDistance].enablingObstacles.push(e.road[M].blockObstacles[_.length-1]),e.road[M+t.disablingDistance].disablingObstacles.push(e.road[M].blockObstacles[_.length-1])}}}(Jt),function(e){e.standingTime=0,e.addFunction(Xt),e.addFunction(Qt),e.addFunction(Yt),e.addFunction(Zt)}(Jt),function(e){let t=0,i=1,n=10,r=(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0).normalize(),Math.PI);e.roadTrains=[],e.roadTrains.push({}),e.utils.newRoadTrain(e.roadTrains[0]),e.roadTrains[0].set({position:{x:t,y:i,z:n},quaternion:new THREE.Quaternion(r.x,r.y,r.z,r.w),axelsVerticalFreedom:.2,chassisTickness:.05,chassisMass:30,chassisFrontLength:4.1,chassisRearLength:-4.3,chassisColor:16777215,wheelsInfo:xt(),cabinInfo:Mt(),cabinPhysic:!0,enable:!0,initialSpeed:7});for(let t=0;t<4;++t){e.roadTrains.push({});let i=e.roadTrains.length-1;e.utils.newRoadTrain(e.roadTrains[i]),e.roadTrains[i].set({position:{x:0,y:0,z:0},quaternion:{x:0,y:0,z:0,w:1},axelsVerticalFreedom:.2,chassisMass:10,chassisTickness:.05,chassisFrontLength:0==t?1.2:8,chassisRearLength:-2,chassisWidth:2,chassisColor:16777215,wheelsInfo:0==t?bt():wt(),cabinInfo:0==t?Et():_t(),towingGap:0==t?10:16,towingRatio:0==t?.4:.18,cabinPhysic:!0})}e.roadTrains[0].addFunction(Tt),e.roadTrains[0].addFunction(St),e.roadTrains[0].visibleTrailers=0,e.loadedObjects.push(e.roadTrains)}(Jt),function(e){e.transitionData=void 0,e.addFunction(pt),e.addFunction(mt),e.addFunction(gt),e.addFunction(vt),e.addFunction(yt),e.addFunction(ut),e.addFunction(dt),e.addFunction(ft)}(Jt),function(e){let t,i=void 0,n=e.roadTrains[0],r=n.touchSpan,o=n.absMaxSteering;function a(e){e.preventDefault();let a=e.changedTouches[0].clientX;t=o*(a-i)/r,t>o&&(t=o),t<-o&&(t=-o),n.steering=t}function s(t){t.preventDefault(),i=t.touches[0].clientX,0==n.speed&&(n.speed=e.checkPoint.speed)}function l(e){e.preventDefault()}function c(t){\"Right\"!=t.key&&\"ArrowRight\"!=t.key||n.turningRight||n.set({turningRight:!0,turningLeft:!1}),\"Left\"!=t.key&&\"ArrowLeft\"!=t.key||n.turningLeft||n.set({turningRight:!1,turningLeft:!0}),\"Up\"!=t.key&&\"ArrowUp\"!=t.key||0==n.speed&&(n.speed=e.checkPoint.speed),\"t\"==t.key&&++n.visibleTrailers,t.preventDefault()}function h(t){\"Right\"!=t.key&&\"ArrowRight\"!=t.key||(n.turningRight=!1),\"Left\"!=t.key&&\"ArrowLeft\"!=t.key||(n.turningLeft=!1),\"c\"==t.key&&(e.set({cheating:!0}),e.checkPoint.block=20,e.checkPoint.speed=20,e.checkPoint.camera=e.cameras.camera3)}e.activateControls=function(){document.addEventListener(\"keydown\",c,!1),document.addEventListener(\"keyup\",h,!1),document.addEventListener(\"touchstart\",s,{passive:!1}),document.addEventListener(\"touchend\",l,{passive:!1}),document.addEventListener(\"touchmove\",a,{passive:!1})}}(Jt),function(e){e.addFunction(At)}(Jt),Jt.utils.start(Jt)}]);","extractedComments":[]}